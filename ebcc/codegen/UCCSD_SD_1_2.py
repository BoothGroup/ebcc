# Code generated by qwick.

import numpy as np
from pyscf import lib
from types import SimpleNamespace
from ebcc.util import pack_2e

def energy(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, **kwargs):
    # Energy
    x0 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x0 += einsum("iajb->jiab", v.aaaa.ovov)
    x0 += einsum("iajb->jiba", v.aaaa.ovov) * -1
    x1 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x1 += einsum("ijab->jiba", t2.aaaa)
    x1 += einsum("ia,jb->ijab", t1.aa, t1.aa)
    e_cc = 0
    e_cc += einsum("ijab,ijab->", x0, x1) * -0.5
    del x0
    del x1
    x2 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x2 += einsum("iajb->jiab", v.bbbb.ovov) * -1
    x2 += einsum("iajb->jiba", v.bbbb.ovov)
    x3 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x3 += einsum("ijab->jiba", t2.bbbb)
    x3 += einsum("ia,jb->ijba", t1.bb, t1.bb) * -1
    e_cc += einsum("ijab,ijba->", x2, x3) * -0.5
    del x2
    del x3
    x4 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x4 += einsum("ijab->ijab", t2.abab)
    x4 += einsum("ia,jb->ijab", t1.aa, t1.bb)
    e_cc += einsum("iajb,ijab->", v.aabb.ovov, x4)
    del x4
    x5 = np.zeros((nbos), dtype=np.float64)
    x5 += einsum("w->w", G)
    x5 += einsum("ia,wia->w", t1.aa, g.aa.bov)
    x5 += einsum("ia,wia->w", t1.bb, g.bb.bov)
    e_cc += einsum("w,w->", s1, x5)
    del x5
    e_cc += einsum("ia,ia->", f.aa.ov, t1.aa)
    e_cc += einsum("ia,ia->", f.bb.ov, t1.bb)
    e_cc += einsum("wia,wia->", g.bb.bov, u11.bb)
    e_cc += einsum("wia,wia->", g.aa.bov, u11.aa)

    return e_cc

def update_amps(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, **kwargs):
    t1new = SimpleNamespace()
    t2new = SimpleNamespace()
    u11new = SimpleNamespace()
    u12new = SimpleNamespace()

    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    # T1, T2, S1, S2, U11 and U12 amplitudes
    x0 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x0 += einsum("ia,jbka->ijkb", t1.aa, v.aaaa.ovov)
    x1 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x1 += einsum("ijka->ijka", x0) * -1
    x1 += einsum("ijka->ikja", x0)
    x156 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x156 += einsum("ia,jkla->jilk", t1.aa, x0)
    x157 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x157 += einsum("ijab,klji->lkab", t2.aaaa, x156)
    x161 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x161 += einsum("ijab->ijab", x157)
    del x157
    x225 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x225 += einsum("ia,jkli->jkla", t1.aa, x156)
    del x156
    x226 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x226 += einsum("ia,jkib->jkab", t1.aa, x225)
    del x225
    x232 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x232 += einsum("ijab->ijab", x226)
    del x226
    x172 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x172 += einsum("ijka->ijka", x0)
    x172 -= einsum("ijka->ikja", x0)
    x264 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x264 += einsum("ijka->jkia", x0)
    x264 += einsum("ijka->kjia", x0) * -1
    del x0
    x1 += einsum("ijka->jika", v.aaaa.ooov)
    x1 += einsum("ijka->jkia", v.aaaa.ooov) * -1
    t1new_aa = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    t1new_aa += einsum("ijab,kijb->ka", t2.aaaa, x1) * -1
    del x1
    x2 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x2 += einsum("iabc->ibac", v.aaaa.ovvv) * -1
    x2 += einsum("iabc->ibca", v.aaaa.ovvv)
    x202 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x202 += einsum("ia,jbca->ijbc", t1.aa, x2)
    t1new_aa += einsum("ijab,icab->jc", t2.aaaa, x2) * -1
    del x2
    x3 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x3 += einsum("ia,jakb->ijkb", t1.aa, v.aabb.ovov)
    x4 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x4 += einsum("ijka->jika", x3)
    x215 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x215 += einsum("ijab,kljb->kila", t2.abab, x3)
    del x3
    x220 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x220 += einsum("ijka->ikja", x215)
    del x215
    x4 += einsum("ijka->ijka", v.aabb.ooov)
    x287 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x287 += einsum("ijab,iklb->kjla", t2.abab, x4)
    x291 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x291 += einsum("ijka->ikja", x287) * -1
    del x287
    x377 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x377 += einsum("wxia,jkia->xwjk", u12.bb, x4)
    t1new_aa += einsum("ijab,ikjb->ka", t2.abab, x4) * -1
    x5 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x5 += einsum("w,wia->ia", s1, g.aa.bov)
    x9 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x9 += einsum("ia->ia", x5)
    x175 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x175 += einsum("ia->ia", x5)
    x300 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x300 += einsum("ia->ia", x5)
    x325 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x325 += einsum("ia->ia", x5)
    x346 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x346 += einsum("ia->ia", x5)
    del x5
    x6 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x6 += einsum("ia,jbia->jb", t1.bb, v.aabb.ovov)
    x9 += einsum("ia->ia", x6)
    x199 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x199 += einsum("ia,ja->ij", t1.aa, x6)
    x200 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x200 += einsum("ij,kjab->ikab", x199, t2.aaaa)
    del x199
    x224 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x224 += einsum("ijab->ijab", x200) * -1
    del x200
    x216 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x216 += einsum("ia,jkba->jkib", x6, t2.aaaa)
    x220 += einsum("ijka->ikja", x216) * -1
    del x216
    x300 += einsum("ia->ia", x6)
    x320 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x320 += einsum("ia->ia", x6)
    del x6
    x7 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x7 += einsum("iajb->jiab", v.aaaa.ovov) * -1
    x7 += einsum("iajb->jiba", v.aaaa.ovov)
    x8 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x8 += einsum("ia,ijba->jb", t1.aa, x7)
    x9 += einsum("ia->ia", x8) * -1
    x320 += einsum("ia->ia", x8) * -1
    del x8
    x321 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x321 += einsum("ia,ib->ab", t1.aa, x320) * -1
    x368 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x368 += einsum("ia,wja->wij", x320, u11.aa)
    del x320
    x369 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x369 += einsum("wia,xij->xwja", u11.aa, x368)
    del x368
    x370 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x370 += einsum("wxia->wxia", x369)
    del x369
    x23 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x23 += einsum("ijab,ikba->jk", t2.aaaa, x7)
    x27 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x27 += einsum("ij->ji", x23) * -1
    x222 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x222 += einsum("ij->ji", x23) * -1
    del x23
    x207 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x207 += einsum("ijab,ijbc->ac", t2.aaaa, x7)
    x209 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x209 += einsum("ab->ab", x207) * -1
    del x207
    x235 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x235 += einsum("ijab,ikca->kjcb", t2.abab, x7)
    x236 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x236 += einsum("ijab->ijab", x235) * -1
    del x235
    x279 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x279 += einsum("ijab,ijcb->ac", t2.aaaa, x7)
    x280 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x280 += einsum("ab->ab", x279) * -1
    x321 += einsum("ab->ab", x279) * -1
    del x279
    x315 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x315 += einsum("wia,ijba->wjb", u11.aa, x7)
    x316 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x316 += einsum("wia->wia", x315) * -1
    x363 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x363 += einsum("wia->wia", x315) * -1
    del x315
    x372 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x372 += einsum("wxia,ijba->wxjb", u12.aa, x7)
    del x7
    x373 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x373 += einsum("wxia->xwia", x372) * -1
    del x372
    x9 += einsum("ia->ia", f.aa.ov)
    x26 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x26 += einsum("ia,ja->ij", t1.aa, x9)
    x27 += einsum("ij->ji", x26)
    del x26
    x268 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x268 += einsum("ia,jkab->jikb", x9, t2.abab)
    x274 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x274 += einsum("ijka->jika", x268)
    del x268
    x377 += einsum("ia,wxja->xwij", x9, u12.aa)
    t1new_bb = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    t1new_bb += einsum("ia,ijab->jb", x9, t2.abab)
    x10 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x10 -= einsum("ijab->jiab", t2.aaaa)
    x10 += einsum("ijab->jiba", t2.aaaa)
    x173 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x173 += einsum("ijab,kilb->klja", x10, x172)
    del x172
    x178 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x178 += einsum("ijka->jika", x173)
    del x173
    x185 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x185 += einsum("wia,ijba->wjb", g.aa.bov, x10)
    x187 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x187 -= einsum("wia->wia", x185)
    del x185
    t1new_aa += einsum("ia,ijba->jb", x9, x10) * -1
    del x9
    x11 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x11 += einsum("w,wia->ia", s1, g.bb.bov)
    x15 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x15 += einsum("ia->ia", x11)
    x73 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x73 += einsum("ia->ia", x11)
    x301 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x301 += einsum("ia->ia", x11)
    x335 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x335 += einsum("ia->ia", x11)
    x382 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x382 += einsum("ia->ia", x11)
    del x11
    x12 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x12 += einsum("ia,iajb->jb", t1.aa, v.aabb.ovov)
    x15 += einsum("ia->ia", x12)
    x125 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x125 += einsum("ia,jkba->jkib", x12, t2.bbbb)
    x128 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x128 += einsum("ijka->ikja", x125) * -1
    del x125
    x139 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x139 += einsum("ia,ja->ij", t1.bb, x12)
    x140 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x140 += einsum("ij->ij", x139)
    del x139
    x301 += einsum("ia->ia", x12)
    x330 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x330 += einsum("ia->ia", x12)
    del x12
    x13 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x13 += einsum("iajb->jiab", v.bbbb.ovov) * -1
    x13 += einsum("iajb->jiba", v.bbbb.ovov)
    x14 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x14 += einsum("ia,ijba->jb", t1.bb, x13)
    x15 += einsum("ia->ia", x14) * -1
    x330 += einsum("ia->ia", x14) * -1
    del x14
    x331 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x331 += einsum("ia,ib->ab", t1.bb, x330) * -1
    x404 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x404 += einsum("ia,wja->wij", x330, u11.bb)
    del x330
    x405 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x405 += einsum("wij->wji", x404)
    del x404
    x135 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x135 += einsum("ijab,ikab->kj", t2.bbbb, x13)
    x137 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x137 += einsum("ij->ij", x135) * -1
    del x135
    x276 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x276 += einsum("ijab,ijcb->ca", t2.bbbb, x13)
    x277 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x277 += einsum("ab->ba", x276) * -1
    x331 += einsum("ab->ba", x276) * -1
    del x276
    x318 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x318 += einsum("wia,ijba->wjb", u11.bb, x13)
    x319 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x319 += einsum("wia->wia", x318) * -1
    x408 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x408 += einsum("wia,xja->xwji", u11.bb, x318) * -1
    x409 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x409 += einsum("wxij->xwji", x408)
    del x408
    x411 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x411 += einsum("ia,wja->wji", t1.bb, x318) * -1
    del x318
    x412 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x412 += einsum("wia,xij->xwja", u11.bb, x411)
    del x411
    x413 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x413 += einsum("wxia->xwia", x412)
    del x412
    x375 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x375 += einsum("wxia,ijba->wxjb", u12.bb, x13)
    x376 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x376 += einsum("wxia->xwia", x375) * -1
    del x375
    x15 += einsum("ia->ia", f.bb.ov)
    x53 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x53 += einsum("ia,ja->ij", t1.bb, x15)
    x54 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x54 += einsum("ij->ji", x53)
    del x53
    x288 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x288 += einsum("ia,jkba->jkib", x15, t2.abab)
    x291 += einsum("ijka->ikja", x288)
    del x288
    x416 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x416 += einsum("ia,wxja->xwij", x15, u12.bb)
    t1new_aa += einsum("ia,jiba->jb", x15, t2.abab)
    x16 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x16 += einsum("iabj->ijba", v.aaaa.ovvo)
    x16 -= einsum("ijab->ijab", v.aaaa.oovv)
    x177 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x177 += einsum("ia,jkba->ijkb", t1.aa, x16)
    x178 -= einsum("ijka->jika", x177)
    del x177
    t1new_aa += einsum("ia,ijba->jb", t1.aa, x16)
    u11new_aa = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    u11new_aa += einsum("wia,ijba->wjb", u11.aa, x16)
    x17 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x17 += einsum("ia,wja->wji", t1.aa, g.aa.bov)
    x18 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x18 += einsum("wij->wij", x17)
    del x17
    x18 += einsum("wij->wij", g.aa.boo)
    x186 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x186 += einsum("ia,wij->wja", t1.aa, x18)
    x187 -= einsum("wia->wia", x186)
    del x186
    t1new_aa -= einsum("wia,wij->ja", u11.aa, x18)
    u11new_aa -= einsum("wij,wxia->xja", x18, u12.aa)
    del x18
    x19 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x19 += einsum("w,wij->ij", s1, g.aa.boo)
    x27 += einsum("ij->ij", x19)
    x181 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x181 += einsum("ij->ji", x19)
    del x19
    x20 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x20 += einsum("wia,wja->ij", g.aa.bov, u11.aa)
    x27 += einsum("ij->ij", x20)
    x194 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x194 += einsum("ij->ij", x20)
    del x20
    x21 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x21 += einsum("ia,jkia->jk", t1.bb, v.aabb.ooov)
    x27 += einsum("ij->ij", x21)
    x194 += einsum("ij->ij", x21)
    del x21
    x195 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x195 += einsum("ij,ikab->jkab", x194, t2.aaaa)
    del x194
    x196 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x196 -= einsum("ijab->jiba", x195)
    del x195
    x22 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x22 += einsum("ijab,kajb->ik", t2.abab, v.aabb.ovov)
    x27 += einsum("ij->ji", x22)
    x222 += einsum("ij->ji", x22)
    del x22
    x24 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x24 += einsum("ijka->ikja", v.aaaa.ooov) * -1
    x24 += einsum("ijka->kija", v.aaaa.ooov)
    x25 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x25 += einsum("ia,jika->jk", t1.aa, x24)
    x27 += einsum("ij->ij", x25) * -1
    x222 += einsum("ij->ij", x25) * -1
    del x25
    x223 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x223 += einsum("ij,ikab->jkab", x222, t2.aaaa)
    del x222
    x224 += einsum("ijab->jiba", x223)
    del x223
    x326 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x326 += einsum("wia,jika->wjk", u11.aa, x24) * -1
    del x24
    x27 += einsum("ij->ij", f.aa.oo)
    x293 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x293 += einsum("ij,ikab->jkab", x27, t2.abab)
    t2new_abab = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    t2new_abab += einsum("ijab->ijab", x293) * -1
    t2new_baba = np.zeros((nocc[1], nocc[0], nvir[1], nvir[0]), dtype=np.float64)
    t2new_baba += einsum("ijab->jiba", x293) * -1
    del x293
    t1new_aa += einsum("ia,ij->ja", t1.aa, x27) * -1
    u11new_aa += einsum("ij,wia->wja", x27, u11.aa) * -1
    u12new_aa = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    u12new_aa += einsum("ij,wxia->xwja", x27, u12.aa) * -1
    del x27
    x28 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x28 += einsum("w,wab->ab", s1, g.aa.bvv)
    x32 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x32 += einsum("ab->ab", x28)
    x189 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x189 += einsum("ab->ab", x28)
    x280 += einsum("ab->ab", x28)
    x321 += einsum("ab->ab", x28)
    del x28
    x29 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x29 += einsum("ia,iabc->bc", t1.bb, v.bbaa.ovvv)
    x32 += einsum("ab->ab", x29)
    x192 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x192 -= einsum("ab->ba", x29)
    x280 += einsum("ab->ab", x29)
    x321 += einsum("ab->ab", x29)
    del x29
    x30 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x30 += einsum("iabc->ibac", v.aaaa.ovvv)
    x30 += einsum("iabc->ibca", v.aaaa.ovvv) * -1
    x31 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x31 += einsum("ia,ibca->bc", t1.aa, x30)
    x32 += einsum("ab->ab", x31) * -1
    x280 += einsum("ab->ab", x31) * -1
    x321 += einsum("ab->ab", x31) * -1
    del x31
    x208 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x208 += einsum("ia,ibac->bc", t1.aa, x30)
    del x30
    x209 += einsum("ab->ab", x208) * -1
    del x208
    x32 += einsum("ab->ab", f.aa.vv)
    t1new_aa += einsum("ia,ba->ib", t1.aa, x32)
    del x32
    x33 = np.zeros((nbos), dtype=np.float64)
    x33 += einsum("ia,wia->w", t1.aa, g.aa.bov)
    x35 = np.zeros((nbos), dtype=np.float64)
    x35 += einsum("w->w", x33)
    del x33
    x34 = np.zeros((nbos), dtype=np.float64)
    x34 += einsum("ia,wia->w", t1.bb, g.bb.bov)
    x35 += einsum("w->w", x34)
    del x34
    x35 += einsum("w->w", G)
    t1new_aa += einsum("w,wia->ia", x35, u11.aa)
    t1new_bb += einsum("w,wia->ia", x35, u11.bb)
    s1new = np.zeros((nbos), dtype=np.float64)
    s1new += einsum("w,wx->x", x35, s2)
    u11new_aa += einsum("w,wxia->xia", x35, u12.aa)
    u11new_bb = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    u11new_bb += einsum("w,wxia->xia", x35, u12.bb)
    del x35
    x36 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x36 += einsum("ia,jbka->ijkb", t1.bb, v.bbbb.ovov)
    x37 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x37 += einsum("ijka->ijka", x36)
    x37 += einsum("ijka->ikja", x36) * -1
    x69 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x69 += einsum("ijka->ijka", x36)
    x69 -= einsum("ijka->ikja", x36)
    x102 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x102 += einsum("ia,jkla->jilk", t1.bb, x36)
    x103 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x103 += einsum("ijab,klij->lkba", t2.bbbb, x102)
    x107 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x107 += einsum("ijab->ijab", x103)
    del x103
    x143 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x143 += einsum("ia,jkli->jkla", t1.bb, x102)
    del x102
    x144 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x144 += einsum("ia,jkib->jkab", t1.bb, x143)
    del x143
    x148 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x148 += einsum("ijab->ijab", x144)
    del x144
    x284 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x284 += einsum("ijka->jkia", x36)
    x284 += einsum("ijka->kjia", x36) * -1
    del x36
    x37 += einsum("ijka->jika", v.bbbb.ooov) * -1
    x37 += einsum("ijka->jkia", v.bbbb.ooov)
    t1new_bb += einsum("ijab,kjib->ka", t2.bbbb, x37) * -1
    del x37
    x38 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x38 += einsum("iabc->ibac", v.bbbb.ovvv) * -1
    x38 += einsum("iabc->ibca", v.bbbb.ovvv)
    x57 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x57 += einsum("ia,ibac->bc", t1.bb, x38)
    x58 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x58 += einsum("ab->ab", x57) * -1
    x277 += einsum("ab->ab", x57) * -1
    x331 += einsum("ab->ab", x57) * -1
    del x57
    x115 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x115 += einsum("ia,jbca->ijbc", t1.bb, x38)
    t1new_bb += einsum("ijab,icab->jc", t2.bbbb, x38) * -1
    del x38
    x39 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x39 += einsum("ia,jbka->jikb", t1.bb, v.aabb.ovov)
    x40 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x40 += einsum("ijka->ikja", x39)
    x124 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x124 += einsum("ijab,ikla->kjlb", t2.abab, x39)
    x128 += einsum("ijka->ikja", x124)
    del x124
    x255 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x255 += einsum("ijka->ikja", x39)
    del x39
    x40 += einsum("iajk->ijka", v.aabb.ovoo)
    x267 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x267 += einsum("ijab,kjla->iklb", t2.abab, x40)
    x274 += einsum("ijka->jika", x267) * -1
    del x267
    x269 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x269 += einsum("ia,jkla->ijkl", t1.aa, x40)
    x270 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x270 += einsum("ijkl->jikl", x269)
    del x269
    x416 += einsum("wxia,ijka->xwjk", u12.aa, x40)
    t1new_bb += einsum("ijab,ijka->kb", t2.abab, x40) * -1
    x41 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x41 += einsum("ijab->jiab", t2.bbbb)
    x41 += einsum("ijab->jiba", t2.bbbb) * -1
    x116 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x116 += einsum("ijab,jkbc->ikac", x115, x41) * -1
    del x115
    x142 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x142 += einsum("ijab->ijba", x116) * -1
    del x116
    x239 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x239 += einsum("ijab,ikbc->jkac", x13, x41)
    del x13
    x241 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x241 += einsum("ijab->ijba", x239)
    del x239
    t1new_bb += einsum("ia,ijba->jb", x15, x41)
    del x15
    x42 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x42 += einsum("iabj->ijba", v.bbbb.ovvo)
    x42 -= einsum("ijab->ijab", v.bbbb.oovv)
    x75 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x75 += einsum("ia,jkba->ijkb", t1.bb, x42)
    x76 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x76 -= einsum("ijka->jika", x75)
    del x75
    t1new_bb += einsum("ia,ijba->jb", t1.bb, x42)
    u11new_bb += einsum("wia,ijba->wjb", u11.bb, x42)
    x43 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x43 += einsum("ia,wja->wji", t1.bb, g.bb.bov)
    x44 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x44 += einsum("wij->wij", x43)
    del x43
    x44 += einsum("wij->wij", g.bb.boo)
    x84 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x84 += einsum("ia,wij->wja", t1.bb, x44)
    x85 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x85 -= einsum("wia->wia", x84)
    del x84
    t1new_bb -= einsum("wia,wij->ja", u11.bb, x44)
    u11new_bb -= einsum("wij,wxia->xja", x44, u12.bb)
    del x44
    x45 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x45 += einsum("w,wij->ij", s1, g.bb.boo)
    x54 += einsum("ij->ij", x45)
    x79 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x79 += einsum("ij->ji", x45)
    del x45
    x46 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x46 += einsum("wia,wja->ij", g.bb.bov, u11.bb)
    x54 += einsum("ij->ij", x46)
    x92 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x92 += einsum("ij->ij", x46)
    del x46
    x47 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x47 += einsum("ia,iajk->jk", t1.aa, v.aabb.ovoo)
    x54 += einsum("ij->ij", x47)
    x92 += einsum("ij->ij", x47)
    del x47
    x93 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x93 += einsum("ij,ikab->jkab", x92, t2.bbbb)
    del x92
    x94 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x94 -= einsum("ijab->jiba", x93)
    del x93
    x48 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x48 += einsum("ijab,iakb->jk", t2.abab, v.aabb.ovov)
    x54 += einsum("ij->ji", x48)
    x140 += einsum("ij->ij", x48)
    del x48
    x141 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x141 += einsum("ij,jkab->ikab", x140, t2.bbbb)
    del x140
    x142 += einsum("ijab->ijba", x141) * -1
    del x141
    x49 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x49 += einsum("iajb->jiab", v.bbbb.ovov)
    x49 += einsum("iajb->jiba", v.bbbb.ovov) * -1
    x50 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x50 += einsum("ijab,ikab->jk", t2.bbbb, x49)
    x54 += einsum("ij->ji", x50) * -1
    del x50
    x130 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x130 += einsum("ijab,ijcb->ac", t2.bbbb, x49)
    del x49
    x133 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x133 += einsum("ab->ab", x130) * -1
    del x130
    x51 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x51 += einsum("ijka->ikja", v.bbbb.ooov) * -1
    x51 += einsum("ijka->kija", v.bbbb.ooov)
    x52 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x52 += einsum("ia,jika->jk", t1.bb, x51)
    x54 += einsum("ij->ij", x52) * -1
    del x52
    x336 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x336 += einsum("wia,jika->wjk", u11.bb, x51) * -1
    del x51
    x54 += einsum("ij->ij", f.bb.oo)
    x294 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x294 += einsum("ij,kiab->kjab", x54, t2.abab)
    t2new_abab += einsum("ijab->ijab", x294) * -1
    t2new_baba += einsum("ijab->jiba", x294) * -1
    del x294
    t1new_bb += einsum("ia,ij->ja", t1.bb, x54) * -1
    u11new_bb += einsum("ij,wia->wja", x54, u11.bb) * -1
    u12new_bb = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    u12new_bb += einsum("ij,wxia->xwja", x54, u12.bb) * -1
    del x54
    x55 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x55 += einsum("w,wab->ab", s1, g.bb.bvv)
    x58 += einsum("ab->ab", x55)
    x87 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x87 += einsum("ab->ab", x55)
    x277 += einsum("ab->ab", x55)
    x331 += einsum("ab->ab", x55)
    del x55
    x56 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x56 += einsum("ia,iabc->bc", t1.aa, v.aabb.ovvv)
    x58 += einsum("ab->ab", x56)
    x90 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x90 -= einsum("ab->ba", x56)
    x277 += einsum("ab->ab", x56)
    x331 += einsum("ab->ab", x56)
    del x56
    x58 += einsum("ab->ab", f.bb.vv)
    t1new_bb += einsum("ia,ba->ib", t1.bb, x58)
    del x58
    x59 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x59 += einsum("ia,bjca->ijbc", t1.bb, v.bbbb.vovv)
    x94 -= einsum("ijab->ijab", x59)
    del x59
    x60 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x60 += einsum("ijab,iack->jkbc", t2.abab, v.aabb.ovvo)
    x94 += einsum("ijab->ijab", x60)
    del x60
    x61 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x61 += einsum("ia,jbca->jibc", t1.bb, v.aabb.ovvv)
    x62 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x62 += einsum("ijab,ikac->kjbc", t2.abab, x61)
    x94 -= einsum("ijab->ijab", x62)
    del x62
    x236 += einsum("ijab->ijab", x61)
    x272 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x272 += einsum("ijab->ijab", x61)
    x415 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x415 += einsum("ijab->ijab", x61)
    del x61
    x63 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x63 -= einsum("ijab->jiab", t2.bbbb)
    x63 += einsum("ijab->jiba", t2.bbbb)
    x64 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x64 += einsum("ijab,ikcb->kjca", x42, x63)
    del x42
    x94 -= einsum("ijab->ijab", x64)
    del x64
    x70 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x70 += einsum("ijab,kilb->jkla", x63, x69)
    del x69
    x76 += einsum("ijka->kjia", x70)
    del x70
    x83 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x83 += einsum("wia,ijba->wjb", g.bb.bov, x63)
    x85 -= einsum("wia->wia", x83)
    del x83
    x65 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x65 += einsum("iajb->jiab", v.bbbb.ovov)
    x65 -= einsum("iajb->jiba", v.bbbb.ovov)
    x66 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x66 += einsum("ijab,ikbc->kjca", t2.bbbb, x65)
    x67 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x67 -= einsum("ijab,ikac->kjcb", t2.bbbb, x66)
    x94 -= einsum("ijab->jiba", x67)
    del x67
    x147 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x147 -= einsum("ijab,ikbc->kjca", t2.bbbb, x66)
    del x66
    x148 += einsum("ijab->jiba", x147)
    del x147
    x145 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x145 += einsum("ijab,ikac->kjcb", t2.bbbb, x65)
    del x65
    x146 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x146 -= einsum("ijab,ikac->kjcb", t2.bbbb, x145)
    del x145
    x148 += einsum("ijab->ijab", x146)
    del x146
    t2new_bbbb = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    t2new_bbbb += einsum("ijab->ijab", x148)
    t2new_bbbb -= einsum("ijab->ijba", x148)
    del x148
    x68 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x68 += einsum("ijab,iakl->jklb", t2.abab, v.aabb.ovoo)
    x76 += einsum("ijka->jika", x68)
    del x68
    x71 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x71 -= einsum("iajb->jiab", v.bbbb.ovov)
    x71 += einsum("iajb->jiba", v.bbbb.ovov)
    x72 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x72 += einsum("ia,ijba->jb", t1.bb, x71)
    x73 -= einsum("ia->ia", x72)
    x301 -= einsum("ia->ia", x72)
    del x72
    x230 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x230 += einsum("ijab,jkcb->ikac", t2.abab, x71)
    x231 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x231 -= einsum("ijab,kjcb->kica", t2.abab, x230)
    del x230
    x232 += einsum("ijab->ijab", x231)
    del x231
    x312 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x312 -= einsum("wia,ijba->wjb", u11.bb, x71)
    del x71
    s2new = np.zeros((nbos, nbos), dtype=np.float64)
    s2new += einsum("wia,xia->xw", u11.bb, x312)
    del x312
    x73 += einsum("ia->ia", f.bb.ov)
    x74 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x74 += einsum("ia,jkab->ijkb", x73, t2.bbbb)
    x76 += einsum("ijka->ikja", x74)
    del x74
    x78 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x78 += einsum("ia,ja->ji", t1.bb, x73)
    del x73
    x79 += einsum("ij->ji", x78)
    del x78
    x76 -= einsum("ijak->ijka", v.bbbb.oovo)
    x77 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x77 += einsum("ia,ijkb->jkba", t1.bb, x76)
    del x76
    x94 += einsum("ijab->ijba", x77)
    del x77
    x79 += einsum("ij->ji", f.bb.oo)
    x80 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x80 += einsum("ij,jkab->ikab", x79, t2.bbbb)
    del x79
    x94 += einsum("ijab->ijba", x80)
    del x80
    x81 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x81 += einsum("ia,wba->wib", t1.bb, g.bb.bvv)
    x85 += einsum("wia->wia", x81)
    del x81
    x82 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x82 += einsum("wia,ijab->wjb", g.aa.bov, t2.abab)
    x85 += einsum("wia->wia", x82)
    del x82
    x85 += einsum("wai->wia", g.bb.bvo)
    x86 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x86 += einsum("wia,wjb->jiba", u11.bb, x85)
    x94 += einsum("ijab->ijab", x86)
    del x86
    x295 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x295 += einsum("wia,wjb->ijab", u11.aa, x85)
    del x85
    t2new_abab += einsum("ijab->ijab", x295)
    t2new_baba += einsum("ijab->jiba", x295)
    del x295
    x87 += einsum("ab->ab", f.bb.vv)
    x88 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x88 += einsum("ab,ijbc->ijac", x87, t2.bbbb)
    del x87
    x94 -= einsum("ijab->jiab", x88)
    del x88
    x89 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x89 += einsum("wia,wib->ab", g.bb.bov, u11.bb)
    x90 += einsum("ab->ab", x89)
    x91 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x91 += einsum("ab,ijac->ijbc", x90, t2.bbbb)
    del x90
    x94 -= einsum("ijab->jiba", x91)
    del x91
    t2new_bbbb += einsum("ijab->ijab", x94)
    t2new_bbbb -= einsum("ijab->ijba", x94)
    t2new_bbbb -= einsum("ijab->jiab", x94)
    t2new_bbbb += einsum("ijab->jiba", x94)
    del x94
    x277 += einsum("ab->ba", x89) * -1
    x331 += einsum("ab->ba", x89) * -1
    del x89
    x95 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x95 += einsum("ijab,ikjl->lkba", t2.bbbb, v.bbbb.oooo)
    x97 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x97 += einsum("ijab->jiba", x95)
    del x95
    x96 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x96 += einsum("ijab,cbda->ijdc", t2.bbbb, v.bbbb.vvvv)
    x97 += einsum("ijab->jiba", x96)
    del x96
    t2new_bbbb += einsum("ijab->ijba", x97) * -1
    t2new_bbbb += einsum("ijab->ijab", x97)
    del x97
    x98 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x98 += einsum("ia,bcda->ibdc", t1.bb, v.bbbb.vvvv)
    x99 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x99 += einsum("ia,jbca->ijbc", t1.bb, x98)
    del x98
    x107 += einsum("ijab->ijab", x99)
    del x99
    x100 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x100 += einsum("ijab,kbla->ijlk", t2.bbbb, v.bbbb.ovov)
    x101 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x101 += einsum("ijab,klji->lkab", t2.bbbb, x100)
    x107 += einsum("ijab->ijab", x101)
    del x101
    x104 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x104 += einsum("ijkl->lkji", x100)
    del x100
    x104 += einsum("ijkl->kilj", v.bbbb.oooo)
    x105 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x105 += einsum("ia,ijkl->jkla", t1.bb, x104)
    del x104
    x106 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x106 += einsum("ia,ijkb->kjba", t1.bb, x105)
    del x105
    x107 += einsum("ijab->ijba", x106)
    del x106
    t2new_bbbb += einsum("ijab->ijab", x107)
    t2new_bbbb += einsum("ijab->ijba", x107) * -1
    del x107
    x108 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x108 -= einsum("iajb->jiab", v.aaaa.ovov)
    x108 += einsum("iajb->jiba", v.aaaa.ovov)
    x109 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x109 += einsum("ijab,ikca->kjcb", t2.abab, x108)
    x110 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x110 -= einsum("ijab,ikac->kjcb", t2.abab, x109)
    del x109
    t2new_bbbb -= einsum("ijab->ijba", x110)
    t2new_bbbb += einsum("ijab->jiba", x110)
    del x110
    x174 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x174 += einsum("ia,ijba->jb", t1.aa, x108)
    x175 -= einsum("ia->ia", x174)
    x300 -= einsum("ia->ia", x174)
    del x174
    x311 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x311 -= einsum("wia,ijba->wjb", u11.aa, x108)
    del x108
    s2new += einsum("wia,xia->wx", u11.aa, x311)
    del x311
    x111 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x111 += einsum("ia,jkla->ijlk", t1.bb, v.bbbb.ooov)
    x112 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x112 += einsum("ijab,kjil->klba", t2.bbbb, x111)
    x142 += einsum("ijab->ijab", x112)
    del x112
    x120 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x120 += einsum("ia,jkil->jkla", t1.bb, x111)
    del x111
    x128 += einsum("ijka->ijka", x120)
    del x120
    x113 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x113 += einsum("ijab,iajc->bc", t2.abab, v.aabb.ovov)
    x114 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x114 += einsum("ab,ijcb->ijac", x113, t2.bbbb)
    x142 += einsum("ijab->ijab", x114) * -1
    del x114
    x277 += einsum("ab->ab", x113) * -1
    x331 += einsum("ab->ab", x113) * -1
    del x113
    x117 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x117 += einsum("ijab->jiab", t2.bbbb) * -1
    x117 += einsum("ijab->jiba", t2.bbbb)
    x118 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x118 += einsum("iajb,jkcb->ikac", v.aabb.ovov, x117)
    x119 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x119 += einsum("ijab,ikac->kjcb", t2.abab, x118) * -1
    x142 += einsum("ijab->jiba", x119) * -1
    del x119
    x236 += einsum("ijab->ijab", x118) * -1
    del x118
    x266 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x266 += einsum("ijab,klib->klja", x117, x4)
    del x4
    x274 += einsum("ijka->ijka", x266) * -1
    del x266
    x121 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x121 += einsum("ijab,kacb->ijkc", t2.bbbb, v.bbbb.ovvv)
    x128 += einsum("ijka->ikja", x121)
    del x121
    x122 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x122 += einsum("ia,jbca->ijcb", t1.bb, v.bbbb.ovvv)
    x123 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x123 += einsum("ia,jkba->ijkb", t1.bb, x122)
    del x122
    x128 += einsum("ijka->ikja", x123)
    del x123
    x126 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x126 += einsum("ijka->ikja", v.bbbb.ooov)
    x126 += einsum("ijka->kija", v.bbbb.ooov) * -1
    x127 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x127 += einsum("ijab,kilb->jkla", x117, x126)
    del x117
    x128 += einsum("ijka->ijka", x127)
    del x127
    x129 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x129 += einsum("ia,jikb->jkba", t1.bb, x128)
    del x128
    x142 += einsum("ijab->ijba", x129)
    del x129
    x136 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x136 += einsum("ia,jika->jk", t1.bb, x126)
    del x126
    x137 += einsum("ij->ij", x136) * -1
    del x136
    x138 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x138 += einsum("ij,ikab->jkab", x137, t2.bbbb)
    del x137
    x142 += einsum("ijab->jiba", x138) * -1
    del x138
    x131 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x131 += einsum("iabc->ibac", v.bbbb.ovvv)
    x131 += einsum("iabc->ibca", v.bbbb.ovvv) * -1
    x132 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x132 += einsum("ia,ibac->bc", t1.bb, x131)
    x133 += einsum("ab->ab", x132) * -1
    del x132
    x134 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x134 += einsum("ab,ijbc->ijac", x133, t2.bbbb)
    del x133
    x142 += einsum("ijab->jiba", x134)
    del x134
    t2new_bbbb += einsum("ijab->ijab", x142) * -1
    t2new_bbbb += einsum("ijab->ijba", x142)
    t2new_bbbb += einsum("ijab->jiab", x142)
    t2new_bbbb += einsum("ijab->jiba", x142) * -1
    del x142
    x240 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x240 += einsum("ia,jbac->jibc", t1.bb, x131)
    del x131
    x241 += einsum("ijab->ijab", x240) * -1
    del x240
    x149 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x149 += einsum("ijab,ikjl->lkba", t2.aaaa, v.aaaa.oooo)
    x151 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x151 += einsum("ijab->jiba", x149)
    del x149
    x150 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x150 += einsum("ijab,cbda->ijdc", t2.aaaa, v.aaaa.vvvv)
    x151 += einsum("ijab->jiba", x150)
    del x150
    t2new_aaaa = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    t2new_aaaa += einsum("ijab->ijba", x151) * -1
    t2new_aaaa += einsum("ijab->ijab", x151)
    del x151
    x152 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x152 += einsum("ia,jkil->jkla", t1.aa, v.aaaa.oooo)
    x153 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x153 += einsum("ia,ijkb->kjba", t1.aa, x152)
    del x152
    x161 += einsum("ijab->ijab", x153)
    del x153
    x154 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x154 += einsum("ia,bcda->ibdc", t1.aa, v.aaaa.vvvv)
    x155 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x155 += einsum("ia,jbca->ijbc", t1.aa, x154)
    del x154
    x161 += einsum("ijab->ijab", x155)
    del x155
    x158 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x158 += einsum("ijab,kalb->ijkl", t2.aaaa, v.aaaa.ovov)
    x159 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x159 += einsum("ijab->jiba", t2.aaaa)
    x159 += einsum("ia,jb->ijab", t1.aa, t1.aa)
    x160 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x160 += einsum("ijkl,klab->ijab", x158, x159)
    del x158
    del x159
    x161 += einsum("ijab->jiba", x160)
    del x160
    t2new_aaaa += einsum("ijab->ijab", x161)
    t2new_aaaa += einsum("ijab->ijba", x161) * -1
    del x161
    x162 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x162 += einsum("ia,bjca->ijbc", t1.aa, v.aaaa.vovv)
    x196 -= einsum("ijab->ijab", x162)
    del x162
    x163 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x163 += einsum("ijab,jbck->ikac", t2.abab, v.bbaa.ovvo)
    x196 += einsum("ijab->ijab", x163)
    del x163
    x164 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x164 += einsum("ia,jbca->ijcb", t1.aa, v.bbaa.ovvv)
    x165 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x165 += einsum("ijab,kjcb->kiac", t2.abab, x164)
    x196 -= einsum("ijab->ijab", x165)
    del x165
    x243 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x243 += einsum("ijab->ijab", x164)
    del x164
    x166 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x166 += einsum("ijab->jiab", t2.aaaa)
    x166 -= einsum("ijab->jiba", t2.aaaa)
    x167 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x167 += einsum("ijab,ikbc->kjca", x16, x166)
    del x16
    del x166
    x196 -= einsum("ijab->ijab", x167)
    del x167
    x168 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x168 += einsum("iajb->jiab", v.aaaa.ovov)
    x168 -= einsum("iajb->jiba", v.aaaa.ovov)
    x169 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x169 += einsum("ijab,ikbc->kjca", t2.aaaa, x168)
    x170 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x170 -= einsum("ijab,ikac->kjcb", t2.aaaa, x169)
    x196 -= einsum("ijab->jiba", x170)
    del x170
    x229 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x229 -= einsum("ijab,ikbc->kjca", t2.aaaa, x169)
    del x169
    x232 += einsum("ijab->jiba", x229)
    del x229
    x227 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x227 += einsum("ijab,ikac->kjcb", t2.aaaa, x168)
    del x168
    x228 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x228 -= einsum("ijab,ikac->kjcb", t2.aaaa, x227)
    del x227
    x232 += einsum("ijab->ijab", x228)
    del x228
    t2new_aaaa += einsum("ijab->ijab", x232)
    t2new_aaaa -= einsum("ijab->ijba", x232)
    del x232
    x171 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x171 += einsum("ijab,kljb->ikla", t2.abab, v.aabb.ooov)
    x178 += einsum("ijka->jika", x171)
    del x171
    x175 += einsum("ia->ia", f.aa.ov)
    x176 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x176 += einsum("ia,jkab->ijkb", x175, t2.aaaa)
    x178 += einsum("ijka->ikja", x176)
    del x176
    x180 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x180 += einsum("ia,ja->ji", t1.aa, x175)
    del x175
    x181 += einsum("ij->ji", x180)
    del x180
    x178 -= einsum("ijak->ijka", v.aaaa.oovo)
    x179 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x179 += einsum("ia,ijkb->jkba", t1.aa, x178)
    del x178
    x196 += einsum("ijab->ijba", x179)
    del x179
    x181 += einsum("ij->ji", f.aa.oo)
    x182 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x182 += einsum("ij,jkab->ikab", x181, t2.aaaa)
    del x181
    x196 += einsum("ijab->ijba", x182)
    del x182
    x183 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x183 += einsum("ia,wba->wib", t1.aa, g.aa.bvv)
    x187 += einsum("wia->wia", x183)
    del x183
    x184 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x184 += einsum("wia,jiba->wjb", g.bb.bov, t2.abab)
    x187 += einsum("wia->wia", x184)
    del x184
    x187 += einsum("wai->wia", g.aa.bvo)
    x188 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x188 += einsum("wia,wjb->jiba", u11.aa, x187)
    x196 += einsum("ijab->ijab", x188)
    del x188
    x296 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x296 += einsum("wia,wjb->jiba", u11.bb, x187)
    del x187
    t2new_abab += einsum("ijab->ijab", x296)
    t2new_baba += einsum("ijab->jiba", x296)
    del x296
    x189 += einsum("ab->ab", f.aa.vv)
    x190 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x190 += einsum("ab,ijbc->ijac", x189, t2.aaaa)
    del x189
    x196 -= einsum("ijab->jiab", x190)
    del x190
    x191 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x191 += einsum("wia,wib->ab", g.aa.bov, u11.aa)
    x192 += einsum("ab->ab", x191)
    x193 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x193 += einsum("ab,ijac->ijbc", x192, t2.aaaa)
    del x192
    x196 -= einsum("ijab->jiba", x193)
    del x193
    t2new_aaaa += einsum("ijab->ijab", x196)
    t2new_aaaa -= einsum("ijab->ijba", x196)
    t2new_aaaa -= einsum("ijab->jiab", x196)
    t2new_aaaa += einsum("ijab->jiba", x196)
    del x196
    x280 += einsum("ab->ba", x191) * -1
    x321 += einsum("ab->ba", x191) * -1
    del x191
    x197 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x197 += einsum("ia,jkla->ijlk", t1.aa, v.aaaa.ooov)
    x198 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x198 += einsum("ijab,kijl->klab", t2.aaaa, x197)
    x224 += einsum("ijab->ijab", x198)
    del x198
    x211 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x211 += einsum("ia,jkil->jkla", t1.aa, x197)
    del x197
    x220 += einsum("ijka->ijka", x211)
    del x211
    x201 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x201 += einsum("ijab->jiab", t2.aaaa) * -1
    x201 += einsum("ijab->jiba", t2.aaaa)
    x203 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x203 += einsum("ijab,kicb->jkac", x201, x202) * -1
    del x202
    x224 += einsum("ijab->jiab", x203) * -1
    del x203
    x286 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x286 += einsum("ijab,iklb->jkla", x201, x40)
    del x40
    x291 += einsum("ijka->ijka", x286) * -1
    del x286
    x204 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x204 += einsum("ijab,kcjb->ikac", t2.abab, v.aabb.ovov)
    x205 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x205 += einsum("ijab,kica->jkbc", x201, x204)
    del x204
    x224 += einsum("ijab->ijab", x205) * -1
    del x205
    x206 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x206 += einsum("ijab,icjb->ac", t2.abab, v.aabb.ovov)
    x209 += einsum("ab->ab", x206)
    x210 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x210 += einsum("ab,ijbc->ijac", x209, t2.aaaa)
    del x209
    x224 += einsum("ijab->jiba", x210)
    del x210
    x280 += einsum("ab->ab", x206) * -1
    x321 += einsum("ab->ab", x206) * -1
    del x206
    x212 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x212 += einsum("ijab,kacb->ijkc", t2.aaaa, v.aaaa.ovvv)
    x220 += einsum("ijka->ikja", x212)
    del x212
    x213 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x213 += einsum("ia,jbca->ijcb", t1.aa, v.aaaa.ovvv)
    x214 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x214 += einsum("ia,jkba->ijkb", t1.aa, x213)
    del x213
    x220 += einsum("ijka->ikja", x214)
    del x214
    x217 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x217 += einsum("ijka->ikja", v.aaaa.ooov)
    x217 += einsum("ijka->kija", v.aaaa.ooov) * -1
    x218 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x218 += einsum("ijab->jiab", t2.aaaa)
    x218 += einsum("ijab->jiba", t2.aaaa) * -1
    x219 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x219 += einsum("ijka,jlab->iklb", x217, x218)
    del x217
    del x218
    x220 += einsum("ijka->kija", x219)
    del x219
    x221 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x221 += einsum("ia,jikb->jkba", t1.aa, x220)
    del x220
    x224 += einsum("ijab->ijba", x221)
    del x221
    t2new_aaaa += einsum("ijab->ijab", x224) * -1
    t2new_aaaa += einsum("ijab->ijba", x224)
    t2new_aaaa += einsum("ijab->jiab", x224)
    t2new_aaaa += einsum("ijab->jiba", x224) * -1
    del x224
    x233 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x233 += einsum("ijab,cadb->ijcd", t2.abab, v.aabb.vvvv)
    t2new_abab += einsum("ijab->ijab", x233)
    t2new_baba += einsum("ijab->jiba", x233)
    del x233
    x234 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x234 += einsum("ia,bacj->ijbc", t1.aa, v.aabb.vvvo)
    t2new_abab += einsum("ijab->ijab", x234)
    t2new_baba += einsum("ijab->jiba", x234)
    del x234
    x236 += einsum("iabj->ijab", v.aabb.ovvo)
    x237 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x237 += einsum("ijab,ikbc->jkac", x10, x236)
    del x10
    del x236
    t2new_abab += einsum("ijab->ijab", x237) * -1
    t2new_baba += einsum("ijab->jiba", x237) * -1
    del x237
    x238 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x238 += einsum("ijab,iakc->jkbc", t2.abab, v.aabb.ovov)
    x241 += einsum("ijab->jiab", x238)
    del x238
    x241 += einsum("iabj->ijba", v.bbbb.ovvo)
    x241 += einsum("ijab->ijab", v.bbbb.oovv) * -1
    x242 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x242 += einsum("ijab,jkcb->ikac", t2.abab, x241)
    del x241
    t2new_abab += einsum("ijab->ijab", x242)
    t2new_baba += einsum("ijab->jiba", x242)
    del x242
    x243 += einsum("iabj->jiba", v.bbaa.ovvo)
    x244 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x244 += einsum("ijab,jkcb->ikac", x243, x63)
    t2new_abab -= einsum("ijab->ijab", x244)
    t2new_baba -= einsum("ijab->jiba", x244)
    del x244
    u12new_aa += einsum("wxia,jiba->xwjb", u12.bb, x243)
    del x243
    x245 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x245 += einsum("iabc->ibac", v.aaaa.ovvv)
    x245 -= einsum("iabc->ibca", v.aaaa.ovvv)
    x246 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x246 += einsum("ia,jbac->jibc", t1.aa, x245)
    x247 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x247 -= einsum("ijab->ijab", x246)
    del x246
    x329 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x329 -= einsum("wia,ibca->wbc", u11.aa, x245)
    x343 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x343 += einsum("wia,ibac->wbc", u11.aa, x245)
    del x245
    x344 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x344 -= einsum("wab->wba", x343)
    del x343
    x247 += einsum("iabj->ijba", v.aaaa.ovvo)
    x247 -= einsum("ijab->ijab", v.aaaa.oovv)
    x248 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x248 += einsum("ijab,ikca->kjcb", t2.abab, x247)
    t2new_abab += einsum("ijab->ijab", x248)
    t2new_baba += einsum("ijab->jiba", x248)
    del x248
    u12new_aa += einsum("wxia,ijba->xwjb", u12.aa, x247)
    del x247
    x249 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x249 += einsum("ia,jabc->ijbc", t1.aa, v.aabb.ovvv)
    x251 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x251 += einsum("ijab->jiab", x249)
    del x249
    x250 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x250 += einsum("ijab,kajc->ikbc", t2.abab, v.aabb.ovov)
    x251 -= einsum("ijab->jiab", x250)
    del x250
    x251 += einsum("ijab->ijab", v.aabb.oovv)
    x252 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x252 += einsum("ijab,ikcb->kjac", t2.abab, x251)
    del x251
    t2new_abab -= einsum("ijab->ijab", x252)
    t2new_baba -= einsum("ijab->jiba", x252)
    del x252
    x253 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x253 += einsum("ia,jkla->jkil", t1.bb, v.aabb.ooov)
    x257 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x257 += einsum("ijkl->ijlk", x253)
    x270 += einsum("ijkl->ijlk", x253)
    del x253
    x254 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x254 += einsum("ijab,kalb->ikjl", t2.abab, v.aabb.ovov)
    x257 += einsum("ijkl->jilk", x254)
    x270 += einsum("ijkl->jilk", x254)
    del x254
    x255 += einsum("iajk->ijka", v.aabb.ovoo)
    x256 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x256 += einsum("ia,jkla->jikl", t1.aa, x255)
    del x255
    x257 += einsum("ijkl->ijkl", x256)
    del x256
    x257 += einsum("ijkl->ijkl", v.aabb.oooo)
    x258 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x258 += einsum("ijab,ikjl->klab", t2.abab, x257)
    del x257
    t2new_abab += einsum("ijab->ijab", x258)
    t2new_baba += einsum("ijab->jiba", x258)
    del x258
    x259 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x259 += einsum("ia,jabc->ijbc", t1.bb, v.bbaa.ovvv)
    x260 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x260 += einsum("ijab->jiab", x259)
    x289 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x289 += einsum("ijab->jiab", x259)
    del x259
    x260 += einsum("ijab->ijab", v.bbaa.oovv)
    x261 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x261 += einsum("ijab,jkca->ikcb", t2.abab, x260)
    del x260
    t2new_abab -= einsum("ijab->ijab", x261)
    t2new_baba -= einsum("ijab->jiba", x261)
    del x261
    x262 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x262 += einsum("ia,jkba->jkib", t1.bb, v.aabb.oovv)
    x274 += einsum("ijka->ijka", x262)
    del x262
    x263 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x263 += einsum("ijab,kacb->ikjc", t2.abab, v.aabb.ovvv)
    x274 += einsum("ijka->jika", x263)
    del x263
    x264 += einsum("ijka->ikja", v.aaaa.ooov) * -1
    x264 += einsum("ijka->kija", v.aaaa.ooov)
    x265 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x265 += einsum("ijab,kila->kljb", t2.abab, x264)
    x274 += einsum("ijka->ijka", x265) * -1
    del x265
    x377 += einsum("wxia,jika->xwjk", u12.aa, x264) * -1
    del x264
    u12new_aa += einsum("ia,wxij->xwja", t1.aa, x377) * -1
    del x377
    x270 += einsum("ijkl->ijkl", v.aabb.oooo)
    x271 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x271 += einsum("ia,jkil->jkla", t1.bb, x270)
    del x270
    x274 += einsum("ijka->ijka", x271) * -1
    del x271
    x272 += einsum("iabj->ijab", v.aabb.ovvo)
    x273 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x273 += einsum("ia,jkab->jikb", t1.aa, x272)
    del x272
    x274 += einsum("ijka->ijka", x273)
    del x273
    x274 += einsum("ijak->ijka", v.aabb.oovo)
    x275 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x275 += einsum("ia,ijkb->jkab", t1.aa, x274)
    del x274
    t2new_abab += einsum("ijab->ijab", x275) * -1
    t2new_baba += einsum("ijab->jiba", x275) * -1
    del x275
    x277 += einsum("ab->ab", f.bb.vv)
    x278 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x278 += einsum("ab,ijcb->ijca", x277, t2.abab)
    t2new_abab += einsum("ijab->ijab", x278)
    t2new_baba += einsum("ijab->jiba", x278)
    del x278
    u12new_bb += einsum("ab,wxib->xwia", x277, u12.bb)
    del x277
    x280 += einsum("ab->ab", f.aa.vv)
    x281 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x281 += einsum("ab,ijbc->ijac", x280, t2.abab)
    t2new_abab += einsum("ijab->ijab", x281)
    t2new_baba += einsum("ijab->jiba", x281)
    del x281
    u12new_aa += einsum("ab,wxib->xwia", x280, u12.aa)
    del x280
    x282 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x282 += einsum("ia,jabk->kijb", t1.bb, v.bbaa.ovvo)
    x291 += einsum("ijka->ikja", x282)
    del x282
    x283 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x283 += einsum("ijab,kbca->ijkc", t2.abab, v.bbaa.ovvv)
    x291 += einsum("ijka->ikja", x283)
    del x283
    x284 += einsum("ijka->ikja", v.bbbb.ooov) * -1
    x284 += einsum("ijka->kija", v.bbbb.ooov)
    x285 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x285 += einsum("ijab,kjlb->ikla", t2.abab, x284)
    x291 += einsum("ijka->ijka", x285) * -1
    del x285
    x416 += einsum("wxia,jika->xwjk", u12.bb, x284) * -1
    del x284
    u12new_bb += einsum("ia,wxij->xwja", t1.bb, x416) * -1
    del x416
    x289 += einsum("ijab->ijab", v.bbaa.oovv)
    x290 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x290 += einsum("ia,jkba->ijkb", t1.aa, x289)
    del x289
    x291 += einsum("ijka->ijka", x290)
    del x290
    x291 += einsum("ijak->kija", v.bbaa.oovo)
    x292 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x292 += einsum("ia,jikb->jkba", t1.bb, x291)
    del x291
    t2new_abab += einsum("ijab->ijab", x292) * -1
    t2new_baba += einsum("ijab->jiba", x292) * -1
    del x292
    x297 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x297 += einsum("ia,bacd->ibcd", t1.aa, v.aabb.vvvv)
    x298 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x298 += einsum("iabc->iabc", x297)
    del x297
    x298 += einsum("aibc->iabc", v.aabb.vovv)
    x299 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x299 += einsum("ia,jbca->jibc", t1.bb, x298)
    del x298
    t2new_abab += einsum("ijab->ijab", x299)
    t2new_baba += einsum("ijab->jiba", x299)
    del x299
    x300 += einsum("ia->ia", f.aa.ov)
    s1new += einsum("ia,wia->w", x300, u11.aa)
    s2new += einsum("ia,wxia->xw", x300, u12.aa)
    del x300
    x301 += einsum("ia->ia", f.bb.ov)
    s1new += einsum("ia,wia->w", x301, u11.bb)
    s2new += einsum("ia,wxia->xw", x301, u12.bb)
    del x301
    x302 = np.zeros((nbos, nbos), dtype=np.float64)
    x302 += einsum("wia,xia->wx", gc.aa.bov, u11.aa)
    x310 = np.zeros((nbos, nbos), dtype=np.float64)
    x310 += einsum("wx->wx", x302)
    del x302
    x303 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x303 += einsum("wia,iajb->wjb", u11.aa, v.aabb.ovov)
    x304 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x304 += einsum("wia->wia", x303)
    x319 += einsum("wia->wia", x303)
    x403 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x403 += einsum("ia,wja->wij", t1.bb, x303)
    x405 += einsum("wij->wij", x403)
    del x403
    x406 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x406 += einsum("wia,xji->xwja", u11.bb, x405)
    del x405
    x413 += einsum("wxia->wxia", x406)
    del x406
    x407 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x407 += einsum("wia,xja->xwij", u11.bb, x303)
    del x303
    x409 += einsum("wxij->wxij", x407)
    del x407
    x410 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x410 += einsum("ia,wxji->wxja", t1.bb, x409)
    del x409
    x413 += einsum("wxia->wxia", x410)
    del x410
    u12new_bb += einsum("wxia->wxia", x413) * -1
    u12new_bb += einsum("wxia->xwia", x413) * -1
    del x413
    x304 += einsum("wia->wia", gc.bb.bov)
    x305 = np.zeros((nbos, nbos), dtype=np.float64)
    x305 += einsum("wia,xia->xw", u11.bb, x304)
    del x304
    x310 += einsum("wx->wx", x305)
    del x305
    x306 = np.zeros((nbos, nbos), dtype=np.float64)
    x306 += einsum("wia,xia->wx", g.aa.bov, u11.aa)
    x308 = np.zeros((nbos, nbos), dtype=np.float64)
    x308 += einsum("wx->wx", x306)
    x360 = np.zeros((nbos, nbos), dtype=np.float64)
    x360 += einsum("wx->wx", x306)
    del x306
    x307 = np.zeros((nbos, nbos), dtype=np.float64)
    x307 += einsum("wia,xia->wx", g.bb.bov, u11.bb)
    x308 += einsum("wx->wx", x307)
    x360 += einsum("wx->wx", x307)
    del x307
    x361 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x361 += einsum("wx,wyia->yxia", x360, u12.aa)
    x362 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x362 -= einsum("wxia->xwia", x361)
    del x361
    x401 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x401 += einsum("wx,wyia->yxia", x360, u12.bb)
    del x360
    x402 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x402 -= einsum("wxia->xwia", x401)
    del x401
    x308 += einsum("wx->wx", w)
    x309 = np.zeros((nbos, nbos), dtype=np.float64)
    x309 += einsum("wx,wy->xy", s2, x308)
    x310 += einsum("wx->wx", x309)
    del x309
    s2new += einsum("wx->wx", x310)
    s2new += einsum("wx->xw", x310)
    del x310
    u11new_aa += einsum("wx,wia->xia", x308, u11.aa)
    u11new_bb += einsum("wx,wia->xia", x308, u11.bb)
    del x308
    x313 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x313 += einsum("wx,xia->wia", s2, g.aa.bov)
    x316 += einsum("wia->wia", x313)
    x348 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x348 += einsum("wia->wia", x313)
    del x313
    x314 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x314 += einsum("wia,jbia->wjb", u11.bb, v.aabb.ovov)
    x316 += einsum("wia->wia", x314)
    x363 += einsum("wia->wia", x314)
    del x314
    x364 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x364 += einsum("ia,wib->wba", t1.aa, x363)
    x365 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x365 += einsum("wia,xab->xwib", u11.aa, x364)
    del x364
    x370 += einsum("wxia->xwia", x365)
    del x365
    x366 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x366 += einsum("ia,wja->wji", t1.aa, x363)
    del x363
    x367 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x367 += einsum("wia,xij->xwja", u11.aa, x366)
    del x366
    x370 += einsum("wxia->xwia", x367)
    del x367
    u12new_aa += einsum("wxia->wxia", x370) * -1
    u12new_aa += einsum("wxia->xwia", x370) * -1
    del x370
    x316 += einsum("wia->wia", gc.aa.bov)
    x326 += einsum("ia,wja->wji", t1.aa, x316)
    u11new_aa += einsum("wia,ijab->wjb", x316, x201)
    u11new_bb += einsum("wia,ijab->wjb", x316, t2.abab)
    del x316
    x317 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x317 += einsum("wx,xia->wia", s2, g.bb.bov)
    x319 += einsum("wia->wia", x317)
    x384 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x384 += einsum("wia->wia", x317)
    del x317
    x319 += einsum("wia->wia", gc.bb.bov)
    x336 += einsum("ia,wja->wji", t1.bb, x319)
    u11new_aa += einsum("wia,jiba->wjb", x319, t2.abab)
    u11new_bb += einsum("wia,ijba->wjb", x319, x63) * -1
    del x319
    del x63
    x321 += einsum("ab->ab", f.aa.vv)
    u11new_aa += einsum("ab,wib->wia", x321, u11.aa)
    del x321
    x322 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x322 += einsum("wx,xij->wij", s2, g.aa.boo)
    x326 += einsum("wij->wij", x322)
    x350 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x350 += einsum("wij->wij", x322)
    del x322
    x323 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x323 += einsum("wia,xwja->xij", g.aa.bov, u12.aa)
    x326 += einsum("wij->wij", x323)
    x354 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x354 += einsum("wij->wij", x323)
    del x323
    x324 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x324 += einsum("wia,jkia->wjk", u11.bb, v.aabb.ooov)
    x326 += einsum("wij->wij", x324)
    x354 += einsum("wij->wij", x324)
    del x324
    x325 += einsum("ia->ia", f.aa.ov)
    x326 += einsum("ia,wja->wij", x325, u11.aa)
    del x325
    x326 += einsum("wij->wij", gc.aa.boo)
    u11new_aa += einsum("ia,wij->wja", t1.aa, x326) * -1
    del x326
    x327 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x327 += einsum("wx,xab->wab", s2, g.aa.bvv)
    x329 += einsum("wab->wab", x327)
    x356 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x356 += einsum("wab->wab", x327)
    del x327
    x328 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x328 += einsum("wia,iabc->wbc", u11.bb, v.bbaa.ovvv)
    x329 += einsum("wab->wab", x328)
    x344 -= einsum("wab->wba", x328)
    del x328
    x329 += einsum("wab->wab", gc.aa.bvv)
    u11new_aa += einsum("ia,wba->wib", t1.aa, x329)
    del x329
    x331 += einsum("ab->ab", f.bb.vv)
    u11new_bb += einsum("ab,wib->wia", x331, u11.bb)
    del x331
    x332 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x332 += einsum("wx,xij->wij", s2, g.bb.boo)
    x336 += einsum("wij->wij", x332)
    x386 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x386 += einsum("wij->wij", x332)
    del x332
    x333 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x333 += einsum("wia,xwja->xij", g.bb.bov, u12.bb)
    x336 += einsum("wij->wij", x333)
    x397 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x397 += einsum("wij->wij", x333)
    del x333
    x334 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x334 += einsum("wia,iajk->wjk", u11.aa, v.aabb.ovoo)
    x336 += einsum("wij->wij", x334)
    x386 += einsum("wij->wij", x334)
    del x334
    x335 += einsum("ia->ia", f.bb.ov)
    x336 += einsum("ia,wja->wij", x335, u11.bb)
    del x335
    x336 += einsum("wij->wij", gc.bb.boo)
    u11new_bb += einsum("ia,wij->wja", t1.bb, x336) * -1
    del x336
    x337 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x337 += einsum("wx,xab->wab", s2, g.bb.bvv)
    x340 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x340 += einsum("wab->wab", x337)
    x388 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x388 += einsum("wab->wab", x337)
    del x337
    x338 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x338 += einsum("wia,iabc->wbc", u11.aa, v.aabb.ovvv)
    x340 += einsum("wab->wab", x338)
    x388 += einsum("wab->wab", x338)
    del x338
    x339 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x339 -= einsum("iabc->ibac", v.bbbb.ovvv)
    x339 += einsum("iabc->ibca", v.bbbb.ovvv)
    x340 -= einsum("wia,ibac->wbc", u11.bb, x339)
    del x339
    x340 += einsum("wab->wab", gc.bb.bvv)
    u11new_bb += einsum("ia,wba->wib", t1.bb, x340)
    del x340
    x341 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x341 += einsum("wx,ywia->yxia", w, u12.aa)
    x362 -= einsum("wxia->wxia", x341)
    del x341
    x342 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x342 += einsum("wia,xwib->xab", g.aa.bov, u12.aa)
    x344 += einsum("wab->wab", x342)
    del x342
    x345 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x345 += einsum("wia,xab->xwib", u11.aa, x344)
    del x344
    x362 += einsum("wxia->xwia", x345)
    del x345
    x346 += einsum("ia->ia", f.aa.ov)
    x347 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x347 += einsum("ia,wja->wij", x346, u11.aa)
    del x346
    x350 += einsum("wij->wij", x347)
    del x347
    x348 += einsum("wia->wia", gc.aa.bov)
    x349 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x349 += einsum("ia,wja->wji", t1.aa, x348)
    x350 += einsum("wij->wij", x349)
    del x349
    x358 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x358 += einsum("wia,xja->xwji", u11.aa, x348)
    del x348
    x359 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x359 += einsum("ia,wxij->wxja", t1.aa, x358)
    del x358
    x362 += einsum("wxia->wxia", x359)
    del x359
    x350 += einsum("wij->wij", gc.aa.boo)
    x351 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x351 += einsum("wia,xij->xwja", u11.aa, x350)
    del x350
    x362 += einsum("wxia->wxia", x351)
    del x351
    x352 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x352 -= einsum("ijka->ikja", v.aaaa.ooov)
    x352 += einsum("ijka->kija", v.aaaa.ooov)
    x353 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x353 += einsum("wia,jika->wjk", u11.aa, x352)
    del x352
    x354 -= einsum("wij->wij", x353)
    del x353
    x355 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x355 += einsum("wia,xij->xwja", u11.aa, x354)
    del x354
    x362 += einsum("wxia->xwia", x355)
    del x355
    x356 += einsum("wab->wab", gc.aa.bvv)
    x357 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x357 += einsum("wia,xba->xwib", u11.aa, x356)
    del x356
    x362 -= einsum("wxia->wxia", x357)
    del x357
    u12new_aa -= einsum("wxia->wxia", x362)
    u12new_aa -= einsum("wxia->xwia", x362)
    del x362
    x371 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x371 += einsum("wxia,jbia->wxjb", u12.bb, v.aabb.ovov)
    x373 += einsum("wxia->xwia", x371)
    del x371
    u12new_aa += einsum("ijab,wxia->xwjb", x201, x373)
    del x201
    u12new_bb += einsum("ijab,wxia->xwjb", t2.abab, x373)
    del x373
    x374 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x374 += einsum("wxia,iajb->wxjb", u12.aa, v.aabb.ovov)
    x376 += einsum("wxia->xwia", x374)
    del x374
    u12new_aa += einsum("ijab,wxjb->xwia", t2.abab, x376)
    u12new_bb += einsum("wxia,ijba->xwjb", x376, x41)
    del x376
    del x41
    x378 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x378 += einsum("wia,xyia->wxy", g.aa.bov, u12.aa)
    x380 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x380 += einsum("wxy->wyx", x378)
    del x378
    x379 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x379 += einsum("wia,xyia->wxy", g.bb.bov, u12.bb)
    x380 += einsum("wxy->wyx", x379)
    del x379
    u12new_aa += einsum("wia,wxy->yxia", u11.aa, x380)
    u12new_bb += einsum("wia,wxy->yxia", u11.bb, x380)
    del x380
    x381 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x381 += einsum("wx,ywia->yxia", w, u12.bb)
    x402 -= einsum("wxia->wxia", x381)
    del x381
    x382 += einsum("ia->ia", f.bb.ov)
    x383 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x383 += einsum("ia,wja->wij", x382, u11.bb)
    del x382
    x386 += einsum("wij->wij", x383)
    del x383
    x384 += einsum("wia->wia", gc.bb.bov)
    x385 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x385 += einsum("ia,wja->wji", t1.bb, x384)
    x386 += einsum("wij->wij", x385)
    del x385
    x399 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x399 += einsum("wia,xja->xwji", u11.bb, x384)
    del x384
    x400 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x400 += einsum("ia,wxij->wxja", t1.bb, x399)
    del x399
    x402 += einsum("wxia->wxia", x400)
    del x400
    x386 += einsum("wij->wij", gc.bb.boo)
    x387 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x387 += einsum("wia,xij->xwja", u11.bb, x386)
    del x386
    x402 += einsum("wxia->wxia", x387)
    del x387
    x388 += einsum("wab->wab", gc.bb.bvv)
    x389 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x389 += einsum("wia,xba->xwib", u11.bb, x388)
    del x388
    x402 -= einsum("wxia->wxia", x389)
    del x389
    x390 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x390 += einsum("wia,xwib->xab", g.bb.bov, u12.bb)
    x393 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x393 += einsum("wab->wab", x390)
    del x390
    x391 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x391 += einsum("iabc->ibac", v.bbbb.ovvv)
    x391 -= einsum("iabc->ibca", v.bbbb.ovvv)
    x392 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x392 += einsum("wia,ibac->wbc", u11.bb, x391)
    x393 -= einsum("wab->wba", x392)
    del x392
    x394 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x394 += einsum("wia,xab->xwib", u11.bb, x393)
    del x393
    x402 += einsum("wxia->xwia", x394)
    del x394
    x414 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x414 -= einsum("ia,jbac->jibc", t1.bb, x391)
    del x391
    x395 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x395 -= einsum("ijka->ikja", v.bbbb.ooov)
    x395 += einsum("ijka->kija", v.bbbb.ooov)
    x396 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x396 += einsum("wia,jika->wjk", u11.bb, x395)
    del x395
    x397 -= einsum("wij->wij", x396)
    del x396
    x398 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x398 += einsum("wia,xij->xwja", u11.bb, x397)
    del x397
    x402 += einsum("wxia->xwia", x398)
    del x398
    u12new_bb -= einsum("wxia->wxia", x402)
    u12new_bb -= einsum("wxia->xwia", x402)
    del x402
    x414 += einsum("iabj->ijba", v.bbbb.ovvo)
    x414 -= einsum("ijab->ijab", v.bbbb.oovv)
    u12new_bb += einsum("wxia,ijba->xwjb", u12.bb, x414)
    del x414
    x415 += einsum("iabj->ijab", v.aabb.ovvo)
    u12new_bb += einsum("wxia,ijab->xwjb", u12.aa, x415)
    del x415
    t1new_aa += einsum("w,wai->ia", s1, g.aa.bvo)
    t1new_aa += einsum("ia,iabj->jb", t1.bb, v.bbaa.ovvo)
    t1new_aa += einsum("ai->ia", f.aa.vo)
    t1new_aa += einsum("ijab,jbca->ic", t2.abab, v.bbaa.ovvv)
    t1new_aa += einsum("wab,wib->ia", g.aa.bvv, u11.aa)
    t1new_bb += einsum("wab,wib->ia", g.bb.bvv, u11.bb)
    t1new_bb += einsum("ai->ia", f.bb.vo)
    t1new_bb += einsum("w,wai->ia", s1, g.bb.bvo)
    t1new_bb += einsum("ia,iabj->jb", t1.aa, v.aabb.ovvo)
    t1new_bb += einsum("ijab,iacb->jc", t2.abab, v.aabb.ovvv)
    t2new_bbbb -= einsum("aibj->jiab", v.bbbb.vovo)
    t2new_bbbb += einsum("aibj->jiba", v.bbbb.vovo)
    t2new_aaaa -= einsum("aibj->jiab", v.aaaa.vovo)
    t2new_aaaa += einsum("aibj->jiba", v.aaaa.vovo)
    t2new_abab += einsum("aibj->ijab", v.aabb.vovo)
    t2new_baba += einsum("aibj->jiba", v.aabb.vovo)
    s1new += einsum("w->w", G)
    s1new += einsum("ia,wia->w", t1.bb, gc.bb.bov)
    s1new += einsum("wia,xwia->x", g.aa.bov, u12.aa)
    s1new += einsum("w,wx->x", s1, w)
    s1new += einsum("ia,wia->w", t1.aa, gc.aa.bov)
    s1new += einsum("wia,xwia->x", g.bb.bov, u12.bb)
    u11new_aa += einsum("wia,iabj->wjb", u11.bb, v.bbaa.ovvo)
    u11new_aa += einsum("wai->wia", gc.aa.bvo)
    u11new_aa += einsum("wab,xwib->xia", g.aa.bvv, u12.aa)
    u11new_aa += einsum("wx,xai->wia", s2, g.aa.bvo)
    u11new_bb += einsum("wai->wia", gc.bb.bvo)
    u11new_bb += einsum("wx,xai->wia", s2, g.bb.bvo)
    u11new_bb += einsum("wia,iabj->wjb", u11.aa, v.aabb.ovvo)
    u11new_bb += einsum("wab,xwib->xia", g.bb.bvv, u12.bb)

    t1new.aa = t1new_aa
    t1new.bb = t1new_bb
    t2new.abab = t2new_abab
    t2new.baba = t2new_baba
    t2new.aaaa = t2new_aaaa
    t2new.bbbb = t2new_bbbb
    u11new.aa = u11new_aa
    u11new.bb = u11new_bb
    u12new.aa = u12new_aa
    u12new.bb = u12new_bb

    return {"t1new": t1new, "t2new": t2new, "s1new": s1new, "s2new": s2new, "u11new": u11new, "u12new": u12new}

def update_lams(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    l1new = SimpleNamespace()
    l2new = SimpleNamespace()
    lu11new = SimpleNamespace()
    lu12new = SimpleNamespace()

    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    # L1, L2, LS1, LS2, LU11 and LU12 amplitudes
    x0 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x0 += einsum("abij,klab->ikjl", l2.abab, t2.abab)
    x62 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x62 += einsum("ijkl->ijkl", x0)
    x526 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x526 += einsum("ijkl->ijkl", x0)
    l1new_aa = np.zeros((nvir[0], nocc[0]), dtype=np.float64)
    l1new_aa += einsum("iajk,likj->al", v.aabb.ovoo, x0)
    l1new_bb = np.zeros((nvir[1], nocc[1]), dtype=np.float64)
    l1new_bb += einsum("ijka,jilk->al", v.aabb.ooov, x0)
    del x0
    x1 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x1 += einsum("ia,bajk->jkib", t1.bb, l2.abab)
    x2 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x2 += einsum("ia,jkla->jikl", t1.aa, x1)
    x62 += einsum("ijkl->ijkl", x2)
    x63 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x63 += einsum("ia,jkil->jkla", t1.bb, x62)
    x296 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x296 += einsum("ia,ijkl->jkla", t1.aa, x62)
    del x62
    x526 += einsum("ijkl->ijkl", x2)
    x527 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x527 += einsum("iajb,kilj->klab", v.aabb.ovov, x526)
    del x526
    l2new_abab = np.zeros((nvir[0], nvir[1], nocc[0], nocc[1]), dtype=np.float64)
    l2new_abab += einsum("ijab->abij", x527)
    l2new_baba = np.zeros((nvir[1], nvir[0], nocc[1], nocc[0]), dtype=np.float64)
    l2new_baba += einsum("ijab->baji", x527)
    del x527
    l1new_aa += einsum("iajk,likj->al", v.aabb.ovoo, x2)
    l1new_bb += einsum("ijka,jilk->al", v.aabb.ooov, x2)
    del x2
    x54 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x54 += einsum("ia,jikb->jkba", t1.bb, x1)
    x63 += einsum("ijab,kjla->kilb", t2.abab, x1)
    x191 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x191 += einsum("ijab,ijka->kb", t2.abab, x1)
    x206 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x206 += einsum("ia->ia", x191)
    x318 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x318 += einsum("ia->ia", x191) * 2
    del x191
    x292 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x292 += einsum("ijab,ikla->kljb", t2.abab, x1)
    x449 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x449 += einsum("iajk,lkjb->liba", v.aabb.ovoo, x1)
    x486 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x486 -= einsum("ijab->ijab", x449)
    del x449
    x499 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x499 += einsum("iabc,jkib->jkca", v.bbaa.ovvv, x1)
    l2new_abab -= einsum("ijab->abij", x499)
    l2new_baba -= einsum("ijab->baji", x499)
    del x499
    l1new_aa -= einsum("ijab,kjia->bk", v.bbaa.oovv, x1)
    x3 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x3 += einsum("abij,kjac->ikbc", l2.abab, t2.abab)
    l1new_aa += einsum("iabc,jibc->aj", v.aabb.ovvv, x3) * -1
    del x3
    x4 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x4 += einsum("w,wia->ia", s1, g.aa.bov)
    x5 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x5 += einsum("ia->ia", x4)
    x41 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x41 += einsum("ia->ia", x4)
    x468 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x468 += einsum("ia->ia", x4)
    x560 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x560 += einsum("ia->ia", x4)
    del x4
    x5 += einsum("ia->ia", f.aa.ov)
    x6 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x6 += einsum("ia,jkab->jkib", x5, t2.aaaa)
    del x5
    x7 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x7 += einsum("ijka->kjia", x6)
    del x6
    x7 += einsum("ijak->ijka", v.aaaa.oovo) * -1
    x32 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x32 += einsum("ijka->kija", x7)
    x32 += einsum("ijka->jika", x7) * -1
    del x7
    x8 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x8 += einsum("ijab,kbca->jikc", t2.aaaa, v.aaaa.ovvv)
    x21 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x21 += einsum("ijka->ijka", x8) * -1
    del x8
    x9 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x9 += einsum("ia,jbca->ijcb", t1.aa, v.aaaa.ovvv)
    x10 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x10 += einsum("ia,jkba->ijkb", t1.aa, x9)
    del x9
    x21 += einsum("ijka->ijka", x10) * -1
    del x10
    x11 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x11 += einsum("ia,jbia->jb", t1.bb, v.aabb.ovov)
    x14 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x14 += einsum("ia->ia", x11)
    x41 += einsum("ia->ia", x11)
    x485 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x485 += einsum("ia->ia", x11)
    x560 += einsum("ia->ia", x11)
    del x11
    x12 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x12 += einsum("iajb->jiab", v.aaaa.ovov)
    x12 += einsum("iajb->jiba", v.aaaa.ovov) * -1
    x13 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x13 += einsum("ia,ijab->jb", t1.aa, x12)
    x14 += einsum("ia->ia", x13) * -1
    x15 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x15 += einsum("ia,jkab->jkib", x14, t2.aaaa)
    x21 += einsum("ijka->jika", x15)
    del x15
    x433 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x433 += einsum("ia,ja->ij", t1.aa, x14)
    x434 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x434 += einsum("ij->ij", x433)
    del x433
    x41 += einsum("ia->ia", x13) * -1
    del x13
    x76 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x76 += einsum("wia,ijab->wjb", u11.aa, x12)
    x77 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x77 += einsum("wia->wia", x76) * -1
    x217 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x217 += einsum("wia->wia", x76) * -1
    x226 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x226 += einsum("wia->wia", x76) * -1
    del x76
    x426 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x426 += einsum("wxia,ijab->wxjb", u12.aa, x12)
    x427 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x427 += einsum("wxia->xwia", x426) * -1
    del x426
    x432 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x432 += einsum("ijab,ikab->jk", t2.aaaa, x12)
    x434 += einsum("ij->ij", x432) * -1
    del x432
    x437 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x437 += einsum("ijab,ijcb->ac", t2.aaaa, x12)
    x438 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x438 += einsum("ab->ab", x437) * -1
    del x437
    x504 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x504 += einsum("ijab,ikac->kjcb", t2.abab, x12)
    x506 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x506 += einsum("ijab->ijab", x504) * -1
    del x504
    x16 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x16 += einsum("ijab,kalb->ijkl", t2.aaaa, v.aaaa.ovov)
    x19 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x19 += einsum("ijkl->jilk", x16)
    x492 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x492 += einsum("ijkl->jilk", x16)
    del x16
    x17 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x17 += einsum("ia,jbka->ijkb", t1.aa, v.aaaa.ovov)
    x18 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x18 += einsum("ia,jkla->ijkl", t1.aa, x17)
    x19 += einsum("ijkl->ijkl", x18)
    x20 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x20 += einsum("ia,jkil->jkla", t1.aa, x19)
    del x19
    x21 += einsum("ijka->jika", x20)
    del x20
    x32 += einsum("ijka->jkia", x21)
    x32 += einsum("ijka->ikja", x21) * -1
    del x21
    x492 += einsum("ijkl->ijkl", x18)
    del x18
    x493 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x493 += einsum("abij,ijkl->klab", l2.aaaa, x492)
    del x492
    x494 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x494 += einsum("ijab->jiba", x493)
    del x493
    x22 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x22 += einsum("ijka->ikja", x17) * -1
    x22 += einsum("ijka->ijka", x17)
    x37 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x37 += einsum("ijka->jkia", x17)
    x37 += einsum("ijka->kjia", x17) * -1
    x81 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x81 += einsum("ijka->jkia", x17)
    x89 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x89 += einsum("ijka->jkia", x17) * -1
    x89 += einsum("ijka->kjia", x17)
    x422 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x422 += einsum("ijka->ikja", x17) * -1
    x422 += einsum("ijka->ijka", x17)
    x482 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x482 += einsum("ijka->ijka", x17)
    x531 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x531 += einsum("ijka->ikja", x17)
    x531 += einsum("ijka->ijka", x17) * -1
    del x17
    x22 += einsum("ijka->jkia", v.aaaa.ooov)
    x22 += einsum("ijka->jika", v.aaaa.ooov) * -1
    x23 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x23 += einsum("ijab->jiab", t2.aaaa)
    x23 += einsum("ijab->jiba", t2.aaaa) * -1
    x24 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x24 += einsum("ijka,klab->ijlb", x22, x23)
    del x22
    x32 += einsum("ijka->ijka", x24)
    x51 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x51 += einsum("ijka->ijka", x24)
    del x24
    x167 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x167 += einsum("ai,ijba->jb", l1.aa, x23)
    x179 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x179 += einsum("ia->ia", x167) * -1
    del x167
    x176 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x176 += einsum("abij,ikab->jk", l2.aaaa, x23)
    x177 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x177 += einsum("ij->ij", x176) * -1
    x440 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x440 += einsum("ij->ij", x176) * -1
    del x176
    x184 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x184 += einsum("abij,ijcb->ac", l2.aaaa, x23) * 2
    x185 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x185 += einsum("ab->ab", x184) * -1
    del x184
    x295 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x295 += einsum("abij,ikca->kjcb", l2.abab, x23) * -1
    x296 += einsum("ijka,ilba->ljkb", x1, x23) * -1
    x429 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x429 += einsum("abij,ijcb->ac", l2.aaaa, x23)
    x430 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x430 += einsum("ab->ab", x429) * -1
    x542 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x542 += einsum("ab->ab", x429) * -1
    del x429
    x500 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x500 += einsum("iajb,ikac->kjcb", v.aabb.ovov, x23)
    x502 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x502 += einsum("ijab->ijab", x500) * -1
    del x500
    x611 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x611 += einsum("wxai,ijab->wxjb", lu12.aa, x23)
    x612 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x612 += einsum("wxia->xwia", x611) * -1
    del x611
    x25 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x25 += einsum("ia,jakb->ijkb", t1.aa, v.aabb.ovov)
    x26 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x26 += einsum("ijka->jika", x25)
    x556 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x556 += einsum("ijka->jika", x25)
    x26 += einsum("ijka->ijka", v.aabb.ooov)
    x27 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x27 += einsum("ijab,kljb->ikla", t2.abab, x26)
    x32 += einsum("ijka->kjia", x27)
    x51 += einsum("ijka->kjia", x27)
    del x27
    x78 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x78 += einsum("wxia,jkia->xwjk", u12.bb, x26) * 0.5
    x91 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x91 += einsum("ijab,ikjb->ka", t2.abab, x26)
    x124 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x124 += einsum("ia->ia", x91) * -1
    del x91
    x286 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x286 += einsum("ijab,iklb->klja", t2.abab, x26) * -1
    x528 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x528 += einsum("ijka,likb->ljab", x1, x26)
    l2new_abab += einsum("ijab->abij", x528)
    l2new_baba += einsum("ijab->baji", x528)
    del x528
    x28 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x28 += einsum("iabj->ijba", v.aaaa.ovvo)
    x28 += einsum("ijab->ijab", v.aaaa.oovv) * -1
    x29 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x29 += einsum("ia,jkba->ijkb", t1.aa, x28)
    x32 += einsum("ijka->ijka", x29)
    x51 += einsum("ijka->ijka", x29)
    del x29
    x99 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x99 += einsum("ia,ijba->jb", t1.aa, x28)
    x124 += einsum("ia->ia", x99)
    del x99
    x566 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x566 += einsum("wia,ijba->wjb", u11.aa, x28) * -1
    x30 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x30 += einsum("ia,jkla->ijlk", t1.aa, v.aaaa.ooov)
    x31 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x31 += einsum("ijkl->jkil", x30)
    x31 += einsum("ijkl->kjil", x30) * -1
    x50 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x50 += einsum("ijkl->ikjl", x30)
    x50 += einsum("ijkl->ijkl", x30) * -1
    x51 += einsum("ia,jkil->jkla", t1.aa, x50) * -1
    del x50
    l1new_aa += einsum("abij,ikjb->ak", l2.aaaa, x51) * -1
    del x51
    x447 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x447 += einsum("abij,jkli->klba", l2.aaaa, x30)
    del x30
    x486 -= einsum("ijab->ijab", x447)
    del x447
    x31 += einsum("ijkl->kijl", v.aaaa.oooo)
    x31 += einsum("ijkl->kilj", v.aaaa.oooo) * -1
    x32 += einsum("ia,ijkl->kjla", t1.aa, x31) * -1
    del x31
    l1new_aa += einsum("abij,ikja->bk", l2.aaaa, x32)
    del x32
    x33 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x33 += einsum("abij,kjcb->ikac", l2.abab, t2.abab)
    x35 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x35 += einsum("ijab->ijab", x33) * 2
    x424 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x424 += einsum("ijab,kicb->kjca", x12, x33)
    del x33
    x443 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x443 += einsum("ijab->ijab", x424)
    del x424
    x34 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x34 += einsum("abij->jiab", l2.aaaa) * -1
    x34 += einsum("abij->jiba", l2.aaaa)
    x35 += einsum("ijab,ikbc->kjca", x23, x34) * 2
    x35 += einsum("wxai,wxjb->ijab", lu12.aa, u12.aa)
    x36 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x36 += einsum("iabc->ibac", v.aaaa.ovvv) * -1
    x36 += einsum("iabc->ibca", v.aaaa.ovvv)
    x508 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x508 += einsum("ia,jbca->ijbc", t1.aa, x36)
    x509 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x509 += einsum("ijab->jiab", x508) * -1
    del x508
    l1new_aa += einsum("ijab,jabc->ci", x35, x36) * -0.5
    del x35
    x37 += einsum("ijka->ikja", v.aaaa.ooov) * -1
    x37 += einsum("ijka->kija", v.aaaa.ooov)
    x49 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x49 += einsum("ijab,kila->kljb", t2.abab, x37) * -1
    x78 += einsum("wxia,jika->xwjk", u12.aa, x37) * -0.5
    del x37
    x38 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x38 += einsum("ijab->jiab", t2.bbbb)
    x38 += einsum("ijab->jiba", t2.bbbb) * -1
    x49 += einsum("ijka,klab->ijlb", x26, x38) * -1
    x505 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x505 += einsum("iajb,jkbc->ikac", v.aabb.ovov, x38)
    x506 += einsum("ijab->ijab", x505) * -1
    del x505
    x616 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x616 += einsum("wxai,ijab->wxjb", lu12.bb, x38)
    x617 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x617 += einsum("wxia->xwia", x616) * -1
    del x616
    x39 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x39 += einsum("ia,jbka->jikb", t1.bb, v.aabb.ovov)
    x40 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x40 += einsum("ijka->ikja", x39)
    x44 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x44 += einsum("ijka->ikja", x39)
    x450 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x450 += einsum("ijka,ljkb->ilab", x1, x39)
    x486 -= einsum("ijab->ijab", x450)
    del x450
    x558 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x558 += einsum("ijka->ikja", x39)
    x40 += einsum("iajk->ijka", v.aabb.ovoo)
    x49 += einsum("ijab,kjla->kilb", t2.abab, x40) * -1
    x134 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x134 += einsum("ijab,ijka->kb", t2.abab, x40)
    x160 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x160 += einsum("ia->ia", x134) * -1
    del x134
    x274 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x274 += einsum("ijab,ikla->jklb", t2.abab, x40)
    x278 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x278 += einsum("ijka->kjia", x274)
    x290 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x290 += einsum("ijka->kjia", x274)
    del x274
    x286 += einsum("ijab,ikla->jklb", x23, x40) * -1
    x312 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x312 += einsum("wxia,ijka->xwjk", u12.aa, x40) * 0.5
    x523 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x523 += einsum("ia,jkla->ijkl", t1.aa, x40)
    x524 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x524 += einsum("ijkl->jikl", x523)
    del x523
    x41 += einsum("ia->ia", f.aa.ov)
    x49 += einsum("ia,jkab->ijkb", x41, t2.abab)
    x78 += einsum("ia,wxja->xwij", x41, u12.aa) * 0.5
    x92 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x92 += einsum("ia,ijab->jb", x41, x23)
    x124 += einsum("ia->ia", x92) * -1
    del x92
    x111 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x111 += einsum("ia,ja->ij", t1.aa, x41)
    x112 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x112 += einsum("ij->ji", x111)
    del x111
    x136 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x136 += einsum("ia,ijab->jb", x41, t2.abab)
    x160 += einsum("ia->ia", x136)
    del x136
    x216 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x216 += einsum("ia,wja->wji", x41, u11.aa)
    x220 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x220 += einsum("wij->wji", x216)
    del x216
    x230 = np.zeros((nbos, nbos), dtype=np.float64)
    x230 += einsum("ia,wxia->xw", x41, u12.aa) * 0.5
    x252 = np.zeros((nbos), dtype=np.float64)
    x252 += einsum("ia,wia->w", x41, u11.aa)
    x255 = np.zeros((nbos), dtype=np.float64)
    x255 += einsum("w->w", x252)
    del x252
    x328 = np.zeros((nbos, nbos), dtype=np.float64)
    x328 += einsum("ia,wxia->xw", x41, u12.aa)
    lu11new_aa = np.zeros((nbos, nvir[0], nocc[0]), dtype=np.float64)
    lu11new_aa += einsum("w,ia->wai", ls1, x41) * 2
    lu12new_aa = np.zeros((nbos, nbos, nvir[0], nocc[0]), dtype=np.float64)
    lu12new_aa += einsum("wx,ia->xwai", ls2, x41) * 2
    x42 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x42 += einsum("ia,jkla->jkil", t1.bb, v.aabb.ooov)
    x46 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x46 += einsum("ijkl->ijlk", x42)
    x524 += einsum("ijkl->ijlk", x42)
    del x42
    x43 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x43 += einsum("ijab,kalb->ikjl", t2.abab, v.aabb.ovov)
    x46 += einsum("ijkl->jilk", x43)
    x524 += einsum("ijkl->jilk", x43)
    del x43
    x44 += einsum("iajk->ijka", v.aabb.ovoo)
    x45 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x45 += einsum("ia,jkla->ijkl", t1.aa, x44)
    del x44
    x46 += einsum("ijkl->jikl", x45)
    del x45
    x46 += einsum("ijkl->ijkl", v.aabb.oooo)
    x49 += einsum("ia,jkil->jkla", t1.bb, x46) * -1
    x286 += einsum("ia,ijkl->jkla", t1.aa, x46) * -1
    del x46
    x47 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x47 += einsum("ia,jbca->jibc", t1.bb, v.aabb.ovvv)
    x48 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x48 += einsum("ijab->ijab", x47)
    x457 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x457 += einsum("ijab->ijab", x47)
    x506 += einsum("ijab->ijab", x47)
    x618 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x618 += einsum("ijab->ijab", x47)
    del x47
    x48 += einsum("iabj->ijab", v.aabb.ovvo)
    x49 += einsum("ia,jkab->jikb", t1.aa, x48)
    x49 += einsum("ijak->ijka", v.aabb.oovo)
    x49 += einsum("ia,jkba->jkib", t1.bb, v.aabb.oovv)
    x49 += einsum("ijab,kacb->kijc", t2.abab, v.aabb.ovvv)
    l1new_aa += einsum("abij,kijb->ak", l2.abab, x49) * -1
    del x49
    x52 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x52 += einsum("abij->jiab", l2.aaaa)
    x52 += einsum("abij->jiba", l2.aaaa) * -1
    x54 += einsum("ijab,ikca->kjcb", t2.abab, x52) * -1
    x243 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x243 += einsum("wia,ijab->wjb", u11.aa, x52) * -1
    x53 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x53 += einsum("ijab->jiab", t2.bbbb) * -1
    x53 += einsum("ijab->jiba", t2.bbbb)
    x54 += einsum("abij,jkbc->ikac", l2.abab, x53) * -1
    x133 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x133 += einsum("iabc,ijca->jb", v.bbbb.ovvv, x53)
    x160 += einsum("ia->ia", x133) * -1
    del x133
    x194 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x194 += einsum("ai,ijab->jb", l1.bb, x53)
    x206 += einsum("ia->ia", x194) * -1
    del x194
    x203 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x203 += einsum("abij,ikba->jk", l2.bbbb, x53)
    x204 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x204 += einsum("ij->ij", x203) * -1
    x409 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x409 += einsum("ij->ij", x203) * -1
    x572 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x572 += einsum("ij->ij", x203) * -1
    del x203
    x211 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x211 += einsum("abij,ijca->bc", l2.bbbb, x53)
    x212 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x212 += einsum("ab->ab", x211) * -1
    x399 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x399 += einsum("ab->ab", x211) * -1
    x544 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x544 += einsum("ab->ab", x211) * -1
    del x211
    x221 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x221 += einsum("abij,ikba->jk", l2.bbbb, x53) * 2
    x222 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x222 += einsum("ij->ij", x221) * -1
    del x221
    x318 += einsum("ai,ijab->jb", l1.bb, x53) * -2
    x571 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x571 += einsum("abij,ijca->bc", l2.bbbb, x53) * -2
    x54 += einsum("wxai,wxjb->ijab", lu12.aa, u12.bb) * -0.5
    l1new_aa += einsum("iabc,jiba->cj", v.bbaa.ovvv, x54) * -1
    del x54
    x55 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x55 += einsum("ia,wxaj->wxji", t1.aa, lu12.aa)
    x59 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x59 += einsum("wxia,wxjk->jkia", u12.aa, x55) * 0.5
    x63 += einsum("wxia,wxjk->jkia", u12.bb, x55) * -0.5
    x164 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x164 += einsum("wxia,wxij->ja", u12.aa, x55)
    x179 += einsum("ia->ia", x164) * 0.5
    del x164
    x582 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x582 += einsum("wia,xwij->xja", u11.aa, x55)
    x583 = np.zeros((nbos, nbos), dtype=np.float64)
    x583 += einsum("wia,xia->wx", g.aa.bov, x582)
    del x582
    x602 = np.zeros((nbos, nbos), dtype=np.float64)
    x602 -= einsum("wx->wx", x583)
    del x583
    lu12new_aa += einsum("ijka,wxij->xwak", x531, x55) * -1
    lu12new_aa += einsum("ia,wxji->xwaj", x41, x55) * -1
    lu12new_bb = np.zeros((nbos, nbos, nvir[1], nocc[1]), dtype=np.float64)
    lu12new_bb -= einsum("ijka,wxji->xwak", v.aabb.ooov, x55)
    lu12new_bb -= einsum("ijka,wxij->xwak", x25, x55)
    x56 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x56 += einsum("ia,abjk->jikb", t1.aa, l2.abab)
    x59 += einsum("ijab,kljb->klia", t2.abab, x56)
    x63 += einsum("ijab,klia->kljb", x53, x56) * -1
    x165 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x165 += einsum("ijab,ikjb->ka", t2.abab, x56)
    x179 += einsum("ia->ia", x165)
    del x165
    x295 += einsum("ia,ijkb->jkab", t1.aa, x56)
    x296 += einsum("ijab,iklb->klja", t2.abab, x56)
    x346 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x346 += einsum("ijka,jilb->lkba", v.aabb.ooov, x56)
    x385 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x385 -= einsum("ijab->ijab", x346)
    del x346
    x349 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x349 += einsum("ijka,ijlb->lkba", x25, x56)
    del x25
    x385 -= einsum("ijab->ijab", x349)
    del x349
    x496 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x496 += einsum("iabc,jikb->jkac", v.aabb.ovvv, x56)
    l2new_abab -= einsum("ijab->abij", x496)
    l2new_baba -= einsum("ijab->baji", x496)
    del x496
    x529 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x529 += einsum("ijka,likb->ljab", x40, x56)
    l2new_abab += einsum("ijab->abij", x529)
    l2new_baba += einsum("ijab->baji", x529)
    del x529
    x548 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x548 += einsum("ia,jikb->jkab", x41, x56)
    l2new_abab += einsum("ijab->abij", x548) * -1
    l2new_baba += einsum("ijab->baji", x548) * -1
    del x548
    l1new_aa += einsum("ijab,kijb->ak", x48, x56) * -1
    del x48
    l1new_bb -= einsum("ijab,jika->bk", v.aabb.oovv, x56)
    l2new_abab += einsum("ijka,iklb->abjl", x531, x56)
    l2new_baba += einsum("ijka,ijlb->balk", x531, x56) * -1
    del x531
    x57 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x57 += einsum("ia,abjk->kjib", t1.aa, l2.aaaa)
    x58 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x58 += einsum("ijka->ijka", x57)
    x58 += einsum("ijka->jika", x57) * -1
    x59 += einsum("ijab,kila->kljb", x23, x58)
    x64 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x64 += einsum("ia,jikb->jkba", t1.aa, x58) * -1
    l1new_aa += einsum("iabc,jiac->bj", x36, x64)
    del x64
    l2new_abab += einsum("ijka,ljib->balk", x26, x58) * -1
    del x58
    x61 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x61 += einsum("ijka->ijka", x57) * -1
    x61 += einsum("ijka->jika", x57)
    x63 += einsum("ijab,kila->kljb", t2.abab, x61) * -1
    x423 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x423 += einsum("ijka,iljb->lkba", x422, x61)
    del x422
    x443 += einsum("ijab->ijab", x423)
    del x423
    l1new_aa += einsum("ijab,kjia->bk", x28, x61) * -1
    del x28
    del x61
    x79 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x79 += einsum("ia,jkla->kjli", t1.aa, x57)
    x80 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x80 += einsum("ijkl->ijkl", x79) * -1
    x80 += einsum("ijkl->ijlk", x79)
    x491 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x491 += einsum("iajb,klji->lkab", v.aaaa.ovov, x79)
    del x79
    x494 += einsum("ijab->ijab", x491)
    del x491
    x442 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x442 += einsum("ia,jkib->jkba", x14, x57)
    del x14
    x443 += einsum("ijab->ijab", x442) * -1
    del x442
    x448 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x448 += einsum("iabc,jkib->kjac", v.aaaa.ovvv, x57)
    x486 -= einsum("ijab->ijab", x448)
    del x448
    x459 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x459 -= einsum("ijka->ijka", x57)
    x459 += einsum("ijka->jika", x57)
    x562 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x562 += einsum("ijka->ijka", x57)
    x562 -= einsum("ijka->jika", x57)
    l2new_baba += einsum("ijka,ljib->abkl", x26, x562) * -1
    del x26
    del x562
    x60 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x60 -= einsum("iajb->jiab", v.aaaa.ovov)
    x60 += einsum("iajb->jiba", v.aaaa.ovov)
    l1new_aa += einsum("ijka,jkba->bi", x59, x60) * -1
    del x59
    del x60
    x63 += einsum("ai,jkab->ijkb", l1.aa, t2.abab) * -1
    l1new_aa += einsum("iajb,kijb->ak", v.aabb.ovov, x63)
    del x63
    x65 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x65 += einsum("ia,bcda->ibdc", t1.aa, v.aaaa.vvvv)
    x66 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x66 += einsum("iabc->iabc", x65) * -1
    del x65
    x66 += einsum("aibc->iabc", v.aaaa.vovv)
    x67 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x67 += einsum("iabc->iabc", x66) * -1
    x67 += einsum("iabc->ibac", x66)
    del x66
    l1new_aa += einsum("abij,iabc->cj", l2.aaaa, x67) * -1
    del x67
    x68 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x68 += einsum("ai,jkba->ijkb", l1.aa, t2.aaaa)
    x71 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x71 += einsum("ijka->ijka", x68)
    del x68
    x69 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x69 += einsum("abij,klba->ijlk", l2.aaaa, t2.aaaa)
    x70 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x70 += einsum("ia,jikl->jkla", t1.aa, x69)
    x71 += einsum("ijka->ijka", x70)
    del x70
    x72 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x72 += einsum("ijka->ikja", x71)
    x72 += einsum("ijka->ijka", x71) * -1
    del x71
    l1new_aa += einsum("iajb,kija->bk", v.aaaa.ovov, x72)
    del x72
    x125 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x125 += einsum("ijkl->jikl", x69)
    x125 += einsum("ijkl->jilk", x69) * -1
    l1new_aa += einsum("ijka,jlik->al", v.aaaa.ooov, x125) * -1
    del x125
    x490 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x490 += einsum("iajb,klij->lkba", v.aaaa.ovov, x69)
    del x69
    x494 += einsum("ijab->ijab", x490)
    del x490
    l2new_aaaa = np.zeros((nvir[0], nvir[0], nocc[0], nocc[0]), dtype=np.float64)
    l2new_aaaa += einsum("ijab->abij", x494)
    l2new_aaaa += einsum("ijab->baij", x494) * -1
    del x494
    x73 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x73 += einsum("abci->iabc", v.aabb.vvvo)
    x73 += einsum("ia,bcda->ibcd", t1.bb, v.aabb.vvvv)
    l1new_aa += einsum("abij,jacb->ci", l2.abab, x73)
    del x73
    x74 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x74 += einsum("wx,wia->xia", s2, g.aa.bov)
    x77 += einsum("wia->wia", x74)
    x550 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x550 += einsum("wia->wia", x74)
    del x74
    x75 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x75 += einsum("wia,jbia->wjb", u11.bb, v.aabb.ovov)
    x77 += einsum("wia->wia", x75)
    x217 += einsum("wia->wia", x75)
    x242 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x242 += einsum("wia->wia", x75)
    x477 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x477 += einsum("wia->wia", x75)
    x550 += einsum("wia->wia", x75)
    del x75
    x77 += einsum("wia->wia", gc.aa.bov)
    x78 += einsum("wia,xja->wxji", u11.aa, x77)
    l1new_aa += einsum("wxai,wxji->aj", lu12.aa, x78) * -1
    del x78
    x566 += einsum("wia,ijba->wjb", x77, x23) * -1
    x570 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x570 += einsum("wia,ijab->wjb", x77, t2.abab) * -1
    del x77
    x81 += einsum("ijka->ikja", v.aaaa.ooov) * -1
    l1new_aa += einsum("ijkl,klja->ai", x80, x81) * -1
    del x80
    del x81
    x82 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x82 += einsum("w,wai->ia", s1, g.aa.bvo)
    x124 += einsum("ia->ia", x82)
    del x82
    x83 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x83 += einsum("wab,wib->ia", g.aa.bvv, u11.aa)
    x124 += einsum("ia->ia", x83)
    del x83
    x84 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x84 += einsum("ia,iabj->jb", t1.bb, v.bbaa.ovvo)
    x124 += einsum("ia->ia", x84)
    del x84
    x85 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x85 += einsum("ijab,ikja->kb", t2.aaaa, v.aaaa.ooov)
    x124 += einsum("ia->ia", x85)
    del x85
    x86 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x86 += einsum("ijab,jbca->ic", t2.abab, v.bbaa.ovvv)
    x124 += einsum("ia->ia", x86)
    del x86
    x87 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x87 += einsum("ijab->jiab", t2.aaaa) * -1
    x87 += einsum("ijab->jiba", t2.aaaa)
    x88 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x88 += einsum("iabc,ijca->jb", v.aaaa.ovvv, x87)
    x124 += einsum("ia->ia", x88) * -1
    del x88
    x166 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x166 += einsum("ijka,ijba->kb", x57, x87)
    x179 += einsum("ia->ia", x166) * -1
    del x166
    x507 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x507 += einsum("ijab,ikca->jkbc", x12, x87)
    del x87
    x509 += einsum("ijab->ijba", x507)
    del x507
    x89 += einsum("ijka->ikja", v.aaaa.ooov)
    x90 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x90 += einsum("ijab,jika->kb", t2.aaaa, x89)
    del x89
    x124 += einsum("ia->ia", x90) * -1
    del x90
    x93 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x93 += einsum("w,wia->ia", s1, g.bb.bov)
    x97 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x97 += einsum("ia->ia", x93)
    x287 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x287 += einsum("ia->ia", x93)
    x367 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x367 += einsum("ia->ia", x93)
    x561 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x561 += einsum("ia->ia", x93)
    del x93
    x94 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x94 += einsum("ia,iajb->jb", t1.aa, v.aabb.ovov)
    x97 += einsum("ia->ia", x94)
    x266 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x266 += einsum("ia->ia", x94)
    x384 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x384 += einsum("ia->ia", x94)
    x561 += einsum("ia->ia", x94)
    del x94
    x95 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x95 += einsum("iajb->jiab", v.bbbb.ovov)
    x95 += einsum("iajb->jiba", v.bbbb.ovov) * -1
    x96 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x96 += einsum("ia,ijab->jb", t1.bb, x95)
    x97 += einsum("ia->ia", x96) * -1
    x266 += einsum("ia->ia", x96) * -1
    del x96
    x267 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x267 += einsum("ia,jkab->jkib", x266, t2.bbbb)
    x272 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x272 += einsum("ijka->jika", x267)
    del x267
    x402 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x402 += einsum("ia,ja->ij", t1.bb, x266)
    x403 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x403 += einsum("ij->ij", x402)
    del x402
    x224 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x224 += einsum("wia,ijab->wjb", u11.bb, x95) * 0.5
    x225 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x225 += einsum("wia->wia", x224) * -1
    del x224
    x310 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x310 += einsum("wia,ijab->wjb", u11.bb, x95)
    x311 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x311 += einsum("wia->wia", x310) * -1
    x324 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x324 += einsum("wia->wia", x310) * -1
    del x310
    x396 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x396 += einsum("wxia,ijab->wxjb", u12.bb, x95)
    x397 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x397 += einsum("wxia->xwia", x396) * -1
    del x396
    x401 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x401 += einsum("ijab,ikab->jk", t2.bbbb, x95)
    x403 += einsum("ij->ij", x401) * -1
    del x401
    x501 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x501 += einsum("ijab,jkbc->ikac", t2.abab, x95)
    x502 += einsum("ijab->ijab", x501) * -1
    del x501
    x97 += einsum("ia->ia", f.bb.ov)
    x98 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x98 += einsum("ia,jiba->jb", x97, t2.abab)
    x124 += einsum("ia->ia", x98)
    del x98
    x135 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x135 += einsum("ia,ijab->jb", x97, x38)
    x160 += einsum("ia->ia", x135) * -1
    del x135
    x150 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x150 += einsum("ia,ja->ij", t1.bb, x97)
    x151 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x151 += einsum("ij->ji", x150)
    del x150
    x230 += einsum("ia,wxia->xw", x97, u12.bb) * 0.5
    x253 = np.zeros((nbos), dtype=np.float64)
    x253 += einsum("ia,wia->w", x97, u11.bb)
    x255 += einsum("w->w", x253)
    del x253
    x286 += einsum("ia,jkba->jikb", x97, t2.abab)
    x312 += einsum("ia,wxja->xwij", x97, u12.bb) * 0.5
    x323 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x323 += einsum("ia,wja->wji", x97, u11.bb)
    x327 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x327 += einsum("wij->wji", x323)
    del x323
    x328 += einsum("ia,wxia->xw", x97, u12.bb)
    x549 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x549 += einsum("ia,jkib->jkba", x97, x1)
    l2new_abab += einsum("ijab->abij", x549) * -1
    l2new_baba += einsum("ijab->baji", x549) * -1
    del x549
    lu11new_bb = np.zeros((nbos, nvir[1], nocc[1]), dtype=np.float64)
    lu11new_bb += einsum("w,ia->wai", ls1, x97) * 2
    lu12new_bb += einsum("wx,ia->xwai", ls2, x97) * 2
    x100 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x100 += einsum("ia,wja->wji", t1.aa, g.aa.bov)
    x101 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x101 += einsum("wij->wij", x100)
    x596 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x596 += einsum("wij->wij", x100)
    x101 += einsum("wij->wij", g.aa.boo)
    x102 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x102 += einsum("wia,wij->ja", u11.aa, x101)
    x124 += einsum("ia->ia", x102) * -1
    del x102
    x219 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x219 += einsum("wx,wij->xij", s2, x101)
    x220 += einsum("wij->wij", x219)
    del x219
    x566 += einsum("wij,wxia->xja", x101, u12.aa)
    x103 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x103 += einsum("w,wij->ij", s1, g.aa.boo)
    x112 += einsum("ij->ij", x103)
    x470 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x470 += einsum("ij->ij", x103)
    del x103
    x104 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x104 += einsum("wia,wja->ij", g.aa.bov, u11.aa)
    x112 += einsum("ij->ij", x104)
    x470 += einsum("ij->ij", x104)
    del x104
    x105 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x105 += einsum("ia,jkia->jk", t1.bb, v.aabb.ooov)
    x112 += einsum("ij->ij", x105)
    x474 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x474 += einsum("ij->ij", x105)
    del x105
    x106 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x106 += einsum("ijab,kajb->ik", t2.abab, v.aabb.ovov)
    x112 += einsum("ij->ji", x106)
    x434 += einsum("ij->ij", x106)
    del x106
    x435 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x435 += einsum("ij,abik->kjab", x434, l2.aaaa)
    del x434
    x443 += einsum("ijab->ijba", x435) * -1
    del x435
    x107 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x107 += einsum("iajb->jiab", v.aaaa.ovov) * -1
    x107 += einsum("iajb->jiba", v.aaaa.ovov)
    x108 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x108 += einsum("ijab,ikba->jk", t2.aaaa, x107)
    x112 += einsum("ij->ji", x108) * -1
    del x108
    x419 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x419 += einsum("ijab,ikbc->kjca", x107, x23)
    del x23
    x420 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x420 += einsum("ijab->ijab", x419)
    del x419
    x534 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x534 += einsum("ijab,ijcb->ac", t2.aaaa, x107)
    del x107
    x535 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x535 += einsum("ab->ab", x534) * -1
    del x534
    x109 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x109 += einsum("ijka->ikja", v.aaaa.ooov) * -1
    x109 += einsum("ijka->kija", v.aaaa.ooov)
    x110 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x110 += einsum("ia,jika->jk", t1.aa, x109)
    x112 += einsum("ij->ij", x110) * -1
    del x110
    x215 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x215 += einsum("wia,jika->wjk", u11.aa, x109)
    x220 += einsum("wij->wij", x215) * -1
    del x215
    x112 += einsum("ij->ij", f.aa.oo)
    x113 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x113 += einsum("ia,ij->ja", t1.aa, x112)
    x124 += einsum("ia->ia", x113) * -1
    del x113
    x540 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x540 += einsum("ij,abjk->ikab", x112, l2.abab)
    l2new_abab += einsum("ijab->abij", x540) * -1
    l2new_baba += einsum("ijab->baji", x540) * -1
    del x540
    x566 += einsum("ij,wia->wja", x112, u11.aa)
    l1new_aa += einsum("ai,ji->aj", l1.aa, x112) * -1
    lu12new_aa += einsum("ij,wxaj->xwai", x112, lu12.aa) * -1
    del x112
    x114 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x114 += einsum("w,wab->ab", s1, g.aa.bvv)
    x118 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x118 += einsum("ab->ab", x114)
    x463 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x463 += einsum("ab->ab", x114)
    x535 += einsum("ab->ab", x114)
    del x114
    x115 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x115 += einsum("ia,iabc->bc", t1.bb, v.bbaa.ovvv)
    x118 += einsum("ab->ab", x115)
    x466 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x466 += einsum("ab->ab", x115)
    x535 += einsum("ab->ab", x115)
    del x115
    x116 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x116 += einsum("iabc->ibac", v.aaaa.ovvv)
    x116 += einsum("iabc->ibca", v.aaaa.ovvv) * -1
    x117 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x117 += einsum("ia,ibca->bc", t1.aa, x116)
    x118 += einsum("ab->ab", x117) * -1
    x535 += einsum("ab->ab", x117) * -1
    del x117
    x563 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x563 += einsum("wia,ibca->wbc", u11.aa, x116) * -1
    del x116
    x118 += einsum("ab->ab", f.aa.vv)
    x119 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x119 += einsum("ia,ba->ib", t1.aa, x118)
    x124 += einsum("ia->ia", x119)
    del x119
    l1new_aa += einsum("ai,ab->bi", l1.aa, x118)
    del x118
    x120 = np.zeros((nbos), dtype=np.float64)
    x120 += einsum("ia,wia->w", t1.aa, g.aa.bov)
    x122 = np.zeros((nbos), dtype=np.float64)
    x122 += einsum("w->w", x120)
    x573 = np.zeros((nbos), dtype=np.float64)
    x573 += einsum("w->w", x120)
    del x120
    x121 = np.zeros((nbos), dtype=np.float64)
    x121 += einsum("ia,wia->w", t1.bb, g.bb.bov)
    x122 += einsum("w->w", x121)
    x573 += einsum("w->w", x121)
    del x121
    x122 += einsum("w->w", G)
    x123 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x123 += einsum("w,wia->ia", x122, u11.aa)
    x124 += einsum("ia->ia", x123)
    del x123
    x159 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x159 += einsum("w,wia->ia", x122, u11.bb)
    x160 += einsum("ia->ia", x159)
    del x159
    x254 = np.zeros((nbos), dtype=np.float64)
    x254 += einsum("w,wx->x", x122, s2)
    x255 += einsum("w->w", x254)
    del x254
    x566 += einsum("w,wxia->xia", x122, u12.aa) * -1
    x570 += einsum("w,wxia->xia", x122, u12.bb) * -1
    del x122
    x124 += einsum("ai->ia", f.aa.vo)
    l1new_aa += einsum("ia,ijba->bj", x124, x52)
    del x52
    l1new_bb += einsum("ia,abij->bj", x124, l2.abab)
    ls1new = np.zeros((nbos), dtype=np.float64)
    ls1new += einsum("ia,wai->w", x124, lu11.aa)
    ls2new = np.zeros((nbos, nbos), dtype=np.float64)
    ls2new += einsum("ia,wxai->xw", x124, lu12.aa)
    del x124
    x126 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x126 += einsum("w,wai->ia", s1, g.bb.bvo)
    x160 += einsum("ia->ia", x126)
    del x126
    x127 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x127 += einsum("wab,wib->ia", g.bb.bvv, u11.bb)
    x160 += einsum("ia->ia", x127)
    del x127
    x128 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x128 += einsum("ia,iabj->jb", t1.aa, v.aabb.ovvo)
    x160 += einsum("ia->ia", x128)
    del x128
    x129 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x129 += einsum("ijab,iacb->jc", t2.abab, v.aabb.ovvv)
    x160 += einsum("ia->ia", x129)
    del x129
    x130 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x130 += einsum("ia,jbka->ijkb", t1.bb, v.bbbb.ovov)
    x131 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x131 += einsum("ijka->ikja", x130)
    x131 += einsum("ijka->ijka", x130) * -1
    x269 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x269 += einsum("ia,jkla->ijkl", t1.bb, x130)
    x270 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x270 += einsum("ijkl->ijkl", x269)
    x413 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x413 += einsum("ijkl->ijkl", x269)
    del x269
    x283 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x283 += einsum("ijka->jkia", x130) * -1
    x283 += einsum("ijka->kjia", x130)
    x381 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x381 += einsum("ijka->ijka", x130)
    x391 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x391 += einsum("ijka->ikja", x130)
    x391 += einsum("ijka->ijka", x130) * -1
    del x130
    x530 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x530 += einsum("ijka,jklb->ilab", x1, x391)
    l2new_abab += einsum("ijab->abij", x530) * -1
    l2new_baba += einsum("ijab->baji", x530) * -1
    del x530
    x131 += einsum("ijka->jkia", v.bbbb.ooov) * -1
    x131 += einsum("ijka->jika", v.bbbb.ooov)
    x132 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x132 += einsum("ijab,kjia->kb", t2.bbbb, x131)
    x160 += einsum("ia->ia", x132) * -1
    del x132
    x273 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x273 += einsum("ijka,jlab->likb", x131, x38)
    del x131
    x278 += einsum("ijka->jkia", x273)
    x290 += einsum("ijka->jkia", x273)
    del x273
    x137 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x137 += einsum("iabj->ijba", v.bbbb.ovvo)
    x137 += einsum("ijab->ijab", v.bbbb.oovv) * -1
    x138 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x138 += einsum("ia,ijba->jb", t1.bb, x137)
    x160 += einsum("ia->ia", x138)
    del x138
    x275 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x275 += einsum("ia,jkba->ijkb", t1.bb, x137)
    x278 += einsum("ijka->ijka", x275)
    x290 += einsum("ijka->ijka", x275)
    del x275
    x570 += einsum("wia,ijba->wjb", u11.bb, x137) * -1
    x139 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x139 += einsum("ia,wja->wji", t1.bb, g.bb.bov)
    x140 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x140 += einsum("wij->wij", x139)
    x598 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x598 += einsum("wij->wij", x139)
    x140 += einsum("wij->wij", g.bb.boo)
    x141 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x141 += einsum("wia,wij->ja", u11.bb, x140)
    x160 += einsum("ia->ia", x141) * -1
    del x141
    x326 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x326 += einsum("wx,wij->xij", s2, x140)
    x327 += einsum("wij->wij", x326)
    del x326
    x570 += einsum("wij,wxia->xja", x140, u12.bb)
    x142 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x142 += einsum("w,wij->ij", s1, g.bb.boo)
    x151 += einsum("ij->ij", x142)
    x369 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x369 += einsum("ij->ij", x142)
    del x142
    x143 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x143 += einsum("wia,wja->ij", g.bb.bov, u11.bb)
    x151 += einsum("ij->ij", x143)
    x369 += einsum("ij->ij", x143)
    del x143
    x144 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x144 += einsum("ia,iajk->jk", t1.aa, v.aabb.ovoo)
    x151 += einsum("ij->ij", x144)
    x373 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x373 += einsum("ij->ij", x144)
    del x144
    x145 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x145 += einsum("ijab,iakb->jk", t2.abab, v.aabb.ovov)
    x151 += einsum("ij->ji", x145)
    x403 += einsum("ij->ij", x145)
    del x145
    x404 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x404 += einsum("ij,abik->kjab", x403, l2.bbbb)
    del x403
    x412 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x412 += einsum("ijab->ijba", x404) * -1
    del x404
    x146 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x146 += einsum("iajb->jiab", v.bbbb.ovov) * -1
    x146 += einsum("iajb->jiba", v.bbbb.ovov)
    x147 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x147 += einsum("ijab,ikba->jk", t2.bbbb, x146)
    x151 += einsum("ij->ji", x147) * -1
    del x147
    x406 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x406 += einsum("ijab,ijbc->ac", t2.bbbb, x146)
    x407 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x407 += einsum("ab->ab", x406) * -1
    del x406
    x512 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x512 += einsum("ijab,ikbc->kjca", x146, x38)
    x514 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x514 += einsum("ijab->jiab", x512)
    del x512
    x537 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x537 += einsum("ijab,ijcb->ac", t2.bbbb, x146)
    x538 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x538 += einsum("ab->ab", x537) * -1
    del x537
    x148 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x148 += einsum("ijka->ikja", v.bbbb.ooov)
    x148 += einsum("ijka->kija", v.bbbb.ooov) * -1
    x149 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x149 += einsum("ia,ijka->jk", t1.bb, x148)
    x151 += einsum("ij->ij", x149) * -1
    del x149
    x322 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x322 += einsum("wia,ijka->wjk", u11.bb, x148)
    x327 += einsum("wij->wij", x322) * -1
    del x322
    x151 += einsum("ij->ij", f.bb.oo)
    x152 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x152 += einsum("ia,ij->ja", t1.bb, x151)
    x160 += einsum("ia->ia", x152) * -1
    del x152
    x541 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x541 += einsum("ij,abkj->kiab", x151, l2.abab)
    l2new_abab += einsum("ijab->abij", x541) * -1
    l2new_baba += einsum("ijab->baji", x541) * -1
    del x541
    x570 += einsum("ij,wia->wja", x151, u11.bb)
    l1new_bb += einsum("ai,ji->aj", l1.bb, x151) * -1
    lu12new_bb += einsum("ij,wxaj->xwai", x151, lu12.bb) * -1
    del x151
    x153 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x153 += einsum("w,wab->ab", s1, g.bb.bvv)
    x157 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x157 += einsum("ab->ab", x153)
    x362 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x362 += einsum("ab->ab", x153)
    x538 += einsum("ab->ab", x153)
    del x153
    x154 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x154 += einsum("ia,iabc->bc", t1.aa, v.aabb.ovvv)
    x157 += einsum("ab->ab", x154)
    x365 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x365 += einsum("ab->ab", x154)
    x538 += einsum("ab->ab", x154)
    del x154
    x155 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x155 += einsum("iabc->ibac", v.bbbb.ovvv) * -1
    x155 += einsum("iabc->ibca", v.bbbb.ovvv)
    x156 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x156 += einsum("ia,ibac->bc", t1.bb, x155)
    x157 += einsum("ab->ab", x156) * -1
    x538 += einsum("ab->ab", x156) * -1
    del x156
    x513 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x513 += einsum("ia,jbca->ijbc", t1.bb, x155)
    x514 += einsum("ijab->jiab", x513) * -1
    del x513
    x567 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x567 += einsum("wia,ibac->wbc", u11.bb, x155) * -1
    x157 += einsum("ab->ab", f.bb.vv)
    x158 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x158 += einsum("ia,ba->ib", t1.bb, x157)
    x160 += einsum("ia->ia", x158)
    del x158
    l1new_bb += einsum("ai,ab->bi", l1.bb, x157)
    del x157
    x160 += einsum("ai->ia", f.bb.vo)
    l1new_aa += einsum("ia,baji->bj", x160, l2.abab)
    ls1new += einsum("ia,wai->w", x160, lu11.bb)
    ls2new += einsum("ia,wxai->xw", x160, lu12.bb)
    x161 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x161 += einsum("w,wia->ia", ls1, u11.aa)
    x179 += einsum("ia->ia", x161) * -1
    del x161
    x162 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x162 += einsum("wx,wxia->ia", ls2, u12.aa)
    x179 += einsum("ia->ia", x162) * -0.5
    del x162
    x163 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x163 += einsum("ai,jiba->jb", l1.bb, t2.abab)
    x179 += einsum("ia->ia", x163) * -1
    del x163
    x168 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x168 += einsum("ia,waj->wji", t1.aa, lu11.aa)
    x170 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x170 += einsum("wij->wij", x168)
    x239 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x239 += einsum("wij->wij", x168)
    x169 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x169 += einsum("wia,wxaj->xji", u11.aa, lu12.aa)
    x170 += einsum("wij->wij", x169)
    x171 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x171 += einsum("wia,wij->ja", u11.aa, x170)
    x179 += einsum("ia->ia", x171)
    del x171
    x244 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x244 += einsum("wx,wij->xij", s2, x170)
    del x170
    x239 += einsum("wij->wij", x169)
    x607 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x607 += einsum("wia,xji->wxja", g.aa.bov, x239)
    x609 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x609 += einsum("wxia->wxia", x607)
    del x607
    x576 = np.zeros((nbos, nbos), dtype=np.float64)
    x576 += einsum("wij,xji->wx", g.aa.boo, x169)
    x602 -= einsum("wx->wx", x576)
    del x576
    x584 = np.zeros((nbos, nbos), dtype=np.float64)
    x584 += einsum("wij,xji->wx", x100, x169)
    del x169
    del x100
    x602 -= einsum("wx->wx", x584)
    del x584
    x172 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x172 += einsum("ai,ja->ij", l1.aa, t1.aa)
    x177 += einsum("ij->ij", x172)
    x479 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x479 += einsum("ij->ij", x172)
    del x172
    x173 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x173 += einsum("wai,wja->ij", lu11.aa, u11.aa)
    x177 += einsum("ij->ij", x173)
    x479 += einsum("ij->ij", x173)
    del x173
    x480 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x480 += einsum("ij,jakb->kiab", x479, v.aaaa.ovov)
    del x479
    x486 += einsum("ijab->jiba", x480)
    del x480
    x174 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x174 += einsum("wxai,wxja->ij", lu12.aa, u12.aa)
    x177 += einsum("ij->ij", x174) * 0.5
    x440 += einsum("ij->ij", x174) * 0.5
    del x174
    x175 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x175 += einsum("abij,kjab->ik", l2.abab, t2.abab)
    x177 += einsum("ij->ij", x175)
    x178 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x178 += einsum("ia,ij->ja", t1.aa, x177)
    x179 += einsum("ia->ia", x178)
    del x178
    x546 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x546 += einsum("ij,jakb->ikab", x177, v.aabb.ovov)
    l2new_abab += einsum("ijab->abij", x546) * -1
    l2new_baba += einsum("ijab->baji", x546) * -1
    del x546
    l1new_aa += einsum("ij,kjia->ak", x177, x109) * -1
    del x109
    l1new_aa += einsum("ij,ja->ai", x177, x41) * -1
    del x41
    l1new_bb += einsum("ij,jika->ak", x177, v.aabb.ooov) * -1
    ls1new += einsum("ij,wji->w", x177, g.aa.boo) * -1
    del x177
    x440 += einsum("ij->ij", x175)
    del x175
    x441 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x441 += einsum("ij,jakb->kiab", x440, v.aaaa.ovov)
    del x440
    x443 += einsum("ijab->jiba", x441)
    del x441
    x179 += einsum("ia->ia", t1.aa) * -1
    l1new_aa += einsum("ia,ijba->bj", x179, x12) * -1
    l1new_bb += einsum("ia,iajb->bj", x179, v.aabb.ovov) * -1
    ls1new += einsum("ia,wia->w", x179, g.aa.bov) * -1
    del x179
    x180 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x180 += einsum("ai,ib->ab", l1.aa, t1.aa)
    x185 += einsum("ab->ab", x180) * 2
    ls1new += einsum("ab,wab->w", x180, g.aa.bvv)
    del x180
    x181 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x181 += einsum("wai,wib->ab", lu11.aa, u11.aa)
    x185 += einsum("ab->ab", x181) * 2
    x446 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x446 += einsum("ab,icjb->ijac", x181, v.aaaa.ovov)
    x486 += einsum("ijab->ijab", x446)
    del x446
    x542 += einsum("ab->ab", x181)
    del x181
    x182 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x182 += einsum("wxai,wxib->ab", lu12.aa, u12.aa)
    x185 += einsum("ab->ab", x182)
    x430 += einsum("ab->ab", x182) * 0.5
    x542 += einsum("ab->ab", x182) * 0.5
    del x182
    x183 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x183 += einsum("abij,ijcb->ac", l2.abab, t2.abab)
    x185 += einsum("ab->ab", x183) * 2
    l1new_aa += einsum("ab,iacb->ci", x185, x36) * -0.5
    del x36
    l1new_bb += einsum("ab,icab->ci", x185, v.bbaa.ovvv) * 0.5
    del x185
    x430 += einsum("ab->ab", x183)
    x431 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x431 += einsum("ab,ibjc->ijca", x430, v.aaaa.ovov)
    del x430
    x443 += einsum("ijab->jiba", x431)
    del x431
    x542 += einsum("ab->ab", x183)
    del x183
    x543 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x543 += einsum("ab,ibjc->ijac", x542, v.aabb.ovov)
    l2new_abab += einsum("ijab->abij", x543) * -1
    l2new_baba += einsum("ijab->baji", x543) * -1
    del x543
    ls1new += einsum("ab,wab->w", x542, g.aa.bvv)
    del x542
    x186 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x186 += einsum("w,wia->ia", ls1, u11.bb)
    x206 += einsum("ia->ia", x186) * -1
    x318 += einsum("ia->ia", x186) * -2
    del x186
    x187 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x187 += einsum("wx,wxia->ia", ls2, u12.bb)
    x206 += einsum("ia->ia", x187) * -0.5
    x318 += einsum("ia->ia", x187) * -1
    del x187
    x188 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x188 += einsum("ai,ijab->jb", l1.aa, t2.abab)
    x206 += einsum("ia->ia", x188) * -1
    x318 += einsum("ia->ia", x188) * -2
    del x188
    x189 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x189 += einsum("ia,wxaj->wxji", t1.bb, lu12.bb)
    x190 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x190 += einsum("wxia,wxij->ja", u12.bb, x189)
    x206 += einsum("ia->ia", x190) * 0.5
    x318 += einsum("ia->ia", x190)
    del x190
    x292 += einsum("wxia,wxjk->jkia", u12.bb, x189) * 0.5
    x296 += einsum("wxia,wxjk->ijka", u12.aa, x189) * -0.5
    x585 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x585 += einsum("wia,xwij->xja", u11.bb, x189)
    x586 = np.zeros((nbos, nbos), dtype=np.float64)
    x586 += einsum("wia,xia->wx", g.bb.bov, x585)
    del x585
    x602 -= einsum("wx->wx", x586)
    del x586
    lu12new_aa -= einsum("iajk,wxkj->xwai", v.aabb.ovoo, x189)
    lu12new_aa -= einsum("wxij,kija->xwak", x189, x39)
    del x39
    lu12new_bb += einsum("wxij,ijka->xwak", x189, x391) * -1
    lu12new_bb += einsum("ia,wxji->xwaj", x97, x189) * -1
    x192 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x192 += einsum("ia,bajk->jkib", t1.bb, l2.bbbb)
    x193 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x193 += einsum("ijka,jiba->kb", x192, x38)
    x206 += einsum("ia->ia", x193) * -1
    del x193
    x291 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x291 += einsum("ijka->ijka", x192)
    x291 += einsum("ijka->jika", x192) * -1
    x292 += einsum("ijka,jlab->iklb", x291, x38)
    x296 += einsum("ijab,jklb->ikla", t2.abab, x291) * -1
    l1new_bb += einsum("ijab,kjia->bk", x137, x291)
    del x137
    l2new_baba += einsum("ijka,lkib->abjl", x291, x40)
    del x291
    x297 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x297 += einsum("ijka->ijka", x192) * -1
    x297 += einsum("ijka->jika", x192)
    x298 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x298 += einsum("ia,ijkb->jkba", t1.bb, x297) * -1
    x392 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x392 += einsum("ijka,ilkb->jlab", x297, x391)
    del x391
    x412 += einsum("ijab->ijab", x392)
    del x392
    l2new_abab += einsum("ijka,lkib->balj", x297, x40) * -1
    del x40
    del x297
    x304 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x304 += einsum("ia,jkla->jkil", t1.bb, x192)
    x305 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x305 += einsum("ijkl->ijkl", x304)
    x317 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x317 += einsum("ijkl->ijkl", x304)
    x317 += einsum("ijkl->ijlk", x304) * -1
    l1new_bb += einsum("ijka,ljki->al", v.bbbb.ooov, x317)
    del x317
    x415 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x415 += einsum("ijkl->ijkl", x304)
    del x304
    x318 += einsum("ijka,jiba->kb", x192, x38) * -2
    x348 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x348 += einsum("iabc,jkib->kjac", v.bbbb.ovvv, x192)
    x385 -= einsum("ijab->ijab", x348)
    del x348
    x358 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x358 -= einsum("ijka->ijka", x192)
    x358 += einsum("ijka->jika", x192)
    x411 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x411 += einsum("ia,jkib->jkba", x266, x192)
    del x266
    x412 += einsum("ijab->ijab", x411) * -1
    del x411
    x195 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x195 += einsum("ia,waj->wji", t1.bb, lu11.bb)
    x197 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x197 += einsum("wij->wij", x195)
    x626 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x626 += einsum("wij->wij", x195)
    x196 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x196 += einsum("wia,wxaj->xji", u11.bb, lu12.bb)
    x197 += einsum("wij->wij", x196)
    x198 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x198 += einsum("wia,wij->ja", u11.bb, x197)
    x206 += einsum("ia->ia", x198)
    del x198
    x318 += einsum("wia,wij->ja", u11.bb, x197) * 2
    x340 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x340 += einsum("wx,wij->xij", s2, x197)
    x579 = np.zeros((nbos, nbos), dtype=np.float64)
    x579 += einsum("wij,xji->wx", g.bb.boo, x196)
    x602 -= einsum("wx->wx", x579)
    del x579
    x587 = np.zeros((nbos, nbos), dtype=np.float64)
    x587 += einsum("wij,xji->wx", x139, x196)
    del x139
    x602 -= einsum("wx->wx", x587)
    del x587
    x626 += einsum("wij->wij", x196)
    del x196
    x627 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x627 += einsum("wia,xji->wxja", g.bb.bov, x626)
    del x626
    x629 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x629 += einsum("wxia->wxia", x627)
    del x627
    x199 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x199 += einsum("ai,ja->ij", l1.bb, t1.bb)
    x204 += einsum("ij->ij", x199)
    x222 += einsum("ij->ij", x199) * 2
    x378 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x378 += einsum("ij->ij", x199)
    ls1new -= einsum("ij,wji->w", x199, g.bb.boo)
    del x199
    x200 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x200 += einsum("wai,wja->ij", lu11.bb, u11.bb)
    x204 += einsum("ij->ij", x200)
    x222 += einsum("ij->ij", x200) * 2
    x378 += einsum("ij->ij", x200)
    x379 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x379 += einsum("ij,jakb->kiab", x378, v.bbbb.ovov)
    del x378
    x385 += einsum("ijab->jiba", x379)
    del x379
    x572 += einsum("ij->ij", x200)
    del x200
    x201 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x201 += einsum("wxai,wxja->ij", lu12.bb, u12.bb)
    x204 += einsum("ij->ij", x201) * 0.5
    x222 += einsum("ij->ij", x201)
    x409 += einsum("ij->ij", x201) * 0.5
    x572 += einsum("ij->ij", x201) * 0.5
    del x201
    x202 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x202 += einsum("abij,ikab->jk", l2.abab, t2.abab)
    x204 += einsum("ij->ij", x202)
    x205 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x205 += einsum("ia,ij->ja", t1.bb, x204)
    x206 += einsum("ia->ia", x205)
    del x205
    x318 += einsum("ia,ij->ja", t1.bb, x204) * 2
    l1new_bb += einsum("ij,jkia->ak", x204, x148) * -1
    del x148
    l1new_bb += einsum("ij,ja->ai", x204, x97) * -1
    del x97
    del x204
    x222 += einsum("ij->ij", x202) * 2
    x547 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x547 += einsum("ij,kajb->kiab", x222, v.aabb.ovov) * 0.5
    l2new_abab += einsum("ijab->abij", x547) * -1
    l2new_baba += einsum("ijab->baji", x547) * -1
    del x547
    l1new_aa += einsum("ij,kaji->ak", x222, v.aabb.ovoo) * -0.5
    del x222
    x409 += einsum("ij->ij", x202)
    x410 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x410 += einsum("ij,jakb->kiab", x409, v.bbbb.ovov)
    del x409
    x412 += einsum("ijab->jiba", x410)
    del x410
    x572 += einsum("ij->ij", x202)
    del x202
    ls1new += einsum("ij,wji->w", x572, g.bb.boo) * -1
    del x572
    x206 += einsum("ia->ia", t1.bb) * -1
    l1new_aa += einsum("ia,jbia->bj", x206, v.aabb.ovov) * -1
    ls1new += einsum("ia,wia->w", x206, g.bb.bov) * -1
    del x206
    x207 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x207 += einsum("ai,ib->ab", l1.bb, t1.bb)
    x212 += einsum("ab->ab", x207)
    x571 += einsum("ab->ab", x207) * 2
    del x207
    x208 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x208 += einsum("wai,wib->ab", lu11.bb, u11.bb)
    x212 += einsum("ab->ab", x208)
    x345 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x345 += einsum("ab,icjb->ijac", x208, v.bbbb.ovov)
    x385 += einsum("ijab->ijab", x345)
    del x345
    x544 += einsum("ab->ab", x208)
    x571 += einsum("ab->ab", x208) * 2
    del x208
    x209 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x209 += einsum("wxai,wxib->ab", lu12.bb, u12.bb)
    x212 += einsum("ab->ab", x209) * 0.5
    x399 += einsum("ab->ab", x209) * 0.5
    x544 += einsum("ab->ab", x209) * 0.5
    x571 += einsum("ab->ab", x209)
    del x209
    x210 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x210 += einsum("abij,ijac->bc", l2.abab, t2.abab)
    x212 += einsum("ab->ab", x210)
    l1new_aa += einsum("ab,icab->ci", x212, v.aabb.ovvv)
    x399 += einsum("ab->ab", x210)
    x400 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x400 += einsum("ab,ibjc->ijca", x399, v.bbbb.ovov)
    del x399
    x412 += einsum("ijab->jiba", x400)
    del x400
    x544 += einsum("ab->ab", x210)
    x545 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x545 += einsum("ab,icjb->ijca", x544, v.aabb.ovov)
    del x544
    l2new_abab += einsum("ijab->abij", x545) * -1
    l2new_baba += einsum("ijab->baji", x545) * -1
    del x545
    x571 += einsum("ab->ab", x210) * 2
    del x210
    ls1new += einsum("ab,wab->w", x571, g.bb.bvv) * 0.5
    del x571
    x213 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x213 += einsum("wia,wxja->xij", g.aa.bov, u12.aa)
    x220 += einsum("wij->wij", x213)
    del x213
    x214 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x214 += einsum("wia,jkia->wjk", u11.bb, v.aabb.ooov)
    x220 += einsum("wij->wij", x214)
    del x214
    x217 += einsum("wia->wia", gc.aa.bov)
    x218 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x218 += einsum("ia,wja->wij", t1.aa, x217)
    del x217
    x220 += einsum("wij->wji", x218)
    del x218
    x220 += einsum("wij->wij", gc.aa.boo)
    x566 += einsum("ia,wij->wja", t1.aa, x220)
    l1new_aa += einsum("wai,wji->aj", lu11.aa, x220) * -1
    del x220
    x223 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x223 += einsum("wia,iajb->wjb", u11.aa, v.aabb.ovov)
    x225 += einsum("wia->wia", x223)
    x311 += einsum("wia->wia", x223)
    x324 += einsum("wia->wia", x223)
    x338 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x338 += einsum("wia->wia", x223)
    x376 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x376 += einsum("wia->wia", x223)
    x552 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x552 += einsum("wia->wia", x223)
    del x223
    x225 += einsum("wia->wia", gc.bb.bov)
    x230 += einsum("wia,xia->xw", u11.bb, x225)
    x328 += einsum("wia,xia->xw", u11.bb, x225) * 2
    del x225
    x226 += einsum("wia->wia", gc.aa.bov) * 2
    x230 += einsum("wia,xia->xw", u11.aa, x226) * 0.5
    x328 += einsum("wia,xia->xw", u11.aa, x226)
    del x226
    x227 = np.zeros((nbos, nbos), dtype=np.float64)
    x227 += einsum("wia,xia->wx", g.aa.bov, u11.aa)
    x229 = np.zeros((nbos, nbos), dtype=np.float64)
    x229 += einsum("wx->wx", x227)
    x600 = np.zeros((nbos, nbos), dtype=np.float64)
    x600 += einsum("wx->wx", x227)
    del x227
    x228 = np.zeros((nbos, nbos), dtype=np.float64)
    x228 += einsum("wia,xia->wx", g.bb.bov, u11.bb)
    x229 += einsum("wx->wx", x228)
    x600 += einsum("wx->wx", x228)
    del x228
    x601 = np.zeros((nbos, nbos), dtype=np.float64)
    x601 += einsum("wx,yw->xy", ls2, x600)
    x602 += einsum("wx->xw", x601)
    del x601
    x608 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x608 += einsum("wx,xyai->ywia", x600, lu12.aa)
    x609 -= einsum("wxia->xwia", x608)
    del x608
    x628 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x628 += einsum("wx,xyai->ywia", x600, lu12.bb)
    del x600
    x629 -= einsum("wxia->xwia", x628)
    del x628
    x229 += einsum("wx->wx", w)
    x230 += einsum("wx,wy->xy", s2, x229)
    l1new_aa += einsum("wx,xwai->ai", x230, lu12.aa)
    del x230
    x328 += einsum("wx,wy->xy", s2, x229) * 2
    l1new_bb += einsum("wx,xwai->ai", x328, lu12.bb) * 0.5
    del x328
    x566 += einsum("wx,wia->xia", x229, u11.aa) * -1
    x570 += einsum("wx,wia->xia", x229, u11.bb) * -1
    del x229
    x231 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x231 += einsum("wx,wai->xia", s2, lu11.aa)
    x235 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x235 += einsum("wia->wia", x231)
    del x231
    x232 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x232 += einsum("wia,baji->wjb", u11.bb, l2.abab)
    x235 += einsum("wia->wia", x232)
    x243 += einsum("wia->wia", x232)
    x244 += einsum("ia,wja->wji", t1.aa, x243)
    del x243
    x245 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x245 += einsum("wia->wia", x232)
    del x232
    x233 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x233 += einsum("abij->jiab", l2.aaaa)
    x233 -= einsum("abij->jiba", l2.aaaa)
    x234 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x234 += einsum("wia,ijab->wjb", u11.aa, x233)
    x235 -= einsum("wia->wia", x234)
    x476 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x476 += einsum("wia,wjb->ijab", g.aa.bov, x235)
    x486 += einsum("ijab->ijab", x476)
    del x476
    l1new_aa += einsum("wab,wia->bi", g.aa.bvv, x235)
    del x235
    x245 -= einsum("wia->wia", x234)
    del x234
    x554 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x554 += einsum("wia,wjb->jiba", g.bb.bov, x245)
    l2new_abab += einsum("ijab->abij", x554)
    l2new_baba += einsum("ijab->baji", x554)
    del x554
    l1new_aa += einsum("wij,wja->ai", x101, x245) * -1
    del x245
    del x101
    lu11new_aa -= einsum("wai,ijab->wbj", g.aa.bvo, x233)
    x236 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x236 += einsum("wia,iabc->wbc", u11.bb, v.bbaa.ovvv)
    x238 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x238 += einsum("wab->wab", x236)
    x563 += einsum("wab->wab", x236)
    del x236
    x237 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x237 += einsum("iabc->ibac", v.aaaa.ovvv)
    x237 -= einsum("iabc->ibca", v.aaaa.ovvv)
    x238 -= einsum("wia,ibca->wbc", u11.aa, x237)
    x452 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x452 += einsum("ia,jbac->ijbc", t1.aa, x237)
    x453 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x453 -= einsum("ijab->ijab", x452)
    del x452
    x465 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x465 += einsum("ia,ibca->bc", t1.aa, x237)
    del x237
    x466 -= einsum("ab->ab", x465)
    del x465
    x467 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x467 += einsum("ab,acij->ijcb", x466, l2.aaaa)
    del x466
    x486 += einsum("ijab->jiab", x467)
    del x467
    x238 += einsum("wab->wab", gc.aa.bvv)
    l1new_aa += einsum("wai,wab->bi", lu11.aa, x238)
    del x238
    x240 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x240 += einsum("iajb->jiab", v.aaaa.ovov)
    x240 -= einsum("iajb->jiba", v.aaaa.ovov)
    x241 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x241 += einsum("wia,ijab->wjb", u11.aa, x240)
    x242 -= einsum("wia->wia", x241)
    x477 -= einsum("wia->wia", x241)
    x478 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x478 += einsum("wai,wjb->ijab", lu11.aa, x477)
    del x477
    x486 += einsum("ijab->ijab", x478)
    del x478
    x550 -= einsum("wia->wia", x241)
    del x241
    x484 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x484 += einsum("ia,ijab->jb", t1.aa, x240)
    del x240
    x485 -= einsum("ia->ia", x484)
    x486 += einsum("ai,jb->ijab", l1.aa, x485)
    del x485
    x560 -= einsum("ia->ia", x484)
    del x484
    x242 += einsum("wia->wia", gc.aa.bov)
    l1new_aa -= einsum("wij,wja->ai", x239, x242)
    del x242
    del x239
    x244 += einsum("ai,wja->wij", l1.aa, u11.aa)
    x244 += einsum("wai,wxja->xij", lu11.aa, u12.aa)
    l1new_aa += einsum("wia,wji->aj", g.aa.bov, x244) * -1
    del x244
    x246 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x246 += einsum("iabj->ijba", v.aaaa.ovvo)
    x246 -= einsum("ijab->ijab", v.aaaa.oovv)
    l1new_aa += einsum("ai,jiab->bj", l1.aa, x246)
    lu11new_aa += einsum("wai,jiab->wbj", lu11.aa, x246)
    del x246
    x247 = np.zeros((nbos), dtype=np.float64)
    x247 += einsum("w,wx->x", s1, w)
    x255 += einsum("w->w", x247)
    x574 = np.zeros((nbos), dtype=np.float64)
    x574 += einsum("w->w", x247)
    del x247
    x248 = np.zeros((nbos), dtype=np.float64)
    x248 += einsum("ia,wia->w", t1.aa, gc.aa.bov)
    x255 += einsum("w->w", x248)
    x574 += einsum("w->w", x248)
    del x248
    x249 = np.zeros((nbos), dtype=np.float64)
    x249 += einsum("ia,wia->w", t1.bb, gc.bb.bov)
    x255 += einsum("w->w", x249)
    x574 += einsum("w->w", x249)
    del x249
    x250 = np.zeros((nbos), dtype=np.float64)
    x250 += einsum("wia,wxia->x", g.aa.bov, u12.aa)
    x255 += einsum("w->w", x250)
    x574 += einsum("w->w", x250)
    del x250
    x251 = np.zeros((nbos), dtype=np.float64)
    x251 += einsum("wia,wxia->x", g.bb.bov, u12.bb)
    x255 += einsum("w->w", x251)
    x574 += einsum("w->w", x251)
    del x251
    x255 += einsum("w->w", G)
    l1new_aa += einsum("w,wai->ai", x255, lu11.aa)
    l1new_bb += einsum("w,wai->ai", x255, lu11.bb)
    del x255
    x256 = np.zeros((nbos), dtype=np.float64)
    x256 += einsum("w,xw->x", ls1, s2)
    x261 = np.zeros((nbos), dtype=np.float64)
    x261 += einsum("w->w", x256)
    del x256
    x257 = np.zeros((nbos), dtype=np.float64)
    x257 += einsum("ai,wia->w", l1.aa, u11.aa)
    x261 += einsum("w->w", x257)
    del x257
    x258 = np.zeros((nbos), dtype=np.float64)
    x258 += einsum("ai,wia->w", l1.bb, u11.bb)
    x261 += einsum("w->w", x258)
    del x258
    x259 = np.zeros((nbos), dtype=np.float64)
    x259 += einsum("wai,wxia->x", lu11.aa, u12.aa)
    x261 += einsum("w->w", x259)
    del x259
    x260 = np.zeros((nbos), dtype=np.float64)
    x260 += einsum("wai,wxia->x", lu11.bb, u12.bb)
    x261 += einsum("w->w", x260)
    del x260
    x261 += einsum("w->w", s1)
    l1new_aa += einsum("w,wia->ai", x261, g.aa.bov)
    l1new_bb += einsum("w,wia->ai", x261, g.bb.bov)
    del x261
    x262 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x262 += einsum("abij,ikcb->jkac", l2.abab, t2.abab)
    l1new_bb += einsum("iabc,jibc->aj", v.bbaa.ovvv, x262) * -1
    del x262
    x263 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x263 += einsum("ijab,kbca->jikc", t2.bbbb, v.bbbb.ovvv)
    x272 += einsum("ijka->ijka", x263) * -1
    del x263
    x264 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x264 += einsum("ia,jbca->ijcb", t1.bb, v.bbbb.ovvv)
    x265 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x265 += einsum("ia,jkba->ijkb", t1.bb, x264)
    del x264
    x272 += einsum("ijka->ijka", x265) * -1
    del x265
    x268 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x268 += einsum("ijab,kalb->ijkl", t2.bbbb, v.bbbb.ovov)
    x270 += einsum("ijkl->jilk", x268)
    x271 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x271 += einsum("ia,jkil->jkla", t1.bb, x270)
    del x270
    x272 += einsum("ijka->jika", x271)
    del x271
    x278 += einsum("ijka->jkia", x272)
    x278 += einsum("ijka->ikja", x272) * -1
    del x272
    x413 += einsum("ijkl->jilk", x268)
    del x268
    x414 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x414 += einsum("abij,ijkl->klab", l2.bbbb, x413)
    del x413
    x417 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x417 += einsum("ijab->jiba", x414)
    del x414
    x276 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x276 += einsum("ia,jkla->ijlk", t1.bb, v.bbbb.ooov)
    x277 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x277 += einsum("ijkl->jkli", x276)
    x277 += einsum("ijkl->kjli", x276) * -1
    x289 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x289 += einsum("ijkl->ikjl", x276) * -1
    x289 += einsum("ijkl->ijkl", x276)
    x290 += einsum("ia,jikl->jkla", t1.bb, x289) * -1
    del x289
    x347 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x347 += einsum("abij,jkli->klba", l2.bbbb, x276)
    del x276
    x385 -= einsum("ijab->ijab", x347)
    del x347
    x277 += einsum("ijkl->kijl", v.bbbb.oooo) * -1
    x277 += einsum("ijkl->kilj", v.bbbb.oooo)
    x278 += einsum("ia,ijkl->ljka", t1.bb, x277) * -1
    del x277
    x278 += einsum("ijak->kija", v.bbbb.oovo) * -1
    x278 += einsum("ijak->jika", v.bbbb.oovo)
    l1new_bb += einsum("abij,ikja->bk", l2.bbbb, x278)
    del x278
    x279 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x279 += einsum("abij,ikac->jkbc", l2.abab, t2.abab)
    x282 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x282 += einsum("ijab->ijab", x279)
    x389 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x389 += einsum("ijab->ijab", x279)
    del x279
    x280 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x280 += einsum("abij->jiab", l2.bbbb)
    x280 += einsum("abij->jiba", l2.bbbb) * -1
    x281 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x281 += einsum("ijab,ikcb->kjca", x280, x38)
    del x38
    x282 += einsum("ijab->jiba", x281)
    x389 += einsum("ijab->jiba", x281)
    del x281
    x390 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x390 += einsum("ijab,jkbc->kica", x389, x95)
    del x389
    x412 += einsum("ijab->jiba", x390) * -1
    del x390
    x339 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x339 += einsum("wia,ijab->wjb", u11.bb, x280) * -1
    x393 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x393 += einsum("ijab,jkbc->ikac", t2.abab, x280)
    x394 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x394 += einsum("iajb,ikac->jkbc", v.aabb.ovov, x393) * -1
    del x393
    x412 += einsum("ijab->jiba", x394)
    del x394
    x282 += einsum("wxai,wxjb->ijab", lu12.bb, u12.bb) * 0.5
    l1new_bb += einsum("iabc,jiab->cj", x155, x282) * -1
    del x282
    del x155
    x283 += einsum("ijka->ikja", v.bbbb.ooov)
    x283 += einsum("ijka->kija", v.bbbb.ooov) * -1
    x286 += einsum("ijab,jklb->ikla", t2.abab, x283) * -1
    x312 += einsum("wxia,ijka->xwjk", u12.bb, x283) * -0.5
    del x283
    x284 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x284 += einsum("ia,jabc->ijbc", t1.bb, v.bbaa.ovvv)
    x285 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x285 += einsum("ijab->jiab", x284)
    x521 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x521 += einsum("ijab->jiab", x284)
    del x284
    x285 += einsum("ijab->ijab", v.bbaa.oovv)
    x286 += einsum("ia,jkba->ijkb", t1.aa, x285)
    del x285
    x286 += einsum("ijak->kija", v.bbaa.oovo)
    x286 += einsum("ia,jabk->kjib", t1.bb, v.bbaa.ovvo)
    x286 += einsum("ijab,kbca->ikjc", t2.abab, v.bbaa.ovvv)
    l1new_bb += einsum("abij,ikja->bk", l2.abab, x286) * -1
    del x286
    x287 += einsum("ia->ia", f.bb.ov)
    x288 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x288 += einsum("ia,jkab->jkib", x287, t2.bbbb)
    del x287
    x290 += einsum("ijka->ikja", x288)
    x290 += einsum("ijka->jkia", x288) * -1
    del x288
    l1new_bb += einsum("abij,ikjb->ak", l2.bbbb, x290) * -1
    del x290
    x292 += einsum("ai,jkab->ikjb", l1.bb, t2.bbbb) * -1
    x293 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x293 -= einsum("iajb->jiab", v.bbbb.ovov)
    x293 += einsum("iajb->jiba", v.bbbb.ovov)
    l1new_bb += einsum("ijka,jkba->bi", x292, x293) * -1
    del x292
    del x293
    x294 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x294 += einsum("abij->jiab", l2.bbbb) * -1
    x294 += einsum("abij->jiba", l2.bbbb)
    x295 += einsum("ijab,jkbc->ikac", t2.abab, x294) * -1
    x295 += einsum("wxai,wxjb->jiba", lu12.bb, u12.aa) * -0.5
    l1new_bb += einsum("iabc,ijab->cj", v.aabb.ovvv, x295) * -1
    del x295
    x296 += einsum("ai,jkba->jikb", l1.bb, t2.abab) * -1
    l1new_bb += einsum("iajb,ikja->bk", v.aabb.ovov, x296)
    del x296
    x299 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x299 += einsum("iabc->ibac", v.bbbb.ovvv)
    x299 += einsum("iabc->ibca", v.bbbb.ovvv) * -1
    l1new_bb += einsum("ijab,jabc->ci", x298, x299)
    del x298
    del x299
    x300 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x300 += einsum("ia,bcda->ibdc", t1.bb, v.bbbb.vvvv)
    x301 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x301 += einsum("iabc->iabc", x300) * -1
    del x300
    x301 += einsum("aibc->iabc", v.bbbb.vovv)
    x302 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x302 += einsum("iabc->iabc", x301) * -1
    x302 += einsum("iabc->ibac", x301)
    del x301
    l1new_bb += einsum("abij,iabc->cj", l2.bbbb, x302) * -1
    del x302
    x303 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x303 += einsum("abij,klba->ijlk", l2.bbbb, t2.bbbb)
    x305 += einsum("ijkl->jilk", x303)
    x306 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x306 += einsum("ia,ijkl->jkla", t1.bb, x305) * 0.9999999999999993
    del x305
    x307 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x307 += einsum("ijka->ijka", x306) * -1
    x307 += einsum("ijka->ikja", x306)
    del x306
    l1new_bb += einsum("iajb,kijb->ak", v.bbbb.ovov, x307)
    del x307
    x316 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x316 += einsum("ijkl->jikl", x303) * -1
    x316 += einsum("ijkl->jilk", x303)
    l1new_bb += einsum("ijka,jlik->al", v.bbbb.ooov, x316)
    del x316
    x415 += einsum("ijkl->jilk", x303)
    del x303
    x416 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x416 += einsum("iajb,klji->klab", v.bbbb.ovov, x415)
    del x415
    x417 += einsum("ijab->jiab", x416)
    del x416
    l2new_bbbb = np.zeros((nvir[1], nvir[1], nocc[1], nocc[1]), dtype=np.float64)
    l2new_bbbb += einsum("ijab->abij", x417)
    l2new_bbbb += einsum("ijab->baij", x417) * -1
    del x417
    x308 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x308 += einsum("aibc->iabc", v.aabb.vovv)
    x308 += einsum("ia,bacd->ibcd", t1.aa, v.aabb.vvvv)
    l1new_bb += einsum("abij,iabc->cj", l2.abab, x308)
    del x308
    x309 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x309 += einsum("wx,xia->wia", s2, g.bb.bov)
    x311 += einsum("wia->wia", x309)
    x552 += einsum("wia->wia", x309)
    del x309
    x311 += einsum("wia->wia", gc.bb.bov)
    x312 += einsum("wia,xja->wxji", u11.bb, x311)
    l1new_bb += einsum("wxai,wxji->aj", lu12.bb, x312) * -1
    del x312
    x566 += einsum("wia,jiba->wjb", x311, t2.abab) * -1
    x570 += einsum("wia,ijab->wjb", x311, x53) * -1
    del x53
    del x311
    x313 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x313 += einsum("ia,jbca->ijcb", t1.aa, v.bbaa.ovvv)
    x314 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x314 += einsum("ijab->ijab", x313)
    x356 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x356 += einsum("ijab->ijab", x313)
    x502 += einsum("ijab->ijab", x313)
    x631 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x631 += einsum("ijab->ijab", x313)
    del x313
    x314 += einsum("iabj->jiba", v.bbaa.ovvo)
    l1new_bb += einsum("ijka,ikab->bj", x1, x314) * -1
    del x314
    x315 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x315 -= einsum("abij->jiab", l2.bbbb)
    x315 += einsum("abij->jiba", l2.bbbb)
    l1new_bb += einsum("ia,ijab->bj", x160, x315)
    del x160
    del x315
    x318 += einsum("ia->ia", t1.bb) * -2
    l1new_bb += einsum("ia,ijab->bj", x318, x146) * -0.5
    del x146
    del x318
    x319 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x319 -= einsum("iabc->ibac", v.bbbb.ovvv)
    x319 += einsum("iabc->ibca", v.bbbb.ovvv)
    x335 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x335 -= einsum("wia,ibac->wbc", u11.bb, x319)
    x364 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x364 += einsum("ia,ibac->bc", t1.bb, x319)
    x365 -= einsum("ab->ab", x364)
    del x364
    x366 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x366 += einsum("ab,acij->ijcb", x365, l2.bbbb)
    del x365
    x385 += einsum("ijab->jiab", x366)
    del x366
    x630 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x630 -= einsum("ia,jbca->jibc", t1.bb, x319)
    l1new_bb += einsum("ab,iacb->ci", x212, x319) * -1
    del x212
    del x319
    x320 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x320 += einsum("wia,wxja->xij", g.bb.bov, u12.bb)
    x327 += einsum("wij->wij", x320)
    del x320
    x321 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x321 += einsum("wia,iajk->wjk", u11.aa, v.aabb.ovoo)
    x327 += einsum("wij->wij", x321)
    del x321
    x324 += einsum("wia->wia", gc.bb.bov)
    x325 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x325 += einsum("ia,wja->wij", t1.bb, x324)
    del x324
    x327 += einsum("wij->wji", x325)
    del x325
    x327 += einsum("wij->wij", gc.bb.boo)
    x570 += einsum("ia,wij->wja", t1.bb, x327)
    l1new_bb += einsum("wai,wji->aj", lu11.bb, x327) * -1
    del x327
    x329 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x329 += einsum("wx,wai->xia", s2, lu11.bb)
    x333 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x333 += einsum("wia->wia", x329)
    del x329
    x330 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x330 += einsum("wia,abij->wjb", u11.aa, l2.abab)
    x333 += einsum("wia->wia", x330)
    x339 += einsum("wia->wia", x330)
    x340 += einsum("ia,wja->wji", t1.bb, x339)
    del x339
    x341 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x341 += einsum("wia->wia", x330)
    del x330
    x331 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x331 += einsum("abij->jiab", l2.bbbb)
    x331 -= einsum("abij->jiba", l2.bbbb)
    x332 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x332 += einsum("wia,ijab->wjb", u11.bb, x331)
    x333 -= einsum("wia->wia", x332)
    x375 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x375 += einsum("wia,wjb->ijab", g.bb.bov, x333)
    x385 += einsum("ijab->ijab", x375)
    del x375
    l1new_bb += einsum("wab,wia->bi", g.bb.bvv, x333)
    del x333
    x341 -= einsum("wia->wia", x332)
    del x332
    x555 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x555 += einsum("wia,wjb->ijab", g.aa.bov, x341)
    l2new_abab += einsum("ijab->abij", x555)
    l2new_baba += einsum("ijab->baji", x555)
    del x555
    l1new_bb += einsum("wij,wja->ai", x140, x341) * -1
    del x140
    del x341
    lu11new_bb -= einsum("wai,ijab->wbj", g.bb.bvo, x331)
    x334 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x334 += einsum("wia,iabc->wbc", u11.aa, v.aabb.ovvv)
    x335 += einsum("wab->wab", x334)
    x567 += einsum("wab->wab", x334)
    del x334
    x335 += einsum("wab->wab", gc.bb.bvv)
    l1new_bb += einsum("wai,wab->bi", lu11.bb, x335)
    del x335
    x336 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x336 += einsum("iajb->jiab", v.bbbb.ovov)
    x336 -= einsum("iajb->jiba", v.bbbb.ovov)
    x337 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x337 += einsum("wia,ijab->wjb", u11.bb, x336)
    x338 -= einsum("wia->wia", x337)
    x376 -= einsum("wia->wia", x337)
    x377 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x377 += einsum("wai,wjb->ijab", lu11.bb, x376)
    del x376
    x385 += einsum("ijab->ijab", x377)
    del x377
    x552 -= einsum("wia->wia", x337)
    del x337
    x383 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x383 += einsum("ia,ijab->jb", t1.bb, x336)
    del x336
    x384 -= einsum("ia->ia", x383)
    x385 += einsum("ai,jb->ijab", l1.bb, x384)
    del x384
    x561 -= einsum("ia->ia", x383)
    del x383
    x338 += einsum("wia->wia", gc.bb.bov)
    l1new_bb += einsum("wij,wja->ai", x197, x338) * -1
    del x338
    del x197
    x340 += einsum("ai,wja->wij", l1.bb, u11.bb)
    x340 += einsum("wai,wxja->xij", lu11.bb, u12.bb)
    l1new_bb += einsum("wia,wji->aj", g.bb.bov, x340) * -1
    del x340
    x342 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x342 += einsum("iabj->ijba", v.bbbb.ovvo)
    x342 -= einsum("ijab->ijab", v.bbbb.oovv)
    l1new_bb += einsum("ai,jiab->bj", l1.bb, x342)
    lu11new_bb += einsum("wai,jiab->wbj", lu11.bb, x342)
    del x342
    x343 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x343 += einsum("wia,wbj->ijab", gc.bb.bov, lu11.bb)
    x385 += einsum("ijab->ijab", x343)
    del x343
    x344 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x344 += einsum("ai,jbac->ijbc", l1.bb, v.bbbb.ovvv)
    x385 -= einsum("ijab->ijab", x344)
    del x344
    x350 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x350 += einsum("iabc->ibac", v.bbbb.ovvv)
    x350 -= einsum("iabc->ibca", v.bbbb.ovvv)
    x351 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x351 += einsum("ia,jbac->ijbc", t1.bb, x350)
    del x350
    x352 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x352 -= einsum("ijab->ijab", x351)
    del x351
    x352 += einsum("iabj->jiba", v.bbbb.ovvo)
    x352 -= einsum("ijab->jiab", v.bbbb.oovv)
    x353 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x353 += einsum("ijab,ikbc->jkac", x331, x352)
    del x352
    del x331
    x385 += einsum("ijab->ijab", x353)
    del x353
    x354 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x354 += einsum("ijab->jiab", t2.aaaa)
    x354 -= einsum("ijab->jiba", t2.aaaa)
    x355 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x355 += einsum("iajb,ikac->kjcb", v.aabb.ovov, x354)
    x356 -= einsum("ijab->ijab", x355)
    del x355
    x589 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x589 += einsum("wia,ijab->wjb", g.aa.bov, x354)
    del x354
    x590 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x590 -= einsum("wia->wia", x589)
    del x589
    x356 += einsum("iabj->jiba", v.bbaa.ovvo)
    x357 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x357 += einsum("abij,ikac->jkbc", l2.abab, x356)
    del x356
    x385 += einsum("ijab->ijab", x357)
    del x357
    x359 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x359 -= einsum("ijka->ikja", v.bbbb.ooov)
    x359 += einsum("ijka->kija", v.bbbb.ooov)
    x360 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x360 += einsum("ijka,klib->jlab", x358, x359)
    del x358
    x385 += einsum("ijab->ijab", x360)
    del x360
    l2new_baba += einsum("ijka,kljb->bali", x1, x359)
    del x359
    x361 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x361 += einsum("wia,wib->ab", g.bb.bov, u11.bb)
    x362 -= einsum("ab->ba", x361)
    x538 += einsum("ab->ba", x361) * -1
    del x361
    x362 += einsum("ab->ab", f.bb.vv)
    x363 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x363 += einsum("ab,acij->ijcb", x362, l2.bbbb)
    del x362
    x385 -= einsum("ijab->jiba", x363)
    del x363
    x367 += einsum("ia->ia", f.bb.ov)
    x368 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x368 += einsum("ia,ja->ij", t1.bb, x367)
    x369 += einsum("ij->ji", x368)
    del x368
    x380 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x380 += einsum("ia,jkib->jkba", x367, x192)
    del x192
    x385 += einsum("ijab->ijba", x380)
    del x380
    x385 += einsum("ai,jb->jiba", l1.bb, x367)
    del x367
    x369 += einsum("ij->ij", f.bb.oo)
    x370 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x370 += einsum("ij,abjk->kiab", x369, l2.bbbb)
    del x369
    x385 += einsum("ijab->jiba", x370)
    del x370
    x371 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x371 += einsum("ijka->ikja", v.bbbb.ooov)
    x371 -= einsum("ijka->kija", v.bbbb.ooov)
    x372 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x372 += einsum("ia,ijka->jk", t1.bb, x371)
    x373 -= einsum("ij->ij", x372)
    del x372
    x374 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x374 += einsum("ij,abjk->kiab", x373, l2.bbbb)
    del x373
    x385 -= einsum("ijab->ijba", x374)
    del x374
    l2new_abab -= einsum("ijka,kljb->abil", x1, x371)
    del x1
    lu12new_bb -= einsum("wxij,jkia->xwak", x189, x371)
    del x371
    del x189
    x381 -= einsum("ijka->jika", v.bbbb.ooov)
    x382 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x382 += einsum("ai,ijkb->jkab", l1.bb, x381)
    del x381
    x385 += einsum("ijab->ijab", x382)
    del x382
    l2new_bbbb += einsum("ijab->abij", x385)
    l2new_bbbb -= einsum("ijab->baij", x385)
    l2new_bbbb -= einsum("ijab->abji", x385)
    l2new_bbbb += einsum("ijab->baji", x385)
    del x385
    x386 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x386 += einsum("abij,kilj->klab", l2.bbbb, v.bbbb.oooo)
    x388 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x388 += einsum("ijab->jiba", x386)
    del x386
    x387 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x387 += einsum("abij,acbd->ijcd", l2.bbbb, v.bbbb.vvvv)
    x388 += einsum("ijab->jiba", x387)
    del x387
    l2new_bbbb += einsum("ijab->baij", x388) * -1
    l2new_bbbb += einsum("ijab->abij", x388)
    del x388
    x395 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x395 += einsum("wxia,iajb->wxjb", u12.aa, v.aabb.ovov)
    x397 += einsum("wxia->xwia", x395)
    del x395
    x398 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x398 += einsum("wxai,wxjb->ijab", lu12.bb, x397) * 0.5
    x412 += einsum("ijab->ijab", x398)
    del x398
    x533 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x533 += einsum("wxai,wxjb->ijab", lu12.aa, x397) * 0.5
    del x397
    l2new_abab += einsum("ijab->abij", x533)
    l2new_baba += einsum("ijab->baji", x533)
    del x533
    x405 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x405 += einsum("ijab,iajc->bc", t2.abab, v.aabb.ovov)
    x407 += einsum("ab->ab", x405)
    x408 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x408 += einsum("ab,acij->ijcb", x407, l2.bbbb)
    del x407
    x412 += einsum("ijab->jiab", x408) * -1
    del x408
    l2new_bbbb += einsum("ijab->abij", x412)
    l2new_bbbb += einsum("ijab->baij", x412) * -1
    l2new_bbbb += einsum("ijab->abji", x412) * -1
    l2new_bbbb += einsum("ijab->baji", x412)
    del x412
    x538 += einsum("ab->ab", x405) * -1
    del x405
    x418 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x418 += einsum("ijab,kcjb->ikac", t2.abab, v.aabb.ovov)
    x420 += einsum("ijab->ijab", x418)
    x421 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x421 += einsum("ijab,ikac->jkbc", x34, x420)
    del x34
    del x420
    x443 += einsum("ijab->ijab", x421)
    del x421
    x509 += einsum("ijab->jiab", x418)
    del x418
    x425 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x425 += einsum("wxia,jbia->wxjb", u12.bb, v.aabb.ovov)
    x427 += einsum("wxia->xwia", x425)
    del x425
    x428 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x428 += einsum("wxai,wxjb->ijab", lu12.aa, x427) * 0.5
    x443 += einsum("ijab->ijab", x428)
    del x428
    x532 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x532 += einsum("wxai,wxjb->jiba", lu12.bb, x427) * 0.5
    del x427
    l2new_abab += einsum("ijab->abij", x532)
    l2new_baba += einsum("ijab->baji", x532)
    del x532
    x436 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x436 += einsum("ijab,icjb->ac", t2.abab, v.aabb.ovov)
    x438 += einsum("ab->ab", x436)
    x439 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x439 += einsum("ab,acij->ijcb", x438, l2.aaaa)
    del x438
    x443 += einsum("ijab->jiab", x439) * -1
    del x439
    l2new_aaaa += einsum("ijab->abij", x443)
    l2new_aaaa += einsum("ijab->baij", x443) * -1
    l2new_aaaa += einsum("ijab->abji", x443) * -1
    l2new_aaaa += einsum("ijab->baji", x443)
    del x443
    x535 += einsum("ab->ab", x436) * -1
    del x436
    x444 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x444 += einsum("wia,wbj->ijab", gc.aa.bov, lu11.aa)
    x486 += einsum("ijab->ijab", x444)
    del x444
    x445 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x445 += einsum("ai,jbac->ijbc", l1.aa, v.aaaa.ovvv)
    x486 -= einsum("ijab->ijab", x445)
    del x445
    x451 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x451 -= einsum("abij->jiab", l2.aaaa)
    x451 += einsum("abij->jiba", l2.aaaa)
    x453 += einsum("iabj->jiba", v.aaaa.ovvo)
    x453 -= einsum("ijab->jiab", v.aaaa.oovv)
    x454 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x454 += einsum("ijab,ikac->jkbc", x451, x453)
    del x451
    del x453
    x486 += einsum("ijab->ijab", x454)
    del x454
    x455 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x455 += einsum("ijab->jiab", t2.bbbb)
    x455 -= einsum("ijab->jiba", t2.bbbb)
    x456 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x456 += einsum("iajb,jkbc->ikac", v.aabb.ovov, x455)
    x457 -= einsum("ijab->ijab", x456)
    del x456
    x593 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x593 += einsum("wia,ijab->wjb", g.bb.bov, x455)
    del x455
    x594 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x594 -= einsum("wia->wia", x593)
    del x593
    x457 += einsum("iabj->ijab", v.aabb.ovvo)
    x458 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x458 += einsum("abij,kjcb->ikac", l2.abab, x457)
    del x457
    x486 += einsum("ijab->ijab", x458)
    del x458
    x460 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x460 += einsum("ijka->ikja", v.aaaa.ooov)
    x460 -= einsum("ijka->kija", v.aaaa.ooov)
    x461 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x461 += einsum("ijka,lkib->jlab", x459, x460)
    del x459
    x486 += einsum("ijab->ijab", x461)
    del x461
    l2new_abab += einsum("ijka,kjlb->abil", x460, x56)
    del x460
    x462 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x462 += einsum("wia,wib->ab", g.aa.bov, u11.aa)
    x463 -= einsum("ab->ba", x462)
    x535 += einsum("ab->ba", x462) * -1
    del x462
    x463 += einsum("ab->ab", f.aa.vv)
    x464 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x464 += einsum("ab,acij->ijcb", x463, l2.aaaa)
    del x463
    x486 -= einsum("ijab->jiba", x464)
    del x464
    x468 += einsum("ia->ia", f.aa.ov)
    x469 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x469 += einsum("ia,ja->ij", t1.aa, x468)
    x470 += einsum("ij->ji", x469)
    del x469
    x481 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x481 += einsum("ia,jkib->jkba", x468, x57)
    del x57
    x486 += einsum("ijab->ijba", x481)
    del x481
    x486 += einsum("ai,jb->jiba", l1.aa, x468)
    del x468
    x470 += einsum("ij->ij", f.aa.oo)
    x471 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x471 += einsum("ij,abjk->kiab", x470, l2.aaaa)
    del x470
    x486 += einsum("ijab->jiba", x471)
    del x471
    x472 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x472 -= einsum("ijka->ikja", v.aaaa.ooov)
    x472 += einsum("ijka->kija", v.aaaa.ooov)
    x473 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x473 += einsum("ia,jika->jk", t1.aa, x472)
    x474 -= einsum("ij->ij", x473)
    del x473
    x475 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x475 += einsum("ij,abjk->kiab", x474, l2.aaaa)
    del x474
    x486 -= einsum("ijab->ijba", x475)
    del x475
    l2new_baba -= einsum("ijka,kjlb->bali", x472, x56)
    del x56
    lu12new_aa -= einsum("ijka,wxkj->xwai", x472, x55)
    del x472
    del x55
    x482 -= einsum("ijka->jika", v.aaaa.ooov)
    x483 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x483 += einsum("ai,ijkb->jkab", l1.aa, x482)
    del x482
    x486 += einsum("ijab->ijab", x483)
    del x483
    l2new_aaaa += einsum("ijab->abij", x486)
    l2new_aaaa -= einsum("ijab->baij", x486)
    l2new_aaaa -= einsum("ijab->abji", x486)
    l2new_aaaa += einsum("ijab->baji", x486)
    del x486
    x487 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x487 += einsum("abij,kilj->klab", l2.aaaa, v.aaaa.oooo)
    x489 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x489 += einsum("ijab->jiba", x487)
    del x487
    x488 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x488 += einsum("abij,acbd->ijcd", l2.aaaa, v.aaaa.vvvv)
    x489 += einsum("ijab->jiba", x488)
    del x488
    l2new_aaaa += einsum("ijab->baij", x489) * -1
    l2new_aaaa += einsum("ijab->abij", x489)
    del x489
    x495 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x495 += einsum("abij,acbd->ijcd", l2.abab, v.aabb.vvvv)
    l2new_abab += einsum("ijab->abij", x495)
    l2new_baba += einsum("ijab->baji", x495)
    del x495
    x497 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x497 += einsum("ai,jbac->ijcb", l1.aa, v.bbaa.ovvv)
    l2new_abab += einsum("ijab->abij", x497)
    l2new_baba += einsum("ijab->baji", x497)
    del x497
    x498 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x498 += einsum("ai,jbac->jibc", l1.bb, v.aabb.ovvv)
    l2new_abab += einsum("ijab->abij", x498)
    l2new_baba += einsum("ijab->baji", x498)
    del x498
    x502 += einsum("iabj->jiba", v.bbaa.ovvo)
    x503 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x503 += einsum("ijab,ikac->jkbc", x233, x502)
    del x233
    del x502
    l2new_abab += einsum("ijab->abij", x503) * -1
    l2new_baba += einsum("ijab->baji", x503) * -1
    del x503
    x506 += einsum("iabj->ijab", v.aabb.ovvo)
    l2new_abab += einsum("ijab,kica->cbkj", x280, x506) * -1
    del x280
    l2new_baba += einsum("ijab,kica->bcjk", x294, x506)
    del x506
    del x294
    x509 += einsum("iabj->ijba", v.aaaa.ovvo)
    x509 += einsum("ijab->ijab", v.aaaa.oovv) * -1
    x510 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x510 += einsum("abij,kiac->kjcb", l2.abab, x509)
    del x509
    l2new_abab += einsum("ijab->abij", x510)
    l2new_baba += einsum("ijab->baji", x510)
    del x510
    x511 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x511 += einsum("ijab,iakc->jkbc", t2.abab, v.aabb.ovov)
    x514 += einsum("ijab->jiab", x511)
    del x511
    x514 += einsum("iabj->ijba", v.bbbb.ovvo)
    x514 += einsum("ijab->ijab", v.bbbb.oovv) * -1
    x515 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x515 += einsum("abij,kjbc->ikac", l2.abab, x514)
    del x514
    l2new_abab += einsum("ijab->abij", x515)
    l2new_baba += einsum("ijab->baji", x515)
    del x515
    x516 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x516 += einsum("ia,jabc->ijbc", t1.aa, v.aabb.ovvv)
    x518 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x518 += einsum("ijab->jiab", x516)
    del x516
    x517 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x517 += einsum("ijab,kajc->ikbc", t2.abab, v.aabb.ovov)
    x518 += einsum("ijab->jiab", x517) * -1
    del x517
    x518 += einsum("ijab->ijab", v.aabb.oovv)
    x519 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x519 += einsum("abij,kibc->kjac", l2.abab, x518)
    del x518
    l2new_abab += einsum("ijab->abij", x519) * -1
    l2new_baba += einsum("ijab->baji", x519) * -1
    del x519
    x520 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x520 += einsum("ijab,ickb->jkac", t2.abab, v.aabb.ovov)
    x521 += einsum("ijab->jiab", x520) * -1
    del x520
    x521 += einsum("ijab->ijab", v.bbaa.oovv)
    x522 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x522 += einsum("abij,kjac->ikcb", l2.abab, x521)
    del x521
    l2new_abab += einsum("ijab->abij", x522) * -1
    l2new_baba += einsum("ijab->baji", x522) * -1
    del x522
    x524 += einsum("ijkl->ijkl", v.aabb.oooo)
    x525 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x525 += einsum("abij,kilj->klab", l2.abab, x524)
    del x524
    l2new_abab += einsum("ijab->abij", x525)
    l2new_baba += einsum("ijab->baji", x525)
    del x525
    x535 += einsum("ab->ab", f.aa.vv)
    x536 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x536 += einsum("ab,acij->ijbc", x535, l2.abab)
    l2new_abab += einsum("ijab->abij", x536)
    l2new_baba += einsum("ijab->baji", x536)
    del x536
    x566 += einsum("ab,wib->wia", x535, u11.aa) * -1
    lu12new_aa += einsum("ab,wxai->xwbi", x535, lu12.aa)
    del x535
    x538 += einsum("ab->ab", f.bb.vv)
    x539 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x539 += einsum("ab,caij->ijcb", x538, l2.abab)
    l2new_abab += einsum("ijab->abij", x539)
    l2new_baba += einsum("ijab->baji", x539)
    del x539
    x570 += einsum("ab,wib->wia", x538, u11.bb) * -1
    lu12new_bb += einsum("ab,wxai->xwbi", x538, lu12.bb)
    del x538
    x550 += einsum("wia->wia", gc.aa.bov)
    x551 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x551 += einsum("wai,wjb->jiba", lu11.bb, x550)
    del x550
    l2new_abab += einsum("ijab->abij", x551)
    l2new_baba += einsum("ijab->baji", x551)
    del x551
    x552 += einsum("wia->wia", gc.bb.bov)
    x553 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x553 += einsum("wai,wjb->ijab", lu11.aa, x552)
    del x552
    l2new_abab += einsum("ijab->abij", x553)
    l2new_baba += einsum("ijab->baji", x553)
    del x553
    x556 += einsum("ijka->ijka", v.aabb.ooov)
    x557 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x557 += einsum("ai,jikb->jkab", l1.aa, x556)
    del x556
    l2new_abab -= einsum("ijab->abij", x557)
    l2new_baba -= einsum("ijab->baji", x557)
    del x557
    x558 += einsum("iajk->ijka", v.aabb.ovoo)
    x559 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x559 += einsum("ai,jkib->jkba", l1.bb, x558)
    del x558
    l2new_abab -= einsum("ijab->abij", x559)
    l2new_baba -= einsum("ijab->baji", x559)
    del x559
    x560 += einsum("ia->ia", f.aa.ov)
    x574 += einsum("ia,wia->w", x560, u11.aa)
    l2new_abab += einsum("ai,jb->baji", l1.bb, x560)
    l2new_baba += einsum("ai,jb->abij", l1.bb, x560)
    del x560
    x561 += einsum("ia->ia", f.bb.ov)
    x574 += einsum("ia,wia->w", x561, u11.bb)
    l2new_abab += einsum("ai,jb->abij", l1.aa, x561)
    l2new_baba += einsum("ai,jb->baji", l1.aa, x561)
    del x561
    x563 += einsum("wab->wab", gc.aa.bvv)
    x566 += einsum("ia,wba->wib", t1.aa, x563) * -1
    del x563
    x564 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x564 += einsum("ia,wba->wib", t1.aa, g.aa.bvv)
    x565 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x565 += einsum("wia->wia", x564)
    x590 += einsum("wia->wia", x564)
    del x564
    x565 += einsum("wai->wia", g.aa.bvo)
    x566 += einsum("wx,wia->xia", s2, x565) * -1
    del x565
    x566 += einsum("wai->wia", gc.aa.bvo) * -1
    x566 += einsum("wab,wxib->xia", g.aa.bvv, u12.aa) * -1
    x566 += einsum("wia,iabj->wjb", u11.bb, v.bbaa.ovvo) * -1
    ls1new += einsum("wia,wxai->x", x566, lu12.aa) * -1
    del x566
    x567 += einsum("wab->wab", gc.bb.bvv)
    x570 += einsum("ia,wba->wib", t1.bb, x567) * -1
    del x567
    x568 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x568 += einsum("ia,wba->wib", t1.bb, g.bb.bvv)
    x569 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x569 += einsum("wia->wia", x568)
    x594 += einsum("wia->wia", x568)
    del x568
    x569 += einsum("wai->wia", g.bb.bvo)
    x570 += einsum("wx,wia->xia", s2, x569) * -1
    del x569
    x570 += einsum("wai->wia", gc.bb.bvo) * -1
    x570 += einsum("wab,wxib->xia", g.bb.bvv, u12.bb) * -1
    x570 += einsum("wia,iabj->wjb", u11.aa, v.aabb.ovvo) * -1
    ls1new += einsum("wia,wxai->x", x570, lu12.bb) * -1
    del x570
    x573 += einsum("w->w", G)
    x574 += einsum("w,wx->x", x573, s2)
    x602 += einsum("w,x->xw", ls1, x573)
    del x573
    x574 += einsum("w->w", G)
    ls1new += einsum("w,wx->x", x574, ls2)
    del x574
    x575 = np.zeros((nbos, nbos), dtype=np.float64)
    x575 += einsum("wx,yx->wy", ls2, w)
    x602 += einsum("wx->wx", x575)
    del x575
    x577 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x577 += einsum("wia,wxbi->xba", u11.aa, lu12.aa)
    x578 = np.zeros((nbos, nbos), dtype=np.float64)
    x578 += einsum("wab,xab->wx", g.aa.bvv, x577)
    x602 += einsum("wx->wx", x578)
    del x578
    x605 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x605 += einsum("wia,xba->wxib", g.aa.bov, x577)
    del x577
    x609 += einsum("wxia->wxia", x605)
    del x605
    x580 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x580 += einsum("wia,xwbi->xba", u11.bb, lu12.bb)
    x581 = np.zeros((nbos, nbos), dtype=np.float64)
    x581 += einsum("wab,xab->wx", g.bb.bvv, x580)
    x602 += einsum("wx->wx", x581)
    del x581
    x624 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x624 += einsum("wia,xba->wxib", g.bb.bov, x580)
    del x580
    x629 += einsum("wxia->wxia", x624)
    del x624
    x588 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x588 += einsum("wia,jiba->wjb", g.bb.bov, t2.abab)
    x590 += einsum("wia->wia", x588)
    del x588
    x590 += einsum("wai->wia", g.aa.bvo)
    x591 = np.zeros((nbos, nbos), dtype=np.float64)
    x591 += einsum("wai,xia->wx", lu11.aa, x590)
    del x590
    x602 += einsum("wx->xw", x591)
    del x591
    x592 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x592 += einsum("wia,ijab->wjb", g.aa.bov, t2.abab)
    x594 += einsum("wia->wia", x592)
    del x592
    x594 += einsum("wai->wia", g.bb.bvo)
    x595 = np.zeros((nbos, nbos), dtype=np.float64)
    x595 += einsum("wai,xia->wx", lu11.bb, x594)
    del x594
    x602 += einsum("wx->xw", x595)
    del x595
    x596 += einsum("wij->wij", g.aa.boo)
    x597 = np.zeros((nbos, nbos), dtype=np.float64)
    x597 += einsum("wij,xji->wx", x168, x596)
    del x168
    x602 -= einsum("wx->xw", x597)
    del x597
    x606 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x606 += einsum("wai,xji->wxja", lu11.aa, x596)
    del x596
    x609 += einsum("wxia->xwia", x606)
    del x606
    x598 += einsum("wij->wij", g.bb.boo)
    x599 = np.zeros((nbos, nbos), dtype=np.float64)
    x599 += einsum("wij,xji->wx", x195, x598)
    del x195
    x602 -= einsum("wx->xw", x599)
    del x599
    ls2new += einsum("wx->wx", x602)
    ls2new += einsum("wx->xw", x602)
    del x602
    x625 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x625 += einsum("wai,xji->wxja", lu11.bb, x598)
    del x598
    x629 += einsum("wxia->xwia", x625)
    del x625
    x603 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x603 += einsum("wx,xyai->ywia", w, lu12.aa)
    x609 -= einsum("wxia->wxia", x603)
    del x603
    x604 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x604 += einsum("wab,xai->wxib", g.aa.bvv, lu11.aa)
    x609 -= einsum("wxia->wxia", x604)
    del x604
    lu12new_aa -= einsum("wxia->wxai", x609)
    lu12new_aa -= einsum("wxia->xwai", x609)
    del x609
    x610 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x610 += einsum("wxai,jiba->wxjb", lu12.bb, t2.abab)
    x612 += einsum("wxia->xwia", x610)
    del x610
    lu12new_aa += einsum("ijab,wxia->xwbj", x12, x612) * -1
    del x12
    lu12new_bb += einsum("iajb,wxia->xwbj", v.aabb.ovov, x612)
    del x612
    x613 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x613 -= einsum("iabc->ibac", v.aaaa.ovvv)
    x613 += einsum("iabc->ibca", v.aaaa.ovvv)
    x614 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x614 -= einsum("ia,jbca->jibc", t1.aa, x613)
    del x613
    x614 += einsum("iabj->ijba", v.aaaa.ovvo)
    x614 -= einsum("ijab->ijab", v.aaaa.oovv)
    lu12new_aa += einsum("wxai,jiab->xwbj", lu12.aa, x614)
    del x614
    x615 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x615 += einsum("wxai,ijab->wxjb", lu12.aa, t2.abab)
    x617 += einsum("wxia->xwia", x615)
    del x615
    lu12new_aa += einsum("iajb,wxjb->xwai", v.aabb.ovov, x617)
    lu12new_bb += einsum("wxia,ijab->xwbj", x617, x95) * -1
    del x617
    del x95
    x618 += einsum("iabj->ijab", v.aabb.ovvo)
    lu12new_aa += einsum("wxai,jiba->xwbj", lu12.bb, x618)
    del x618
    x619 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x619 += einsum("wia,xyai->xyw", u11.aa, lu12.aa)
    x621 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x621 += einsum("wxy->xwy", x619)
    del x619
    x620 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x620 += einsum("wia,xyai->xyw", u11.bb, lu12.bb)
    x621 += einsum("wxy->xwy", x620)
    del x620
    lu12new_aa += einsum("wia,xyw->yxai", g.aa.bov, x621)
    lu12new_bb += einsum("wia,xyw->yxai", g.bb.bov, x621)
    del x621
    x622 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x622 += einsum("wx,xyai->ywia", w, lu12.bb)
    x629 -= einsum("wxia->wxia", x622)
    del x622
    x623 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x623 += einsum("wab,xai->wxib", g.bb.bvv, lu11.bb)
    x629 -= einsum("wxia->wxia", x623)
    del x623
    lu12new_bb -= einsum("wxia->wxai", x629)
    lu12new_bb -= einsum("wxia->xwai", x629)
    del x629
    x630 += einsum("iabj->ijba", v.bbbb.ovvo)
    x630 -= einsum("ijab->ijab", v.bbbb.oovv)
    lu12new_bb += einsum("wxai,jiab->xwbj", lu12.bb, x630)
    del x630
    x631 += einsum("iabj->jiba", v.bbaa.ovvo)
    lu12new_bb += einsum("wxai,ijab->xwbj", lu12.aa, x631)
    del x631
    l1new_aa += einsum("w,wia->ai", ls1, gc.aa.bov)
    l1new_aa += einsum("ia->ai", f.aa.ov)
    l1new_aa += einsum("ai,jbai->bj", l1.bb, v.aabb.ovvo)
    l1new_bb += einsum("ia->ai", f.bb.ov)
    l1new_bb += einsum("w,wia->ai", ls1, gc.bb.bov)
    l1new_bb += einsum("ai,jbai->bj", l1.aa, v.bbaa.ovvo)
    l2new_bbbb -= einsum("iajb->abji", v.bbbb.ovov)
    l2new_bbbb += einsum("iajb->baji", v.bbbb.ovov)
    l2new_aaaa -= einsum("iajb->abji", v.aaaa.ovov)
    l2new_aaaa += einsum("iajb->baji", v.aaaa.ovov)
    l2new_abab += einsum("iajb->abij", v.aabb.ovov)
    l2new_baba += einsum("iajb->baji", v.aabb.ovov)
    ls1new += einsum("w->w", G)
    ls1new += einsum("w,xw->x", ls1, w)
    ls1new += einsum("ai,wai->w", l1.aa, g.aa.bvo)
    ls1new += einsum("ai,wai->w", l1.bb, g.bb.bvo)
    lu11new_aa += einsum("ab,wai->wbi", f.aa.vv, lu11.aa)
    lu11new_aa += einsum("ai,wab->wbi", l1.aa, g.aa.bvv)
    lu11new_aa += einsum("wia->wai", g.aa.bov)
    lu11new_aa -= einsum("ij,waj->wai", f.aa.oo, lu11.aa)
    lu11new_aa -= einsum("ai,wji->waj", l1.aa, g.aa.boo)
    lu11new_aa += einsum("w,xwai->xai", G, lu12.aa)
    lu11new_aa += einsum("wx,xia->wai", ls2, gc.aa.bov)
    lu11new_aa += einsum("wx,xai->wai", w, lu11.aa)
    lu11new_aa += einsum("wai,baji->wbj", g.bb.bvo, l2.abab)
    lu11new_aa += einsum("wai,jbai->wbj", lu11.bb, v.aabb.ovvo)
    lu11new_aa += einsum("wab,xwai->xbi", gc.aa.bvv, lu12.aa)
    lu11new_aa -= einsum("wij,xwaj->xai", gc.aa.boo, lu12.aa)
    lu11new_bb += einsum("wia->wai", g.bb.bov)
    lu11new_bb += einsum("ab,wai->wbi", f.bb.vv, lu11.bb)
    lu11new_bb += einsum("ai,wab->wbi", l1.bb, g.bb.bvv)
    lu11new_bb -= einsum("ij,waj->wai", f.bb.oo, lu11.bb)
    lu11new_bb -= einsum("ai,wji->waj", l1.bb, g.bb.boo)
    lu11new_bb += einsum("w,xwai->xai", G, lu12.bb)
    lu11new_bb += einsum("wx,xia->wai", ls2, gc.bb.bov)
    lu11new_bb += einsum("wx,xai->wai", w, lu11.bb)
    lu11new_bb -= einsum("wij,xwaj->xai", gc.bb.boo, lu12.bb)
    lu11new_bb += einsum("wai,abij->wbj", g.aa.bvo, l2.abab)
    lu11new_bb += einsum("wai,jbai->wbj", lu11.aa, v.bbaa.ovvo)
    lu11new_bb += einsum("wab,xwai->xbi", gc.bb.bvv, lu12.bb)

    l1new.aa = l1new_aa
    l1new.bb = l1new_bb
    l2new.abab = l2new_abab
    l2new.baba = l2new_baba
    l2new.aaaa = l2new_aaaa
    l2new.bbbb = l2new_bbbb
    lu11new.aa = lu11new_aa
    lu11new.bb = lu11new_bb
    lu12new.aa = lu12new_aa
    lu12new.bb = lu12new_bb

    return {"l1new": l1new, "l2new": l2new, "ls1new": ls1new, "ls2new": ls2new, "lu11new": lu11new, "lu12new": lu12new}

def make_rdm1_f(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    rdm1_f = SimpleNamespace()

    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    delta_oo = SimpleNamespace()
    delta_oo.aa = np.eye(nocc[0])
    delta_oo.bb = np.eye(nocc[1])
    delta_vv = SimpleNamespace()
    delta_vv.aa = np.eye(nvir[0])
    delta_vv.bb = np.eye(nvir[1])

    # 1RDM
    x0 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x0 += einsum("wai,wja->ij", lu11.aa, u11.aa)
    x15 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x15 += einsum("ij->ij", x0) * 2
    rdm1_f_oo_aa = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    rdm1_f_oo_aa -= einsum("ij->ij", x0)
    del x0
    x1 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x1 += einsum("ai,ja->ij", l1.aa, t1.aa)
    x15 += einsum("ij->ij", x1) * 2
    rdm1_f_oo_aa -= einsum("ij->ij", x1)
    del x1
    x2 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x2 += einsum("abij,kjab->ik", l2.abab, t2.abab)
    x15 += einsum("ij->ij", x2) * 2
    rdm1_f_oo_aa += einsum("ij->ij", x2) * -1
    del x2
    x3 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x3 += einsum("wxai,wxja->ij", lu12.aa, u12.aa)
    x15 += einsum("ij->ij", x3)
    rdm1_f_oo_aa += einsum("ij->ij", x3) * -0.5
    del x3
    x4 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x4 += einsum("ijab->jiab", t2.aaaa) * -1
    x4 += einsum("ijab->jiba", t2.aaaa)
    x15 += einsum("abij,ikba->jk", l2.aaaa, x4) * -2
    rdm1_f_vo_aa = np.zeros((nvir[0], nocc[0]), dtype=np.float64)
    rdm1_f_vo_aa += einsum("ia,ij->aj", t1.aa, x15) * -0.5
    del x15
    rdm1_f_oo_aa += einsum("abij,ikab->jk", l2.aaaa, x4) * -1
    rdm1_f_vv_aa = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    rdm1_f_vv_aa += einsum("abij,ijbc->ca", l2.aaaa, x4) * -1
    x5 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x5 += einsum("wxai,wxja->ij", lu12.bb, u12.bb)
    x23 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x23 += einsum("ij->ij", x5) * 0.5
    rdm1_f_oo_bb = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    rdm1_f_oo_bb += einsum("ij->ij", x5) * -0.5
    del x5
    x6 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x6 += einsum("ai,ja->ij", l1.bb, t1.bb)
    x23 += einsum("ij->ij", x6)
    rdm1_f_oo_bb -= einsum("ij->ij", x6)
    del x6
    x7 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x7 += einsum("abij,ikab->jk", l2.abab, t2.abab)
    x23 += einsum("ij->ij", x7)
    rdm1_f_oo_bb += einsum("ij->ij", x7) * -1
    del x7
    x8 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x8 += einsum("wai,wja->ij", lu11.bb, u11.bb)
    x23 += einsum("ij->ij", x8)
    rdm1_f_oo_bb -= einsum("ij->ij", x8)
    del x8
    x9 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x9 += einsum("ijab->jiab", t2.bbbb)
    x9 += einsum("ijab->jiba", t2.bbbb) * -1
    rdm1_f_oo_bb += einsum("abij,ikba->jk", l2.bbbb, x9) * -1
    del x9
    x10 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x10 += einsum("ia,wxaj->wxji", t1.aa, lu12.aa)
    rdm1_f_vo_aa += einsum("wxia,wxij->aj", u12.aa, x10) * -0.5
    del x10
    x11 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x11 += einsum("ia,abjk->jikb", t1.aa, l2.abab)
    rdm1_f_vo_aa += einsum("ijab,ikjb->ak", t2.abab, x11) * -1
    del x11
    x12 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x12 += einsum("ia,abjk->kjib", t1.aa, l2.aaaa)
    rdm1_f_vo_aa += einsum("ijka,jiba->bk", x12, x4) * -1
    del x4
    del x12
    x13 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x13 += einsum("ijab->jiab", t2.aaaa)
    x13 -= einsum("ijab->jiba", t2.aaaa)
    rdm1_f_vo_aa -= einsum("ai,ijab->bj", l1.aa, x13)
    del x13
    x14 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x14 += einsum("ia,waj->wji", t1.aa, lu11.aa)
    x14 += einsum("wia,wxaj->xji", u11.aa, lu12.aa)
    rdm1_f_vo_aa -= einsum("wia,wij->aj", u11.aa, x14)
    del x14
    x16 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x16 += einsum("ia,bajk->jkib", t1.bb, l2.abab)
    rdm1_f_vo_bb = np.zeros((nvir[1], nocc[1]), dtype=np.float64)
    rdm1_f_vo_bb += einsum("ijab,ijka->bk", t2.abab, x16) * -1
    del x16
    x17 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x17 += einsum("ia,wxaj->wxji", t1.bb, lu12.bb)
    rdm1_f_vo_bb += einsum("wxia,wxij->aj", u12.bb, x17) * -0.5
    del x17
    x18 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x18 += einsum("ia,bajk->jkib", t1.bb, l2.bbbb)
    x19 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x19 += einsum("ijka->ijka", x18) * -1
    x19 += einsum("ijka->jika", x18)
    del x18
    rdm1_f_vo_bb += einsum("ijab,ijkb->ak", t2.bbbb, x19) * -1
    del x19
    x20 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x20 += einsum("ijab->jiab", t2.bbbb)
    x20 -= einsum("ijab->jiba", t2.bbbb)
    rdm1_f_vo_bb -= einsum("ai,ijab->bj", l1.bb, x20)
    del x20
    x21 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x21 += einsum("ia,waj->wji", t1.bb, lu11.bb)
    x21 += einsum("wia,wxaj->xji", u11.bb, lu12.bb)
    rdm1_f_vo_bb -= einsum("wia,wij->aj", u11.bb, x21)
    del x21
    x22 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x22 += einsum("ijab->jiab", t2.bbbb) * -1
    x22 += einsum("ijab->jiba", t2.bbbb)
    x23 += einsum("abij,ikba->jk", l2.bbbb, x22) * -1
    del x22
    rdm1_f_vo_bb += einsum("ia,ij->aj", t1.bb, x23) * -1
    del x23
    x24 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x24 += einsum("abij->jiab", l2.bbbb)
    x24 += einsum("abij->jiba", l2.bbbb) * -1
    rdm1_f_vv_bb = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    rdm1_f_vv_bb += einsum("ijab,ijcb->ac", t2.bbbb, x24) * -1
    del x24
    rdm1_f_oo_aa += einsum("ij->ji", delta_oo.aa)
    rdm1_f_oo_bb += einsum("ij->ji", delta_oo.bb)
    rdm1_f_ov_aa = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    rdm1_f_ov_aa += einsum("ai->ia", l1.aa)
    rdm1_f_ov_bb = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    rdm1_f_ov_bb += einsum("ai->ia", l1.bb)
    rdm1_f_vo_aa += einsum("ia->ai", t1.aa)
    rdm1_f_vo_aa += einsum("wx,wxia->ai", ls2, u12.aa) * 0.5
    rdm1_f_vo_aa += einsum("ai,jiba->bj", l1.bb, t2.abab)
    rdm1_f_vo_aa += einsum("w,wia->ai", ls1, u11.aa)
    rdm1_f_vo_bb += einsum("ia->ai", t1.bb)
    rdm1_f_vo_bb += einsum("ai,ijab->bj", l1.aa, t2.abab)
    rdm1_f_vo_bb += einsum("wx,wxia->ai", ls2, u12.bb) * 0.5
    rdm1_f_vo_bb += einsum("w,wia->ai", ls1, u11.bb)
    rdm1_f_vv_aa += einsum("wxai,wxib->ba", lu12.aa, u12.aa) * 0.5
    rdm1_f_vv_aa += einsum("abij,ijcb->ca", l2.abab, t2.abab)
    rdm1_f_vv_aa += einsum("wai,wib->ba", lu11.aa, u11.aa)
    rdm1_f_vv_aa += einsum("ai,ib->ba", l1.aa, t1.aa)
    rdm1_f_vv_bb += einsum("ai,ib->ba", l1.bb, t1.bb)
    rdm1_f_vv_bb += einsum("wai,wib->ba", lu11.bb, u11.bb)
    rdm1_f_vv_bb += einsum("abij,ijac->cb", l2.abab, t2.abab)
    rdm1_f_vv_bb += einsum("wxai,wxib->ba", lu12.bb, u12.bb) * 0.5

    rdm1_f_aa = np.block([[rdm1_f_oo_aa, rdm1_f_ov_aa], [rdm1_f_vo_aa, rdm1_f_vv_aa]])
    rdm1_f_bb = np.block([[rdm1_f_oo_bb, rdm1_f_ov_bb], [rdm1_f_vo_bb, rdm1_f_vv_bb]])

    rdm1_f.aa = rdm1_f_aa
    rdm1_f.bb = rdm1_f_bb

    return rdm1_f

def make_rdm2_f(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    rdm2_f = SimpleNamespace()

    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    delta_oo = SimpleNamespace()
    delta_oo.aa = np.eye(nocc[0])
    delta_oo.bb = np.eye(nocc[1])
    delta_vv = SimpleNamespace()
    delta_vv.aa = np.eye(nvir[0])
    delta_vv.bb = np.eye(nvir[1])

    # 2RDM
    x0 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x0 += einsum("wxai,wxja->ij", lu12.aa, u12.aa)
    x4 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x4 += einsum("ij->ij", x0)
    x20 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x20 += einsum("ij->ij", x0) * 0.5
    x22 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x22 += einsum("ij->ji", x0) * 0.5
    x43 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x43 += einsum("ij->ij", x0) * 0.5
    x112 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x112 += einsum("ij->ij", x0)
    x285 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x285 += einsum("ij->ij", x0) * 0.49999999999999967
    x332 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x332 += einsum("ij->ij", x0) * 0.5
    del x0
    x1 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x1 += einsum("abij,kjab->ik", l2.abab, t2.abab)
    x4 += einsum("ij->ij", x1) * 2
    x20 += einsum("ij->ij", x1)
    x22 += einsum("ij->ji", x1)
    x43 += einsum("ij->ij", x1)
    x112 += einsum("ij->ij", x1) * 2
    x285 += einsum("ij->ij", x1)
    x332 += einsum("ij->ij", x1)
    del x1
    x2 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x2 += einsum("ijab->jiab", t2.aaaa) * -1
    x2 += einsum("ijab->jiba", t2.aaaa)
    x3 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x3 += einsum("abij,ikba->jk", l2.aaaa, x2) * 2
    x4 += einsum("ij->ij", x3) * -1
    rdm2_f_oooo_aaaa = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_oooo_aaaa += einsum("ij,kl->jikl", delta_oo.aa, x4) * -0.5
    rdm2_f_oooo_aaaa += einsum("ij,kl->jlki", delta_oo.aa, x4) * 0.5
    rdm2_f_oooo_aaaa += einsum("ij,kl->kjil", delta_oo.aa, x4) * 0.5
    rdm2_f_oooo_aaaa += einsum("ij,kl->klij", delta_oo.aa, x4) * -0.5
    del x4
    x112 += einsum("ij->ij", x3) * -1
    del x3
    x19 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x19 += einsum("abij,ikba->jk", l2.aaaa, x2)
    x20 += einsum("ij->ij", x19) * -1
    x43 += einsum("ij->ij", x19) * -1
    x44 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x44 += einsum("ia,ij->ja", t1.aa, x43) * 2
    x45 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x45 += einsum("ia->ia", x44)
    del x44
    x46 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x46 += einsum("ia,jk->jika", t1.aa, x43) * -1
    x127 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x127 += einsum("ia,jk->jika", t1.aa, x43)
    x283 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x283 += einsum("ij,ikab->kjab", x43, t2.aaaa)
    del x43
    x288 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x288 += einsum("ijab->ijba", x283)
    del x283
    x285 += einsum("ij->ij", x19) * -1
    del x19
    x286 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x286 += einsum("ia,ij->ja", t1.aa, x285) * 2.0000000000000013
    del x285
    x287 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x287 += einsum("ia->ia", x286)
    del x286
    x277 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x277 += einsum("wxai,ijba->wxjb", lu12.aa, x2)
    x278 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x278 += einsum("wxia->xwia", x277) * -1
    del x277
    x331 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x331 += einsum("abij,ikba->jk", l2.aaaa, x2)
    x332 += einsum("ij->ij", x331) * -1
    del x331
    x5 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x5 += einsum("wai,wja->ij", lu11.aa, u11.aa)
    x20 += einsum("ij->ij", x5)
    x22 += einsum("ij->ji", x5)
    x53 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x53 += einsum("ia,ij->ja", t1.aa, x5)
    x58 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x58 += einsum("ia->ia", x53)
    del x53
    x59 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x59 += einsum("ij->ij", x5)
    x112 += einsum("ij->ij", x5) * 2
    x254 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x254 += einsum("ij,kiab->kjab", x5, t2.aaaa)
    x274 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x274 -= einsum("ijab->ijab", x254)
    del x254
    x296 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x296 += einsum("ij->ij", x5)
    x332 += einsum("ij->ij", x5)
    rdm2_f_oooo_aaaa -= einsum("ij,kl->ijkl", delta_oo.aa, x5)
    rdm2_f_oooo_aaaa += einsum("ij,kl->ilkj", delta_oo.aa, x5)
    rdm2_f_oooo_aaaa += einsum("ij,kl->kijl", delta_oo.aa, x5)
    rdm2_f_oooo_aaaa -= einsum("ij,kl->klji", delta_oo.aa, x5)
    del x5
    x6 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x6 += einsum("abij,klab->ijkl", l2.aaaa, t2.aaaa)
    x37 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x37 += einsum("ijkl->jilk", x6)
    rdm2_f_oooo_aaaa += einsum("ijkl->jkil", x6) * -1
    rdm2_f_oooo_aaaa += einsum("ijkl->jlik", x6)
    x7 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x7 += einsum("ia,abjk->kjib", t1.aa, l2.aaaa)
    x8 = np.zeros((nocc[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    x8 += einsum("ia,jkla->jkil", t1.aa, x7)
    x37 += einsum("ijkl->ijkl", x8)
    x38 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x38 += einsum("ia,ijkl->jkla", t1.aa, x37)
    del x37
    x46 += einsum("ijka->ikja", x38) * -1
    x127 += einsum("ijka->ikja", x38)
    del x38
    x244 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x244 += einsum("ia,ijkl->jlka", t1.aa, x8)
    x245 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x245 += einsum("ia,ijkb->jkab", t1.aa, x244)
    del x244
    x251 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x251 += einsum("ijab->ijab", x245)
    del x245
    x289 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x289 += einsum("ijab,jikl->lkab", t2.aaaa, x8)
    x292 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x292 += einsum("ijab->ijab", x289)
    del x289
    rdm2_f_oooo_aaaa += einsum("ijkl->ikjl", x8)
    rdm2_f_oooo_aaaa += einsum("ijkl->iljk", x8) * -1
    del x8
    x35 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x35 += einsum("ijka->ijka", x7)
    x35 += einsum("ijka->jika", x7) * -1
    x126 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x126 += einsum("ijab,kila->jklb", x2, x35)
    x127 += einsum("ijka->jkia", x126)
    del x126
    x41 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x41 += einsum("ijka->ijka", x7) * -1
    x41 += einsum("ijka->jika", x7)
    x42 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x42 += einsum("ijab,jikb->ka", t2.aaaa, x41) * 2
    x45 += einsum("ia->ia", x42) * -1
    del x42
    x101 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x101 += einsum("ijab,kila->kljb", t2.abab, x41)
    x314 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x314 += einsum("ijka->ijka", x101) * -1
    rdm2_f_oovo_aabb = np.zeros((nocc[0], nocc[0], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_oovo_aabb += einsum("ijka->ijak", x101) * -1
    rdm2_f_vooo_bbaa = np.zeros((nvir[1], nocc[1], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_vooo_bbaa += einsum("ijka->akij", x101) * -1
    del x101
    x120 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x120 += einsum("ijab,jikb->ka", t2.aaaa, x41)
    x125 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x125 += einsum("ia->ia", x120) * -1
    x340 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x340 += einsum("ia->ia", x120) * -1
    del x120
    x284 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x284 += einsum("ijab,jikb->ka", t2.aaaa, x41) * 2.0000000000000013
    x287 += einsum("ia->ia", x284) * -1
    del x284
    x333 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x333 += einsum("ijab,jikb->ka", t2.aaaa, x41) * -1
    del x41
    x138 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x138 -= einsum("ijka->ijka", x7)
    x138 += einsum("ijka->jika", x7)
    x139 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x139 += einsum("ia,jikb->jkab", t1.aa, x138)
    del x138
    rdm2_f_oovv_aaaa = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_oovv_aaaa -= einsum("ijab->ijab", x139)
    rdm2_f_vvoo_aaaa = np.zeros((nvir[0], nvir[0], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_vvoo_aaaa -= einsum("ijab->abij", x139)
    del x139
    x167 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x167 += einsum("ijka->ijka", x7)
    x167 -= einsum("ijka->jika", x7)
    x168 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x168 += einsum("ia,jikb->jkab", t1.aa, x167)
    rdm2_f_ovvo_aaaa = np.zeros((nocc[0], nvir[0], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_ovvo_aaaa -= einsum("ijab->ibaj", x168)
    rdm2_f_voov_aaaa = np.zeros((nvir[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_voov_aaaa -= einsum("ijab->ajib", x168)
    del x168
    x352 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x352 += einsum("ijab,ijkc->kcab", t2.aaaa, x7)
    x358 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x358 += einsum("iabc->iabc", x352)
    del x352
    x353 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x353 += einsum("ia,jikb->jkba", t1.aa, x7)
    x356 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x356 += einsum("ijab->ijab", x353) * -2
    del x353
    rdm2_f_ooov_aaaa = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_ooov_aaaa += einsum("ijka->ikja", x7)
    rdm2_f_ooov_aaaa -= einsum("ijka->jkia", x7)
    rdm2_f_ovoo_aaaa = np.zeros((nocc[0], nvir[0], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_ovoo_aaaa -= einsum("ijka->iajk", x7)
    rdm2_f_ovoo_aaaa += einsum("ijka->jaik", x7)
    del x7
    x9 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x9 += einsum("ai,ja->ij", l1.aa, t1.aa)
    x20 += einsum("ij->ij", x9)
    x124 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x124 += einsum("ia,ij->ja", t1.aa, x20)
    x125 += einsum("ia->ia", x124)
    del x124
    x320 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x320 += einsum("ij,ikab->jkab", x20, t2.abab)
    rdm2_f_vovo_aabb = np.zeros((nvir[0], nocc[0], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x320) * -1
    rdm2_f_vovo_bbaa = np.zeros((nvir[1], nocc[1], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x320) * -1
    del x320
    rdm2_f_oooo_aabb = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_oooo_aabb += einsum("ij,kl->klji", delta_oo.bb, x20) * -1
    del x20
    x22 += einsum("ij->ji", x9)
    x59 += einsum("ij->ij", x9)
    x60 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x60 += einsum("ia,jk->jika", t1.aa, x59)
    x128 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x128 += einsum("ia,jk->jika", t1.aa, x59)
    del x59
    x63 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x63 += einsum("ia,ij->ja", t1.aa, x9)
    x64 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x64 += einsum("ia->ia", x63) * -1
    del x63
    x112 += einsum("ij->ij", x9) * 2
    rdm2_f_oovo_aabb += einsum("ia,jk->jkai", t1.bb, x112) * -0.5
    rdm2_f_vooo_bbaa += einsum("ia,jk->aijk", t1.bb, x112) * -0.5
    del x112
    x252 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x252 += einsum("ij,kiab->jkab", x9, t2.aaaa)
    x274 += einsum("ijab->ijab", x252)
    del x252
    x296 += einsum("ij->ij", x9)
    x297 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x297 += einsum("ia,ij->ja", t1.aa, x296)
    del x296
    x298 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x298 += einsum("ia->ia", x297)
    x299 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x299 += einsum("ia->ia", x297)
    del x297
    x332 += einsum("ij->ij", x9)
    x333 += einsum("ia,ij->ja", t1.aa, x332)
    x340 += einsum("ia,ij->ja", t1.aa, x332) * 0.9999999999999993
    del x332
    rdm2_f_oooo_aaaa -= einsum("ij,kl->jikl", delta_oo.aa, x9)
    rdm2_f_oooo_aaaa += einsum("ij,kl->kijl", delta_oo.aa, x9)
    rdm2_f_oooo_aaaa += einsum("ij,kl->jlki", delta_oo.aa, x9)
    rdm2_f_oooo_aaaa -= einsum("ij,kl->klji", delta_oo.aa, x9)
    del x9
    x10 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x10 += einsum("abij,klab->ikjl", l2.abab, t2.abab)
    x103 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x103 += einsum("ijkl->ijkl", x10)
    x304 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x304 += einsum("ijkl->ijkl", x10)
    x312 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x312 += einsum("ijkl->ijkl", x10)
    rdm2_f_oooo_aabb += einsum("ijkl->ijkl", x10)
    rdm2_f_oooo_bbaa = np.zeros((nocc[1], nocc[1], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_oooo_bbaa += einsum("ijkl->klij", x10)
    del x10
    x11 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x11 += einsum("ia,bajk->jkib", t1.bb, l2.abab)
    x12 = np.zeros((nocc[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    x12 += einsum("ia,jkla->jikl", t1.aa, x11)
    x103 += einsum("ijkl->ijkl", x12)
    x104 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x104 += einsum("ia,jkil->jkla", t1.bb, x103)
    rdm2_f_oovo_aabb += einsum("ijka->ijak", x104)
    rdm2_f_vooo_bbaa += einsum("ijka->akij", x104)
    del x104
    x118 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x118 += einsum("ia,ijkl->jkla", t1.aa, x103)
    del x103
    rdm2_f_oovo_bbaa = np.zeros((nocc[1], nocc[1], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_oovo_bbaa += einsum("ijka->jkai", x118)
    rdm2_f_vooo_aabb = np.zeros((nvir[0], nocc[0], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_vooo_aabb += einsum("ijka->aijk", x118)
    del x118
    x304 += einsum("ijkl->ijkl", x12)
    x305 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x305 += einsum("ijab,ikjl->klab", t2.abab, x304)
    del x304
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x305)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x305)
    del x305
    x312 += einsum("ijkl->ijkl", x12) * 0.9999999999999993
    x313 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x313 += einsum("ia,jkil->jkla", t1.bb, x312)
    del x312
    x314 += einsum("ijka->ijka", x313)
    del x313
    rdm2_f_oooo_aabb += einsum("ijkl->ijkl", x12)
    rdm2_f_oooo_bbaa += einsum("ijkl->klij", x12)
    del x12
    x67 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x67 += einsum("ijab,ikla->kljb", t2.abab, x11)
    x79 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x79 += einsum("ijka->ijka", x67)
    x131 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x131 += einsum("ijka->ijka", x67) * -1
    x195 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x195 -= einsum("ijka->ijka", x67)
    del x67
    x73 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x73 += einsum("ijab,ijka->kb", t2.abab, x11)
    x78 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x78 += einsum("ia->ia", x73) * 2
    x111 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x111 += einsum("ia->ia", x73)
    x231 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x231 += einsum("ia->ia", x73) * 2.0000000000000013
    x338 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x338 += einsum("ia->ia", x73)
    x339 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x339 += einsum("ia->ia", x73)
    del x73
    x99 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x99 += einsum("ijab,kjla->kilb", t2.abab, x11)
    x314 += einsum("ijka->ijka", x99)
    rdm2_f_oovo_aabb += einsum("ijka->ijak", x99)
    rdm2_f_vooo_bbaa += einsum("ijka->akij", x99)
    del x99
    x165 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x165 += einsum("ia,ijkb->jkba", t1.aa, x11)
    rdm2_f_oovv_bbaa = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_oovv_bbaa -= einsum("ijab->ijba", x165)
    rdm2_f_vvoo_aabb = np.zeros((nvir[0], nvir[0], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_vvoo_aabb -= einsum("ijab->baij", x165)
    del x165
    x170 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x170 += einsum("ia,jikb->jkba", t1.bb, x11)
    x379 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x379 += einsum("ijab->ijab", x170)
    rdm2_f_ovvo_aabb = np.zeros((nocc[0], nvir[0], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_ovvo_aabb -= einsum("ijab->iabj", x170)
    rdm2_f_voov_bbaa = np.zeros((nvir[1], nocc[1], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_voov_bbaa -= einsum("ijab->bjia", x170)
    del x170
    x317 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x317 += einsum("ijka,ilba->ljkb", x11, x2) * 2
    x318 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x318 += einsum("ijka->ijka", x317) * -1
    del x317
    x374 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x374 += einsum("ijab,ijkc->kcab", t2.abab, x11)
    rdm2_f_vovv_bbaa = np.zeros((nvir[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_vovv_bbaa += einsum("iabc->ciba", x374) * -1
    rdm2_f_vvvo_aabb = np.zeros((nvir[0], nvir[0], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_vvvo_aabb += einsum("iabc->baci", x374) * -1
    del x374
    rdm2_f_ooov_bbaa = np.zeros((nocc[1], nocc[1], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_ooov_bbaa -= einsum("ijka->jkia", x11)
    rdm2_f_ovoo_aabb = np.zeros((nocc[0], nvir[0], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_ovoo_aabb -= einsum("ijka->iajk", x11)
    x13 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x13 += einsum("ai,ja->ij", l1.bb, t1.bb)
    x18 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x18 += einsum("ij->ji", x13)
    x25 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x25 += einsum("ij->ij", x13)
    x92 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x92 += einsum("ij->ij", x13)
    x96 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x96 += einsum("ia,ij->ja", t1.bb, x13)
    x97 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x97 += einsum("ia->ia", x96) * -1
    del x96
    x183 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x183 += einsum("ij,kiab->jkab", x13, t2.bbbb)
    x205 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x205 += einsum("ijab->ijab", x183)
    del x183
    x239 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x239 += einsum("ij->ij", x13)
    x321 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x321 += einsum("ij->ij", x13) * 2
    x336 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x336 += einsum("ij->ij", x13)
    rdm2_f_oooo_bbbb = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_oooo_bbbb -= einsum("ij,kl->jikl", delta_oo.bb, x13)
    rdm2_f_oooo_bbbb += einsum("ij,kl->kijl", delta_oo.bb, x13)
    rdm2_f_oooo_bbbb += einsum("ij,kl->jlki", delta_oo.bb, x13)
    rdm2_f_oooo_bbbb -= einsum("ij,kl->klji", delta_oo.bb, x13)
    del x13
    x14 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x14 += einsum("wai,wja->ij", lu11.bb, u11.bb)
    x18 += einsum("ij->ji", x14)
    x25 += einsum("ij->ij", x14)
    x86 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x86 += einsum("ia,ij->ja", t1.bb, x14)
    x91 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x91 += einsum("ia->ia", x86)
    del x86
    x92 += einsum("ij->ij", x14)
    x93 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x93 += einsum("ia,jk->jika", t1.bb, x92)
    x129 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x129 += einsum("ia,jk->jika", t1.bb, x92)
    del x92
    x185 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x185 += einsum("ij,kiab->kjab", x14, t2.bbbb)
    x205 -= einsum("ijab->ijab", x185)
    del x185
    x239 += einsum("ij->ij", x14)
    x240 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x240 += einsum("ia,ij->ja", t1.bb, x239)
    x241 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x241 += einsum("ia->ia", x240)
    del x240
    x242 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x242 += einsum("ia,ij->ja", t1.bb, x239) * 2
    del x239
    x243 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x243 += einsum("ia->ia", x242)
    del x242
    x321 += einsum("ij->ij", x14) * 2
    x336 += einsum("ij->ij", x14)
    rdm2_f_oooo_bbbb -= einsum("ij,kl->ijkl", delta_oo.bb, x14)
    rdm2_f_oooo_bbbb += einsum("ij,kl->ilkj", delta_oo.bb, x14)
    rdm2_f_oooo_bbbb += einsum("ij,kl->kijl", delta_oo.bb, x14)
    rdm2_f_oooo_bbbb -= einsum("ij,kl->klji", delta_oo.bb, x14)
    del x14
    x15 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x15 += einsum("wxai,wxja->ij", lu12.bb, u12.bb)
    x18 += einsum("ij->ji", x15) * 0.5
    x25 += einsum("ij->ij", x15) * 0.5
    x27 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x27 += einsum("ij->ij", x15)
    x76 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x76 += einsum("ij->ij", x15) * 0.5
    x226 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x226 += einsum("ij->ij", x15) * 0.5
    x229 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x229 += einsum("ij->ij", x15) * 0.49999999999999967
    x321 += einsum("ij->ij", x15)
    x336 += einsum("ij->ij", x15) * 0.5
    del x15
    x16 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x16 += einsum("abij,ikab->jk", l2.abab, t2.abab)
    x18 += einsum("ij->ji", x16)
    x25 += einsum("ij->ij", x16)
    x27 += einsum("ij->ij", x16) * 2
    x76 += einsum("ij->ij", x16)
    x217 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x217 += einsum("ij,kiab->jkab", x16, t2.bbbb)
    x232 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x232 += einsum("ijab->ijab", x217) * -1
    del x217
    x229 += einsum("ij->ij", x16)
    x321 += einsum("ij->ij", x16) * 2
    x336 += einsum("ij->ij", x16)
    del x16
    x17 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x17 += einsum("ijab->jiab", t2.bbbb) * -1
    x17 += einsum("ijab->jiba", t2.bbbb)
    x18 += einsum("abij,ikba->kj", l2.bbbb, x17) * -1
    del x17
    x18 += einsum("ij->ji", delta_oo.bb) * -1
    rdm2_f_oooo_aabb += einsum("ij,kl->jilk", delta_oo.aa, x18) * -1
    del x18
    x21 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x21 += einsum("ijab->jiab", t2.aaaa)
    x21 += einsum("ijab->jiba", t2.aaaa) * -1
    x22 += einsum("abij,ikab->kj", l2.aaaa, x21) * -1
    x36 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x36 += einsum("ijab,kila->jklb", x21, x35)
    del x35
    x46 += einsum("ijka->jkia", x36)
    del x36
    x117 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x117 += einsum("ijka,ilba->ljkb", x11, x21)
    del x11
    rdm2_f_oovo_bbaa += einsum("ijka->jkai", x117) * -1
    rdm2_f_vooo_aabb += einsum("ijka->aijk", x117) * -1
    del x117
    x121 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x121 += einsum("ai,ijba->jb", l1.aa, x21)
    x125 += einsum("ia->ia", x121) * -1
    x333 += einsum("ia->ia", x121) * -1
    del x121
    x340 += einsum("ai,ijba->jb", l1.aa, x21) * -0.9999999999999993
    x386 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x386 += einsum("abij,ikca->kjcb", l2.abab, x21)
    del x21
    x388 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x388 += einsum("ijab->ijab", x386) * -1
    del x386
    x22 += einsum("ij->ji", delta_oo.aa) * -1
    rdm2_f_oooo_bbaa += einsum("ij,kl->jilk", delta_oo.bb, x22) * -1
    del x22
    x23 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x23 += einsum("ijab->jiab", t2.bbbb)
    x23 += einsum("ijab->jiba", t2.bbbb) * -1
    x24 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x24 += einsum("abij,ikab->jk", l2.bbbb, x23)
    x25 += einsum("ij->ij", x24) * -1
    x110 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x110 += einsum("ia,ij->ja", t1.bb, x25)
    x111 += einsum("ia->ia", x110)
    del x110
    rdm2_f_oooo_bbaa += einsum("ij,kl->klji", delta_oo.aa, x25) * -1
    rdm2_f_oovo_bbaa += einsum("ia,jk->jkai", t1.aa, x25) * -1
    rdm2_f_vooo_aabb += einsum("ia,jk->aijk", t1.aa, x25) * -1
    del x25
    x76 += einsum("ij->ij", x24) * -1
    x77 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x77 += einsum("ia,ij->ja", t1.bb, x76) * 2
    x78 += einsum("ia->ia", x77)
    del x77
    x79 += einsum("ia,jk->jika", t1.bb, x76) * -1
    x131 += einsum("ia,jk->jika", t1.bb, x76)
    del x76
    x226 += einsum("ij->ij", x24) * -1
    x227 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x227 += einsum("ij,ikab->kjab", x226, t2.bbbb)
    del x226
    x232 += einsum("ijab->ijba", x227)
    del x227
    x229 += einsum("ij->ij", x24) * -1
    del x24
    x230 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x230 += einsum("ia,ij->ja", t1.bb, x229) * 2.0000000000000013
    del x229
    x231 += einsum("ia->ia", x230)
    del x230
    x26 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x26 += einsum("abij,ikab->jk", l2.bbbb, x23) * 2
    x27 += einsum("ij->ij", x26) * -1
    rdm2_f_oooo_bbbb += einsum("ij,kl->jikl", delta_oo.bb, x27) * -0.5
    rdm2_f_oooo_bbbb += einsum("ij,kl->jlki", delta_oo.bb, x27) * 0.5
    rdm2_f_oooo_bbbb += einsum("ij,kl->kjil", delta_oo.bb, x27) * 0.5
    rdm2_f_oooo_bbbb += einsum("ij,kl->klij", delta_oo.bb, x27) * -0.5
    del x27
    x321 += einsum("ij->ij", x26) * -1
    del x26
    x322 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x322 += einsum("ij,kiab->kjab", x321, t2.abab) * 0.5
    del x321
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x322) * -1
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x322) * -1
    del x322
    x107 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x107 += einsum("ai,ijba->jb", l1.bb, x23)
    x111 += einsum("ia->ia", x107) * -1
    x338 += einsum("ia->ia", x107) * -1
    x339 += einsum("ia->ia", x107) * -1
    del x107
    x220 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x220 += einsum("wxai,ijab->wxjb", lu12.bb, x23)
    x221 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x221 += einsum("wxia->xwia", x220) * -1
    del x220
    x335 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x335 += einsum("abij,ikab->jk", l2.bbbb, x23)
    x336 += einsum("ij->ij", x335) * -1
    del x335
    x337 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x337 += einsum("ia,ij->ja", t1.bb, x336)
    del x336
    x338 += einsum("ia->ia", x337)
    x339 += einsum("ia->ia", x337)
    del x337
    x378 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x378 += einsum("abij,jkcb->ikac", l2.abab, x23)
    x379 += einsum("ijab->ijab", x378) * -1
    del x378
    x28 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x28 += einsum("abij,klba->ijlk", l2.bbbb, t2.bbbb)
    x70 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x70 += einsum("ijkl->jilk", x28)
    x233 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x233 += einsum("ia,jikl->jkla", t1.bb, x28)
    x234 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x234 += einsum("ia,ijkb->kjba", t1.bb, x233)
    del x233
    x237 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x237 += einsum("ijab->ijab", x234)
    del x234
    x235 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x235 += einsum("ijkl->jilk", x28)
    rdm2_f_oooo_bbbb += einsum("ijkl->jkil", x28) * -1
    rdm2_f_oooo_bbbb += einsum("ijkl->jlik", x28)
    del x28
    x29 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x29 += einsum("ia,bajk->jkib", t1.bb, l2.bbbb)
    x30 = np.zeros((nocc[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    x30 += einsum("ia,jkla->kjli", t1.bb, x29)
    x70 += einsum("ijkl->ijkl", x30)
    x71 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x71 += einsum("ia,ijkl->jkla", t1.bb, x70)
    del x70
    x79 += einsum("ijka->ikja", x71) * -1
    x131 += einsum("ijka->ikja", x71)
    del x71
    x210 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x210 += einsum("ia,ijkl->jlka", t1.bb, x30)
    x211 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x211 += einsum("ia,ijkb->jkab", t1.bb, x210)
    del x210
    x215 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x215 += einsum("ijab->ijab", x211)
    del x211
    x235 += einsum("ijkl->ijkl", x30)
    x236 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x236 += einsum("ijab,ijkl->klab", t2.bbbb, x235)
    del x235
    x237 += einsum("ijab->ijab", x236)
    del x236
    rdm2_f_vovo_bbbb = np.zeros((nvir[1], nocc[1], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_vovo_bbbb += einsum("ijab->ajbi", x237) * -1
    rdm2_f_vovo_bbbb += einsum("ijab->bjai", x237)
    del x237
    rdm2_f_oooo_bbbb += einsum("ijkl->ikjl", x30)
    rdm2_f_oooo_bbbb += einsum("ijkl->iljk", x30) * -1
    del x30
    x68 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x68 += einsum("ijka->ijka", x29)
    x68 += einsum("ijka->jika", x29) * -1
    x69 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x69 += einsum("ijab,kila->jklb", x23, x68)
    x79 += einsum("ijka->jkia", x69)
    del x69
    x130 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x130 += einsum("ijab,kilb->jkla", x23, x68)
    x131 += einsum("ijka->jkia", x130)
    del x130
    x316 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x316 += einsum("ijab,kjlb->ikla", t2.abab, x68) * 2
    del x68
    x318 += einsum("ijka->ijka", x316) * -1
    del x316
    x74 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x74 += einsum("ijka->ijka", x29) * -1
    x74 += einsum("ijka->jika", x29)
    x75 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x75 += einsum("ijab,ijka->kb", t2.bbbb, x74) * 2
    x78 += einsum("ia->ia", x75) * -1
    del x75
    x106 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x106 += einsum("ijab,ijka->kb", t2.bbbb, x74)
    x111 += einsum("ia->ia", x106) * -1
    del x106
    x116 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x116 += einsum("ijab,kjlb->ikla", t2.abab, x74)
    rdm2_f_oovo_bbaa += einsum("ijka->jkai", x116) * -1
    rdm2_f_vooo_aabb += einsum("ijka->aijk", x116) * -1
    del x116
    x228 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x228 += einsum("ijab,ijka->kb", t2.bbbb, x74) * 2.0000000000000013
    x231 += einsum("ia->ia", x228) * -1
    del x228
    x334 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x334 += einsum("ijab,ijka->kb", t2.bbbb, x74)
    del x74
    x338 += einsum("ia->ia", x334) * -1
    x339 += einsum("ia->ia", x334) * -1
    del x334
    x153 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x153 -= einsum("ijka->ijka", x29)
    x153 += einsum("ijka->jika", x29)
    x154 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x154 += einsum("ia,jikb->jkab", t1.bb, x153)
    del x153
    rdm2_f_oovv_bbbb = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_oovv_bbbb -= einsum("ijab->ijab", x154)
    rdm2_f_vvoo_bbbb = np.zeros((nvir[1], nvir[1], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_vvoo_bbbb -= einsum("ijab->abij", x154)
    del x154
    x181 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x181 += einsum("ijka->ijka", x29)
    x181 -= einsum("ijka->jika", x29)
    x182 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x182 += einsum("ia,jikb->jkab", t1.bb, x181)
    rdm2_f_ovvo_bbbb = np.zeros((nocc[1], nvir[1], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_ovvo_bbbb -= einsum("ijab->ibaj", x182)
    rdm2_f_voov_bbbb = np.zeros((nvir[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_voov_bbbb -= einsum("ijab->ajib", x182)
    del x182
    x366 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x366 += einsum("ijab,ijkc->kcab", t2.bbbb, x29)
    x373 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x373 += einsum("iabc->iabc", x366)
    del x366
    x367 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x367 += einsum("ia,jikb->jkba", t1.bb, x29)
    x370 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x370 += einsum("ijab->ijab", x367) * -2
    del x367
    rdm2_f_ooov_bbbb = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_ooov_bbbb += einsum("ijka->ikja", x29)
    rdm2_f_ooov_bbbb -= einsum("ijka->jkia", x29)
    rdm2_f_ovoo_bbbb = np.zeros((nocc[1], nvir[1], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_ovoo_bbbb -= einsum("ijka->iajk", x29)
    rdm2_f_ovoo_bbbb += einsum("ijka->jaik", x29)
    del x29
    x31 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x31 += einsum("ia,abjk->jikb", t1.aa, l2.abab)
    x34 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x34 += einsum("ijab,kljb->klia", t2.abab, x31)
    x46 += einsum("ijka->ijka", x34)
    x127 += einsum("ijka->ijka", x34) * -1
    x264 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x264 -= einsum("ijka->ijka", x34)
    del x34
    x40 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x40 += einsum("ijab,ikjb->ka", t2.abab, x31)
    x45 += einsum("ia->ia", x40) * 2
    x125 += einsum("ia->ia", x40)
    x287 += einsum("ia->ia", x40) * 2.0000000000000013
    x333 += einsum("ia->ia", x40)
    x340 += einsum("ia->ia", x40)
    del x40
    x102 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x102 += einsum("ijab,klib->klja", x23, x31)
    x314 += einsum("ijka->ijka", x102) * -1
    rdm2_f_oovo_aabb += einsum("ijka->ijak", x102) * -1
    rdm2_f_vooo_bbaa += einsum("ijka->akij", x102) * -1
    del x102
    x114 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x114 += einsum("ijab,iklb->klja", t2.abab, x31)
    x318 += einsum("ijka->ijka", x114) * -2
    rdm2_f_oovo_bbaa += einsum("ijka->jkai", x114)
    rdm2_f_vooo_aabb += einsum("ijka->aijk", x114)
    del x114
    x163 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x163 += einsum("ia,jkib->jkba", t1.bb, x31)
    rdm2_f_oovv_aabb = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_oovv_aabb -= einsum("ijab->ijba", x163)
    rdm2_f_vvoo_bbaa = np.zeros((nvir[1], nvir[1], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_vvoo_bbaa -= einsum("ijab->baij", x163)
    del x163
    x175 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x175 += einsum("ia,ijkb->jkab", t1.aa, x31)
    x388 += einsum("ijab->ijab", x175)
    rdm2_f_ovvo_bbaa = np.zeros((nocc[1], nvir[1], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_ovvo_bbaa -= einsum("ijab->jbai", x175)
    rdm2_f_voov_aabb = np.zeros((nvir[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_voov_aabb -= einsum("ijab->aijb", x175)
    del x175
    x384 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x384 += einsum("ijab,ikjc->kacb", t2.abab, x31)
    rdm2_f_vovv_aabb = np.zeros((nvir[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_vovv_aabb += einsum("iabc->aicb", x384) * -1
    rdm2_f_vvvo_bbaa = np.zeros((nvir[1], nvir[1], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_vvvo_bbaa += einsum("iabc->cbai", x384) * -1
    del x384
    rdm2_f_ooov_aabb = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_ooov_aabb -= einsum("ijka->ijka", x31)
    rdm2_f_ovoo_bbaa = np.zeros((nocc[1], nvir[1], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_ovoo_bbaa -= einsum("ijka->kaij", x31)
    del x31
    x32 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x32 += einsum("ia,wxaj->wxji", t1.aa, lu12.aa)
    x33 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x33 += einsum("wxia,wxjk->jkia", u12.aa, x32)
    x46 += einsum("ijka->ijka", x33) * 0.5
    x127 += einsum("ijka->ijka", x33) * -0.5
    rdm2_f_vooo_aaaa = np.zeros((nvir[0], nocc[0], nocc[0], nocc[0]), dtype=np.float64)
    rdm2_f_vooo_aaaa += einsum("ijka->ajik", x127) * -1
    rdm2_f_vooo_aaaa += einsum("ijka->akij", x127)
    del x127
    x275 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x275 += einsum("ia,ijkb->jkab", t1.aa, x33)
    del x33
    x288 += einsum("ijab->ijab", x275) * 0.5
    del x275
    x39 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x39 += einsum("wxia,wxij->ja", u12.aa, x32)
    x45 += einsum("ia->ia", x39)
    x46 += einsum("ij,ka->jika", delta_oo.aa, x45) * 0.5
    rdm2_f_oovo_aaaa = np.zeros((nocc[0], nocc[0], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_oovo_aaaa += einsum("ijka->ijak", x46) * -1
    rdm2_f_oovo_aaaa += einsum("ijka->ikaj", x46)
    del x46
    rdm2_f_vooo_aaaa += einsum("ij,ka->ajik", delta_oo.aa, x45) * 0.5
    rdm2_f_vooo_aaaa += einsum("ij,ka->akij", delta_oo.aa, x45) * -0.5
    del x45
    x125 += einsum("ia->ia", x39) * 0.5
    x287 += einsum("ia->ia", x39)
    x288 += einsum("ia,jb->ijab", t1.aa, x287) * 0.5
    del x287
    x333 += einsum("ia->ia", x39) * 0.5
    x340 += einsum("ia->ia", x39) * 0.49999999999999967
    del x39
    x98 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x98 += einsum("wxia,wxjk->jkia", u12.bb, x32)
    x314 += einsum("ijka->ijka", x98) * -0.5
    rdm2_f_oovo_aabb += einsum("ijka->ijak", x98) * -0.5
    rdm2_f_vooo_bbaa += einsum("ijka->akij", x98) * -0.5
    del x98
    x255 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x255 += einsum("wia,wxij->xja", u11.aa, x32)
    del x32
    x256 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x256 += einsum("wia,wjb->jiab", u11.aa, x255)
    x274 += einsum("ijab->ijab", x256)
    del x256
    x329 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x329 += einsum("wia->wia", x255)
    del x255
    x47 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x47 += einsum("ai,jkba->ijkb", l1.aa, t2.aaaa)
    x60 += einsum("ijka->ijka", x47)
    x128 += einsum("ijka->ijka", x47)
    x264 += einsum("ijka->ijka", x47)
    del x47
    x48 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x48 += einsum("ia,waj->wji", t1.aa, lu11.aa)
    x49 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x49 += einsum("wia,wjk->jkia", u11.aa, x48)
    x60 -= einsum("ijka->ijka", x49)
    x128 -= einsum("ijka->ijka", x49)
    del x49
    x56 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x56 += einsum("wij->wij", x48)
    x122 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x122 += einsum("wij->wij", x48)
    x266 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x266 += einsum("ia,wij->wja", t1.aa, x48)
    x269 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x269 -= einsum("wia->wia", x266)
    del x266
    x295 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x295 += einsum("wia,wij->ja", u11.aa, x48)
    del x48
    x298 += einsum("ia->ia", x295)
    x299 += einsum("ia->ia", x295)
    del x295
    x50 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x50 += einsum("wia,wxaj->xji", u11.aa, lu12.aa)
    x51 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x51 += einsum("wia,wjk->jika", u11.aa, x50)
    x60 += einsum("ijka->ijka", x51)
    x128 += einsum("ijka->ijka", x51)
    del x51
    rdm2_f_vooo_aaaa -= einsum("ijka->ajik", x128)
    rdm2_f_vooo_aaaa += einsum("ijka->akij", x128)
    del x128
    x56 += einsum("wij->wij", x50)
    x57 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x57 += einsum("wia,wij->ja", u11.aa, x56)
    x58 += einsum("ia->ia", x57)
    del x57
    x105 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x105 += einsum("wia,wjk->jkia", u11.bb, x56)
    rdm2_f_oovo_aabb -= einsum("ijka->ijak", x105)
    rdm2_f_vooo_bbaa -= einsum("ijka->akij", x105)
    del x105
    x328 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x328 += einsum("ia,wij->wja", t1.aa, x56)
    del x56
    x329 += einsum("wia->wia", x328)
    del x328
    x122 += einsum("wij->wij", x50)
    x123 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x123 += einsum("wia,wij->ja", u11.aa, x122)
    x125 += einsum("ia->ia", x123)
    x333 += einsum("ia->ia", x123)
    del x123
    x340 += einsum("wia,wij->ja", u11.aa, x122) * 0.9999999999999993
    del x122
    x257 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x257 += einsum("ia,wij->wja", t1.aa, x50)
    x258 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x258 += einsum("wia,wjb->ijba", u11.aa, x257)
    del x257
    x274 += einsum("ijab->ijab", x258)
    del x258
    x271 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x271 += einsum("wia,wij->ja", u11.aa, x50)
    del x50
    x273 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x273 -= einsum("ia->ia", x271)
    del x271
    x52 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x52 += einsum("ai,jiba->jb", l1.bb, t2.abab)
    x58 -= einsum("ia->ia", x52)
    x125 += einsum("ia->ia", x52) * -1
    x273 += einsum("ia->ia", x52)
    x333 += einsum("ia->ia", x52) * -1
    x340 += einsum("ia->ia", x52) * -0.9999999999999993
    del x52
    x54 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x54 += einsum("ijab->jiab", t2.aaaa)
    x54 -= einsum("ijab->jiba", t2.aaaa)
    x55 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x55 += einsum("ai,ijba->jb", l1.aa, x54)
    x58 -= einsum("ia->ia", x55)
    del x55
    x60 -= einsum("ij,ka->jika", delta_oo.aa, x58)
    rdm2_f_oovo_aaaa += einsum("ijka->ijak", x60)
    rdm2_f_oovo_aaaa -= einsum("ijka->ikaj", x60)
    del x60
    rdm2_f_vooo_aaaa += einsum("ij,ka->ajik", delta_oo.aa, x58)
    rdm2_f_vooo_aaaa -= einsum("ij,ka->akij", delta_oo.aa, x58)
    del x58
    x327 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x327 += einsum("wai,ijba->wjb", lu11.aa, x54)
    x329 -= einsum("wia->wia", x327)
    del x327
    x61 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x61 += einsum("w,wia->ia", ls1, u11.aa)
    x64 += einsum("ia->ia", x61)
    x125 += einsum("ia->ia", x61) * -1
    x298 += einsum("ia->ia", x61) * -1
    x299 += einsum("ia->ia", x61) * -1
    x333 += einsum("ia->ia", x61) * -1
    x340 += einsum("ia->ia", x61) * -0.9999999999999993
    del x61
    x62 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x62 += einsum("wx,wxia->ia", ls2, u12.aa)
    x64 += einsum("ia->ia", x62) * 0.5
    x125 += einsum("ia->ia", x62) * -0.5
    x298 += einsum("ia->ia", x62) * -0.5
    x299 += einsum("ia->ia", x62) * -0.5
    rdm2_f_vovo_aaaa = np.zeros((nvir[0], nocc[0], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_vovo_aaaa += einsum("ia,jb->aibj", t1.aa, x299) * -1
    rdm2_f_vovo_aaaa += einsum("ia,jb->biaj", t1.aa, x299)
    del x299
    x333 += einsum("ia->ia", x62) * -0.5
    x340 += einsum("ia->ia", x62) * -0.49999999999999967
    del x62
    rdm2_f_vovo_bbaa += einsum("ia,jb->aibj", t1.bb, x340) * -1
    del x340
    x64 += einsum("ia->ia", t1.aa)
    rdm2_f_oovo_aaaa += einsum("ij,ka->jkai", delta_oo.aa, x64) * -1
    rdm2_f_oovo_aaaa += einsum("ij,ka->jiak", delta_oo.aa, x64)
    rdm2_f_vooo_aaaa += einsum("ij,ka->akji", delta_oo.aa, x64)
    rdm2_f_vooo_aaaa += einsum("ij,ka->aijk", delta_oo.aa, x64) * -1
    del x64
    x65 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x65 += einsum("ia,wxaj->wxji", t1.bb, lu12.bb)
    x66 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x66 += einsum("wxia,wxjk->jkia", u12.bb, x65)
    x79 += einsum("ijka->ijka", x66) * 0.5
    x131 += einsum("ijka->ijka", x66) * -0.5
    rdm2_f_vooo_bbbb = np.zeros((nvir[1], nocc[1], nocc[1], nocc[1]), dtype=np.float64)
    rdm2_f_vooo_bbbb += einsum("ijka->ajik", x131) * -1
    rdm2_f_vooo_bbbb += einsum("ijka->akij", x131)
    del x131
    x216 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x216 += einsum("ia,ijkb->jkab", t1.bb, x66)
    del x66
    x232 += einsum("ijab->ijab", x216) * 0.5
    del x216
    x72 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x72 += einsum("wxia,wxij->ja", u12.bb, x65)
    x78 += einsum("ia->ia", x72)
    x79 += einsum("ij,ka->jika", delta_oo.bb, x78) * 0.5
    rdm2_f_oovo_bbbb = np.zeros((nocc[1], nocc[1], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_oovo_bbbb += einsum("ijka->ijak", x79) * -1
    rdm2_f_oovo_bbbb += einsum("ijka->ikaj", x79)
    del x79
    rdm2_f_vooo_bbbb += einsum("ij,ka->ajik", delta_oo.bb, x78) * 0.5
    rdm2_f_vooo_bbbb += einsum("ij,ka->akij", delta_oo.bb, x78) * -0.5
    del x78
    x111 += einsum("ia->ia", x72) * 0.5
    x231 += einsum("ia->ia", x72)
    x232 += einsum("ia,jb->ijab", t1.bb, x231) * 0.5
    del x231
    x338 += einsum("ia->ia", x72) * 0.5
    x339 += einsum("ia->ia", x72) * 0.5
    del x72
    x115 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x115 += einsum("wxia,wxjk->ijka", u12.aa, x65)
    x318 += einsum("ijka->ijka", x115)
    rdm2_f_oovo_bbaa += einsum("ijka->jkai", x115) * -0.5
    rdm2_f_vooo_aabb += einsum("ijka->aijk", x115) * -0.5
    del x115
    x186 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x186 += einsum("wia,wxij->xja", u11.bb, x65)
    del x65
    x187 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x187 += einsum("wia,wjb->jiab", u11.bb, x186)
    x205 += einsum("ijab->ijab", x187)
    del x187
    x325 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x325 += einsum("wia->wia", x186)
    del x186
    x80 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x80 += einsum("ai,jkba->ijkb", l1.bb, t2.bbbb)
    x93 += einsum("ijka->ijka", x80)
    x129 += einsum("ijka->ijka", x80)
    x195 += einsum("ijka->ijka", x80)
    del x80
    x81 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x81 += einsum("ia,waj->wji", t1.bb, lu11.bb)
    x82 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x82 += einsum("wia,wjk->jkia", u11.bb, x81)
    x93 -= einsum("ijka->ijka", x82)
    x129 -= einsum("ijka->ijka", x82)
    del x82
    x89 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x89 += einsum("wij->wij", x81)
    x108 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x108 += einsum("wij->wij", x81)
    x198 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x198 += einsum("ia,wij->wja", t1.bb, x81)
    x200 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x200 -= einsum("wia->wia", x198)
    del x198
    x238 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x238 += einsum("wia,wij->ja", u11.bb, x81)
    del x81
    x241 += einsum("ia->ia", x238)
    x243 += einsum("ia->ia", x238) * 2
    del x238
    x83 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x83 += einsum("wia,wxaj->xji", u11.bb, lu12.bb)
    x84 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x84 += einsum("wia,wjk->jika", u11.bb, x83)
    x93 += einsum("ijka->ijka", x84)
    x129 += einsum("ijka->ijka", x84)
    del x84
    rdm2_f_vooo_bbbb -= einsum("ijka->ajik", x129)
    rdm2_f_vooo_bbbb += einsum("ijka->akij", x129)
    del x129
    x89 += einsum("wij->wij", x83)
    x90 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x90 += einsum("wia,wij->ja", u11.bb, x89)
    x91 += einsum("ia->ia", x90)
    del x90
    x119 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x119 += einsum("wia,wjk->ijka", u11.aa, x89)
    rdm2_f_oovo_bbaa -= einsum("ijka->jkai", x119)
    rdm2_f_vooo_aabb -= einsum("ijka->aijk", x119)
    del x119
    x324 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x324 += einsum("ia,wij->wja", t1.bb, x89)
    del x89
    x325 += einsum("wia->wia", x324)
    del x324
    x108 += einsum("wij->wij", x83)
    x109 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x109 += einsum("wia,wij->ja", u11.bb, x108)
    del x108
    x111 += einsum("ia->ia", x109)
    x338 += einsum("ia->ia", x109)
    x339 += einsum("ia->ia", x109)
    del x109
    x188 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x188 += einsum("ia,wij->wja", t1.bb, x83)
    x189 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x189 += einsum("wia,wjb->ijba", u11.bb, x188)
    del x188
    x205 += einsum("ijab->ijab", x189)
    del x189
    x202 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x202 += einsum("wia,wij->ja", u11.bb, x83)
    del x83
    x204 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x204 -= einsum("ia->ia", x202)
    del x202
    x85 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x85 += einsum("ai,ijab->jb", l1.aa, t2.abab)
    x91 -= einsum("ia->ia", x85)
    x111 += einsum("ia->ia", x85) * -1
    x204 += einsum("ia->ia", x85)
    x338 += einsum("ia->ia", x85) * -1
    x339 += einsum("ia->ia", x85) * -1
    del x85
    x87 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x87 += einsum("ijab->jiab", t2.bbbb)
    x87 -= einsum("ijab->jiba", t2.bbbb)
    x88 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x88 += einsum("ai,ijba->jb", l1.bb, x87)
    x91 -= einsum("ia->ia", x88)
    del x88
    x93 -= einsum("ij,ka->jika", delta_oo.bb, x91)
    rdm2_f_oovo_bbbb += einsum("ijka->ijak", x93)
    rdm2_f_oovo_bbbb -= einsum("ijka->ikaj", x93)
    del x93
    rdm2_f_vooo_bbbb += einsum("ij,ka->ajik", delta_oo.bb, x91)
    rdm2_f_vooo_bbbb -= einsum("ij,ka->akij", delta_oo.bb, x91)
    del x91
    x174 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x174 += einsum("abij,jkbc->ikac", l2.abab, x87)
    x301 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x301 -= einsum("ijab->ijab", x174)
    rdm2_f_ovvo_aabb -= einsum("ijab->iabj", x174)
    rdm2_f_voov_bbaa -= einsum("ijab->bjia", x174)
    del x174
    x194 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x194 += einsum("ijka,jlba->likb", x181, x87)
    del x181
    x195 += einsum("ijka->jkia", x194)
    del x194
    x196 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x196 += einsum("ia,ijkb->jkab", t1.bb, x195)
    del x195
    x205 += einsum("ijab->ijab", x196)
    del x196
    x199 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x199 += einsum("wai,ijab->wjb", lu11.bb, x87)
    x200 -= einsum("wia->wia", x199)
    del x199
    x203 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x203 += einsum("ai,ijab->jb", l1.bb, x87)
    x204 -= einsum("ia->ia", x203)
    del x203
    x205 += einsum("ia,jb->ijab", t1.bb, x204)
    del x204
    x323 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x323 += einsum("wai,ijba->wjb", lu11.bb, x87)
    x325 -= einsum("wia->wia", x323)
    del x323
    x94 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x94 += einsum("w,wia->ia", ls1, u11.bb)
    x97 += einsum("ia->ia", x94)
    x111 += einsum("ia->ia", x94) * -1
    x241 += einsum("ia->ia", x94) * -1
    x243 += einsum("ia->ia", x94) * -2
    x338 += einsum("ia->ia", x94) * -1
    x339 += einsum("ia->ia", x94) * -1
    del x94
    x95 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x95 += einsum("wx,wxia->ia", ls2, u12.bb)
    x97 += einsum("ia->ia", x95) * 0.5
    x111 += einsum("ia->ia", x95) * -0.5
    x241 += einsum("ia->ia", x95) * -0.5
    x243 += einsum("ia->ia", x95) * -1
    rdm2_f_vovo_bbbb += einsum("ia,jb->ajbi", t1.bb, x243) * 0.5
    rdm2_f_vovo_bbbb += einsum("ia,jb->bjai", t1.bb, x243) * -0.5
    del x243
    x338 += einsum("ia->ia", x95) * -0.5
    rdm2_f_vovo_aabb += einsum("ia,jb->aibj", t1.aa, x338) * -1
    del x338
    x339 += einsum("ia->ia", x95) * -0.5
    del x95
    x97 += einsum("ia->ia", t1.bb)
    rdm2_f_oovo_bbbb += einsum("ij,ka->jkai", delta_oo.bb, x97) * -1
    rdm2_f_oovo_bbbb += einsum("ij,ka->jiak", delta_oo.bb, x97)
    rdm2_f_vooo_bbbb += einsum("ij,ka->aijk", delta_oo.bb, x97) * -1
    rdm2_f_vooo_bbbb += einsum("ij,ka->akji", delta_oo.bb, x97)
    del x97
    x100 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x100 += einsum("ai,jkab->ijkb", l1.aa, t2.abab)
    x314 += einsum("ijka->ijka", x100) * -1
    x315 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x315 += einsum("ia,ijkb->jkab", t1.aa, x314)
    del x314
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x315)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x315)
    del x315
    rdm2_f_oovo_aabb -= einsum("ijka->ijak", x100)
    rdm2_f_vooo_bbaa -= einsum("ijka->akij", x100)
    del x100
    x111 += einsum("ia->ia", t1.bb) * -1
    rdm2_f_oovo_aabb += einsum("ij,ka->jiak", delta_oo.aa, x111) * -1
    rdm2_f_vooo_bbaa += einsum("ij,ka->akji", delta_oo.aa, x111) * -1
    del x111
    x113 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x113 += einsum("ai,jkba->jikb", l1.bb, t2.abab)
    x318 += einsum("ijka->ijka", x113) * 2
    x319 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x319 += einsum("ia,jikb->jkba", t1.bb, x318) * 0.5
    del x318
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x319) * -1
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x319) * -1
    del x319
    rdm2_f_oovo_bbaa -= einsum("ijka->jkai", x113)
    rdm2_f_vooo_aabb -= einsum("ijka->aijk", x113)
    del x113
    x125 += einsum("ia->ia", t1.aa) * -1
    rdm2_f_oovo_bbaa += einsum("ij,ka->jiak", delta_oo.bb, x125) * -1
    rdm2_f_vooo_aabb += einsum("ij,ka->akji", delta_oo.bb, x125) * -1
    del x125
    x132 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x132 += einsum("abij,kjcb->ikac", l2.abab, t2.abab)
    x259 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x259 += einsum("ijab,jkac->ikbc", t2.aaaa, x132)
    x274 -= einsum("ijab->ijab", x259)
    del x259
    x261 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x261 += einsum("ijab->ijab", x132)
    x356 += einsum("ijab->ijab", x132) * 2
    rdm2_f_oovv_aaaa -= einsum("ijab->ijba", x132)
    rdm2_f_ovvo_aaaa += einsum("ijab->iabj", x132)
    rdm2_f_voov_aaaa += einsum("ijab->bjia", x132)
    rdm2_f_vvoo_aaaa -= einsum("ijab->baij", x132)
    del x132
    x133 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x133 += einsum("wxai,wxjb->ijab", lu12.aa, u12.aa)
    x356 += einsum("ijab->ijab", x133)
    rdm2_f_oovv_aaaa += einsum("ijab->ijba", x133) * -0.5
    rdm2_f_ovvo_aaaa += einsum("ijab->iabj", x133) * 0.5
    rdm2_f_voov_aaaa += einsum("ijab->bjia", x133) * 0.5
    rdm2_f_vvoo_aaaa += einsum("ijab->baij", x133) * -0.5
    del x133
    x134 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x134 += einsum("wai,wjb->ijab", lu11.aa, u11.aa)
    rdm2_f_oovv_aaaa -= einsum("ijab->ijba", x134)
    rdm2_f_ovvo_aaaa += einsum("ijab->iabj", x134)
    rdm2_f_voov_aaaa += einsum("ijab->bjia", x134)
    rdm2_f_vvoo_aaaa -= einsum("ijab->baij", x134)
    del x134
    x135 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x135 -= einsum("ijab->jiab", t2.aaaa)
    x135 += einsum("ijab->jiba", t2.aaaa)
    x178 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x178 += einsum("abij,ikca->kjcb", l2.abab, x135)
    rdm2_f_ovvo_bbaa -= einsum("ijab->jbai", x178)
    rdm2_f_voov_aabb -= einsum("ijab->aijb", x178)
    del x178
    x263 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x263 += einsum("ijab,kila->jklb", x135, x167)
    del x167
    x264 += einsum("ijka->jkia", x263)
    del x263
    x265 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x265 += einsum("ia,ijkb->jkab", t1.aa, x264)
    del x264
    x274 += einsum("ijab->ijab", x265)
    del x265
    x268 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x268 += einsum("wai,ijba->wjb", lu11.aa, x135)
    x269 -= einsum("wia->wia", x268)
    del x268
    x272 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x272 += einsum("ai,ijba->jb", l1.aa, x135)
    x273 -= einsum("ia->ia", x272)
    del x272
    x274 += einsum("ia,jb->ijab", t1.aa, x273)
    del x273
    x136 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x136 += einsum("abij->jiab", l2.aaaa)
    x136 -= einsum("abij->jiba", l2.aaaa)
    x137 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x137 += einsum("ijab,ikac->jkbc", x135, x136)
    rdm2_f_oovv_aaaa += einsum("ijab->jiab", x137)
    rdm2_f_vvoo_aaaa += einsum("ijab->abji", x137)
    del x137
    x166 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x166 += einsum("ijab,ikac->kjcb", x136, x54)
    rdm2_f_ovvo_aaaa += einsum("ijab->jbai", x166)
    rdm2_f_voov_aaaa += einsum("ijab->aijb", x166)
    del x166
    x260 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x260 += einsum("ijab,ikcb->jkac", t2.aaaa, x136)
    del x136
    x261 -= einsum("ijab->jiba", x260)
    del x260
    x262 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x262 += einsum("ijab,ikac->jkbc", t2.aaaa, x261)
    del x261
    x274 += einsum("ijab->ijab", x262)
    del x262
    x140 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x140 += einsum("ai,ib->ab", l1.aa, t1.aa)
    x146 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x146 += einsum("ab->ab", x140)
    x350 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x350 += einsum("ab->ab", x140)
    del x140
    x141 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x141 += einsum("wai,wib->ab", lu11.aa, u11.aa)
    x146 += einsum("ab->ab", x141)
    x253 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x253 += einsum("ab,ijca->ijcb", x141, t2.aaaa)
    x274 -= einsum("ijab->ijab", x253)
    del x253
    x308 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x308 += einsum("ab->ab", x141)
    x350 += einsum("ab->ab", x141)
    del x141
    x351 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x351 += einsum("ia,bc->ibac", t1.aa, x350)
    del x350
    x142 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x142 += einsum("wxai,wxib->ab", lu12.aa, u12.aa)
    x146 += einsum("ab->ab", x142) * 0.5
    x281 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x281 += einsum("ab->ab", x142)
    x308 += einsum("ab->ab", x142) * 0.5
    del x142
    x143 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x143 += einsum("abij,ijcb->ac", l2.abab, t2.abab)
    x146 += einsum("ab->ab", x143)
    x281 += einsum("ab->ab", x143) * 2
    x308 += einsum("ab->ab", x143)
    del x143
    x144 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x144 += einsum("abij->jiab", l2.aaaa)
    x144 += einsum("abij->jiba", l2.aaaa) * -1
    x145 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x145 += einsum("ijab,ijcb->ac", t2.aaaa, x144)
    x146 += einsum("ab->ba", x145) * -1
    rdm2_f_oovv_aaaa += einsum("ij,ab->jiba", delta_oo.aa, x146)
    rdm2_f_oovv_bbaa += einsum("ij,ab->jiba", delta_oo.bb, x146)
    rdm2_f_ovvo_aaaa += einsum("ij,ab->jabi", delta_oo.aa, x146) * -1
    rdm2_f_voov_aaaa += einsum("ij,ab->bija", delta_oo.aa, x146) * -1
    rdm2_f_vvoo_aaaa += einsum("ij,ab->baji", delta_oo.aa, x146)
    rdm2_f_vvoo_aabb += einsum("ij,ab->baji", delta_oo.bb, x146)
    rdm2_f_vovv_bbaa += einsum("ia,bc->aicb", t1.bb, x146)
    rdm2_f_vvvo_aabb += einsum("ia,bc->cbai", t1.bb, x146)
    del x146
    x308 += einsum("ab->ba", x145) * -1
    del x145
    x309 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x309 += einsum("ab,ijac->ijbc", x308, t2.abab)
    del x308
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x309) * -1
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x309) * -1
    del x309
    x280 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x280 += einsum("ijab,ijcb->ac", t2.aaaa, x144) * 2
    x281 += einsum("ab->ba", x280) * -1
    del x280
    x282 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x282 += einsum("ab,ijac->ijcb", x281, t2.aaaa) * 0.5
    x288 += einsum("ijab->jiab", x282)
    del x282
    x358 += einsum("ia,bc->ibac", t1.aa, x281) * 0.5
    del x281
    x377 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x377 += einsum("ijab,ikca->kjcb", t2.abab, x144)
    del x144
    x379 += einsum("ijab->ijab", x377) * -1
    del x377
    x147 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x147 += einsum("wxai,wxjb->ijab", lu12.bb, u12.bb)
    x370 += einsum("ijab->ijab", x147)
    rdm2_f_oovv_bbbb += einsum("ijab->ijba", x147) * -0.5
    rdm2_f_ovvo_bbbb += einsum("ijab->iabj", x147) * 0.5
    rdm2_f_voov_bbbb += einsum("ijab->bjia", x147) * 0.5
    rdm2_f_vvoo_bbbb += einsum("ijab->baij", x147) * -0.5
    del x147
    x148 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x148 += einsum("abij,ikac->jkbc", l2.abab, t2.abab)
    x190 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x190 += einsum("ijab,jkbc->kica", t2.bbbb, x148)
    x205 += einsum("ijab->ijab", x190)
    del x190
    x192 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x192 += einsum("ijab->ijab", x148)
    x302 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x302 += einsum("ijab->ijab", x148)
    x370 += einsum("ijab->ijab", x148) * 2
    rdm2_f_oovv_bbbb -= einsum("ijab->ijba", x148)
    rdm2_f_ovvo_bbbb += einsum("ijab->iabj", x148)
    rdm2_f_voov_bbbb += einsum("ijab->bjia", x148)
    rdm2_f_vvoo_bbbb -= einsum("ijab->baij", x148)
    del x148
    x149 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x149 += einsum("wai,wjb->ijab", lu11.bb, u11.bb)
    rdm2_f_oovv_bbbb -= einsum("ijab->ijba", x149)
    rdm2_f_ovvo_bbbb += einsum("ijab->iabj", x149)
    rdm2_f_voov_bbbb += einsum("ijab->bjia", x149)
    rdm2_f_vvoo_bbbb -= einsum("ijab->baij", x149)
    del x149
    x150 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x150 -= einsum("ijab->jiab", t2.bbbb)
    x150 += einsum("ijab->jiba", t2.bbbb)
    x151 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x151 += einsum("abij->jiab", l2.bbbb)
    x151 -= einsum("abij->jiba", l2.bbbb)
    x152 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x152 += einsum("ijab,ikac->jkbc", x150, x151)
    del x150
    rdm2_f_oovv_bbbb += einsum("ijab->jiab", x152)
    rdm2_f_vvoo_bbbb += einsum("ijab->abji", x152)
    del x152
    x179 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x179 += einsum("ijab,jkbc->ikac", t2.abab, x151)
    x250 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x250 -= einsum("ijab,kjcb->ikac", t2.abab, x179)
    x251 += einsum("ijab->ijab", x250)
    del x250
    rdm2_f_ovvo_bbaa -= einsum("ijab->jbai", x179)
    rdm2_f_voov_aabb -= einsum("ijab->aijb", x179)
    del x179
    x180 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x180 += einsum("ijab,ikac->kjcb", x151, x87)
    del x87
    x302 += einsum("ijab->jiba", x180)
    x303 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x303 += einsum("ijab,jkbc->ikac", t2.abab, x302)
    del x302
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x303)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x303)
    del x303
    rdm2_f_ovvo_bbbb += einsum("ijab->jbai", x180)
    rdm2_f_voov_bbbb += einsum("ijab->aijb", x180)
    del x180
    x191 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x191 += einsum("ijab,ikac->jkbc", t2.bbbb, x151)
    x192 -= einsum("ijab->jiba", x191)
    x193 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x193 += einsum("ijab,ikbc->jkac", t2.bbbb, x192)
    del x192
    x205 -= einsum("ijab->jiba", x193)
    del x193
    x212 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x212 -= einsum("ijab,kica->jkbc", t2.bbbb, x191)
    del x191
    x215 += einsum("ijab->ijab", x212)
    del x212
    x213 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x213 += einsum("ijab,ikbc->jkac", t2.bbbb, x151)
    del x151
    x214 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x214 -= einsum("ijab,kicb->jkac", t2.bbbb, x213)
    del x213
    x215 += einsum("ijab->jiba", x214)
    del x214
    x155 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x155 += einsum("ai,ib->ab", l1.bb, t1.bb)
    x161 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x161 += einsum("ab->ab", x155)
    x364 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x364 += einsum("ab->ab", x155)
    del x155
    x156 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x156 += einsum("wai,wib->ab", lu11.bb, u11.bb)
    x161 += einsum("ab->ab", x156)
    x184 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x184 += einsum("ab,ijac->jicb", x156, t2.bbbb)
    x205 -= einsum("ijab->ijab", x184)
    del x184
    x310 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x310 += einsum("ab->ab", x156) * 2
    x364 += einsum("ab->ab", x156)
    del x156
    x365 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x365 += einsum("ia,bc->ibac", t1.bb, x364)
    del x364
    x157 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x157 += einsum("wxai,wxib->ab", lu12.bb, u12.bb)
    x161 += einsum("ab->ab", x157) * 0.5
    x224 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x224 += einsum("ab->ab", x157)
    x310 += einsum("ab->ab", x157)
    x372 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x372 += einsum("ab->ab", x157)
    del x157
    x158 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x158 += einsum("abij,ijac->bc", l2.abab, t2.abab)
    x161 += einsum("ab->ab", x158)
    x218 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x218 += einsum("ab,ijac->jibc", x158, t2.bbbb)
    x232 += einsum("ijab->ijab", x218) * -1
    del x218
    x310 += einsum("ab->ab", x158) * 2
    x372 += einsum("ab->ab", x158) * 2
    del x158
    x159 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x159 += einsum("abij->jiab", l2.bbbb) * -1
    x159 += einsum("abij->jiba", l2.bbbb)
    x160 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x160 += einsum("ijab,ijca->bc", t2.bbbb, x159)
    x161 += einsum("ab->ba", x160) * -1
    del x160
    rdm2_f_oovv_bbbb += einsum("ij,ab->jiba", delta_oo.bb, x161)
    rdm2_f_oovv_aabb += einsum("ij,ab->jiba", delta_oo.aa, x161)
    rdm2_f_ovvo_bbbb += einsum("ij,ab->jabi", delta_oo.bb, x161) * -1
    rdm2_f_voov_bbbb += einsum("ij,ab->bija", delta_oo.bb, x161) * -1
    rdm2_f_vvoo_bbbb += einsum("ij,ab->baji", delta_oo.bb, x161)
    rdm2_f_vvoo_bbaa += einsum("ij,ab->baji", delta_oo.aa, x161)
    rdm2_f_vovv_aabb += einsum("ia,bc->aicb", t1.aa, x161)
    rdm2_f_vvvo_bbaa += einsum("ia,bc->cbai", t1.aa, x161)
    del x161
    x223 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x223 += einsum("ijab,ijca->bc", t2.bbbb, x159) * 2
    del x159
    x224 += einsum("ab->ba", x223) * -1
    x225 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x225 += einsum("ab,ijac->ijcb", x224, t2.bbbb) * 0.5
    del x224
    x232 += einsum("ijab->jiab", x225)
    del x225
    x310 += einsum("ab->ba", x223) * -1
    x311 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x311 += einsum("ab,ijca->ijcb", x310, t2.abab) * 0.5
    del x310
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x311) * -1
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x311) * -1
    del x311
    x372 += einsum("ab->ba", x223) * -1
    del x223
    x373 += einsum("ia,bc->ibac", t1.bb, x372) * 0.5
    del x372
    x162 = np.zeros((nocc[0], nocc[0], nvir[1], nvir[1]), dtype=np.float64)
    x162 += einsum("abij,kjac->ikbc", l2.abab, t2.abab)
    x300 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x300 += einsum("ijab,ikbc->kjac", t2.abab, x162)
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x300)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x300)
    del x300
    x385 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x385 += einsum("ia,ijbc->jabc", t1.aa, x162)
    rdm2_f_vovv_aabb += einsum("iabc->aicb", x385) * -1
    rdm2_f_vvvo_bbaa += einsum("iabc->cbai", x385) * -1
    del x385
    rdm2_f_oovv_aabb -= einsum("ijab->ijba", x162)
    rdm2_f_vvoo_bbaa -= einsum("ijab->baij", x162)
    del x162
    x164 = np.zeros((nocc[1], nocc[1], nvir[0], nvir[0]), dtype=np.float64)
    x164 += einsum("abij,ikcb->jkac", l2.abab, t2.abab)
    x375 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x375 += einsum("ia,ijbc->jbca", t1.bb, x164)
    rdm2_f_vovv_bbaa += einsum("iabc->ciba", x375) * -1
    rdm2_f_vvvo_aabb += einsum("iabc->baci", x375) * -1
    del x375
    rdm2_f_oovv_bbaa -= einsum("ijab->ijba", x164)
    rdm2_f_vvoo_aabb -= einsum("ijab->baij", x164)
    del x164
    x169 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x169 += einsum("wxai,wxjb->ijab", lu12.aa, u12.bb)
    x379 += einsum("ijab->ijab", x169) * -0.5
    x380 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x380 += einsum("ia,ijbc->jabc", t1.aa, x379)
    del x379
    rdm2_f_vovv_bbaa += einsum("iabc->ciab", x380) * -1
    rdm2_f_vvvo_aabb += einsum("iabc->abci", x380) * -1
    del x380
    rdm2_f_ovvo_aabb += einsum("ijab->iabj", x169) * 0.5
    rdm2_f_voov_bbaa += einsum("ijab->bjia", x169) * 0.5
    del x169
    x171 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x171 += einsum("wai,wjb->ijab", lu11.aa, u11.bb)
    rdm2_f_ovvo_aabb += einsum("ijab->iabj", x171)
    rdm2_f_voov_bbaa += einsum("ijab->bjia", x171)
    del x171
    x172 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x172 -= einsum("abij->jiab", l2.aaaa)
    x172 += einsum("abij->jiba", l2.aaaa)
    x173 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x173 += einsum("ijab,ikca->kjcb", t2.abab, x172)
    x208 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x208 -= einsum("ijab,ikac->jkbc", t2.abab, x173)
    x209 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x209 += einsum("ijab->ijab", x208)
    del x208
    x301 -= einsum("ijab->ijab", x173)
    rdm2_f_vovo_aabb += einsum("ijab,ikca->ckbj", x301, x54)
    del x54
    rdm2_f_vovo_bbaa -= einsum("ijab,ikbc->ckaj", x135, x301)
    del x301
    del x135
    rdm2_f_ovvo_aabb -= einsum("ijab->iabj", x173)
    rdm2_f_voov_bbaa -= einsum("ijab->bjia", x173)
    del x173
    x246 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x246 += einsum("ijab,ikca->jkbc", t2.aaaa, x172)
    x247 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x247 -= einsum("ijab,kica->jkbc", t2.aaaa, x246)
    del x246
    x251 += einsum("ijab->jiba", x247)
    del x247
    x248 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x248 += einsum("ijab,ikcb->jkac", t2.aaaa, x172)
    del x172
    x249 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x249 -= einsum("ijab,kicb->jkac", t2.aaaa, x248)
    del x248
    x251 += einsum("ijab->ijab", x249)
    del x249
    x176 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x176 += einsum("wxai,wxjb->jiba", lu12.bb, u12.aa)
    x388 += einsum("ijab->ijab", x176) * -0.5
    rdm2_f_ovvo_bbaa += einsum("ijab->jbai", x176) * 0.5
    rdm2_f_voov_aabb += einsum("ijab->aijb", x176) * 0.5
    del x176
    x177 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x177 += einsum("wai,wjb->jiba", lu11.bb, u11.aa)
    rdm2_f_ovvo_bbaa += einsum("ijab->jbai", x177)
    rdm2_f_voov_aabb += einsum("ijab->aijb", x177)
    del x177
    x197 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x197 += einsum("wai,ijab->wjb", lu11.aa, t2.abab)
    x200 += einsum("wia->wia", x197)
    x201 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x201 += einsum("wia,wjb->ijab", u11.bb, x200)
    del x200
    x205 += einsum("ijab->jiba", x201)
    del x201
    rdm2_f_vovo_bbbb += einsum("ijab->aibj", x205)
    rdm2_f_vovo_bbbb -= einsum("ijab->biaj", x205)
    rdm2_f_vovo_bbbb -= einsum("ijab->ajbi", x205)
    rdm2_f_vovo_bbbb += einsum("ijab->bjai", x205)
    del x205
    x325 -= einsum("wia->wia", x197)
    del x197
    x206 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x206 += einsum("wx,xia->wia", ls2, u11.bb)
    x207 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x207 += einsum("wia,wjb->jiba", u11.bb, x206)
    x209 += einsum("ijab->jiba", x207)
    del x207
    rdm2_f_vovo_bbbb -= einsum("ijab->ajbi", x209)
    rdm2_f_vovo_bbbb += einsum("ijab->aibj", x209)
    del x209
    x325 -= einsum("wia->wia", x206)
    del x206
    x326 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x326 += einsum("wia,wjb->ijab", u11.aa, x325)
    del x325
    rdm2_f_vovo_aabb -= einsum("ijab->aibj", x326)
    rdm2_f_vovo_bbaa -= einsum("ijab->bjai", x326)
    del x326
    x215 += einsum("ijab->jiba", t2.bbbb)
    rdm2_f_vovo_bbbb -= einsum("ijab->biaj", x215)
    rdm2_f_vovo_bbbb += einsum("ijab->aibj", x215)
    del x215
    x219 = np.zeros((nbos, nbos, nocc[1], nvir[1]), dtype=np.float64)
    x219 += einsum("wxai,ijab->wxjb", lu12.aa, t2.abab)
    x221 += einsum("wxia->xwia", x219)
    del x219
    x222 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x222 += einsum("wxia,wxjb->ijab", u12.bb, x221) * 0.5
    x232 += einsum("ijab->jiba", x222) * -1
    del x222
    rdm2_f_vovo_bbbb += einsum("ijab->aibj", x232) * -1
    rdm2_f_vovo_bbbb += einsum("ijab->biaj", x232)
    rdm2_f_vovo_bbbb += einsum("ijab->ajbi", x232)
    rdm2_f_vovo_bbbb += einsum("ijab->bjai", x232) * -1
    del x232
    x307 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x307 += einsum("wxia,wxjb->ijab", u12.aa, x221) * 0.5
    del x221
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x307)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x307)
    del x307
    x241 += einsum("ia->ia", t1.bb) * -1
    rdm2_f_vovo_bbbb += einsum("ia,jb->biaj", t1.bb, x241)
    rdm2_f_vovo_bbbb += einsum("ia,jb->aibj", t1.bb, x241) * -1
    del x241
    x251 += einsum("ijab->jiba", t2.aaaa)
    rdm2_f_vovo_aaaa -= einsum("ijab->biaj", x251)
    rdm2_f_vovo_aaaa += einsum("ijab->aibj", x251)
    del x251
    x267 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x267 += einsum("wai,jiba->wjb", lu11.bb, t2.abab)
    x269 += einsum("wia->wia", x267)
    x270 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x270 += einsum("wia,wjb->ijab", u11.aa, x269)
    del x269
    x274 += einsum("ijab->jiba", x270)
    del x270
    rdm2_f_vovo_aaaa += einsum("ijab->aibj", x274)
    rdm2_f_vovo_aaaa -= einsum("ijab->biaj", x274)
    rdm2_f_vovo_aaaa -= einsum("ijab->ajbi", x274)
    rdm2_f_vovo_aaaa += einsum("ijab->bjai", x274)
    del x274
    x329 -= einsum("wia->wia", x267)
    del x267
    x330 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x330 += einsum("wia,wjb->jiba", u11.bb, x329)
    del x329
    rdm2_f_vovo_aabb -= einsum("ijab->aibj", x330)
    rdm2_f_vovo_bbaa -= einsum("ijab->bjai", x330)
    del x330
    x276 = np.zeros((nbos, nbos, nocc[0], nvir[0]), dtype=np.float64)
    x276 += einsum("wxai,jiba->wxjb", lu12.bb, t2.abab)
    x278 += einsum("wxia->xwia", x276)
    del x276
    x279 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x279 += einsum("wxia,wxjb->ijab", u12.aa, x278) * 0.5
    x288 += einsum("ijab->jiba", x279) * -1
    del x279
    rdm2_f_vovo_aaaa += einsum("ijab->aibj", x288) * -1
    rdm2_f_vovo_aaaa += einsum("ijab->biaj", x288)
    rdm2_f_vovo_aaaa += einsum("ijab->ajbi", x288)
    rdm2_f_vovo_aaaa += einsum("ijab->bjai", x288) * -1
    del x288
    x306 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x306 += einsum("wxia,wxjb->jiba", u12.bb, x278) * 0.5
    del x278
    rdm2_f_vovo_aabb += einsum("ijab->aibj", x306)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", x306)
    del x306
    x290 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x290 += einsum("ijab->jiba", t2.aaaa)
    x290 += einsum("ia,jb->ijab", t1.aa, t1.aa)
    x291 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x291 += einsum("ijab,ijkl->klab", x290, x6)
    del x290
    del x6
    x292 += einsum("ijab->jiba", x291)
    del x291
    rdm2_f_vovo_aaaa += einsum("ijab->ajbi", x292) * -1
    rdm2_f_vovo_aaaa += einsum("ijab->bjai", x292)
    del x292
    x293 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x293 += einsum("wx,xia->wia", ls2, u11.aa)
    x294 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x294 += einsum("wia,wjb->jiba", u11.aa, x293)
    del x293
    rdm2_f_vovo_aaaa -= einsum("ijab->biaj", x294)
    rdm2_f_vovo_aaaa += einsum("ijab->bjai", x294)
    del x294
    x298 += einsum("ia->ia", t1.aa) * -1
    rdm2_f_vovo_aaaa += einsum("ia,jb->bjai", t1.aa, x298) * -1
    rdm2_f_vovo_aaaa += einsum("ia,jb->ajbi", t1.aa, x298)
    del x298
    x333 += einsum("ia->ia", t1.aa) * -1
    rdm2_f_vovo_aabb += einsum("ia,jb->bjai", t1.bb, x333) * -1
    del x333
    x339 += einsum("ia->ia", t1.bb) * -1
    rdm2_f_vovo_bbaa += einsum("ia,jb->bjai", t1.aa, x339) * -1
    del x339
    x341 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x341 += einsum("ia,bcji->jbca", t1.aa, l2.aaaa)
    x398 = np.zeros((nvir[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x398 += einsum("ia,ibcd->cbda", t1.aa, x341)
    x399 = np.zeros((nvir[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x399 += einsum("abcd->badc", x398)
    del x398
    rdm2_f_ovvv_aaaa = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_ovvv_aaaa += einsum("iabc->iacb", x341)
    rdm2_f_ovvv_aaaa -= einsum("iabc->ibca", x341)
    rdm2_f_vvov_aaaa = np.zeros((nvir[0], nvir[0], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_vvov_aaaa -= einsum("iabc->caib", x341)
    rdm2_f_vvov_aaaa += einsum("iabc->cbia", x341)
    del x341
    x342 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x342 += einsum("ia,bcji->jbca", t1.bb, l2.bbbb)
    x393 = np.zeros((nvir[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x393 += einsum("ia,ibcd->cbda", t1.bb, x342)
    x394 = np.zeros((nvir[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x394 += einsum("abcd->badc", x393)
    del x393
    rdm2_f_ovvv_bbbb = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_ovvv_bbbb += einsum("iabc->iacb", x342)
    rdm2_f_ovvv_bbbb -= einsum("iabc->ibca", x342)
    rdm2_f_vvov_bbbb = np.zeros((nvir[1], nvir[1], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_vvov_bbbb -= einsum("iabc->caib", x342)
    rdm2_f_vvov_bbbb += einsum("iabc->cbia", x342)
    del x342
    x343 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x343 += einsum("ia,bcij->jbac", t1.aa, l2.abab)
    rdm2_f_ovvv_bbaa = np.zeros((nocc[1], nvir[1], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_ovvv_bbaa += einsum("iabc->icba", x343)
    rdm2_f_vvov_aabb = np.zeros((nvir[0], nvir[0], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_vvov_aabb += einsum("iabc->baic", x343)
    del x343
    x344 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x344 += einsum("ia,bcji->jbca", t1.bb, l2.abab)
    x396 = np.zeros((nvir[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x396 += einsum("ia,ibcd->bacd", t1.aa, x344)
    rdm2_f_vvvv_aabb = np.zeros((nvir[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_vvvv_aabb += einsum("abcd->badc", x396)
    rdm2_f_vvvv_bbaa = np.zeros((nvir[1], nvir[1], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_vvvv_bbaa += einsum("abcd->dcba", x396)
    del x396
    rdm2_f_ovvv_aabb = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_ovvv_aabb += einsum("iabc->iacb", x344)
    rdm2_f_vvov_bbaa = np.zeros((nvir[1], nvir[1], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_vvov_bbaa += einsum("iabc->cbia", x344)
    del x344
    x345 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x345 += einsum("ai,jibc->jabc", l1.aa, t2.aaaa)
    x351 += einsum("iabc->iabc", x345)
    del x345
    x346 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x346 += einsum("ia,wbi->wba", t1.aa, lu11.aa)
    x347 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x347 += einsum("wia,wbc->ibca", u11.aa, x346)
    x351 -= einsum("iabc->iabc", x347)
    del x347
    x381 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x381 += einsum("wab->wab", x346)
    del x346
    x348 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x348 += einsum("wia,xwbi->xba", u11.aa, lu12.aa)
    x349 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x349 += einsum("wia,wbc->ibac", u11.aa, x348)
    x351 += einsum("iabc->iabc", x349)
    del x349
    rdm2_f_vovv_aaaa = np.zeros((nvir[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_vovv_aaaa += einsum("iabc->bica", x351)
    rdm2_f_vovv_aaaa -= einsum("iabc->ciba", x351)
    rdm2_f_vvvo_aaaa = np.zeros((nvir[0], nvir[0], nvir[0], nocc[0]), dtype=np.float64)
    rdm2_f_vvvo_aaaa -= einsum("iabc->baci", x351)
    rdm2_f_vvvo_aaaa += einsum("iabc->cabi", x351)
    del x351
    x381 += einsum("wab->wab", x348)
    del x348
    x382 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x382 += einsum("wia,wbc->ibca", u11.bb, x381)
    del x381
    rdm2_f_vovv_bbaa += einsum("iabc->ciba", x382)
    rdm2_f_vvvo_aabb += einsum("iabc->baci", x382)
    del x382
    x354 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x354 += einsum("abij->jiab", l2.aaaa) * -1
    x354 += einsum("abij->jiba", l2.aaaa)
    x355 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x355 += einsum("ijab,ikcb->jkac", x2, x354) * 2
    del x2
    del x354
    x356 += einsum("ijab->jiba", x355)
    del x355
    x357 = np.zeros((nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x357 += einsum("ia,ijbc->jabc", t1.aa, x356) * 0.5
    del x356
    x358 += einsum("iabc->ibac", x357) * -1
    del x357
    rdm2_f_vovv_aaaa += einsum("iabc->bica", x358)
    rdm2_f_vovv_aaaa += einsum("iabc->ciba", x358) * -1
    rdm2_f_vvvo_aaaa += einsum("iabc->baci", x358) * -1
    rdm2_f_vvvo_aaaa += einsum("iabc->cabi", x358)
    del x358
    x359 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x359 += einsum("ai,jibc->jabc", l1.bb, t2.bbbb)
    x365 += einsum("iabc->iabc", x359)
    del x359
    x360 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x360 += einsum("ia,wbi->wba", t1.bb, lu11.bb)
    x361 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x361 += einsum("wia,wbc->ibca", u11.bb, x360)
    x365 -= einsum("iabc->iabc", x361)
    del x361
    x390 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x390 += einsum("wab->wab", x360)
    del x360
    x362 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x362 += einsum("wia,xwbi->xba", u11.bb, lu12.bb)
    x363 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x363 += einsum("wia,wbc->ibac", u11.bb, x362)
    x365 += einsum("iabc->iabc", x363)
    del x363
    rdm2_f_vovv_bbbb = np.zeros((nvir[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_vovv_bbbb += einsum("iabc->bica", x365)
    rdm2_f_vovv_bbbb -= einsum("iabc->ciba", x365)
    rdm2_f_vvvo_bbbb = np.zeros((nvir[1], nvir[1], nvir[1], nocc[1]), dtype=np.float64)
    rdm2_f_vvvo_bbbb -= einsum("iabc->baci", x365)
    rdm2_f_vvvo_bbbb += einsum("iabc->cabi", x365)
    del x365
    x390 += einsum("wab->wab", x362)
    del x362
    x391 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x391 += einsum("wia,wbc->iabc", u11.aa, x390)
    del x390
    rdm2_f_vovv_aabb += einsum("iabc->aicb", x391)
    rdm2_f_vvvo_bbaa += einsum("iabc->cbai", x391)
    del x391
    x368 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x368 += einsum("abij->jiab", l2.bbbb)
    x368 += einsum("abij->jiba", l2.bbbb) * -1
    x369 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x369 += einsum("ijab,ikac->jkbc", x23, x368) * 2
    del x23
    x370 += einsum("ijab->jiba", x369)
    del x369
    x371 = np.zeros((nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x371 += einsum("ia,ijbc->jabc", t1.bb, x370) * 0.5
    del x370
    x373 += einsum("iabc->ibac", x371) * -1
    del x371
    rdm2_f_vovv_bbbb += einsum("iabc->bica", x373)
    rdm2_f_vovv_bbbb += einsum("iabc->ciba", x373) * -1
    rdm2_f_vvvo_bbbb += einsum("iabc->baci", x373) * -1
    rdm2_f_vvvo_bbbb += einsum("iabc->cabi", x373)
    del x373
    x387 = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    x387 += einsum("ijab,jkcb->ikac", t2.abab, x368)
    del x368
    x388 += einsum("ijab->ijab", x387) * -1
    del x387
    x389 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x389 += einsum("ia,jibc->jbac", t1.bb, x388)
    del x388
    rdm2_f_vovv_aabb += einsum("iabc->aibc", x389) * -1
    rdm2_f_vvvo_bbaa += einsum("iabc->bcai", x389) * -1
    del x389
    x376 = np.zeros((nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    x376 += einsum("ai,ijbc->jabc", l1.aa, t2.abab)
    rdm2_f_vovv_bbaa += einsum("iabc->ciba", x376)
    rdm2_f_vvvo_aabb += einsum("iabc->baci", x376)
    del x376
    x383 = np.zeros((nocc[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x383 += einsum("ai,jibc->jbac", l1.bb, t2.abab)
    rdm2_f_vovv_aabb += einsum("iabc->aicb", x383)
    rdm2_f_vvvo_bbaa += einsum("iabc->cbai", x383)
    del x383
    x392 = np.zeros((nvir[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    x392 += einsum("abij,ijcd->abcd", l2.bbbb, t2.bbbb)
    x394 += einsum("abcd->badc", x392)
    del x392
    rdm2_f_vvvv_bbbb = np.zeros((nvir[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    rdm2_f_vvvv_bbbb += einsum("abcd->dacb", x394) * -1
    rdm2_f_vvvv_bbbb += einsum("abcd->cadb", x394)
    del x394
    x395 = np.zeros((nvir[0], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    x395 += einsum("abij,ijcd->acbd", l2.abab, t2.abab)
    rdm2_f_vvvv_aabb += einsum("abcd->badc", x395)
    rdm2_f_vvvv_bbaa += einsum("abcd->dcba", x395)
    del x395
    x397 = np.zeros((nvir[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    x397 += einsum("abij,ijcd->abcd", l2.aaaa, t2.aaaa)
    x399 += einsum("abcd->badc", x397)
    del x397
    rdm2_f_vvvv_aaaa = np.zeros((nvir[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    rdm2_f_vvvv_aaaa += einsum("abcd->dacb", x399) * -1
    rdm2_f_vvvv_aaaa += einsum("abcd->cadb", x399)
    del x399
    rdm2_f_oooo_aaaa += einsum("ij,kl->jilk", delta_oo.aa, delta_oo.aa)
    rdm2_f_oooo_aaaa -= einsum("ij,kl->ljik", delta_oo.aa, delta_oo.aa)
    rdm2_f_oooo_bbbb += einsum("ij,kl->jilk", delta_oo.bb, delta_oo.bb)
    rdm2_f_oooo_bbbb -= einsum("ij,kl->ljik", delta_oo.bb, delta_oo.bb)
    rdm2_f_ooov_aaaa += einsum("ij,ak->jika", delta_oo.aa, l1.aa)
    rdm2_f_ooov_aaaa -= einsum("ij,ak->kija", delta_oo.aa, l1.aa)
    rdm2_f_ooov_bbbb += einsum("ij,ak->jika", delta_oo.bb, l1.bb)
    rdm2_f_ooov_bbbb -= einsum("ij,ak->kija", delta_oo.bb, l1.bb)
    rdm2_f_ooov_aabb += einsum("ij,ak->jika", delta_oo.aa, l1.bb)
    rdm2_f_ooov_bbaa += einsum("ij,ak->jika", delta_oo.bb, l1.aa)
    rdm2_f_ovoo_aaaa -= einsum("ij,ak->jaki", delta_oo.aa, l1.aa)
    rdm2_f_ovoo_aaaa += einsum("ij,ak->kaji", delta_oo.aa, l1.aa)
    rdm2_f_ovoo_bbaa += einsum("ij,ak->kaji", delta_oo.aa, l1.bb)
    rdm2_f_ovoo_aabb += einsum("ij,ak->kaji", delta_oo.bb, l1.aa)
    rdm2_f_ovoo_bbbb -= einsum("ij,ak->jaki", delta_oo.bb, l1.bb)
    rdm2_f_ovoo_bbbb += einsum("ij,ak->kaji", delta_oo.bb, l1.bb)
    rdm2_f_ovov_bbbb = np.zeros((nocc[1], nvir[1], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_ovov_bbbb -= einsum("abij->jaib", l2.bbbb)
    rdm2_f_ovov_bbbb += einsum("abij->jbia", l2.bbbb)
    rdm2_f_ovov_aaaa = np.zeros((nocc[0], nvir[0], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_ovov_aaaa -= einsum("abij->jaib", l2.aaaa)
    rdm2_f_ovov_aaaa += einsum("abij->jbia", l2.aaaa)
    rdm2_f_ovov_aabb = np.zeros((nocc[0], nvir[0], nocc[1], nvir[1]), dtype=np.float64)
    rdm2_f_ovov_aabb += einsum("abij->iajb", l2.abab)
    rdm2_f_ovov_bbaa = np.zeros((nocc[1], nvir[1], nocc[0], nvir[0]), dtype=np.float64)
    rdm2_f_ovov_bbaa += einsum("abij->jbia", l2.abab)
    rdm2_f_oovv_aaaa -= einsum("ai,jb->ijba", l1.aa, t1.aa)
    rdm2_f_oovv_bbbb -= einsum("ai,jb->ijba", l1.bb, t1.bb)
    rdm2_f_ovvo_aaaa += einsum("ai,jb->iabj", l1.aa, t1.aa)
    rdm2_f_ovvo_aabb += einsum("ai,jb->iabj", l1.aa, t1.bb)
    rdm2_f_ovvo_bbaa += einsum("ai,jb->iabj", l1.bb, t1.aa)
    rdm2_f_ovvo_bbbb += einsum("ai,jb->iabj", l1.bb, t1.bb)
    rdm2_f_voov_aaaa += einsum("ai,jb->bjia", l1.aa, t1.aa)
    rdm2_f_voov_bbaa += einsum("ai,jb->bjia", l1.aa, t1.bb)
    rdm2_f_voov_aabb += einsum("ai,jb->bjia", l1.bb, t1.aa)
    rdm2_f_voov_bbbb += einsum("ai,jb->bjia", l1.bb, t1.bb)
    rdm2_f_vvoo_aaaa -= einsum("ai,jb->baij", l1.aa, t1.aa)
    rdm2_f_vvoo_bbbb -= einsum("ai,jb->baij", l1.bb, t1.bb)
    rdm2_f_vovo_aabb += einsum("ijab->aibj", t2.abab)
    rdm2_f_vovo_bbaa += einsum("ijab->bjai", t2.abab)

    rdm2_f_aaaa = pack_2e(rdm2_f_oooo_aaaa, rdm2_f_ooov_aaaa, rdm2_f_oovo_aaaa, rdm2_f_ovoo_aaaa, rdm2_f_vooo_aaaa, rdm2_f_oovv_aaaa, rdm2_f_ovov_aaaa, rdm2_f_ovvo_aaaa, rdm2_f_voov_aaaa, rdm2_f_vovo_aaaa, rdm2_f_vvoo_aaaa, rdm2_f_ovvv_aaaa, rdm2_f_vovv_aaaa, rdm2_f_vvov_aaaa, rdm2_f_vvvo_aaaa, rdm2_f_vvvv_aaaa)
    rdm2_f_abab = pack_2e(rdm2_f_oooo_abab, rdm2_f_ooov_abab, rdm2_f_oovo_abab, rdm2_f_ovoo_abab, rdm2_f_vooo_abab, rdm2_f_oovv_abab, rdm2_f_ovov_abab, rdm2_f_ovvo_abab, rdm2_f_voov_abab, rdm2_f_vovo_abab, rdm2_f_vvoo_abab, rdm2_f_ovvv_abab, rdm2_f_vovv_abab, rdm2_f_vvov_abab, rdm2_f_vvvo_abab, rdm2_f_vvvv_abab)
    rdm2_f_baba = pack_2e(rdm2_f_oooo_baba, rdm2_f_ooov_baba, rdm2_f_oovo_baba, rdm2_f_ovoo_baba, rdm2_f_vooo_baba, rdm2_f_oovv_baba, rdm2_f_ovov_baba, rdm2_f_ovvo_baba, rdm2_f_voov_baba, rdm2_f_vovo_baba, rdm2_f_vvoo_baba, rdm2_f_ovvv_baba, rdm2_f_vovv_baba, rdm2_f_vvov_baba, rdm2_f_vvvo_baba, rdm2_f_vvvv_baba)
    rdm2_f_bbbb = pack_2e(rdm2_f_oooo_bbbb, rdm2_f_ooov_bbbb, rdm2_f_oovo_bbbb, rdm2_f_ovoo_bbbb, rdm2_f_vooo_bbbb, rdm2_f_oovv_bbbb, rdm2_f_ovov_bbbb, rdm2_f_ovvo_bbbb, rdm2_f_voov_bbbb, rdm2_f_vovo_bbbb, rdm2_f_vvoo_bbbb, rdm2_f_ovvv_bbbb, rdm2_f_vovv_bbbb, rdm2_f_vvov_bbbb, rdm2_f_vvvo_bbbb, rdm2_f_vvvv_bbbb)

    rdm2_f.aaaa = rdm2_f_aaaa
    rdm2_f.abab = rdm2_f_abab
    rdm2_f.baba = rdm2_f_baba
    rdm2_f.bbbb = rdm2_f_bbbb

    return rdm2_f

def make_sing_b_dm(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    # Single boson DM
    dm_b_cre = np.zeros((nbos), dtype=np.float64)
    dm_b_cre += einsum("w->w", ls1)
    dm_b_des = np.zeros((nbos), dtype=np.float64)
    dm_b_des += einsum("wai,xwia->x", lu11.bb, u12.bb)
    dm_b_des += einsum("w->w", s1)
    dm_b_des += einsum("w,xw->x", ls1, s2)
    dm_b_des += einsum("ai,wia->w", l1.aa, u11.aa)
    dm_b_des += einsum("ai,wia->w", l1.bb, u11.bb)
    dm_b_des += einsum("wai,xwia->x", lu11.aa, u12.aa)

    dm_b = np.array([dm_b_cre, dm_b_des])

    return dm_b

def make_rdm1_b(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    # Boson 1RDM
    rdm1_b = np.zeros((nbos, nbos), dtype=np.float64)
    rdm1_b += einsum("w,x->wx", ls1, s1)
    rdm1_b += einsum("wai,xia->wx", lu11.aa, u11.aa)
    rdm1_b += einsum("wai,xia->wx", lu11.bb, u11.bb)
    rdm1_b += einsum("wxai,yxia->wy", lu12.aa, u12.aa)
    rdm1_b += einsum("wxai,yxia->wy", lu12.bb, u12.bb)
    rdm1_b += einsum("wx,yx->wy", ls2, s2)

    return rdm1_b

def make_eb_coup_rdm(f=None, v=None, w=None, g=None, G=None, nocc=None, nvir=None, nbos=None, t1=None, t2=None, s1=None, s2=None, u11=None, u12=None, l1=None, l2=None, ls1=None, ls2=None, lu11=None, lu12=None, **kwargs):
    rdm_eb = SimpleNamespace()

    # Get boson coupling creation array:
    gc = SimpleNamespace(
        aa = SimpleNamespace(
            boo=g.aa.boo.transpose(0, 2, 1),
            bov=g.aa.bvo.transpose(0, 2, 1),
            bvo=g.aa.bov.transpose(0, 2, 1),
            bvv=g.aa.bvv.transpose(0, 2, 1),
        ),
        bb = SimpleNamespace(
            boo=g.bb.boo.transpose(0, 2, 1),
            bov=g.bb.bvo.transpose(0, 2, 1),
            bvo=g.bb.bov.transpose(0, 2, 1),
            bvv=g.bb.bvv.transpose(0, 2, 1),
        ),
    )

    delta_oo = SimpleNamespace()
    delta_oo.aa = np.eye(nocc[0])
    delta_oo.bb = np.eye(nocc[1])
    delta_vv = SimpleNamespace()
    delta_vv.aa = np.eye(nvir[0])
    delta_vv.bb = np.eye(nvir[1])

    # Boson-fermion coupling RDM
    x0 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x0 += einsum("ia,waj->wji", t1.aa, lu11.aa)
    x7 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x7 += einsum("wij->wij", x0)
    x73 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x73 += einsum("wij->wij", x0)
    rdm_eb_cre_oo_aa = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    rdm_eb_cre_oo_aa -= einsum("wij->wji", x0)
    del x0
    x1 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x1 += einsum("wia,xwaj->xji", u11.aa, lu12.aa)
    x7 += einsum("wij->wij", x1)
    rdm_eb_cre_ov_aa = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    rdm_eb_cre_ov_aa -= einsum("ia,wij->wja", t1.aa, x7)
    rdm_eb_des_ov_aa = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    rdm_eb_des_ov_aa -= einsum("wij,wxia->xja", x7, u12.aa)
    del x7
    x16 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x16 += einsum("wx,xij->wij", s2, x1)
    x62 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x62 += einsum("wij->wij", x16)
    rdm_eb_des_oo_aa = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    rdm_eb_des_oo_aa -= einsum("wij->wji", x16)
    del x16
    x73 += einsum("wij->wij", x1)
    x75 = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    x75 += einsum("wia,wij->ja", u11.aa, x73) * 0.9999999999999993
    del x73
    rdm_eb_cre_oo_aa -= einsum("wij->wji", x1)
    del x1
    x2 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x2 += einsum("ia,waj->wji", t1.bb, lu11.bb)
    x11 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x11 += einsum("wij->wij", x2)
    x86 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x86 += einsum("wij->wij", x2)
    rdm_eb_cre_oo_bb = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    rdm_eb_cre_oo_bb -= einsum("wij->wji", x2)
    del x2
    x3 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x3 += einsum("wia,xwaj->xji", u11.bb, lu12.bb)
    x11 += einsum("wij->wij", x3)
    rdm_eb_cre_ov_bb = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    rdm_eb_cre_ov_bb -= einsum("ia,wij->wja", t1.bb, x11)
    rdm_eb_des_ov_bb = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    rdm_eb_des_ov_bb -= einsum("wij,wxia->xja", x11, u12.bb)
    del x11
    x35 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x35 += einsum("wx,xij->wij", s2, x3)
    x81 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x81 += einsum("wij->wij", x35)
    rdm_eb_des_oo_bb = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    rdm_eb_des_oo_bb -= einsum("wij->wji", x35)
    del x35
    x86 += einsum("wij->wij", x3)
    x88 = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    x88 += einsum("wia,wij->ja", u11.bb, x86)
    del x86
    rdm_eb_cre_oo_bb -= einsum("wij->wji", x3)
    del x3
    x4 = np.zeros((nbos, nbos, nocc[0], nocc[0]), dtype=np.float64)
    x4 += einsum("ia,wxaj->wxji", t1.aa, lu12.aa)
    x5 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x5 += einsum("wia,xwij->xja", u11.aa, x4)
    rdm_eb_cre_ov_aa -= einsum("wia->wia", x5)
    rdm_eb_des_ov_aa -= einsum("wx,xia->wia", s2, x5)
    del x5
    x75 += einsum("wxia,wxij->ja", u12.aa, x4) * 0.49999999999999967
    del x4
    x6 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x6 += einsum("ijab->jiab", t2.aaaa)
    x6 -= einsum("ijab->jiba", t2.aaaa)
    rdm_eb_cre_ov_aa -= einsum("wai,ijab->wjb", lu11.aa, x6)
    x8 = np.zeros((nbos, nbos, nocc[1], nocc[1]), dtype=np.float64)
    x8 += einsum("ia,wxaj->wxji", t1.bb, lu12.bb)
    x9 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x9 += einsum("wia,xwij->xja", u11.bb, x8)
    rdm_eb_cre_ov_bb -= einsum("wia->wia", x9)
    rdm_eb_des_ov_bb -= einsum("wx,xia->wia", s2, x9)
    del x9
    x88 += einsum("wxia,wxij->ja", u12.bb, x8) * 0.5
    del x8
    x10 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x10 += einsum("ijab->jiab", t2.bbbb)
    x10 -= einsum("ijab->jiba", t2.bbbb)
    rdm_eb_cre_ov_bb -= einsum("wai,ijab->wjb", lu11.bb, x10)
    x12 = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    x12 += einsum("wia,xwbi->xba", u11.aa, lu12.aa)
    rdm_eb_cre_vv_aa = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    rdm_eb_cre_vv_aa += einsum("wab->wab", x12)
    rdm_eb_des_ov_aa -= einsum("wab,xwia->xib", x12, u12.aa)
    rdm_eb_des_vv_aa = np.zeros((nbos, nvir[0], nvir[0]), dtype=np.float64)
    rdm_eb_des_vv_aa += einsum("wx,xab->wab", s2, x12)
    del x12
    x13 = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    x13 += einsum("wia,xwbi->xba", u11.bb, lu12.bb)
    rdm_eb_cre_vv_bb = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    rdm_eb_cre_vv_bb += einsum("wab->wab", x13)
    rdm_eb_des_ov_bb -= einsum("wab,xwia->xib", x13, u12.bb)
    rdm_eb_des_vv_bb = np.zeros((nbos, nvir[1], nvir[1]), dtype=np.float64)
    rdm_eb_des_vv_bb += einsum("wx,xab->wab", s2, x13)
    del x13
    x14 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x14 += einsum("wai,xwja->xij", lu11.aa, u12.aa)
    x62 += einsum("wij->wij", x14)
    rdm_eb_des_oo_aa -= einsum("wij->wji", x14)
    del x14
    x15 = np.zeros((nbos, nocc[0], nocc[0]), dtype=np.float64)
    x15 += einsum("ai,wja->wij", l1.aa, u11.aa)
    x62 += einsum("wij->wij", x15)
    rdm_eb_des_oo_aa -= einsum("wij->wji", x15)
    del x15
    x17 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x17 += einsum("wx,xai->wia", s2, lu11.aa)
    x21 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x21 += einsum("wia->wia", x17)
    x51 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x51 += einsum("wia->wia", x17)
    rdm_eb_des_vo_aa = np.zeros((nbos, nvir[0], nocc[0]), dtype=np.float64)
    rdm_eb_des_vo_aa += einsum("wia->wai", x17)
    del x17
    x18 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x18 += einsum("wia,baji->wjb", u11.bb, l2.abab)
    x21 += einsum("wia->wia", x18)
    x51 += einsum("wia->wia", x18)
    rdm_eb_des_vo_aa += einsum("wia->wai", x18)
    del x18
    x19 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x19 += einsum("abij->jiab", l2.aaaa)
    x19 += einsum("abij->jiba", l2.aaaa) * -1
    x20 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x20 += einsum("wia,ijab->wjb", u11.aa, x19)
    del x19
    x21 += einsum("wia->wia", x20) * -1
    del x20
    rdm_eb_des_oo_aa += einsum("ia,wja->wij", t1.aa, x21) * -1
    rdm_eb_des_vv_aa += einsum("ia,wib->wba", t1.aa, x21)
    del x21
    x22 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x22 += einsum("ai,ja->ij", l1.aa, t1.aa)
    x28 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x28 += einsum("ij->ij", x22)
    x63 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x63 += einsum("ij->ij", x22)
    x74 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x74 += einsum("ij->ij", x22)
    del x22
    x23 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x23 += einsum("wai,wja->ij", lu11.aa, u11.aa)
    x28 += einsum("ij->ij", x23)
    x63 += einsum("ij->ij", x23)
    x74 += einsum("ij->ij", x23)
    del x23
    x24 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x24 += einsum("wxai,wxja->ij", lu12.aa, u12.aa)
    x28 += einsum("ij->ij", x24) * 0.5
    x63 += einsum("ij->ij", x24) * 0.5
    x74 += einsum("ij->ij", x24) * 0.5
    del x24
    x25 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x25 += einsum("abij,kjab->ik", l2.abab, t2.abab)
    x28 += einsum("ij->ij", x25)
    x63 += einsum("ij->ij", x25)
    x74 += einsum("ij->ij", x25)
    del x25
    x26 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x26 += einsum("ijab->jiab", t2.aaaa) * -1
    x26 += einsum("ijab->jiba", t2.aaaa)
    x27 = np.zeros((nocc[0], nocc[0]), dtype=np.float64)
    x27 += einsum("abij,ikba->jk", l2.aaaa, x26)
    x28 += einsum("ij->ij", x27) * -1
    x63 += einsum("ij->ij", x27) * -1
    del x27
    rdm_eb_des_ov_aa += einsum("ij,wia->wja", x63, u11.aa) * -1
    del x63
    x61 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x61 += einsum("abij,ijca->bc", l2.aaaa, x26) * -1
    x74 += einsum("abij,ikba->jk", l2.aaaa, x26) * -1
    x75 += einsum("ia,ij->ja", t1.aa, x74) * 0.9999999999999993
    del x74
    x89 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x89 += einsum("abij,ijca->bc", l2.aaaa, x26) * -2
    x28 += einsum("ij->ji", delta_oo.aa) * -1
    rdm_eb_des_oo_aa += einsum("w,ij->wji", s1, x28) * -1
    del x28
    x29 = np.zeros((nbos), dtype=np.float64)
    x29 += einsum("w,xw->x", ls1, s2)
    x34 = np.zeros((nbos), dtype=np.float64)
    x34 += einsum("w->w", x29)
    del x29
    x30 = np.zeros((nbos), dtype=np.float64)
    x30 += einsum("ai,wia->w", l1.aa, u11.aa)
    x34 += einsum("w->w", x30)
    del x30
    x31 = np.zeros((nbos), dtype=np.float64)
    x31 += einsum("ai,wia->w", l1.bb, u11.bb)
    x34 += einsum("w->w", x31)
    del x31
    x32 = np.zeros((nbos), dtype=np.float64)
    x32 += einsum("wai,xwia->x", lu11.aa, u12.aa)
    x34 += einsum("w->w", x32)
    del x32
    x33 = np.zeros((nbos), dtype=np.float64)
    x33 += einsum("wai,xwia->x", lu11.bb, u12.bb)
    x34 += einsum("w->w", x33)
    del x33
    rdm_eb_des_oo_aa += einsum("w,ij->wji", x34, delta_oo.aa)
    rdm_eb_des_oo_bb += einsum("w,ij->wji", x34, delta_oo.bb)
    rdm_eb_des_ov_aa += einsum("w,ia->wia", x34, t1.aa)
    rdm_eb_des_ov_bb += einsum("w,ia->wia", x34, t1.bb)
    del x34
    x36 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x36 += einsum("ai,wja->wij", l1.bb, u11.bb)
    x81 += einsum("wij->wij", x36)
    rdm_eb_des_oo_bb -= einsum("wij->wji", x36)
    del x36
    x37 = np.zeros((nbos, nocc[1], nocc[1]), dtype=np.float64)
    x37 += einsum("wai,xwja->xij", lu11.bb, u12.bb)
    x81 += einsum("wij->wij", x37)
    rdm_eb_des_oo_bb -= einsum("wij->wji", x37)
    del x37
    x38 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x38 += einsum("wx,xai->wia", s2, lu11.bb)
    x42 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x42 += einsum("wia->wia", x38)
    x54 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x54 += einsum("wia->wia", x38)
    rdm_eb_des_vo_bb = np.zeros((nbos, nvir[1], nocc[1]), dtype=np.float64)
    rdm_eb_des_vo_bb += einsum("wia->wai", x38)
    del x38
    x39 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x39 += einsum("wia,abij->wjb", u11.aa, l2.abab)
    x42 += einsum("wia->wia", x39)
    x54 += einsum("wia->wia", x39)
    rdm_eb_des_vo_bb += einsum("wia->wai", x39)
    del x39
    x40 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x40 += einsum("abij->jiab", l2.bbbb)
    x40 += einsum("abij->jiba", l2.bbbb) * -1
    x41 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x41 += einsum("wia,ijab->wjb", u11.bb, x40)
    del x40
    x42 += einsum("wia->wia", x41) * -1
    del x41
    rdm_eb_des_oo_bb += einsum("ia,wja->wij", t1.bb, x42) * -1
    rdm_eb_des_vv_bb += einsum("ia,wib->wba", t1.bb, x42)
    del x42
    x43 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x43 += einsum("ai,ja->ij", l1.bb, t1.bb)
    x48 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x48 += einsum("ij->ij", x43)
    x82 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x82 += einsum("ij->ij", x43) * 2
    x87 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x87 += einsum("ij->ij", x43)
    del x43
    x44 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x44 += einsum("wai,wja->ij", lu11.bb, u11.bb)
    x48 += einsum("ij->ij", x44)
    x82 += einsum("ij->ij", x44) * 2
    x87 += einsum("ij->ij", x44)
    del x44
    x45 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x45 += einsum("wxai,wxja->ij", lu12.bb, u12.bb)
    x48 += einsum("ij->ij", x45) * 0.5
    x82 += einsum("ij->ij", x45)
    x87 += einsum("ij->ij", x45) * 0.5
    del x45
    x46 = np.zeros((nocc[1], nocc[1]), dtype=np.float64)
    x46 += einsum("abij,ikab->jk", l2.abab, t2.abab)
    x48 += einsum("ij->ij", x46)
    x82 += einsum("ij->ij", x46) * 2
    x87 += einsum("ij->ij", x46)
    del x46
    x47 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x47 += einsum("ijab->jiab", t2.bbbb) * -1
    x47 += einsum("ijab->jiba", t2.bbbb)
    x48 += einsum("abij,ikba->jk", l2.bbbb, x47) * -1
    x82 += einsum("abij,ikba->jk", l2.bbbb, x47) * -2
    rdm_eb_des_ov_bb += einsum("ij,wia->wja", x82, u11.bb) * -0.5
    del x82
    x87 += einsum("abij,ikba->jk", l2.bbbb, x47) * -1
    x88 += einsum("ia,ij->ja", t1.bb, x87)
    del x87
    x88 += einsum("ai,ijab->jb", l1.bb, x47) * -1
    del x47
    x48 += einsum("ij->ji", delta_oo.bb) * -1
    rdm_eb_des_oo_bb += einsum("w,ij->wji", s1, x48) * -1
    del x48
    x49 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x49 += einsum("abij->jiab", l2.aaaa)
    x49 -= einsum("abij->jiba", l2.aaaa)
    x50 = np.zeros((nbos, nocc[0], nvir[0]), dtype=np.float64)
    x50 += einsum("wia,ijab->wjb", u11.aa, x49)
    del x49
    x51 -= einsum("wia->wia", x50)
    x62 += einsum("ia,wja->wji", t1.aa, x51)
    rdm_eb_des_ov_aa -= einsum("ia,wij->wja", t1.aa, x62)
    del x62
    rdm_eb_des_ov_aa -= einsum("wia,ijab->wjb", x51, x6)
    del x6
    rdm_eb_des_ov_bb += einsum("wia,ijab->wjb", x51, t2.abab)
    del x51
    rdm_eb_des_vo_aa -= einsum("wia->wai", x50)
    del x50
    x52 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x52 += einsum("abij->jiab", l2.bbbb)
    x52 -= einsum("abij->jiba", l2.bbbb)
    x53 = np.zeros((nbos, nocc[1], nvir[1]), dtype=np.float64)
    x53 += einsum("wia,ijab->wjb", u11.bb, x52)
    del x52
    x54 -= einsum("wia->wia", x53)
    x81 += einsum("ia,wja->wji", t1.bb, x54)
    rdm_eb_des_ov_bb -= einsum("ia,wij->wja", t1.bb, x81)
    del x81
    rdm_eb_des_ov_aa += einsum("wia,jiba->wjb", x54, t2.abab)
    rdm_eb_des_ov_bb -= einsum("wia,ijab->wjb", x54, x10)
    del x10
    del x54
    rdm_eb_des_vo_bb -= einsum("wia->wai", x53)
    del x53
    x55 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x55 += einsum("wia,xyai->xyw", u11.aa, lu12.aa)
    x57 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x57 += einsum("wxy->xwy", x55)
    del x55
    x56 = np.zeros((nbos, nbos, nbos), dtype=np.float64)
    x56 += einsum("wia,xyai->xyw", u11.bb, lu12.bb)
    x57 += einsum("wxy->xwy", x56)
    del x56
    rdm_eb_des_ov_aa += einsum("wxy,wxia->yia", x57, u12.aa) * 0.5
    rdm_eb_des_ov_bb += einsum("wxy,wxia->yia", x57, u12.bb) * 0.5
    del x57
    x58 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x58 += einsum("wai,wib->ab", lu11.aa, u11.aa)
    x61 += einsum("ab->ab", x58)
    x89 += einsum("ab->ab", x58) * 2
    del x58
    x59 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x59 += einsum("wxai,wxib->ab", lu12.aa, u12.aa)
    x61 += einsum("ab->ab", x59) * 0.5
    x89 += einsum("ab->ab", x59)
    del x59
    x60 = np.zeros((nvir[0], nvir[0]), dtype=np.float64)
    x60 += einsum("abij,ijcb->ac", l2.abab, t2.abab)
    x61 += einsum("ab->ab", x60)
    rdm_eb_des_ov_aa += einsum("ab,wia->wib", x61, u11.aa) * -1
    del x61
    x89 += einsum("ab->ab", x60) * 2
    del x60
    x64 = np.zeros((nbos, nbos), dtype=np.float64)
    x64 += einsum("wx,yx->wy", ls2, s2)
    x69 = np.zeros((nbos, nbos), dtype=np.float64)
    x69 += einsum("wx->wx", x64)
    del x64
    x65 = np.zeros((nbos, nbos), dtype=np.float64)
    x65 += einsum("wai,xia->wx", lu11.aa, u11.aa)
    x69 += einsum("wx->wx", x65)
    del x65
    x66 = np.zeros((nbos, nbos), dtype=np.float64)
    x66 += einsum("wai,xia->wx", lu11.bb, u11.bb)
    x69 += einsum("wx->wx", x66)
    del x66
    x67 = np.zeros((nbos, nbos), dtype=np.float64)
    x67 += einsum("wxai,ywia->xy", lu12.aa, u12.aa)
    x69 += einsum("wx->wx", x67)
    del x67
    x68 = np.zeros((nbos, nbos), dtype=np.float64)
    x68 += einsum("wxai,ywia->xy", lu12.bb, u12.bb)
    x69 += einsum("wx->wx", x68)
    del x68
    rdm_eb_des_ov_aa += einsum("wx,wia->xia", x69, u11.aa)
    rdm_eb_des_ov_bb += einsum("wx,wia->xia", x69, u11.bb)
    del x69
    x70 = np.zeros((nocc[0], nocc[0], nocc[1], nvir[1]), dtype=np.float64)
    x70 += einsum("ia,abjk->jikb", t1.aa, l2.abab)
    x75 += einsum("ijab,ikjb->ka", t2.abab, x70)
    del x70
    x71 = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0]), dtype=np.float64)
    x71 += einsum("ia,bajk->jkib", t1.aa, l2.aaaa)
    x75 += einsum("ijab,jika->kb", x26, x71) * -1
    del x26
    del x71
    x72 = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    x72 += einsum("ijab->jiab", t2.aaaa)
    x72 += einsum("ijab->jiba", t2.aaaa) * -1
    x75 += einsum("ai,ijba->jb", l1.aa, x72) * -0.9999999999999993
    del x72
    x75 += einsum("ia->ia", t1.aa) * -0.9999999999999993
    x75 += einsum("w,wia->ia", ls1, u11.aa) * -0.9999999999999993
    x75 += einsum("wx,wxia->ia", ls2, u12.aa) * -0.49999999999999967
    x75 += einsum("ai,jiba->jb", l1.bb, t2.abab) * -0.9999999999999993
    rdm_eb_des_ov_aa += einsum("w,ia->wia", s1, x75) * -1
    del x75
    x76 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x76 += einsum("wai,wib->ab", lu11.bb, u11.bb)
    x80 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x80 += einsum("ab->ab", x76) * 2
    x90 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x90 += einsum("ab->ab", x76)
    del x76
    x77 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x77 += einsum("wxai,wxib->ab", lu12.bb, u12.bb)
    x80 += einsum("ab->ab", x77)
    x90 += einsum("ab->ab", x77) * 0.5
    del x77
    x78 = np.zeros((nvir[1], nvir[1]), dtype=np.float64)
    x78 += einsum("abij,ijac->bc", l2.abab, t2.abab)
    x80 += einsum("ab->ab", x78) * 2
    x90 += einsum("ab->ab", x78)
    del x78
    x79 = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    x79 += einsum("abij->jiab", l2.bbbb) * -1
    x79 += einsum("abij->jiba", l2.bbbb)
    x80 += einsum("ijab,ijbc->ca", t2.bbbb, x79) * -2
    rdm_eb_des_ov_bb += einsum("ab,wia->wib", x80, u11.bb) * -0.5
    del x80
    x90 += einsum("ijab,ijbc->ca", t2.bbbb, x79) * -1
    del x79
    x83 = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0]), dtype=np.float64)
    x83 += einsum("ia,bajk->jkib", t1.bb, l2.abab)
    x88 += einsum("ijab,ijka->kb", t2.abab, x83)
    del x83
    x84 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x84 += einsum("ia,bajk->jkib", t1.bb, l2.bbbb)
    x85 = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1]), dtype=np.float64)
    x85 += einsum("ijka->ijka", x84)
    x85 += einsum("ijka->jika", x84) * -1
    del x84
    x88 += einsum("ijab,ijkb->ka", t2.bbbb, x85) * -1
    del x85
    x88 += einsum("ia->ia", t1.bb) * -1
    x88 += einsum("w,wia->ia", ls1, u11.bb) * -1
    x88 += einsum("wx,wxia->ia", ls2, u12.bb) * -0.5
    x88 += einsum("ai,ijab->jb", l1.aa, t2.abab) * -1
    rdm_eb_des_ov_bb += einsum("w,ia->wia", s1, x88) * -1
    del x88
    x89 += einsum("ai,ib->ab", l1.aa, t1.aa) * 2
    rdm_eb_des_vv_aa += einsum("w,ab->wab", s1, x89) * 0.5
    del x89
    x90 += einsum("ai,ib->ab", l1.bb, t1.bb)
    rdm_eb_des_vv_bb += einsum("w,ab->wab", s1, x90)
    del x90
    rdm_eb_cre_oo_aa += einsum("w,ij->wji", ls1, delta_oo.aa)
    rdm_eb_cre_oo_bb += einsum("w,ij->wji", ls1, delta_oo.bb)
    rdm_eb_cre_ov_aa += einsum("w,ia->wia", ls1, t1.aa)
    rdm_eb_cre_ov_aa += einsum("wx,xia->wia", ls2, u11.aa)
    rdm_eb_cre_ov_aa += einsum("wai,jiba->wjb", lu11.bb, t2.abab)
    rdm_eb_cre_ov_bb += einsum("w,ia->wia", ls1, t1.bb)
    rdm_eb_cre_ov_bb += einsum("wai,ijab->wjb", lu11.aa, t2.abab)
    rdm_eb_cre_ov_bb += einsum("wx,xia->wia", ls2, u11.bb)
    rdm_eb_cre_vo_aa = np.zeros((nbos, nvir[0], nocc[0]), dtype=np.float64)
    rdm_eb_cre_vo_aa += einsum("wai->wai", lu11.aa)
    rdm_eb_cre_vo_bb = np.zeros((nbos, nvir[1], nocc[1]), dtype=np.float64)
    rdm_eb_cre_vo_bb += einsum("wai->wai", lu11.bb)
    rdm_eb_cre_vv_aa += einsum("ia,wbi->wba", t1.aa, lu11.aa)
    rdm_eb_cre_vv_bb += einsum("ia,wbi->wba", t1.bb, lu11.bb)
    rdm_eb_des_ov_aa += einsum("wia->wia", u11.aa)
    rdm_eb_des_ov_aa += einsum("w,xwia->xia", ls1, u12.aa)
    rdm_eb_des_ov_bb += einsum("wia->wia", u11.bb)
    rdm_eb_des_ov_bb += einsum("w,xwia->xia", ls1, u12.bb)
    rdm_eb_des_vo_aa += einsum("w,ai->wai", s1, l1.aa)
    rdm_eb_des_vo_bb += einsum("w,ai->wai", s1, l1.bb)
    rdm_eb_des_vv_aa += einsum("ai,wib->wab", l1.aa, u11.aa)
    rdm_eb_des_vv_aa += einsum("wai,xwib->xab", lu11.aa, u12.aa)
    rdm_eb_des_vv_bb += einsum("ai,wib->wab", l1.bb, u11.bb)
    rdm_eb_des_vv_bb += einsum("wai,xwib->xab", lu11.bb, u12.bb)

    rdm_eb_aa = np.array([
            np.block([[rdm_eb_cre_oo_aa, rdm_eb_cre_ov_aa], [rdm_eb_cre_vo_aa, rdm_eb_cre_vv_aa]]),
            np.block([[rdm_eb_des_oo_aa, rdm_eb_des_ov_aa], [rdm_eb_des_vo_aa, rdm_eb_des_vv_aa]]),
    ])
    rdm_eb_bb = np.array([
            np.block([[rdm_eb_cre_oo_bb, rdm_eb_cre_ov_bb], [rdm_eb_cre_vo_bb, rdm_eb_cre_vv_bb]]),
            np.block([[rdm_eb_des_oo_bb, rdm_eb_des_ov_bb], [rdm_eb_des_vo_bb, rdm_eb_des_vv_bb]]),
    ])

    rdm_eb.aa = rdm_eb_aa
    rdm_eb.bb = rdm_eb_bb

    return rdm_eb

