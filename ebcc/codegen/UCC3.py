# Code generated by qwick.

import numpy as np
from ebcc.util import pack_2e, einsum, Namespace

def energy(f=None, v=None, nocc=None, nvir=None, t1=None, t2=None, t3=None, **kwargs):
    # energy
    e_cc = 0.0
    e_cc += np.einsum("ia,ia->", f.aa.ov, t1.aa)
    e_cc += np.einsum("ia,ia->", f.bb.ov, t1.bb)
    e_cc += np.einsum("ijab,iajb->", t2.abab, v.aabb.ovov)
    e_cc += np.einsum("ijab,iajb->", t2.aaaa, v.aaaa.ovov) * 0.5
    e_cc += np.einsum("ijab,iajb->", t2.bbbb, v.bbbb.ovov) * 0.5
    e_cc += np.einsum("ijab,ibja->", t2.aaaa, v.aaaa.ovov) * -0.5
    e_cc += np.einsum("ijab,ibja->", t2.bbbb, v.bbbb.ovov) * -0.5
    e_cc += np.einsum("ia,jb,iajb->", t1.aa, t1.aa, v.aaaa.ovov) * 0.5
    e_cc += np.einsum("ia,jb,ibja->", t1.aa, t1.aa, v.aaaa.ovov) * -0.5
    e_cc += np.einsum("ia,jb,iajb->", t1.aa, t1.bb, v.aabb.ovov)
    e_cc += np.einsum("ia,jb,iajb->", t1.bb, t1.bb, v.bbbb.ovov) * 0.5
    e_cc += np.einsum("ia,jb,ibja->", t1.bb, t1.bb, v.bbbb.ovov) * -0.5

    return e_cc

def update_amps(f=None, v=None, nocc=None, nvir=None, t1=None, t2=None, t3=None, **kwargs):
    t1new = Namespace()
    t2new = Namespace()
    t3new = Namespace()

    # T1 amplitudes
    t1new_aa = np.zeros((nocc[0], nvir[0]), dtype=np.float64)
    t1new_aa += np.einsum("ia->ia", f.aa.ov)
    t1new_aa += np.einsum("ij,ja->ia", f.aa.oo, t1.aa) * -1.0
    t1new_aa += np.einsum("ab,ib->ia", f.aa.vv, t1.aa)
    t1new_aa += np.einsum("jb,ijab->ia", f.bb.ov, t2.abab)
    t1new_aa += np.einsum("jb,ijab->ia", f.aa.ov, t2.aaaa) * 2.0
    t1new_aa += np.einsum("jb,ijab->ia", t1.aa, v.aaaa.oovv) * -1.0
    t1new_aa += np.einsum("jb,iajb->ia", t1.aa, v.aaaa.ovov)
    t1new_aa += np.einsum("jb,iajb->ia", t1.bb, v.aabb.ovov)
    t1new_aa += np.einsum("jkab,ijkb->ia", t2.abab, v.aabb.ooov) * -1.0
    t1new_aa += np.einsum("ijbc,jcab->ia", t2.abab, v.bbaa.ovvv)
    t1new_aa += np.einsum("jkab,ijkb->ia", t2.aaaa, v.aaaa.ooov) * -1.0
    t1new_aa += np.einsum("jkab,ikjb->ia", t2.aaaa, v.aaaa.ooov)
    t1new_aa += np.einsum("ijbc,jbac->ia", t2.aaaa, v.aaaa.ovvv) * -1.0
    t1new_aa += np.einsum("ijbc,jcab->ia", t2.aaaa, v.aaaa.ovvv)
    t1new_aa += np.einsum("jbkc,ijkabc->ia", v.bbaa.ovov, t3.abaaba)
    t1new_aa += np.einsum("jbkc,ikjacb->ia", v.aabb.ovov, t3.abaaba)
    t1new_aa += np.einsum("jbkc,ijkabc->ia", v.aaaa.ovov, t3.aaaaaa) * 3.0
    t1new_aa += np.einsum("jbkc,ijkabc->ia", v.bbbb.ovov, t3.abbabb)
    t1new_aa += np.einsum("jb,ib,ja->ia", f.aa.ov, t1.aa, t1.aa) * -1.0
    t1new_aa += np.einsum("jb,ka,ijkb->ia", t1.aa, t1.aa, v.aaaa.ooov)
    t1new_aa += np.einsum("jb,ka,ikjb->ia", t1.aa, t1.aa, v.aaaa.ooov) * -1.0
    t1new_aa += np.einsum("ib,jc,jbac->ia", t1.aa, t1.aa, v.aaaa.ovvv) * -1.0
    t1new_aa += np.einsum("ib,jc,jcab->ia", t1.aa, t1.aa, v.aaaa.ovvv)
    t1new_aa += np.einsum("ja,kb,ijkb->ia", t1.aa, t1.bb, v.aabb.ooov) * -1.0
    t1new_aa += np.einsum("ib,jc,jcab->ia", t1.aa, t1.bb, v.bbaa.ovvv)
    t1new_aa += np.einsum("ib,jkac,jbkc->ia", t1.aa, t2.abab, v.aabb.ovov) * -1.0
    t1new_aa += np.einsum("ja,ikbc,jbkc->ia", t1.aa, t2.abab, v.aabb.ovov) * -1.0
    t1new_aa += np.einsum("jb,ikac,jbkc->ia", t1.aa, t2.abab, v.aabb.ovov)
    t1new_aa += np.einsum("ib,jkac,jbkc->ia", t1.aa, t2.aaaa, v.aaaa.ovov) * -1.0
    t1new_aa += np.einsum("ib,jkac,jckb->ia", t1.aa, t2.aaaa, v.aaaa.ovov)
    t1new_aa += np.einsum("ja,ikbc,jbkc->ia", t1.aa, t2.aaaa, v.aaaa.ovov) * -1.0
    t1new_aa += np.einsum("ja,ikbc,jckb->ia", t1.aa, t2.aaaa, v.aaaa.ovov)
    t1new_aa += np.einsum("jb,ikac,jbkc->ia", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t1new_aa += np.einsum("jb,ikac,jckb->ia", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t1new_aa += np.einsum("jb,ikac,jbkc->ia", t1.bb, t2.abab, v.bbbb.ovov)
    t1new_aa += np.einsum("jb,ikac,jckb->ia", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t1new_aa += np.einsum("jb,ikac,jbkc->ia", t1.bb, t2.aaaa, v.bbaa.ovov) * 2.0
    t1new_aa += np.einsum("ib,jc,ka,jbkc->ia", t1.aa, t1.aa, t1.aa, v.aaaa.ovov)
    t1new_aa += np.einsum("ib,jc,ka,jckb->ia", t1.aa, t1.aa, t1.aa, v.aaaa.ovov) * -1.0
    t1new_aa += np.einsum("ib,ja,kc,jbkc->ia", t1.aa, t1.aa, t1.bb, v.aabb.ovov) * -1.0

    # T1 amplitudes
    t1new_bb = np.zeros((nocc[1], nvir[1]), dtype=np.float64)
    t1new_bb += np.einsum("ia->ia", f.bb.ov)
    t1new_bb += np.einsum("ij,ja->ia", f.bb.oo, t1.bb) * -1.0
    t1new_bb += np.einsum("ab,ib->ia", f.bb.vv, t1.bb)
    t1new_bb += np.einsum("jb,jiba->ia", f.aa.ov, t2.abab)
    t1new_bb += np.einsum("jb,ijab->ia", f.bb.ov, t2.bbbb) * 2.0
    t1new_bb += np.einsum("jb,iajb->ia", t1.aa, v.bbaa.ovov)
    t1new_bb += np.einsum("jb,ijab->ia", t1.bb, v.bbbb.oovv) * -1.0
    t1new_bb += np.einsum("jb,iajb->ia", t1.bb, v.bbbb.ovov)
    t1new_bb += np.einsum("jkba,ikjb->ia", t2.abab, v.bbaa.ooov) * -1.0
    t1new_bb += np.einsum("jibc,jbac->ia", t2.abab, v.aabb.ovvv)
    t1new_bb += np.einsum("jkab,ijkb->ia", t2.bbbb, v.bbbb.ooov) * -1.0
    t1new_bb += np.einsum("jkab,ikjb->ia", t2.bbbb, v.bbbb.ooov)
    t1new_bb += np.einsum("ijbc,jbac->ia", t2.bbbb, v.bbbb.ovvv) * -1.0
    t1new_bb += np.einsum("ijbc,jcab->ia", t2.bbbb, v.bbbb.ovvv)
    t1new_bb += np.einsum("jbkc,jikbac->ia", v.aaaa.ovov, t3.abaaba)
    t1new_bb += np.einsum("jbkc,ijkabc->ia", v.aabb.ovov, t3.babbab)
    t1new_bb += np.einsum("jbkc,ijkabc->ia", v.bbaa.ovov, t3.bbabba)
    t1new_bb += np.einsum("jbkc,ijkabc->ia", v.bbbb.ovov, t3.bbbbbb) * 3.0
    t1new_bb += np.einsum("jb,ib,ja->ia", f.bb.ov, t1.bb, t1.bb) * -1.0
    t1new_bb += np.einsum("jb,ka,ikjb->ia", t1.aa, t1.bb, v.bbaa.ooov) * -1.0
    t1new_bb += np.einsum("jb,ic,jbac->ia", t1.aa, t1.bb, v.aabb.ovvv)
    t1new_bb += np.einsum("jb,ka,ijkb->ia", t1.bb, t1.bb, v.bbbb.ooov)
    t1new_bb += np.einsum("jb,ka,ikjb->ia", t1.bb, t1.bb, v.bbbb.ooov) * -1.0
    t1new_bb += np.einsum("ib,jc,jbac->ia", t1.bb, t1.bb, v.bbbb.ovvv) * -1.0
    t1new_bb += np.einsum("ib,jc,jcab->ia", t1.bb, t1.bb, v.bbbb.ovvv)
    t1new_bb += np.einsum("jb,kica,jbkc->ia", t1.aa, t2.abab, v.aaaa.ovov)
    t1new_bb += np.einsum("jb,kica,jckb->ia", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t1new_bb += np.einsum("jb,ikac,jbkc->ia", t1.aa, t2.bbbb, v.aabb.ovov) * 2.0
    t1new_bb += np.einsum("ib,jkca,jckb->ia", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t1new_bb += np.einsum("ja,kibc,jckb->ia", t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t1new_bb += np.einsum("jb,kica,jbkc->ia", t1.bb, t2.abab, v.bbaa.ovov)
    t1new_bb += np.einsum("ib,jkac,jbkc->ia", t1.bb, t2.bbbb, v.bbbb.ovov) * -1.0
    t1new_bb += np.einsum("ib,jkac,jckb->ia", t1.bb, t2.bbbb, v.bbbb.ovov)
    t1new_bb += np.einsum("ja,ikbc,jbkc->ia", t1.bb, t2.bbbb, v.bbbb.ovov) * -1.0
    t1new_bb += np.einsum("ja,ikbc,jckb->ia", t1.bb, t2.bbbb, v.bbbb.ovov)
    t1new_bb += np.einsum("jb,ikac,jbkc->ia", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t1new_bb += np.einsum("jb,ikac,jckb->ia", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t1new_bb += np.einsum("jb,ic,ka,jbkc->ia", t1.aa, t1.bb, t1.bb, v.aabb.ovov) * -1.0
    t1new_bb += np.einsum("ib,jc,ka,jbkc->ia", t1.bb, t1.bb, t1.bb, v.bbbb.ovov)
    t1new_bb += np.einsum("ib,jc,ka,jckb->ia", t1.bb, t1.bb, t1.bb, v.bbbb.ovov) * -1.0

    # T2 amplitudes
    t2new_aaaa = np.zeros((nocc[0], nocc[0], nvir[0], nvir[0]), dtype=np.float64)
    t2new_aaaa += np.einsum("iajb->ijab", v.aaaa.ovov)
    t2new_aaaa += np.einsum("ibja->ijab", v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("ik,jkab->ijab", f.aa.oo, t2.aaaa) * 2.0
    t2new_aaaa += np.einsum("jk,ikab->ijab", f.aa.oo, t2.aaaa) * -2.0
    t2new_aaaa += np.einsum("ac,ijbc->ijab", f.aa.vv, t2.aaaa) * -2.0
    t2new_aaaa += np.einsum("bc,ijac->ijab", f.aa.vv, t2.aaaa) * 2.0
    t2new_aaaa += np.einsum("ka,ikjb->ijab", t1.aa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ka,jkib->ijab", t1.aa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("kb,ikja->ijab", t1.aa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("kb,jkia->ijab", t1.aa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ic,jabc->ijab", t1.aa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ic,jbac->ijab", t1.aa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("jc,iabc->ijab", t1.aa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("jc,ibac->ijab", t1.aa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("kc,ikjacb->ijab", f.bb.ov, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("kc,ijkabc->ijab", f.aa.ov, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("ikbc,jakc->ijab", t2.abab, v.aabb.ovov) * -1.0
    t2new_aaaa += np.einsum("ikac,jbkc->ijab", t2.abab, v.aabb.ovov)
    t2new_aaaa += np.einsum("jkbc,iakc->ijab", t2.abab, v.aabb.ovov)
    t2new_aaaa += np.einsum("jkac,ibkc->ijab", t2.abab, v.aabb.ovov) * -1.0
    t2new_aaaa += np.einsum("klab,ikjl->ijab", t2.aaaa, v.aaaa.oooo)
    t2new_aaaa += np.einsum("klab,iljk->ijab", t2.aaaa, v.aaaa.oooo) * -1.0
    t2new_aaaa += np.einsum("ikac,jkbc->ijab", t2.aaaa, v.aaaa.oovv) * -2.0
    t2new_aaaa += np.einsum("ikbc,jkac->ijab", t2.aaaa, v.aaaa.oovv) * 2.0
    t2new_aaaa += np.einsum("jkac,ikbc->ijab", t2.aaaa, v.aaaa.oovv) * 2.0
    t2new_aaaa += np.einsum("jkbc,ikac->ijab", t2.aaaa, v.aaaa.oovv) * -2.0
    t2new_aaaa += np.einsum("ikbc,jakc->ijab", t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ikac,jbkc->ijab", t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jkbc,iakc->ijab", t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jkac,ibkc->ijab", t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ijcd,acbd->ijab", t2.aaaa, v.aaaa.vvvv)
    t2new_aaaa += np.einsum("ijcd,adbc->ijab", t2.aaaa, v.aaaa.vvvv) * -1.0
    t2new_aaaa += np.einsum("iklc,jlkacb->ijab", v.aabb.ooov, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("jklc,ilkacb->ijab", v.aabb.ooov, t3.abaaba) * -2.0
    t2new_aaaa += np.einsum("kcad,ikjbcd->ijab", v.bbaa.ovvv, t3.abaaba) * -2.0
    t2new_aaaa += np.einsum("kcbd,ikjacd->ijab", v.bbaa.ovvv, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("iklc,jklabc->ijab", v.aaaa.ooov, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("jklc,iklabc->ijab", v.aaaa.ooov, t3.aaaaaa) * -6.0
    t2new_aaaa += np.einsum("kcad,ijkbcd->ijab", v.aaaa.ovvv, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("kcbd,ijkacd->ijab", v.aaaa.ovvv, t3.aaaaaa) * -6.0
    t2new_aaaa += np.einsum("kc,ic,jkab->ijab", f.aa.ov, t1.aa, t2.aaaa) * 2.0
    t2new_aaaa += np.einsum("kc,jc,ikab->ijab", f.aa.ov, t1.aa, t2.aaaa) * -2.0
    t2new_aaaa += np.einsum("kc,ka,ijbc->ijab", f.aa.ov, t1.aa, t2.aaaa) * 2.0
    t2new_aaaa += np.einsum("kc,kb,ijac->ijab", f.aa.ov, t1.aa, t2.aaaa) * -2.0
    t2new_aaaa += np.einsum("ic,ka,jkbc->ijab", t1.aa, t1.aa, v.aaaa.oovv)
    t2new_aaaa += np.einsum("ic,kb,jkac->ijab", t1.aa, t1.aa, v.aaaa.oovv) * -1.0
    t2new_aaaa += np.einsum("jc,ka,ikbc->ijab", t1.aa, t1.aa, v.aaaa.oovv) * -1.0
    t2new_aaaa += np.einsum("jc,kb,ikac->ijab", t1.aa, t1.aa, v.aaaa.oovv)
    t2new_aaaa += np.einsum("ka,lb,ikjl->ijab", t1.aa, t1.aa, v.aaaa.oooo)
    t2new_aaaa += np.einsum("ka,lb,iljk->ijab", t1.aa, t1.aa, v.aaaa.oooo) * -1.0
    t2new_aaaa += np.einsum("ic,ka,jbkc->ijab", t1.aa, t1.aa, v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,kb,jakc->ijab", t1.aa, t1.aa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("jc,ka,ibkc->ijab", t1.aa, t1.aa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("jc,kb,iakc->ijab", t1.aa, t1.aa, v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,jd,acbd->ijab", t1.aa, t1.aa, v.aaaa.vvvv)
    t2new_aaaa += np.einsum("ic,jd,adbc->ijab", t1.aa, t1.aa, v.aaaa.vvvv) * -1.0
    t2new_aaaa += np.einsum("ka,ilbc,jklc->ijab", t1.aa, t2.abab, v.aabb.ooov)
    t2new_aaaa += np.einsum("ka,jlbc,iklc->ijab", t1.aa, t2.abab, v.aabb.ooov) * -1.0
    t2new_aaaa += np.einsum("kb,ilac,jklc->ijab", t1.aa, t2.abab, v.aabb.ooov) * -1.0
    t2new_aaaa += np.einsum("kb,jlac,iklc->ijab", t1.aa, t2.abab, v.aabb.ooov)
    t2new_aaaa += np.einsum("ic,jkad,kdbc->ijab", t1.aa, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ic,jkbd,kdac->ijab", t1.aa, t2.abab, v.bbaa.ovvv)
    t2new_aaaa += np.einsum("jc,ikad,kdbc->ijab", t1.aa, t2.abab, v.bbaa.ovvv)
    t2new_aaaa += np.einsum("jc,ikbd,kdac->ijab", t1.aa, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ic,klab,jklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ic,klab,jlkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("jc,klab,iklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("jc,klab,ilkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ka,ilbc,jklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("ka,ilbc,jlkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("ka,jlbc,iklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("ka,jlbc,ilkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("kb,ilac,jklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("kb,ilac,jlkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("kb,jlac,iklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("kb,jlac,ilkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("kc,ilab,jklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("kc,ilab,jlkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("kc,jlab,iklc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t2new_aaaa += np.einsum("kc,jlab,ilkc->ijab", t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t2new_aaaa += np.einsum("ic,jkad,kcbd->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("ic,jkbd,kcad->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("ic,jkad,kdbc->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("ic,jkbd,kdac->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("jc,ikad,kcbd->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("jc,ikbd,kcad->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("jc,ikad,kdbc->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("jc,ikbd,kdac->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("ka,ijcd,kcbd->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ka,ijcd,kdbc->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("kb,ijcd,kcad->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("kb,ijcd,kdac->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("kc,ijad,kcbd->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("kc,ijbd,kcad->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("kc,ijad,kdbc->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("kc,ijbd,kdac->ijab", t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("kc,ilab,jlkc->ijab", t1.bb, t2.aaaa, v.aabb.ooov) * -2.0
    t2new_aaaa += np.einsum("kc,jlab,ilkc->ijab", t1.bb, t2.aaaa, v.aabb.ooov) * 2.0
    t2new_aaaa += np.einsum("kc,ijad,kcbd->ijab", t1.bb, t2.aaaa, v.bbaa.ovvv) * 2.0
    t2new_aaaa += np.einsum("kc,ijbd,kcad->ijab", t1.bb, t2.aaaa, v.bbaa.ovvv) * -2.0
    t2new_aaaa += np.einsum("ic,kcld,jlkadb->ijab", t1.aa, v.aabb.ovov, t3.abaaba)
    t2new_aaaa += np.einsum("ic,kdlc,jkladb->ijab", t1.aa, v.bbaa.ovov, t3.abaaba)
    t2new_aaaa += np.einsum("jc,kcld,ilkadb->ijab", t1.aa, v.aabb.ovov, t3.abaaba) * -1.0
    t2new_aaaa += np.einsum("jc,kdlc,ikladb->ijab", t1.aa, v.bbaa.ovov, t3.abaaba) * -1.0
    t2new_aaaa += np.einsum("ka,kcld,iljbdc->ijab", t1.aa, v.aabb.ovov, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("kb,kcld,iljadc->ijab", t1.aa, v.aabb.ovov, t3.abaaba) * -2.0
    t2new_aaaa += np.einsum("kc,kcld,iljadb->ijab", t1.aa, v.aabb.ovov, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("ic,kcld,jklabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * 3.0
    t2new_aaaa += np.einsum("ic,kdlc,jklabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * -3.0
    t2new_aaaa += np.einsum("jc,kcld,iklabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * -3.0
    t2new_aaaa += np.einsum("jc,kdlc,iklabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * 3.0
    t2new_aaaa += np.einsum("ka,kcld,ijlbcd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("kb,kcld,ijlacd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * -6.0
    t2new_aaaa += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("kc,kdlc,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.aaaaaa) * -6.0
    t2new_aaaa += np.einsum("kc,kcld,iljadb->ijab", t1.bb, v.bbbb.ovov, t3.abaaba) * 2.0
    t2new_aaaa += np.einsum("kc,kdlc,iljadb->ijab", t1.bb, v.bbbb.ovov, t3.abaaba) * -2.0
    t2new_aaaa += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbaa.ovov, t3.aaaaaa) * 6.0
    t2new_aaaa += np.einsum("ikac,jlbd,kcld->ijab", t2.abab, t2.abab, v.bbbb.ovov)
    t2new_aaaa += np.einsum("ikbc,jlad,kcld->ijab", t2.abab, t2.abab, v.bbbb.ovov) * -1.0
    t2new_aaaa += np.einsum("ikac,jlbd,kdlc->ijab", t2.abab, t2.abab, v.bbbb.ovov) * -1.0
    t2new_aaaa += np.einsum("ikbc,jlad,kdlc->ijab", t2.abab, t2.abab, v.bbbb.ovov)
    t2new_aaaa += np.einsum("ikac,jlbd,kcld->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ikbc,jlad,kcld->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ikcd,jlab,kdlc->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jkac,ilbd,kcld->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_aaaa += np.einsum("jkbc,ilad,kcld->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jkcd,ilab,kdlc->ijab", t2.abab, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_aaaa += np.einsum("klac,ijbd,kdlc->ijab", t2.abab, t2.aaaa, v.aabb.ovov) * 2.0
    t2new_aaaa += np.einsum("klbc,ijad,kdlc->ijab", t2.abab, t2.aaaa, v.aabb.ovov) * -2.0
    t2new_aaaa += np.einsum("ikac,jlbd,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 4.0
    t2new_aaaa += np.einsum("ikab,jlcd,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ikbc,jlad,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -4.0
    t2new_aaaa += np.einsum("ikcd,jlab,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ikac,jlbd,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -4.0
    t2new_aaaa += np.einsum("ikab,jlcd,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ikbc,jlad,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 4.0
    t2new_aaaa += np.einsum("ikcd,jlab,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ijac,klbd,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ijbc,klad,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ijcd,klab,kcld->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("ijac,klbd,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ijbc,klad,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ijcd,klab,kdlc->ijab", t2.aaaa, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,ka,lb,jklc->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ic,ka,lb,jlkc->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("jc,ka,lb,iklc->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ooov)
    t2new_aaaa += np.einsum("jc,ka,lb,ilkc->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ooov) * -1.0
    t2new_aaaa += np.einsum("ic,jd,ka,kcbd->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ic,jd,ka,kdbc->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("ic,jd,kb,kcad->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ovvv)
    t2new_aaaa += np.einsum("ic,jd,kb,kdac->ijab", t1.aa, t1.aa, t1.aa, v.aaaa.ovvv) * -1.0
    t2new_aaaa += np.einsum("ic,ka,jlbd,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aabb.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,kb,jlad,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aabb.ovov)
    t2new_aaaa += np.einsum("jc,ka,ilbd,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aabb.ovov)
    t2new_aaaa += np.einsum("jc,kb,ilad,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aabb.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,jd,klab,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("ic,jd,klab,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("ic,ka,jlbd,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ic,ka,jlbd,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ic,kb,jlad,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ic,kb,jlad,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ic,kd,jlab,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ic,kd,jlab,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jc,ka,ilbd,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jc,ka,ilbd,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("jc,kb,ilad,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("jc,kb,ilad,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jc,kd,ilab,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jc,kd,ilab,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ka,lb,ijcd,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("ka,lb,ijcd,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_aaaa += np.einsum("kc,la,ijbd,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("kc,la,ijbd,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("kc,lb,ijad,kcld->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_aaaa += np.einsum("kc,lb,ijad,kdlc->ijab", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_aaaa += np.einsum("ic,kd,jlab,kdlc->ijab", t1.aa, t1.bb, t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_aaaa += np.einsum("jc,kd,ilab,kdlc->ijab", t1.aa, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_aaaa += np.einsum("ka,lc,ijbd,kdlc->ijab", t1.aa, t1.bb, t2.aaaa, v.aabb.ovov) * 2.0
    t2new_aaaa += np.einsum("kb,lc,ijad,kdlc->ijab", t1.aa, t1.bb, t2.aaaa, v.aabb.ovov) * -2.0
    t2new_aaaa += np.einsum("ic,jd,ka,lb,kcld->ijab", t1.aa, t1.aa, t1.aa, t1.aa, v.aaaa.ovov)
    t2new_aaaa += np.einsum("ic,jd,ka,lb,kdlc->ijab", t1.aa, t1.aa, t1.aa, t1.aa, v.aaaa.ovov) * -1.0

    # T2 amplitudes
    t2new_abab = np.zeros((nocc[0], nocc[1], nvir[0], nvir[1]), dtype=np.float64)
    t2new_abab += np.einsum("iajb->ijab", v.aabb.ovov)
    t2new_abab += np.einsum("ik,kjab->ijab", f.aa.oo, t2.abab) * -1.0
    t2new_abab += np.einsum("jk,ikab->ijab", f.bb.oo, t2.abab) * -1.0
    t2new_abab += np.einsum("ac,ijcb->ijab", f.aa.vv, t2.abab)
    t2new_abab += np.einsum("bc,ijac->ijab", f.bb.vv, t2.abab)
    t2new_abab += np.einsum("ka,ikjb->ijab", t1.aa, v.aabb.ooov) * -1.0
    t2new_abab += np.einsum("ic,jbac->ijab", t1.aa, v.bbaa.ovvv)
    t2new_abab += np.einsum("kb,jkia->ijab", t1.bb, v.bbaa.ooov) * -1.0
    t2new_abab += np.einsum("jc,iabc->ijab", t1.bb, v.aabb.ovvv)
    t2new_abab += np.einsum("kc,ijkabc->ijab", f.aa.ov, t3.abaaba) * 2.0
    t2new_abab += np.einsum("kc,ijkabc->ijab", f.bb.ov, t3.abbabb) * 2.0
    t2new_abab += np.einsum("klab,ikjl->ijab", t2.abab, v.aabb.oooo)
    t2new_abab += np.einsum("ikac,jkbc->ijab", t2.abab, v.bbbb.oovv) * -1.0
    t2new_abab += np.einsum("ikcb,jkac->ijab", t2.abab, v.bbaa.oovv) * -1.0
    t2new_abab += np.einsum("kjac,ikbc->ijab", t2.abab, v.aabb.oovv) * -1.0
    t2new_abab += np.einsum("kjcb,ikac->ijab", t2.abab, v.aaaa.oovv) * -1.0
    t2new_abab += np.einsum("ikac,jbkc->ijab", t2.abab, v.bbbb.ovov)
    t2new_abab += np.einsum("kjcb,iakc->ijab", t2.abab, v.aaaa.ovov)
    t2new_abab += np.einsum("ijcd,acbd->ijab", t2.abab, v.aabb.vvvv)
    t2new_abab += np.einsum("ikac,jbkc->ijab", t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_abab += np.einsum("jkbc,iakc->ijab", t2.bbbb, v.aabb.ovov) * 2.0
    t2new_abab += np.einsum("iklc,kjlabc->ijab", v.aaaa.ooov, t3.abaaba) * -2.0
    t2new_abab += np.einsum("jklc,iklabc->ijab", v.bbaa.ooov, t3.abaaba) * -2.0
    t2new_abab += np.einsum("kcad,ijkcbd->ijab", v.aaaa.ovvv, t3.abaaba) * -2.0
    t2new_abab += np.einsum("kcbd,ijkadc->ijab", v.aabb.ovvv, t3.abaaba) * 2.0
    t2new_abab += np.einsum("iklc,jklbac->ijab", v.aabb.ooov, t3.babbab) * -2.0
    t2new_abab += np.einsum("jklc,iklabc->ijab", v.bbbb.ooov, t3.abbabb) * -2.0
    t2new_abab += np.einsum("kcad,ijkdbc->ijab", v.bbaa.ovvv, t3.abbabb) * 2.0
    t2new_abab += np.einsum("kcbd,ijkacd->ijab", v.bbbb.ovvv, t3.abbabb) * -2.0
    t2new_abab += np.einsum("kc,ic,kjab->ijab", f.aa.ov, t1.aa, t2.abab) * -1.0
    t2new_abab += np.einsum("kc,ka,ijcb->ijab", f.aa.ov, t1.aa, t2.abab) * -1.0
    t2new_abab += np.einsum("kc,jc,ikab->ijab", f.bb.ov, t1.bb, t2.abab) * -1.0
    t2new_abab += np.einsum("kc,kb,ijac->ijab", f.bb.ov, t1.bb, t2.abab) * -1.0
    t2new_abab += np.einsum("ic,ka,jbkc->ijab", t1.aa, t1.aa, v.bbaa.ovov) * -1.0
    t2new_abab += np.einsum("ic,kb,jkac->ijab", t1.aa, t1.bb, v.bbaa.oovv) * -1.0
    t2new_abab += np.einsum("ka,jc,ikbc->ijab", t1.aa, t1.bb, v.aabb.oovv) * -1.0
    t2new_abab += np.einsum("ka,lb,ikjl->ijab", t1.aa, t1.bb, v.aabb.oooo)
    t2new_abab += np.einsum("ic,jd,acbd->ijab", t1.aa, t1.bb, v.aabb.vvvv)
    t2new_abab += np.einsum("jc,kb,iakc->ijab", t1.bb, t1.bb, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("ic,klab,jlkc->ijab", t1.aa, t2.abab, v.bbaa.ooov)
    t2new_abab += np.einsum("ka,ilcb,jlkc->ijab", t1.aa, t2.abab, v.bbaa.ooov)
    t2new_abab += np.einsum("ka,ljcb,iklc->ijab", t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t2new_abab += np.einsum("ka,ljcb,ilkc->ijab", t1.aa, t2.abab, v.aaaa.ooov)
    t2new_abab += np.einsum("kc,ilab,jlkc->ijab", t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t2new_abab += np.einsum("kc,ljab,iklc->ijab", t1.aa, t2.abab, v.aaaa.ooov)
    t2new_abab += np.einsum("kc,ljab,ilkc->ijab", t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t2new_abab += np.einsum("ic,kjad,kcbd->ijab", t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t2new_abab += np.einsum("ic,kjdb,kcad->ijab", t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t2new_abab += np.einsum("ic,kjdb,kdac->ijab", t1.aa, t2.abab, v.aaaa.ovvv)
    t2new_abab += np.einsum("ka,ijcd,kcbd->ijab", t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t2new_abab += np.einsum("kc,ijad,kcbd->ijab", t1.aa, t2.abab, v.aabb.ovvv)
    t2new_abab += np.einsum("kc,ijdb,kcad->ijab", t1.aa, t2.abab, v.aaaa.ovvv)
    t2new_abab += np.einsum("kc,ijdb,kdac->ijab", t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t2new_abab += np.einsum("ka,jlbc,iklc->ijab", t1.aa, t2.bbbb, v.aabb.ooov) * -2.0
    t2new_abab += np.einsum("ic,jkbd,kdac->ijab", t1.aa, t2.bbbb, v.bbaa.ovvv) * 2.0
    t2new_abab += np.einsum("jc,klab,iklc->ijab", t1.bb, t2.abab, v.aabb.ooov)
    t2new_abab += np.einsum("kb,ilac,jklc->ijab", t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t2new_abab += np.einsum("kb,ilac,jlkc->ijab", t1.bb, t2.abab, v.bbbb.ooov)
    t2new_abab += np.einsum("kb,ljac,ilkc->ijab", t1.bb, t2.abab, v.aabb.ooov)
    t2new_abab += np.einsum("kc,ilab,jklc->ijab", t1.bb, t2.abab, v.bbbb.ooov)
    t2new_abab += np.einsum("kc,ilab,jlkc->ijab", t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t2new_abab += np.einsum("kc,ljab,ilkc->ijab", t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t2new_abab += np.einsum("jc,ikad,kcbd->ijab", t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t2new_abab += np.einsum("jc,ikdb,kcad->ijab", t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_abab += np.einsum("jc,ikad,kdbc->ijab", t1.bb, t2.abab, v.bbbb.ovvv)
    t2new_abab += np.einsum("kb,ijcd,kdac->ijab", t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_abab += np.einsum("kc,ijad,kcbd->ijab", t1.bb, t2.abab, v.bbbb.ovvv)
    t2new_abab += np.einsum("kc,ijdb,kcad->ijab", t1.bb, t2.abab, v.bbaa.ovvv)
    t2new_abab += np.einsum("kc,ijad,kdbc->ijab", t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t2new_abab += np.einsum("kb,ilac,jklc->ijab", t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t2new_abab += np.einsum("jc,ikad,kdbc->ijab", t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t2new_abab += np.einsum("ic,kcld,kjlabd->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -1.0
    t2new_abab += np.einsum("ic,kdlc,kjlabd->ijab", t1.aa, v.aaaa.ovov, t3.abaaba)
    t2new_abab += np.einsum("ka,kcld,ijlcbd->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -2.0
    t2new_abab += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * 2.0
    t2new_abab += np.einsum("kc,kdlc,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -2.0
    t2new_abab += np.einsum("ic,kcld,jklbad->ijab", t1.aa, v.aabb.ovov, t3.babbab) * -1.0
    t2new_abab += np.einsum("ic,kdlc,jklbda->ijab", t1.aa, v.bbaa.ovov, t3.bbabba) * -1.0
    t2new_abab += np.einsum("ka,kcld,ijlcbd->ijab", t1.aa, v.aabb.ovov, t3.abbabb) * -2.0
    t2new_abab += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aabb.ovov, t3.abbabb) * 2.0
    t2new_abab += np.einsum("jc,kcld,iklabd->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * -1.0
    t2new_abab += np.einsum("jc,kdlc,ilkabd->ijab", t1.bb, v.aabb.ovov, t3.abaaba) * -1.0
    t2new_abab += np.einsum("kb,kcld,ijlacd->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * -2.0
    t2new_abab += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * 2.0
    t2new_abab += np.einsum("jc,kcld,iklabd->ijab", t1.bb, v.bbbb.ovov, t3.abbabb) * -1.0
    t2new_abab += np.einsum("jc,kdlc,iklabd->ijab", t1.bb, v.bbbb.ovov, t3.abbabb)
    t2new_abab += np.einsum("kb,kcld,ijlacd->ijab", t1.bb, v.bbbb.ovov, t3.abbabb) * -2.0
    t2new_abab += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.abbabb) * 2.0
    t2new_abab += np.einsum("kc,kdlc,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.abbabb) * -2.0
    t2new_abab += np.einsum("ijcb,klad,kcld->ijab", t2.abab, t2.abab, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("ijcd,klab,kcld->ijab", t2.abab, t2.abab, v.aabb.ovov)
    t2new_abab += np.einsum("ijac,kldb,kdlc->ijab", t2.abab, t2.abab, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("ikac,ljdb,kcld->ijab", t2.abab, t2.abab, v.bbaa.ovov)
    t2new_abab += np.einsum("ikab,ljcd,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov) * -1.0
    t2new_abab += np.einsum("ikcb,ljad,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov)
    t2new_abab += np.einsum("ikcd,ljab,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov) * -1.0
    t2new_abab += np.einsum("ikac,jlbd,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_abab += np.einsum("ikab,jlcd,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_abab += np.einsum("ikac,jlbd,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_abab += np.einsum("ikab,jlcd,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov)
    t2new_abab += np.einsum("ijac,klbd,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_abab += np.einsum("ijcb,klad,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_abab += np.einsum("ijac,klbd,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov)
    t2new_abab += np.einsum("ijcb,klad,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov)
    t2new_abab += np.einsum("kjab,ilcd,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_abab += np.einsum("kjcb,ilad,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_abab += np.einsum("kjab,ilcd,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov)
    t2new_abab += np.einsum("kjcb,ilad,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_abab += np.einsum("ikac,jlbd,kcld->ijab", t2.aaaa, t2.bbbb, v.aabb.ovov) * 4.0
    t2new_abab += np.einsum("ic,ka,lb,jlkc->ijab", t1.aa, t1.aa, t1.bb, v.bbaa.ooov)
    t2new_abab += np.einsum("ic,ka,jd,kcbd->ijab", t1.aa, t1.aa, t1.bb, v.aabb.ovvv) * -1.0
    t2new_abab += np.einsum("ka,jc,lb,iklc->ijab", t1.aa, t1.bb, t1.bb, v.aabb.ooov)
    t2new_abab += np.einsum("ic,jd,kb,kdac->ijab", t1.aa, t1.bb, t1.bb, v.bbaa.ovvv) * -1.0
    t2new_abab += np.einsum("ic,ka,ljdb,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_abab += np.einsum("ic,ka,ljdb,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_abab += np.einsum("ic,kd,ljab,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_abab += np.einsum("ic,kd,ljab,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_abab += np.einsum("kc,la,ijdb,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_abab += np.einsum("kc,la,ijdb,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_abab += np.einsum("ic,ka,jlbd,kcld->ijab", t1.aa, t1.aa, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_abab += np.einsum("ic,jd,klab,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_abab += np.einsum("ic,kb,ljad,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.bbaa.ovov)
    t2new_abab += np.einsum("ic,kd,ljab,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t2new_abab += np.einsum("ka,jc,ildb,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_abab += np.einsum("kc,jd,ilab,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("ka,lb,ijcd,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_abab += np.einsum("ka,lc,ijdb,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("kc,lb,ijad,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_abab += np.einsum("jc,kb,ilad,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_abab += np.einsum("jc,kb,ilad,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_abab += np.einsum("jc,kd,ilab,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_abab += np.einsum("jc,kd,ilab,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_abab += np.einsum("kc,lb,ijad,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_abab += np.einsum("kc,lb,ijad,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_abab += np.einsum("jc,kb,ilad,kcld->ijab", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_abab += np.einsum("ic,ka,jd,lb,kcld->ijab", t1.aa, t1.aa, t1.bb, t1.bb, v.aabb.ovov)

    # T2 amplitudes
    t2new_baba = np.zeros((nocc[1], nocc[0], nvir[1], nvir[0]), dtype=np.float64)
    t2new_baba += np.einsum("iajb->ijab", v.bbaa.ovov)
    t2new_baba += np.einsum("ik,jkba->ijab", f.bb.oo, t2.abab) * -1.0
    t2new_baba += np.einsum("jk,kiba->ijab", f.aa.oo, t2.abab) * -1.0
    t2new_baba += np.einsum("ac,jibc->ijab", f.bb.vv, t2.abab)
    t2new_baba += np.einsum("bc,jica->ijab", f.aa.vv, t2.abab)
    t2new_baba += np.einsum("kb,jkia->ijab", t1.aa, v.aabb.ooov) * -1.0
    t2new_baba += np.einsum("jc,iabc->ijab", t1.aa, v.bbaa.ovvv)
    t2new_baba += np.einsum("ka,ikjb->ijab", t1.bb, v.bbaa.ooov) * -1.0
    t2new_baba += np.einsum("ic,jbac->ijab", t1.bb, v.aabb.ovvv)
    t2new_baba += np.einsum("kc,jikbac->ijab", f.aa.ov, t3.abaaba) * 2.0
    t2new_baba += np.einsum("kc,ijkabc->ijab", f.bb.ov, t3.babbab) * 2.0
    t2new_baba += np.einsum("klba,iljk->ijab", t2.abab, v.bbaa.oooo)
    t2new_baba += np.einsum("jkbc,ikac->ijab", t2.abab, v.bbbb.oovv) * -1.0
    t2new_baba += np.einsum("jkca,ikbc->ijab", t2.abab, v.bbaa.oovv) * -1.0
    t2new_baba += np.einsum("kibc,jkac->ijab", t2.abab, v.aabb.oovv) * -1.0
    t2new_baba += np.einsum("kica,jkbc->ijab", t2.abab, v.aaaa.oovv) * -1.0
    t2new_baba += np.einsum("jkbc,iakc->ijab", t2.abab, v.bbbb.ovov)
    t2new_baba += np.einsum("kica,jbkc->ijab", t2.abab, v.aaaa.ovov)
    t2new_baba += np.einsum("jicd,adbc->ijab", t2.abab, v.bbaa.vvvv)
    t2new_baba += np.einsum("ikac,jbkc->ijab", t2.bbbb, v.aabb.ovov) * 2.0
    t2new_baba += np.einsum("jkbc,iakc->ijab", t2.aaaa, v.bbaa.ovov) * 2.0
    t2new_baba += np.einsum("iklc,jklbac->ijab", v.bbaa.ooov, t3.abaaba) * -2.0
    t2new_baba += np.einsum("jklc,kilbac->ijab", v.aaaa.ooov, t3.abaaba) * -2.0
    t2new_baba += np.einsum("kcad,jikbdc->ijab", v.aabb.ovvv, t3.abaaba) * 2.0
    t2new_baba += np.einsum("kcbd,jikcad->ijab", v.aaaa.ovvv, t3.abaaba) * -2.0
    t2new_baba += np.einsum("iklc,jklbac->ijab", v.bbbb.ooov, t3.abbabb) * -2.0
    t2new_baba += np.einsum("jklc,iklabc->ijab", v.aabb.ooov, t3.babbab) * -2.0
    t2new_baba += np.einsum("kcad,ijkcbd->ijab", v.bbbb.ovvv, t3.babbab) * -2.0
    t2new_baba += np.einsum("kcbd,ijkadc->ijab", v.bbaa.ovvv, t3.babbab) * 2.0
    t2new_baba += np.einsum("kc,jc,kiba->ijab", f.aa.ov, t1.aa, t2.abab) * -1.0
    t2new_baba += np.einsum("kc,kb,jica->ijab", f.aa.ov, t1.aa, t2.abab) * -1.0
    t2new_baba += np.einsum("kc,ic,jkba->ijab", f.bb.ov, t1.bb, t2.abab) * -1.0
    t2new_baba += np.einsum("kc,ka,jibc->ijab", f.bb.ov, t1.bb, t2.abab) * -1.0
    t2new_baba += np.einsum("jc,kb,iakc->ijab", t1.aa, t1.aa, v.bbaa.ovov) * -1.0
    t2new_baba += np.einsum("jc,ka,ikbc->ijab", t1.aa, t1.bb, v.bbaa.oovv) * -1.0
    t2new_baba += np.einsum("kb,ic,jkac->ijab", t1.aa, t1.bb, v.aabb.oovv) * -1.0
    t2new_baba += np.einsum("kb,la,iljk->ijab", t1.aa, t1.bb, v.bbaa.oooo)
    t2new_baba += np.einsum("jc,id,adbc->ijab", t1.aa, t1.bb, v.bbaa.vvvv)
    t2new_baba += np.einsum("ic,ka,jbkc->ijab", t1.bb, t1.bb, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("jc,klba,ilkc->ijab", t1.aa, t2.abab, v.bbaa.ooov)
    t2new_baba += np.einsum("kb,jlca,ilkc->ijab", t1.aa, t2.abab, v.bbaa.ooov)
    t2new_baba += np.einsum("kb,lica,jklc->ijab", t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t2new_baba += np.einsum("kb,lica,jlkc->ijab", t1.aa, t2.abab, v.aaaa.ooov)
    t2new_baba += np.einsum("kc,jlba,ilkc->ijab", t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t2new_baba += np.einsum("kc,liba,jklc->ijab", t1.aa, t2.abab, v.aaaa.ooov)
    t2new_baba += np.einsum("kc,liba,jlkc->ijab", t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t2new_baba += np.einsum("jc,kibd,kcad->ijab", t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t2new_baba += np.einsum("jc,kida,kcbd->ijab", t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t2new_baba += np.einsum("jc,kida,kdbc->ijab", t1.aa, t2.abab, v.aaaa.ovvv)
    t2new_baba += np.einsum("kb,jicd,kcad->ijab", t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t2new_baba += np.einsum("kc,jibd,kcad->ijab", t1.aa, t2.abab, v.aabb.ovvv)
    t2new_baba += np.einsum("kc,jida,kcbd->ijab", t1.aa, t2.abab, v.aaaa.ovvv)
    t2new_baba += np.einsum("kc,jida,kdbc->ijab", t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t2new_baba += np.einsum("kb,ilac,jklc->ijab", t1.aa, t2.bbbb, v.aabb.ooov) * -2.0
    t2new_baba += np.einsum("jc,ikad,kdbc->ijab", t1.aa, t2.bbbb, v.bbaa.ovvv) * 2.0
    t2new_baba += np.einsum("ic,klba,jklc->ijab", t1.bb, t2.abab, v.aabb.ooov)
    t2new_baba += np.einsum("ka,jlbc,iklc->ijab", t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t2new_baba += np.einsum("ka,jlbc,ilkc->ijab", t1.bb, t2.abab, v.bbbb.ooov)
    t2new_baba += np.einsum("ka,libc,jlkc->ijab", t1.bb, t2.abab, v.aabb.ooov)
    t2new_baba += np.einsum("kc,jlba,iklc->ijab", t1.bb, t2.abab, v.bbbb.ooov)
    t2new_baba += np.einsum("kc,jlba,ilkc->ijab", t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t2new_baba += np.einsum("kc,liba,jlkc->ijab", t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t2new_baba += np.einsum("ic,jkbd,kcad->ijab", t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t2new_baba += np.einsum("ic,jkda,kcbd->ijab", t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_baba += np.einsum("ic,jkbd,kdac->ijab", t1.bb, t2.abab, v.bbbb.ovvv)
    t2new_baba += np.einsum("ka,jicd,kdbc->ijab", t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t2new_baba += np.einsum("kc,jibd,kcad->ijab", t1.bb, t2.abab, v.bbbb.ovvv)
    t2new_baba += np.einsum("kc,jida,kcbd->ijab", t1.bb, t2.abab, v.bbaa.ovvv)
    t2new_baba += np.einsum("kc,jibd,kdac->ijab", t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t2new_baba += np.einsum("ka,jlbc,iklc->ijab", t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t2new_baba += np.einsum("ic,jkbd,kdac->ijab", t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t2new_baba += np.einsum("jc,kcld,kilbad->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -1.0
    t2new_baba += np.einsum("jc,kdlc,kilbad->ijab", t1.aa, v.aaaa.ovov, t3.abaaba)
    t2new_baba += np.einsum("kb,kcld,jilcad->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -2.0
    t2new_baba += np.einsum("kc,kcld,jilbad->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * 2.0
    t2new_baba += np.einsum("kc,kdlc,jilbad->ijab", t1.aa, v.aaaa.ovov, t3.abaaba) * -2.0
    t2new_baba += np.einsum("jc,kcld,iklabd->ijab", t1.aa, v.aabb.ovov, t3.babbab) * -1.0
    t2new_baba += np.einsum("jc,kdlc,ikladb->ijab", t1.aa, v.bbaa.ovov, t3.bbabba) * -1.0
    t2new_baba += np.einsum("kb,kcld,ijlacd->ijab", t1.aa, v.aabb.ovov, t3.babbab) * -2.0
    t2new_baba += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aabb.ovov, t3.babbab) * 2.0
    t2new_baba += np.einsum("ic,kcld,jklbad->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * -1.0
    t2new_baba += np.einsum("ic,kdlc,jlkbad->ijab", t1.bb, v.aabb.ovov, t3.abaaba) * -1.0
    t2new_baba += np.einsum("ka,kcld,jilbcd->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * -2.0
    t2new_baba += np.einsum("kc,kcld,jilbad->ijab", t1.bb, v.bbaa.ovov, t3.abaaba) * 2.0
    t2new_baba += np.einsum("ic,kcld,jklbad->ijab", t1.bb, v.bbbb.ovov, t3.abbabb) * -1.0
    t2new_baba += np.einsum("ic,kdlc,jklbad->ijab", t1.bb, v.bbbb.ovov, t3.abbabb)
    t2new_baba += np.einsum("ka,kcld,ijlcbd->ijab", t1.bb, v.bbbb.ovov, t3.babbab) * -2.0
    t2new_baba += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.babbab) * 2.0
    t2new_baba += np.einsum("kc,kdlc,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.babbab) * -2.0
    t2new_baba += np.einsum("jica,klbd,kcld->ijab", t2.abab, t2.abab, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("jicd,klba,kcld->ijab", t2.abab, t2.abab, v.aabb.ovov)
    t2new_baba += np.einsum("jibc,klda,kdlc->ijab", t2.abab, t2.abab, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("jkbc,lida,kcld->ijab", t2.abab, t2.abab, v.bbaa.ovov)
    t2new_baba += np.einsum("jkba,licd,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov) * -1.0
    t2new_baba += np.einsum("jkca,libd,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov)
    t2new_baba += np.einsum("jkcd,liba,kdlc->ijab", t2.abab, t2.abab, v.bbaa.ovov) * -1.0
    t2new_baba += np.einsum("jkbc,ilad,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_baba += np.einsum("jkba,ilcd,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_baba += np.einsum("jkbc,ilad,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_baba += np.einsum("jkba,ilcd,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov)
    t2new_baba += np.einsum("jibc,klad,kcld->ijab", t2.abab, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_baba += np.einsum("jica,klbd,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_baba += np.einsum("jibc,klad,kdlc->ijab", t2.abab, t2.bbbb, v.bbbb.ovov)
    t2new_baba += np.einsum("jica,klbd,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov)
    t2new_baba += np.einsum("kiba,jlcd,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -1.0
    t2new_baba += np.einsum("kica,jlbd,kcld->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * 2.0
    t2new_baba += np.einsum("kiba,jlcd,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov)
    t2new_baba += np.einsum("kica,jlbd,kdlc->ijab", t2.abab, t2.aaaa, v.aaaa.ovov) * -2.0
    t2new_baba += np.einsum("ikac,jlbd,kcld->ijab", t2.bbbb, t2.aaaa, v.bbaa.ovov) * 4.0
    t2new_baba += np.einsum("jc,kb,la,ilkc->ijab", t1.aa, t1.aa, t1.bb, v.bbaa.ooov)
    t2new_baba += np.einsum("jc,kb,id,kcad->ijab", t1.aa, t1.aa, t1.bb, v.aabb.ovvv) * -1.0
    t2new_baba += np.einsum("kb,ic,la,jklc->ijab", t1.aa, t1.bb, t1.bb, v.aabb.ooov)
    t2new_baba += np.einsum("jc,id,ka,kdbc->ijab", t1.aa, t1.bb, t1.bb, v.bbaa.ovvv) * -1.0
    t2new_baba += np.einsum("jc,kb,lida,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_baba += np.einsum("jc,kb,lida,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_baba += np.einsum("jc,kd,liba,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_baba += np.einsum("jc,kd,liba,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_baba += np.einsum("kc,lb,jida,kcld->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t2new_baba += np.einsum("kc,lb,jida,kdlc->ijab", t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t2new_baba += np.einsum("jc,kb,ilad,kcld->ijab", t1.aa, t1.aa, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_baba += np.einsum("jc,id,klba,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_baba += np.einsum("jc,ka,libd,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.bbaa.ovov)
    t2new_baba += np.einsum("jc,kd,liba,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t2new_baba += np.einsum("kb,ic,jlda,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_baba += np.einsum("kc,id,jlba,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("kb,la,jicd,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t2new_baba += np.einsum("kb,lc,jida,kdlc->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("kc,la,jibd,kcld->ijab", t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t2new_baba += np.einsum("ic,ka,jlbd,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_baba += np.einsum("ic,ka,jlbd,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_baba += np.einsum("ic,kd,jlba,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_baba += np.einsum("ic,kd,jlba,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_baba += np.einsum("kc,la,jibd,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t2new_baba += np.einsum("kc,la,jibd,kdlc->ijab", t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t2new_baba += np.einsum("ic,ka,jlbd,kcld->ijab", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t2new_baba += np.einsum("jc,kb,id,la,kcld->ijab", t1.aa, t1.aa, t1.bb, t1.bb, v.aabb.ovov)

    # T2 amplitudes
    t2new_bbbb = np.zeros((nocc[1], nocc[1], nvir[1], nvir[1]), dtype=np.float64)
    t2new_bbbb += np.einsum("iajb->ijab", v.bbbb.ovov)
    t2new_bbbb += np.einsum("ibja->ijab", v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("ik,jkab->ijab", f.bb.oo, t2.bbbb) * 2.0
    t2new_bbbb += np.einsum("jk,ikab->ijab", f.bb.oo, t2.bbbb) * -2.0
    t2new_bbbb += np.einsum("ac,ijbc->ijab", f.bb.vv, t2.bbbb) * -2.0
    t2new_bbbb += np.einsum("bc,ijac->ijab", f.bb.vv, t2.bbbb) * 2.0
    t2new_bbbb += np.einsum("ka,ikjb->ijab", t1.bb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ka,jkib->ijab", t1.bb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("kb,ikja->ijab", t1.bb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("kb,jkia->ijab", t1.bb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ic,jabc->ijab", t1.bb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("ic,jbac->ijab", t1.bb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("jc,iabc->ijab", t1.bb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("jc,ibac->ijab", t1.bb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("kc,ijkabc->ijab", f.aa.ov, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("kc,ijkabc->ijab", f.bb.ov, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("kjcb,iakc->ijab", t2.abab, v.bbaa.ovov)
    t2new_bbbb += np.einsum("kjca,ibkc->ijab", t2.abab, v.bbaa.ovov) * -1.0
    t2new_bbbb += np.einsum("kicb,jakc->ijab", t2.abab, v.bbaa.ovov) * -1.0
    t2new_bbbb += np.einsum("kica,jbkc->ijab", t2.abab, v.bbaa.ovov)
    t2new_bbbb += np.einsum("klab,ikjl->ijab", t2.bbbb, v.bbbb.oooo)
    t2new_bbbb += np.einsum("klab,iljk->ijab", t2.bbbb, v.bbbb.oooo) * -1.0
    t2new_bbbb += np.einsum("ikac,jkbc->ijab", t2.bbbb, v.bbbb.oovv) * -2.0
    t2new_bbbb += np.einsum("ikbc,jkac->ijab", t2.bbbb, v.bbbb.oovv) * 2.0
    t2new_bbbb += np.einsum("jkac,ikbc->ijab", t2.bbbb, v.bbbb.oovv) * 2.0
    t2new_bbbb += np.einsum("jkbc,ikac->ijab", t2.bbbb, v.bbbb.oovv) * -2.0
    t2new_bbbb += np.einsum("ikbc,jakc->ijab", t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ikac,jbkc->ijab", t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jkbc,iakc->ijab", t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jkac,ibkc->ijab", t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ijcd,acbd->ijab", t2.bbbb, v.bbbb.vvvv)
    t2new_bbbb += np.einsum("ijcd,adbc->ijab", t2.bbbb, v.bbbb.vvvv) * -1.0
    t2new_bbbb += np.einsum("iklc,jklabc->ijab", v.bbaa.ooov, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("iklc,jklabc->ijab", v.bbbb.ooov, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("jklc,iklabc->ijab", v.bbaa.ooov, t3.bbabba) * -2.0
    t2new_bbbb += np.einsum("jklc,iklabc->ijab", v.bbbb.ooov, t3.bbbbbb) * -6.0
    t2new_bbbb += np.einsum("kcad,ijkbcd->ijab", v.bbbb.ovvv, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("kcad,ijkbdc->ijab", v.aabb.ovvv, t3.bbabba) * -2.0
    t2new_bbbb += np.einsum("kcbd,ijkacd->ijab", v.bbbb.ovvv, t3.bbbbbb) * -6.0
    t2new_bbbb += np.einsum("kcbd,ijkadc->ijab", v.aabb.ovvv, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("kc,ic,jkab->ijab", f.bb.ov, t1.bb, t2.bbbb) * 2.0
    t2new_bbbb += np.einsum("kc,jc,ikab->ijab", f.bb.ov, t1.bb, t2.bbbb) * -2.0
    t2new_bbbb += np.einsum("kc,ka,ijbc->ijab", f.bb.ov, t1.bb, t2.bbbb) * 2.0
    t2new_bbbb += np.einsum("kc,kb,ijac->ijab", f.bb.ov, t1.bb, t2.bbbb) * -2.0
    t2new_bbbb += np.einsum("ic,ka,jkbc->ijab", t1.bb, t1.bb, v.bbbb.oovv)
    t2new_bbbb += np.einsum("ic,kb,jkac->ijab", t1.bb, t1.bb, v.bbbb.oovv) * -1.0
    t2new_bbbb += np.einsum("jc,ka,ikbc->ijab", t1.bb, t1.bb, v.bbbb.oovv) * -1.0
    t2new_bbbb += np.einsum("jc,kb,ikac->ijab", t1.bb, t1.bb, v.bbbb.oovv)
    t2new_bbbb += np.einsum("ka,lb,ikjl->ijab", t1.bb, t1.bb, v.bbbb.oooo)
    t2new_bbbb += np.einsum("ka,lb,iljk->ijab", t1.bb, t1.bb, v.bbbb.oooo) * -1.0
    t2new_bbbb += np.einsum("ic,ka,jbkc->ijab", t1.bb, t1.bb, v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,kb,jakc->ijab", t1.bb, t1.bb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("jc,ka,ibkc->ijab", t1.bb, t1.bb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("jc,kb,iakc->ijab", t1.bb, t1.bb, v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,jd,acbd->ijab", t1.bb, t1.bb, v.bbbb.vvvv)
    t2new_bbbb += np.einsum("ic,jd,adbc->ijab", t1.bb, t1.bb, v.bbbb.vvvv) * -1.0
    t2new_bbbb += np.einsum("kc,ilab,jlkc->ijab", t1.aa, t2.bbbb, v.bbaa.ooov) * -2.0
    t2new_bbbb += np.einsum("kc,jlab,ilkc->ijab", t1.aa, t2.bbbb, v.bbaa.ooov) * 2.0
    t2new_bbbb += np.einsum("kc,ijad,kcbd->ijab", t1.aa, t2.bbbb, v.aabb.ovvv) * 2.0
    t2new_bbbb += np.einsum("kc,ijbd,kcad->ijab", t1.aa, t2.bbbb, v.aabb.ovvv) * -2.0
    t2new_bbbb += np.einsum("ka,ljcb,iklc->ijab", t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t2new_bbbb += np.einsum("ka,licb,jklc->ijab", t1.bb, t2.abab, v.bbaa.ooov)
    t2new_bbbb += np.einsum("kb,ljca,iklc->ijab", t1.bb, t2.abab, v.bbaa.ooov)
    t2new_bbbb += np.einsum("kb,lica,jklc->ijab", t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t2new_bbbb += np.einsum("ic,kjdb,kdac->ijab", t1.bb, t2.abab, v.aabb.ovvv)
    t2new_bbbb += np.einsum("ic,kjda,kdbc->ijab", t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t2new_bbbb += np.einsum("jc,kidb,kdac->ijab", t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t2new_bbbb += np.einsum("jc,kida,kdbc->ijab", t1.bb, t2.abab, v.aabb.ovvv)
    t2new_bbbb += np.einsum("ic,klab,jklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ic,klab,jlkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("jc,klab,iklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("jc,klab,ilkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ka,ilbc,jklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("ka,ilbc,jlkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("ka,jlbc,iklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("ka,jlbc,ilkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("kb,ilac,jklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("kb,ilac,jlkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("kb,jlac,iklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("kb,jlac,ilkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("kc,ilab,jklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("kc,ilab,jlkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("kc,jlab,iklc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t2new_bbbb += np.einsum("kc,jlab,ilkc->ijab", t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t2new_bbbb += np.einsum("ic,jkad,kcbd->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("ic,jkbd,kcad->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("ic,jkad,kdbc->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("ic,jkbd,kdac->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("jc,ikad,kcbd->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("jc,ikbd,kcad->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("jc,ikad,kdbc->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("jc,ikbd,kdac->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("ka,ijcd,kcbd->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("ka,ijcd,kdbc->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("kb,ijcd,kcad->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("kb,ijcd,kdac->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("kc,ijad,kcbd->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("kc,ijbd,kcad->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("kc,ijad,kdbc->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t2new_bbbb += np.einsum("kc,ijbd,kdac->ijab", t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t2new_bbbb += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("kc,kcld,ijlabd->ijab", t1.aa, v.aabb.ovov, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("kc,kdlc,ijlabd->ijab", t1.aa, v.aaaa.ovov, t3.bbabba) * -2.0
    t2new_bbbb += np.einsum("ic,kcld,jklabd->ijab", t1.bb, v.bbaa.ovov, t3.bbabba)
    t2new_bbbb += np.einsum("ic,kcld,jklabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * 3.0
    t2new_bbbb += np.einsum("ic,kdlc,jkladb->ijab", t1.bb, v.aabb.ovov, t3.babbab)
    t2new_bbbb += np.einsum("ic,kdlc,jklabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * -3.0
    t2new_bbbb += np.einsum("jc,kcld,iklabd->ijab", t1.bb, v.bbaa.ovov, t3.bbabba) * -1.0
    t2new_bbbb += np.einsum("jc,kcld,iklabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * -3.0
    t2new_bbbb += np.einsum("jc,kdlc,ikladb->ijab", t1.bb, v.aabb.ovov, t3.babbab) * -1.0
    t2new_bbbb += np.einsum("jc,kdlc,iklabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * 3.0
    t2new_bbbb += np.einsum("ka,kcld,ijlbcd->ijab", t1.bb, v.bbaa.ovov, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("ka,kcld,ijlbcd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("kb,kcld,ijlacd->ijab", t1.bb, v.bbaa.ovov, t3.bbabba) * -2.0
    t2new_bbbb += np.einsum("kb,kcld,ijlacd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * -6.0
    t2new_bbbb += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbaa.ovov, t3.bbabba) * 2.0
    t2new_bbbb += np.einsum("kc,kcld,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * 6.0
    t2new_bbbb += np.einsum("kc,kdlc,ijlabd->ijab", t1.bb, v.bbbb.ovov, t3.bbbbbb) * -6.0
    t2new_bbbb += np.einsum("kica,ljdb,kcld->ijab", t2.abab, t2.abab, v.aaaa.ovov)
    t2new_bbbb += np.einsum("kicb,ljda,kcld->ijab", t2.abab, t2.abab, v.aaaa.ovov) * -1.0
    t2new_bbbb += np.einsum("kica,ljdb,kdlc->ijab", t2.abab, t2.abab, v.aaaa.ovov) * -1.0
    t2new_bbbb += np.einsum("kicb,ljda,kdlc->ijab", t2.abab, t2.abab, v.aaaa.ovov)
    t2new_bbbb += np.einsum("kjcb,ilad,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("kjcd,ilab,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("kjca,ilbd,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("klcb,ijad,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("klca,ijbd,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("kicb,jlad,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("kicd,jlab,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("kica,jlbd,kcld->ijab", t2.abab, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("ikac,jlbd,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 4.0
    t2new_bbbb += np.einsum("ikab,jlcd,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ikbc,jlad,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -4.0
    t2new_bbbb += np.einsum("ikcd,jlab,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ikac,jlbd,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -4.0
    t2new_bbbb += np.einsum("ikab,jlcd,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ikbc,jlad,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 4.0
    t2new_bbbb += np.einsum("ikcd,jlab,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ijac,klbd,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ijbc,klad,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ijcd,klab,kcld->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("ijac,klbd,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ijbc,klad,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ijcd,klab,kdlc->ijab", t2.bbbb, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,ka,lb,jklc->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ic,ka,lb,jlkc->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("jc,ka,lb,iklc->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ooov)
    t2new_bbbb += np.einsum("jc,ka,lb,ilkc->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ooov) * -1.0
    t2new_bbbb += np.einsum("ic,jd,ka,kcbd->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("ic,jd,ka,kdbc->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("ic,jd,kb,kcad->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ovvv)
    t2new_bbbb += np.einsum("ic,jd,kb,kdac->ijab", t1.bb, t1.bb, t1.bb, v.bbbb.ovvv) * -1.0
    t2new_bbbb += np.einsum("kc,id,jlab,kcld->ijab", t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("kc,jd,ilab,kcld->ijab", t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("kc,la,ijbd,kcld->ijab", t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t2new_bbbb += np.einsum("kc,lb,ijad,kcld->ijab", t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t2new_bbbb += np.einsum("ic,ka,ljdb,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,kb,ljda,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t2new_bbbb += np.einsum("jc,ka,lidb,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t2new_bbbb += np.einsum("jc,kb,lida,kcld->ijab", t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,jd,klab,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("ic,jd,klab,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("ic,ka,jlbd,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ic,ka,jlbd,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ic,kb,jlad,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ic,kb,jlad,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ic,kd,jlab,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ic,kd,jlab,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jc,ka,ilbd,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jc,ka,ilbd,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("jc,kb,ilad,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("jc,kb,ilad,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jc,kd,ilab,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("jc,kd,ilab,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("ka,lb,ijcd,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("ka,lb,ijcd,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -1.0
    t2new_bbbb += np.einsum("kc,la,ijbd,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("kc,la,ijbd,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("kc,lb,ijad,kcld->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t2new_bbbb += np.einsum("kc,lb,ijad,kdlc->ijab", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t2new_bbbb += np.einsum("ic,jd,ka,lb,kcld->ijab", t1.bb, t1.bb, t1.bb, t1.bb, v.bbbb.ovov)
    t2new_bbbb += np.einsum("ic,jd,ka,lb,kdlc->ijab", t1.bb, t1.bb, t1.bb, t1.bb, v.bbbb.ovov) * -1.0

    # T3 amplitudes
    t3new_aaaaaa = np.zeros((nocc[0], nocc[0], nocc[0], nvir[0], nvir[0], nvir[0]), dtype=np.float64)
    t3new_aaaaaa += np.einsum("il,jklabc->ijkabc", f.aa.oo, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("jl,iklabc->ijkabc", f.aa.oo, t3.aaaaaa) * 6.0
    t3new_aaaaaa += np.einsum("kl,ijlabc->ijkabc", f.aa.oo, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("ad,ijkbcd->ijkabc", f.aa.vv, t3.aaaaaa) * 6.0
    t3new_aaaaaa += np.einsum("bd,ijkacd->ijkabc", f.aa.vv, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("cd,ijkabd->ijkabc", f.aa.vv, t3.aaaaaa) * 6.0
    t3new_aaaaaa += np.einsum("ilab,jlkc->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("ilac,jlkb->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("ilbc,jlka->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("ilab,kljc->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("ilac,kljb->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("ilbc,klja->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jlab,ilkc->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jlac,ilkb->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jlbc,ilka->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jlab,klic->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jlac,klib->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jlbc,klia->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("klab,iljc->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("klac,iljb->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("klbc,ilja->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("klab,jlic->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("klac,jlib->ijkabc", t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("klbc,jlia->ijkabc", t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("ikbd,jacd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ikcd,jabd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ikad,jbcd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ikcd,jbad->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ikad,jcbd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ikbd,jcad->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ijbd,kacd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ijcd,kabd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ijad,kbcd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ijcd,kbad->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ijad,kcbd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("ijbd,kcad->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jkbd,iacd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jkcd,iabd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jkad,ibcd->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jkcd,ibad->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jkad,icbd->ijkabc", t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jkbd,icad->ijkabc", t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("ld,id,jklabc->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("ld,jd,iklabc->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * 6.0
    t3new_aaaaaa += np.einsum("ld,kd,ijlabc->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("ld,la,ijkbcd->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("ld,lb,ijkacd->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * 6.0
    t3new_aaaaaa += np.einsum("ld,lc,ijkabd->ijkabc", f.aa.ov, t1.aa, t3.aaaaaa) * -6.0
    t3new_aaaaaa += np.einsum("ld,ikad,jlbc->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * -4.0
    t3new_aaaaaa += np.einsum("ld,ikbd,jlac->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * 4.0
    t3new_aaaaaa += np.einsum("ld,ikcd,jlab->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * -4.0
    t3new_aaaaaa += np.einsum("ld,ilac,jkbd->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * -4.0
    t3new_aaaaaa += np.einsum("ld,ilab,jkcd->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * 4.0
    t3new_aaaaaa += np.einsum("ld,ilbc,jkad->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * 4.0
    t3new_aaaaaa += np.einsum("ld,ijad,klbc->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * 4.0
    t3new_aaaaaa += np.einsum("ld,ijbd,klac->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * -4.0
    t3new_aaaaaa += np.einsum("ld,ijcd,klab->ijkabc", f.aa.ov, t2.aaaa, t2.aaaa) * 4.0
    t3new_aaaaaa += np.einsum("id,jlac,klbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("id,jlab,klcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("id,jlbc,klad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("id,klac,jlbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("id,klab,jlcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("id,klbc,jlad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ilac,klbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ilab,klcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ilbc,klad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("jd,klac,ilbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("jd,klab,ilcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("jd,klbc,ilad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ilac,jlbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("kd,ilab,jlcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ilbc,jlad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("kd,jlac,ilbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("kd,jlab,ilcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("kd,jlbc,ilad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("la,imbc,jlkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("la,imbc,jmkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("la,jmbc,ilkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("la,jmbc,imkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("la,kmbc,iljm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("la,kmbc,imjl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lb,imac,jlkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lb,imac,jmkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lb,jmac,ilkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lb,jmac,imkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lb,kmac,iljm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lb,kmac,imjl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lc,imab,jlkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lc,imab,jmkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lc,jmab,ilkm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("lc,jmab,imkl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lc,kmab,iljm->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * -2.0
    t3new_aaaaaa += np.einsum("lc,kmab,imjl->ijkabc", t1.aa, t2.aaaa, v.aaaa.oooo) * 2.0
    t3new_aaaaaa += np.einsum("la,ikbd,jlcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("la,ikcd,jlbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("la,ijbd,klcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("la,ijcd,klbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("la,jkbd,ilcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("la,jkcd,ilbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lb,ikad,jlcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lb,ikcd,jlad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lb,ijad,klcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lb,ijcd,klad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lb,jkad,ilcd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lb,jkcd,ilad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lc,ikad,jlbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lc,ikbd,jlad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lc,ijad,klbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lc,ijbd,klad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("lc,jkad,ilbd->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * -2.0
    t3new_aaaaaa += np.einsum("lc,jkbd,ilad->ijkabc", t1.aa, t2.aaaa, v.aaaa.oovv) * 2.0
    t3new_aaaaaa += np.einsum("id,jlbc,kald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,jlac,kbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,jlab,kcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,klbc,jald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,klac,jbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,klab,jcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,ilbc,kald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,ilac,kbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,ilab,kcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,klbc,iald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,klac,ibld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,klab,icld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,ilbc,jald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,ilac,jbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,ilab,jcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,jlbc,iald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,jlac,ibld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,jlab,icld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("la,ikcd,jbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("la,ikbd,jcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("la,ijcd,kbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("la,ijbd,kcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("la,jkcd,ibld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("la,jkbd,icld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lb,ikcd,jald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lb,ikad,jcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lb,ijcd,kald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lb,ijad,kcld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lb,jkcd,iald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lb,jkad,icld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lc,ikbd,jald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lc,ikad,jbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lc,ijbd,kald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lc,ijad,kbld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("lc,jkbd,iald->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("lc,jkad,ibld->ijkabc", t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,jkbe,adce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("id,jkce,adbe->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("id,jkbe,aecd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("id,jkce,aebd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("id,jkae,bdce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("id,jkae,becd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ikbe,adce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ikce,adbe->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ikbe,aecd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ikce,aebd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ikae,bdce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ikae,becd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ijbe,adce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,ijce,adbe->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ijbe,aecd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ijce,aebd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,ijae,bdce->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,ijae,becd->ijkabc", t1.aa, t2.aaaa, v.aaaa.vvvv) * 2.0
    t3new_aaaaaa += np.einsum("id,la,jmbc,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("id,la,jmbc,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,la,kmbc,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,la,kmbc,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,jmac,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,lb,jmac,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,kmac,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,kmac,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,jmab,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("id,lc,jmab,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,kmab,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,kmab,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,imbc,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jd,la,imbc,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,kmbc,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,kmbc,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,imac,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,lb,imac,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,kmac,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,kmac,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,imab,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lc,imab,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,kmab,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,kmab,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,imbc,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("kd,la,imbc,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,jmbc,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,jmbc,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,imac,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,lb,imac,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,jmac,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,jmac,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,imab,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lc,imab,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,jmab,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,jmab,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mb,ikcd,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mb,ikcd,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mb,ijcd,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mb,ijcd,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mb,jkcd,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mb,jkcd,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mc,ikbd,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mc,ikbd,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mc,ijbd,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mc,ijbd,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("la,mc,jkbd,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("la,mc,jkbd,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("lb,mc,ikad,jlmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("lb,mc,ikad,jmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("lb,mc,ijad,klmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("lb,mc,ijad,kmld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("lb,mc,jkad,ilmd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * -2.0
    t3new_aaaaaa += np.einsum("lb,mc,jkad,imld->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ooov) * 2.0
    t3new_aaaaaa += np.einsum("id,je,klac,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,je,klab,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,je,klbc,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,je,klac,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,je,klab,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,je,klbc,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,jlac,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,ke,jlab,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,jlbc,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,jlac,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,jlab,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,ke,jlbc,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,la,jkbe,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,la,jkce,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,la,jkbe,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,la,jkce,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,jkae,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,lb,jkce,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,jkae,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,jkce,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,jkae,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,lc,jkbe,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,jkae,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("id,lc,jkbe,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilac,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilab,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilbc,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilac,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilab,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,ke,ilbc,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,la,ikbe,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,la,ikce,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,ikbe,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,ikce,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,lb,ikce,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,ikae,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,ikce,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,ikae,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("jd,lc,ikbe,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,ikae,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("jd,lc,ikbe,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,ijbe,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,la,ijce,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,ijbe,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,ijce,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,ijae,ldce->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,lb,ijce,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,ijae,lecd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,ijce,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("kd,lc,ijbe,ldae->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,ijae,lebd->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * 2.0
    t3new_aaaaaa += np.einsum("kd,lc,ijbe,lead->ijkabc", t1.aa, t1.aa, t2.aaaa, v.aaaa.ovvv) * -2.0
    t3new_aaaaaa += np.einsum("id,je,la,kmbc,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,je,la,kmbc,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,je,lb,kmac,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,je,lb,kmac,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,je,lc,kmab,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,je,lc,kmab,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,la,jmbc,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,la,jmbc,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,ke,lb,jmac,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,ke,lb,jmac,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,lc,jmab,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,ke,lc,jmab,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,la,mb,jkce,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,la,mb,jkce,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,la,mc,jkbe,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("id,la,mc,jkbe,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,mc,jkae,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("id,lb,mc,jkae,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,ke,la,imbc,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,la,imbc,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,ke,lb,imac,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,ke,lb,imac,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,lc,imab,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,ke,lc,imab,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,la,mb,ikce,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,la,mb,ikce,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,mc,ikbe,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("jd,la,mc,ikbe,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,mc,ikae,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("jd,lb,mc,ikae,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,la,mb,ijce,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,la,mb,ijce,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,mc,ijbe,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0
    t3new_aaaaaa += np.einsum("kd,la,mc,ijbe,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,mc,ijae,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * -2.0
    t3new_aaaaaa += np.einsum("kd,lb,mc,ijae,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.aaaa, v.aaaa.ovov) * 2.0

    # T3 amplitudes
    t3new_aabaab = np.zeros((nocc[0], nocc[0], nocc[1], nvir[0], nvir[0], nvir[1]), dtype=np.float64)
    t3new_aabaab += np.einsum("il,jklacb->ijkabc", f.aa.oo, t3.abaaba) * 2.0
    t3new_aabaab += np.einsum("jl,iklacb->ijkabc", f.aa.oo, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("kl,iljacb->ijkabc", f.bb.oo, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("ad,ikjbcd->ijkabc", f.aa.vv, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("bd,ikjacd->ijkabc", f.aa.vv, t3.abaaba) * 2.0
    t3new_aabaab += np.einsum("cd,ikjadb->ijkabc", f.bb.vv, t3.abaaba) * 2.0
    t3new_aabaab += np.einsum("ilac,kljb->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_aabaab += np.einsum("ilbc,klja->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_aabaab += np.einsum("jlac,klib->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_aabaab += np.einsum("jlbc,klia->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_aabaab += np.einsum("lkac,iljb->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("lkbc,ilja->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("lkac,jlib->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("lkbc,jlia->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("ikbd,jacd->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_aabaab += np.einsum("ikdc,jabd->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("ikad,jbcd->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_aabaab += np.einsum("ikdc,jbad->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("jkbd,iacd->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_aabaab += np.einsum("jkdc,iabd->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("jkad,ibcd->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_aabaab += np.einsum("jkdc,ibad->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("ilab,jlkc->ijkabc", t2.aaaa, v.aabb.ooov) * -2.0
    t3new_aabaab += np.einsum("jlab,ilkc->ijkabc", t2.aaaa, v.aabb.ooov) * 2.0
    t3new_aabaab += np.einsum("ijad,kcbd->ijkabc", t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_aabaab += np.einsum("ijbd,kcad->ijkabc", t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_aabaab += np.einsum("ld,id,jklacb->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_aabaab += np.einsum("ld,jd,iklacb->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("ld,la,ikjbcd->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_aabaab += np.einsum("ld,lb,ikjacd->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("ld,kd,iljacb->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("ld,lc,ikjadb->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_aabaab += np.einsum("ld,ikad,jlbc->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_aabaab += np.einsum("ld,ikbd,jlac->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_aabaab += np.einsum("ld,ilac,jkbd->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_aabaab += np.einsum("ld,ilbc,jkad->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_aabaab += np.einsum("ld,ikdc,jlab->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_aabaab += np.einsum("ld,jkdc,ilab->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_aabaab += np.einsum("ld,lkac,ijbd->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_aabaab += np.einsum("ld,lkbc,ijad->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_aabaab += np.einsum("id,jlac,klbd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_aabaab += np.einsum("id,jlbc,klad->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_aabaab += np.einsum("id,lkac,jlbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_aabaab += np.einsum("id,lkbc,jlad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_aabaab += np.einsum("jd,ilac,klbd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_aabaab += np.einsum("jd,ilbc,klad->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_aabaab += np.einsum("jd,lkac,ilbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_aabaab += np.einsum("jd,lkbc,ilad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_aabaab += np.einsum("la,imbc,jlkm->ijkabc", t1.aa, t2.abab, v.aabb.oooo) * -1.0
    t3new_aabaab += np.einsum("la,jmbc,ilkm->ijkabc", t1.aa, t2.abab, v.aabb.oooo)
    t3new_aabaab += np.einsum("la,mkbc,iljm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_aabaab += np.einsum("la,mkbc,imjl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_aabaab += np.einsum("lb,imac,jlkm->ijkabc", t1.aa, t2.abab, v.aabb.oooo)
    t3new_aabaab += np.einsum("lb,jmac,ilkm->ijkabc", t1.aa, t2.abab, v.aabb.oooo) * -1.0
    t3new_aabaab += np.einsum("lb,mkac,iljm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_aabaab += np.einsum("lb,mkac,imjl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_aabaab += np.einsum("la,ikbd,jlcd->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_aabaab += np.einsum("la,ikdc,jlbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_aabaab += np.einsum("la,jkbd,ilcd->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_aabaab += np.einsum("la,jkdc,ilbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_aabaab += np.einsum("lb,ikad,jlcd->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_aabaab += np.einsum("lb,ikdc,jlad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_aabaab += np.einsum("lb,jkad,ilcd->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_aabaab += np.einsum("lb,jkdc,ilad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_aabaab += np.einsum("id,lkbc,jald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("id,lkac,jbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,lkbc,iald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,lkac,ibld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("la,ikdc,jbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("la,jkdc,ibld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("lb,ikdc,jald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("lb,jkdc,iald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("id,jkbe,adce->ijkabc", t1.aa, t2.abab, v.aabb.vvvv)
    t3new_aabaab += np.einsum("id,jkec,adbe->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_aabaab += np.einsum("id,jkec,aebd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_aabaab += np.einsum("id,jkae,bdce->ijkabc", t1.aa, t2.abab, v.aabb.vvvv) * -1.0
    t3new_aabaab += np.einsum("jd,ikbe,adce->ijkabc", t1.aa, t2.abab, v.aabb.vvvv) * -1.0
    t3new_aabaab += np.einsum("jd,ikec,adbe->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_aabaab += np.einsum("jd,ikec,aebd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_aabaab += np.einsum("jd,ikae,bdce->ijkabc", t1.aa, t2.abab, v.aabb.vvvv)
    t3new_aabaab += np.einsum("id,jlab,kcld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_aabaab += np.einsum("jd,ilab,kcld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_aabaab += np.einsum("la,ijbd,kcld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_aabaab += np.einsum("lb,ijad,kcld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_aabaab += np.einsum("kd,ilbc,jald->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("kd,ilac,jbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("kd,jlbc,iald->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("kd,jlac,ibld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("lc,ikbd,jald->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("lc,ikad,jbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("lc,jkbd,iald->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("lc,jkad,ibld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("kd,ilab,jlcd->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * -2.0
    t3new_aabaab += np.einsum("kd,jlab,ilcd->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * 2.0
    t3new_aabaab += np.einsum("lc,imab,jmkl->ijkabc", t1.bb, t2.aaaa, v.aabb.oooo) * 2.0
    t3new_aabaab += np.einsum("lc,jmab,imkl->ijkabc", t1.bb, t2.aaaa, v.aabb.oooo) * -2.0
    t3new_aabaab += np.einsum("lc,ijad,klbd->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * -2.0
    t3new_aabaab += np.einsum("lc,ijbd,klad->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * 2.0
    t3new_aabaab += np.einsum("kd,ijbe,aecd->ijkabc", t1.bb, t2.aaaa, v.aabb.vvvv) * -2.0
    t3new_aabaab += np.einsum("kd,ijae,becd->ijkabc", t1.bb, t2.aaaa, v.aabb.vvvv) * 2.0
    t3new_aabaab += np.einsum("id,la,jmbc,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_aabaab += np.einsum("id,la,mkbc,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("id,la,mkbc,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("id,lb,jmac,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_aabaab += np.einsum("id,lb,mkac,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("id,lb,mkac,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("jd,la,imbc,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_aabaab += np.einsum("jd,la,mkbc,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("jd,la,mkbc,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("jd,lb,imac,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_aabaab += np.einsum("jd,lb,mkac,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("jd,lb,mkac,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("la,mb,ikdc,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("la,mb,ikdc,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("la,mb,jkdc,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_aabaab += np.einsum("la,mb,jkdc,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_aabaab += np.einsum("id,je,lkac,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("id,je,lkbc,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("id,je,lkac,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("id,je,lkbc,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("id,la,jkbe,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_aabaab += np.einsum("id,la,jkec,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("id,la,jkec,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("id,lb,jkae,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_aabaab += np.einsum("id,lb,jkec,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("id,lb,jkec,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,la,ikbe,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_aabaab += np.einsum("jd,la,ikec,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("jd,la,ikec,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,lb,ikec,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,lb,ikec,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_aabaab += np.einsum("la,kd,imbc,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_aabaab += np.einsum("la,kd,jmbc,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_aabaab += np.einsum("lb,kd,imac,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_aabaab += np.einsum("lb,kd,jmac,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_aabaab += np.einsum("la,mc,ikbd,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_aabaab += np.einsum("la,mc,jkbd,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_aabaab += np.einsum("lb,mc,ikad,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_aabaab += np.einsum("lb,mc,jkad,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_aabaab += np.einsum("id,ke,jlac,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_aabaab += np.einsum("id,ke,jlbc,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("id,lc,jkae,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_aabaab += np.einsum("id,lc,jkbe,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,ke,ilac,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,ke,ilbc,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_aabaab += np.einsum("jd,lc,ikae,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_aabaab += np.einsum("jd,lc,ikbe,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_aabaab += np.einsum("id,lc,jmab,klmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_aabaab += np.einsum("jd,lc,imab,klmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_aabaab += np.einsum("la,mc,ijbd,kmld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_aabaab += np.einsum("lb,mc,ijad,kmld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_aabaab += np.einsum("id,ke,jlab,ldce->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_aabaab += np.einsum("jd,ke,ilab,ldce->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_aabaab += np.einsum("la,kd,ijbe,lecd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_aabaab += np.einsum("lb,kd,ijae,lecd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_aabaab += np.einsum("kd,lc,imab,jmld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * 2.0
    t3new_aabaab += np.einsum("kd,lc,jmab,imld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * -2.0
    t3new_aabaab += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_aabaab += np.einsum("kd,lc,ijbe,ldae->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_aabaab += np.einsum("id,je,la,mkbc,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("id,je,la,mkbc,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("id,je,lb,mkac,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("id,je,lb,mkac,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("id,la,mb,jkec,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("id,la,mb,jkec,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,la,mb,ikec,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,la,mb,ikec,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_aabaab += np.einsum("id,la,ke,jmbc,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("id,lb,ke,jmac,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("id,la,mc,jkbe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("id,lb,mc,jkae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,la,ke,imbc,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,lb,ke,imac,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("jd,la,mc,ikbe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_aabaab += np.einsum("jd,lb,mc,ikae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_aabaab += np.einsum("id,ke,lc,jmab,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_aabaab += np.einsum("jd,ke,lc,imab,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_aabaab += np.einsum("la,kd,mc,ijbe,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * -2.0
    t3new_aabaab += np.einsum("lb,kd,mc,ijae,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * 2.0

    # T3 amplitudes
    t3new_abaaba = np.zeros((nocc[0], nocc[1], nocc[0], nvir[0], nvir[1], nvir[0]), dtype=np.float64)
    t3new_abaaba += np.einsum("il,kjlabc->ijkabc", f.aa.oo, t3.abaaba) * 2.0
    t3new_abaaba += np.einsum("jl,ilkabc->ijkabc", f.bb.oo, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("kl,ijlabc->ijkabc", f.aa.oo, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("ad,ijkcbd->ijkabc", f.aa.vv, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("bd,ijkadc->ijkabc", f.bb.vv, t3.abaaba) * 2.0
    t3new_abaaba += np.einsum("cd,ijkabd->ijkabc", f.aa.vv, t3.abaaba) * 2.0
    t3new_abaaba += np.einsum("ilab,jlkc->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_abaaba += np.einsum("ilcb,jlka->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_abaaba += np.einsum("klab,jlic->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_abaaba += np.einsum("klcb,jlia->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_abaaba += np.einsum("ljab,ilkc->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("ljcb,ilka->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("ljab,klic->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("ljcb,klia->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("ijcd,kabd->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_abaaba += np.einsum("ijdb,kacd->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("ijad,kcbd->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_abaaba += np.einsum("ijdb,kcad->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("kjcd,iabd->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_abaaba += np.einsum("kjdb,iacd->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("kjad,icbd->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_abaaba += np.einsum("kjdb,icad->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("ilac,kljb->ijkabc", t2.aaaa, v.aabb.ooov) * -2.0
    t3new_abaaba += np.einsum("klac,iljb->ijkabc", t2.aaaa, v.aabb.ooov) * 2.0
    t3new_abaaba += np.einsum("ikad,jbcd->ijkabc", t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_abaaba += np.einsum("ikcd,jbad->ijkabc", t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_abaaba += np.einsum("ld,id,kjlabc->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_abaaba += np.einsum("ld,kd,ijlabc->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("ld,la,ijkcbd->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_abaaba += np.einsum("ld,lc,ijkabd->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("ld,jd,ilkabc->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("ld,lb,ijkadc->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_abaaba += np.einsum("ld,ijad,klcb->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_abaaba += np.einsum("ld,ijcd,klab->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_abaaba += np.einsum("ld,ilab,kjcd->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_abaaba += np.einsum("ld,ilcb,kjad->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_abaaba += np.einsum("ld,ijdb,klac->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_abaaba += np.einsum("ld,kjdb,ilac->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_abaaba += np.einsum("ld,ljab,ikcd->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_abaaba += np.einsum("ld,ljcb,ikad->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_abaaba += np.einsum("id,klab,jlcd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_abaaba += np.einsum("id,klcb,jlad->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_abaaba += np.einsum("id,ljab,klcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_abaaba += np.einsum("id,ljcb,klad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_abaaba += np.einsum("kd,ilab,jlcd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_abaaba += np.einsum("kd,ilcb,jlad->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_abaaba += np.einsum("kd,ljab,ilcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_abaaba += np.einsum("kd,ljcb,ilad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_abaaba += np.einsum("la,imcb,jmkl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo) * -1.0
    t3new_abaaba += np.einsum("la,kmcb,iljm->ijkabc", t1.aa, t2.abab, v.aabb.oooo)
    t3new_abaaba += np.einsum("la,mjcb,ilkm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_abaaba += np.einsum("la,mjcb,imkl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_abaaba += np.einsum("lc,imab,jmkl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo)
    t3new_abaaba += np.einsum("lc,kmab,iljm->ijkabc", t1.aa, t2.abab, v.aabb.oooo) * -1.0
    t3new_abaaba += np.einsum("lc,mjab,ilkm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_abaaba += np.einsum("lc,mjab,imkl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_abaaba += np.einsum("la,ijcd,klbd->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_abaaba += np.einsum("la,ijdb,klcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_abaaba += np.einsum("la,kjcd,ilbd->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_abaaba += np.einsum("la,kjdb,ilcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_abaaba += np.einsum("lc,ijad,klbd->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_abaaba += np.einsum("lc,ijdb,klad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_abaaba += np.einsum("lc,kjad,ilbd->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_abaaba += np.einsum("lc,kjdb,ilad->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_abaaba += np.einsum("id,ljcb,kald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("id,ljab,kcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,ljcb,iald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,ljab,icld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("la,ijdb,kcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("la,kjdb,icld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("lc,ijdb,kald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("lc,kjdb,iald->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("id,kjce,adbe->ijkabc", t1.aa, t2.abab, v.aabb.vvvv)
    t3new_abaaba += np.einsum("id,kjeb,adce->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_abaaba += np.einsum("id,kjeb,aecd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_abaaba += np.einsum("id,kjae,becd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_abaaba += np.einsum("kd,ijce,adbe->ijkabc", t1.aa, t2.abab, v.aabb.vvvv) * -1.0
    t3new_abaaba += np.einsum("kd,ijeb,adce->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_abaaba += np.einsum("kd,ijeb,aecd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_abaaba += np.einsum("kd,ijae,becd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv)
    t3new_abaaba += np.einsum("id,klac,jbld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_abaaba += np.einsum("kd,ilac,jbld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_abaaba += np.einsum("la,ikcd,jbld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_abaaba += np.einsum("lc,ikad,jbld->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_abaaba += np.einsum("jd,ilcb,kald->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("jd,ilab,kcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("jd,klcb,iald->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("jd,klab,icld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("lb,ijcd,kald->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("lb,ijad,kcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("lb,kjcd,iald->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("lb,kjad,icld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("jd,ilac,klbd->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * -2.0
    t3new_abaaba += np.einsum("jd,klac,ilbd->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * 2.0
    t3new_abaaba += np.einsum("lb,imac,jlkm->ijkabc", t1.bb, t2.aaaa, v.bbaa.oooo) * 2.0
    t3new_abaaba += np.einsum("lb,kmac,imjl->ijkabc", t1.bb, t2.aaaa, v.aabb.oooo) * -2.0
    t3new_abaaba += np.einsum("lb,ikad,jlcd->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * -2.0
    t3new_abaaba += np.einsum("lb,ikcd,jlad->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * 2.0
    t3new_abaaba += np.einsum("jd,ikce,aebd->ijkabc", t1.bb, t2.aaaa, v.aabb.vvvv) * -2.0
    t3new_abaaba += np.einsum("jd,ikae,bdce->ijkabc", t1.bb, t2.aaaa, v.bbaa.vvvv) * 2.0
    t3new_abaaba += np.einsum("id,la,kmcb,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_abaaba += np.einsum("id,la,mjcb,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("id,la,mjcb,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("id,lc,kmab,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abaaba += np.einsum("id,lc,mjab,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("id,lc,mjab,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("kd,la,imcb,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abaaba += np.einsum("kd,la,mjcb,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("kd,la,mjcb,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("kd,lc,imab,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_abaaba += np.einsum("kd,lc,mjab,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("kd,lc,mjab,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("la,mc,ijdb,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("la,mc,ijdb,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("la,mc,kjdb,ilmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_abaaba += np.einsum("la,mc,kjdb,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_abaaba += np.einsum("id,ke,ljab,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("id,ke,ljcb,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("id,ke,ljab,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("id,ke,ljcb,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("id,la,kjce,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abaaba += np.einsum("id,la,kjeb,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("id,la,kjeb,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("id,lc,kjae,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_abaaba += np.einsum("id,lc,kjeb,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("id,lc,kjeb,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,la,ijce,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_abaaba += np.einsum("kd,la,ijeb,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("kd,la,ijeb,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,lc,ijeb,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,lc,ijeb,lead->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_abaaba += np.einsum("la,jd,imcb,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abaaba += np.einsum("la,jd,kmcb,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abaaba += np.einsum("lc,jd,imab,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abaaba += np.einsum("lc,jd,kmab,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abaaba += np.einsum("la,mb,ijcd,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abaaba += np.einsum("la,mb,kjcd,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abaaba += np.einsum("lc,mb,ijad,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abaaba += np.einsum("lc,mb,kjad,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abaaba += np.einsum("id,je,klab,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abaaba += np.einsum("id,je,klcb,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("id,lb,kjae,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abaaba += np.einsum("id,lb,kjce,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,je,ilab,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,je,ilcb,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abaaba += np.einsum("kd,lb,ijae,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abaaba += np.einsum("kd,lb,ijce,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abaaba += np.einsum("id,lb,kmac,jlmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_abaaba += np.einsum("kd,lb,imac,jlmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_abaaba += np.einsum("la,mb,ikcd,jmld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_abaaba += np.einsum("lc,mb,ikad,jmld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_abaaba += np.einsum("id,je,klac,ldbe->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_abaaba += np.einsum("kd,je,ilac,ldbe->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_abaaba += np.einsum("la,jd,ikce,lebd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_abaaba += np.einsum("lc,jd,ikae,lebd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_abaaba += np.einsum("jd,lb,imac,kmld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * 2.0
    t3new_abaaba += np.einsum("jd,lb,kmac,imld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * -2.0
    t3new_abaaba += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_abaaba += np.einsum("jd,lb,ikce,ldae->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_abaaba += np.einsum("id,ke,la,mjcb,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("id,ke,la,mjcb,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("id,ke,lc,mjab,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("id,ke,lc,mjab,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("id,la,mc,kjeb,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("id,la,mc,kjeb,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,la,mc,ijeb,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,la,mc,ijeb,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_abaaba += np.einsum("id,la,je,kmcb,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("id,lc,je,kmab,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("id,la,mb,kjce,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("id,lc,mb,kjae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,la,je,imcb,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,lc,je,imab,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("kd,la,mb,ijce,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abaaba += np.einsum("kd,lc,mb,ijae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abaaba += np.einsum("id,je,lb,kmac,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_abaaba += np.einsum("kd,je,lb,imac,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_abaaba += np.einsum("la,jd,mb,ikce,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * -2.0
    t3new_abaaba += np.einsum("lc,jd,mb,ikae,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * 2.0

    # T3 amplitudes
    t3new_abbabb = np.zeros((nocc[0], nocc[1], nocc[1], nvir[0], nvir[1], nvir[1]), dtype=np.float64)
    t3new_abbabb += np.einsum("il,jklbca->ijkabc", f.aa.oo, t3.bbabba) * -2.0
    t3new_abbabb += np.einsum("jl,iklabc->ijkabc", f.bb.oo, t3.abbabb) * 2.0
    t3new_abbabb += np.einsum("kl,ijlabc->ijkabc", f.bb.oo, t3.abbabb) * -2.0
    t3new_abbabb += np.einsum("ad,ijkdbc->ijkabc", f.aa.vv, t3.abbabb) * 2.0
    t3new_abbabb += np.einsum("bd,ijkacd->ijkabc", f.bb.vv, t3.abbabb) * -2.0
    t3new_abbabb += np.einsum("cd,ijkabd->ijkabc", f.bb.vv, t3.abbabb) * 2.0
    t3new_abbabb += np.einsum("ilab,jlkc->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("ilac,jlkb->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("ilab,kljc->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("ilac,kljb->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("ljab,ilkc->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_abbabb += np.einsum("ljac,ilkb->ijkabc", t2.abab, v.aabb.ooov)
    t3new_abbabb += np.einsum("lkab,iljc->ijkabc", t2.abab, v.aabb.ooov)
    t3new_abbabb += np.einsum("lkac,iljb->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_abbabb += np.einsum("ikad,jbcd->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("ikdc,jbad->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_abbabb += np.einsum("ikad,jcbd->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("ikdb,jcad->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abbabb += np.einsum("ijad,kbcd->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("ijdc,kbad->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abbabb += np.einsum("ijad,kcbd->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("ijdb,kcad->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_abbabb += np.einsum("jlbc,klia->ijkabc", t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_abbabb += np.einsum("klbc,jlia->ijkabc", t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_abbabb += np.einsum("jkbd,iacd->ijkabc", t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_abbabb += np.einsum("jkcd,iabd->ijkabc", t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_abbabb += np.einsum("ld,id,jklbca->ijkabc", f.aa.ov, t1.aa, t3.bbabba) * -2.0
    t3new_abbabb += np.einsum("ld,la,ijkdbc->ijkabc", f.aa.ov, t1.aa, t3.abbabb) * -2.0
    t3new_abbabb += np.einsum("ld,jd,iklabc->ijkabc", f.bb.ov, t1.bb, t3.abbabb) * 2.0
    t3new_abbabb += np.einsum("ld,kd,ijlabc->ijkabc", f.bb.ov, t1.bb, t3.abbabb) * -2.0
    t3new_abbabb += np.einsum("ld,lb,ijkacd->ijkabc", f.bb.ov, t1.bb, t3.abbabb) * 2.0
    t3new_abbabb += np.einsum("ld,lc,ijkabd->ijkabc", f.bb.ov, t1.bb, t3.abbabb) * -2.0
    t3new_abbabb += np.einsum("ld,ijdb,lkac->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_abbabb += np.einsum("ld,ijdc,lkab->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_abbabb += np.einsum("ld,ikdb,ljac->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_abbabb += np.einsum("ld,ikdc,ljab->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_abbabb += np.einsum("ld,ikad,jlbc->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_abbabb += np.einsum("ld,ilac,jkbd->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_abbabb += np.einsum("ld,ilab,jkcd->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_abbabb += np.einsum("ld,ijad,klbc->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_abbabb += np.einsum("id,lkac,jbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("id,lkab,jcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("id,ljac,kbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("id,ljab,kcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("la,ikdc,jbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("la,ikdb,jcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("la,ijdc,kbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("la,ijdb,kcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("id,jlbc,klad->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * -2.0
    t3new_abbabb += np.einsum("id,klbc,jlad->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * 2.0
    t3new_abbabb += np.einsum("la,jmbc,ilkm->ijkabc", t1.aa, t2.bbbb, v.aabb.oooo) * 2.0
    t3new_abbabb += np.einsum("la,kmbc,iljm->ijkabc", t1.aa, t2.bbbb, v.aabb.oooo) * -2.0
    t3new_abbabb += np.einsum("la,jkbd,ilcd->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * -2.0
    t3new_abbabb += np.einsum("la,jkcd,ilbd->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * 2.0
    t3new_abbabb += np.einsum("id,jkbe,adce->ijkabc", t1.aa, t2.bbbb, v.aabb.vvvv) * 2.0
    t3new_abbabb += np.einsum("id,jkce,adbe->ijkabc", t1.aa, t2.bbbb, v.aabb.vvvv) * -2.0
    t3new_abbabb += np.einsum("jd,ilac,klbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_abbabb += np.einsum("jd,ilab,klcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_abbabb += np.einsum("jd,lkac,ilbd->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_abbabb += np.einsum("jd,lkab,ilcd->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_abbabb += np.einsum("kd,ilac,jlbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_abbabb += np.einsum("kd,ilab,jlcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_abbabb += np.einsum("kd,ljac,ilbd->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_abbabb += np.einsum("kd,ljab,ilcd->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_abbabb += np.einsum("lb,imac,jlkm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_abbabb += np.einsum("lb,imac,jmkl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_abbabb += np.einsum("lb,mjac,imkl->ijkabc", t1.bb, t2.abab, v.aabb.oooo) * -1.0
    t3new_abbabb += np.einsum("lb,mkac,imjl->ijkabc", t1.bb, t2.abab, v.aabb.oooo)
    t3new_abbabb += np.einsum("lc,imab,jlkm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_abbabb += np.einsum("lc,imab,jmkl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_abbabb += np.einsum("lc,mjab,imkl->ijkabc", t1.bb, t2.abab, v.aabb.oooo)
    t3new_abbabb += np.einsum("lc,mkab,imjl->ijkabc", t1.bb, t2.abab, v.aabb.oooo) * -1.0
    t3new_abbabb += np.einsum("lb,ikad,jlcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_abbabb += np.einsum("lb,ikdc,jlad->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_abbabb += np.einsum("lb,ijad,klcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_abbabb += np.einsum("lb,ijdc,klad->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_abbabb += np.einsum("lc,ikad,jlbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_abbabb += np.einsum("lc,ikdb,jlad->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_abbabb += np.einsum("lc,ijad,klbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_abbabb += np.einsum("lc,ijdb,klad->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_abbabb += np.einsum("jd,ilac,kbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("jd,ilab,kcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("kd,ilac,jbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("kd,ilab,jcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("lb,ikad,jcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("lb,ijad,kcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("lc,ikad,jbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("lc,ijad,kbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("jd,ikec,aebd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv)
    t3new_abbabb += np.einsum("jd,ikeb,aecd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv) * -1.0
    t3new_abbabb += np.einsum("jd,ikae,bdce->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_abbabb += np.einsum("jd,ikae,becd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_abbabb += np.einsum("kd,ijec,aebd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv) * -1.0
    t3new_abbabb += np.einsum("kd,ijeb,aecd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv)
    t3new_abbabb += np.einsum("kd,ijae,bdce->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_abbabb += np.einsum("kd,ijae,becd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_abbabb += np.einsum("jd,klbc,iald->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_abbabb += np.einsum("kd,jlbc,iald->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_abbabb += np.einsum("lb,jkcd,iald->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_abbabb += np.einsum("lc,jkbd,iald->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_abbabb += np.einsum("id,la,jmbc,kmld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_abbabb += np.einsum("id,la,kmbc,jmld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_abbabb += np.einsum("id,la,jkbe,ldce->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_abbabb += np.einsum("id,la,jkce,ldbe->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_abbabb += np.einsum("id,lb,mkac,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_abbabb += np.einsum("id,lb,mjac,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abbabb += np.einsum("id,lc,mkab,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abbabb += np.einsum("id,lc,mjab,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_abbabb += np.einsum("la,mb,ikdc,jmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_abbabb += np.einsum("la,mb,ijdc,kmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abbabb += np.einsum("la,mc,ikdb,jmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_abbabb += np.einsum("la,mc,ijdb,kmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_abbabb += np.einsum("id,je,lkac,ldbe->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abbabb += np.einsum("id,je,lkab,ldce->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_abbabb += np.einsum("id,ke,ljac,ldbe->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_abbabb += np.einsum("id,ke,ljab,ldce->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abbabb += np.einsum("la,jd,ikec,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abbabb += np.einsum("la,jd,ikeb,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_abbabb += np.einsum("la,kd,ijec,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_abbabb += np.einsum("la,kd,ijeb,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_abbabb += np.einsum("la,jd,kmbc,ilmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_abbabb += np.einsum("la,kd,jmbc,ilmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_abbabb += np.einsum("la,mb,jkcd,ilmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_abbabb += np.einsum("la,mc,jkbd,ilmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_abbabb += np.einsum("id,je,klbc,lead->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_abbabb += np.einsum("id,ke,jlbc,lead->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_abbabb += np.einsum("id,lb,jkce,lead->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_abbabb += np.einsum("id,lc,jkbe,lead->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_abbabb += np.einsum("jd,lb,imac,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("jd,lb,imac,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("jd,lb,mkac,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abbabb += np.einsum("jd,lc,imab,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("jd,lc,imab,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("jd,lc,mkab,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abbabb += np.einsum("kd,lb,imac,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("kd,lb,imac,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("kd,lb,mjac,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_abbabb += np.einsum("kd,lc,imab,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("kd,lc,imab,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("kd,lc,mjab,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_abbabb += np.einsum("lb,mc,ikad,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("lb,mc,ikad,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("lb,mc,ijad,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_abbabb += np.einsum("lb,mc,ijad,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_abbabb += np.einsum("jd,ke,ilac,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("jd,ke,ilab,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("jd,ke,ilac,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("jd,ke,ilab,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("jd,lb,ikec,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abbabb += np.einsum("jd,lb,ikae,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("jd,lc,ikae,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("jd,lc,ikeb,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abbabb += np.einsum("jd,lc,ikae,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("kd,lb,ijae,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("kd,lb,ijec,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_abbabb += np.einsum("kd,lb,ijae,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_abbabb += np.einsum("kd,lc,ijeb,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_abbabb += np.einsum("kd,lc,ijae,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_abbabb += np.einsum("id,la,je,kmbc,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_abbabb += np.einsum("id,la,ke,jmbc,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_abbabb += np.einsum("id,la,mb,jkce,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_abbabb += np.einsum("id,la,mc,jkbe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_abbabb += np.einsum("id,je,lb,mkac,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("id,je,lc,mkab,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("id,ke,lb,mjac,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_abbabb += np.einsum("id,ke,lc,mjab,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_abbabb += np.einsum("la,jd,mb,ikec,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abbabb += np.einsum("la,jd,mc,ikeb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abbabb += np.einsum("la,kd,mb,ijec,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_abbabb += np.einsum("la,kd,mc,ijeb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_abbabb += np.einsum("jd,ke,lb,imac,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("jd,ke,lb,imac,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("jd,ke,lc,imab,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("jd,ke,lc,imab,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("jd,lb,mc,ikae,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_abbabb += np.einsum("jd,lb,mc,ikae,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("kd,lb,mc,ijae,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_abbabb += np.einsum("kd,lb,mc,ijae,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)

    # T3 amplitudes
    t3new_baabaa = np.zeros((nocc[1], nocc[0], nocc[0], nvir[1], nvir[0], nvir[0]), dtype=np.float64)
    t3new_baabaa += np.einsum("il,jlkbac->ijkabc", f.bb.oo, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("jl,kilbac->ijkabc", f.aa.oo, t3.abaaba) * 2.0
    t3new_baabaa += np.einsum("kl,jilbac->ijkabc", f.aa.oo, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("ad,jikbdc->ijkabc", f.bb.vv, t3.abaaba) * 2.0
    t3new_baabaa += np.einsum("bd,jikcad->ijkabc", f.aa.vv, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("cd,jikbad->ijkabc", f.aa.vv, t3.abaaba) * 2.0
    t3new_baabaa += np.einsum("jlba,ilkc->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_baabaa += np.einsum("jlca,ilkb->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_baabaa += np.einsum("klba,iljc->ijkabc", t2.abab, v.bbaa.ooov)
    t3new_baabaa += np.einsum("klca,iljb->ijkabc", t2.abab, v.bbaa.ooov) * -1.0
    t3new_baabaa += np.einsum("liba,jlkc->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("lica,jlkb->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("liba,kljc->ijkabc", t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("lica,kljb->ijkabc", t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("jicd,kbad->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_baabaa += np.einsum("jida,kbcd->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jibd,kcad->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_baabaa += np.einsum("jida,kcbd->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("kicd,jbad->ijkabc", t2.abab, v.aabb.ovvv)
    t3new_baabaa += np.einsum("kida,jbcd->ijkabc", t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("kibd,jcad->ijkabc", t2.abab, v.aabb.ovvv) * -1.0
    t3new_baabaa += np.einsum("kida,jcbd->ijkabc", t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jlbc,klia->ijkabc", t2.aaaa, v.aabb.ooov) * -2.0
    t3new_baabaa += np.einsum("klbc,jlia->ijkabc", t2.aaaa, v.aabb.ooov) * 2.0
    t3new_baabaa += np.einsum("jkbd,iacd->ijkabc", t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_baabaa += np.einsum("jkcd,iabd->ijkabc", t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_baabaa += np.einsum("ld,jd,kilbac->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_baabaa += np.einsum("ld,kd,jilbac->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("ld,lb,jikcad->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * 2.0
    t3new_baabaa += np.einsum("ld,lc,jikbad->ijkabc", f.aa.ov, t1.aa, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("ld,id,jlkbac->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("ld,la,jikbdc->ijkabc", f.bb.ov, t1.bb, t3.abaaba) * -2.0
    t3new_baabaa += np.einsum("ld,jibd,klca->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_baabaa += np.einsum("ld,jicd,klba->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_baabaa += np.einsum("ld,jlba,kicd->ijkabc", f.bb.ov, t2.abab, t2.abab) * -1.0
    t3new_baabaa += np.einsum("ld,jlca,kibd->ijkabc", f.bb.ov, t2.abab, t2.abab)
    t3new_baabaa += np.einsum("ld,jida,klbc->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_baabaa += np.einsum("ld,kida,jlbc->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_baabaa += np.einsum("ld,liba,jkcd->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * 2.0
    t3new_baabaa += np.einsum("ld,lica,jkbd->ijkabc", f.aa.ov, t2.abab, t2.aaaa) * -2.0
    t3new_baabaa += np.einsum("jd,klba,ilcd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_baabaa += np.einsum("jd,klca,ilbd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_baabaa += np.einsum("jd,liba,klcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_baabaa += np.einsum("jd,lica,klbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_baabaa += np.einsum("kd,jlba,ilcd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv) * -1.0
    t3new_baabaa += np.einsum("kd,jlca,ilbd->ijkabc", t1.aa, t2.abab, v.bbaa.oovv)
    t3new_baabaa += np.einsum("kd,liba,jlcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_baabaa += np.einsum("kd,lica,jlbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_baabaa += np.einsum("lb,jmca,imkl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo) * -1.0
    t3new_baabaa += np.einsum("lb,kmca,imjl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo)
    t3new_baabaa += np.einsum("lb,mica,jlkm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_baabaa += np.einsum("lb,mica,jmkl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_baabaa += np.einsum("lc,jmba,imkl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo)
    t3new_baabaa += np.einsum("lc,kmba,imjl->ijkabc", t1.aa, t2.abab, v.bbaa.oooo) * -1.0
    t3new_baabaa += np.einsum("lc,miba,jlkm->ijkabc", t1.aa, t2.abab, v.aaaa.oooo) * -1.0
    t3new_baabaa += np.einsum("lc,miba,jmkl->ijkabc", t1.aa, t2.abab, v.aaaa.oooo)
    t3new_baabaa += np.einsum("lb,jicd,klad->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_baabaa += np.einsum("lb,jida,klcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_baabaa += np.einsum("lb,kicd,jlad->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_baabaa += np.einsum("lb,kida,jlcd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_baabaa += np.einsum("lc,jibd,klad->ijkabc", t1.aa, t2.abab, v.aabb.oovv) * -1.0
    t3new_baabaa += np.einsum("lc,jida,klbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv) * -1.0
    t3new_baabaa += np.einsum("lc,kibd,jlad->ijkabc", t1.aa, t2.abab, v.aabb.oovv)
    t3new_baabaa += np.einsum("lc,kida,jlbd->ijkabc", t1.aa, t2.abab, v.aaaa.oovv)
    t3new_baabaa += np.einsum("jd,lica,kbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("jd,liba,kcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lica,jbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,liba,jcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("lb,jida,kcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("lb,kida,jcld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("lc,jida,kbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("lc,kida,jbld->ijkabc", t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("jd,kibe,aecd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_baabaa += np.einsum("jd,kice,aebd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv)
    t3new_baabaa += np.einsum("jd,kiea,bdce->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_baabaa += np.einsum("jd,kiea,becd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_baabaa += np.einsum("kd,jibe,aecd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv)
    t3new_baabaa += np.einsum("kd,jice,aebd->ijkabc", t1.aa, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_baabaa += np.einsum("kd,jiea,bdce->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv) * -1.0
    t3new_baabaa += np.einsum("kd,jiea,becd->ijkabc", t1.aa, t2.abab, v.aaaa.vvvv)
    t3new_baabaa += np.einsum("jd,klbc,iald->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_baabaa += np.einsum("kd,jlbc,iald->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_baabaa += np.einsum("lb,jkcd,iald->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_baabaa += np.einsum("lc,jkbd,iald->ijkabc", t1.aa, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_baabaa += np.einsum("id,jlca,kbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("id,jlba,kcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("id,klca,jbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("id,klba,jcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("la,jicd,kbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("la,jibd,kcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("la,kicd,jbld->ijkabc", t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("la,kibd,jcld->ijkabc", t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("id,jlbc,klad->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * -2.0
    t3new_baabaa += np.einsum("id,klbc,jlad->ijkabc", t1.bb, t2.aaaa, v.aabb.oovv) * 2.0
    t3new_baabaa += np.einsum("la,jmbc,ilkm->ijkabc", t1.bb, t2.aaaa, v.bbaa.oooo) * 2.0
    t3new_baabaa += np.einsum("la,kmbc,iljm->ijkabc", t1.bb, t2.aaaa, v.bbaa.oooo) * -2.0
    t3new_baabaa += np.einsum("la,jkbd,ilcd->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * -2.0
    t3new_baabaa += np.einsum("la,jkcd,ilbd->ijkabc", t1.bb, t2.aaaa, v.bbaa.oovv) * 2.0
    t3new_baabaa += np.einsum("id,jkbe,adce->ijkabc", t1.bb, t2.aaaa, v.bbaa.vvvv) * 2.0
    t3new_baabaa += np.einsum("id,jkce,adbe->ijkabc", t1.bb, t2.aaaa, v.bbaa.vvvv) * -2.0
    t3new_baabaa += np.einsum("jd,lb,kmca,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_baabaa += np.einsum("jd,lb,mica,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("jd,lb,mica,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("jd,lc,kmba,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_baabaa += np.einsum("jd,lc,miba,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("jd,lc,miba,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("kd,lb,jmca,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov) * -1.0
    t3new_baabaa += np.einsum("kd,lb,mica,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("kd,lb,mica,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("kd,lc,jmba,imld->ijkabc", t1.aa, t1.aa, t2.abab, v.bbaa.ooov)
    t3new_baabaa += np.einsum("kd,lc,miba,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("kd,lc,miba,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("lb,mc,jida,klmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("lb,mc,jida,kmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("lb,mc,kida,jlmd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov)
    t3new_baabaa += np.einsum("lb,mc,kida,jmld->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ooov) * -1.0
    t3new_baabaa += np.einsum("jd,ke,liba,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jd,ke,lica,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("jd,ke,liba,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("jd,ke,lica,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jd,lb,kice,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_baabaa += np.einsum("jd,lb,kiea,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jd,lb,kiea,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("jd,lc,kibe,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_baabaa += np.einsum("jd,lc,kiea,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("jd,lc,kiea,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,lb,jice,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv)
    t3new_baabaa += np.einsum("kd,lb,jiea,ldce->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("kd,lb,jiea,lecd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,lc,jibe,ldae->ijkabc", t1.aa, t1.aa, t2.abab, v.aabb.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,lc,jiea,ldbe->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,lc,jiea,lebd->ijkabc", t1.aa, t1.aa, t2.abab, v.aaaa.ovvv)
    t3new_baabaa += np.einsum("lb,id,jmca,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_baabaa += np.einsum("lb,id,kmca,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_baabaa += np.einsum("lc,id,jmba,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_baabaa += np.einsum("lc,id,kmba,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_baabaa += np.einsum("lb,ma,jicd,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_baabaa += np.einsum("lb,ma,kicd,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_baabaa += np.einsum("lc,ma,jibd,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov)
    t3new_baabaa += np.einsum("lc,ma,kibd,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_baabaa += np.einsum("jd,ie,klba,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_baabaa += np.einsum("jd,ie,klca,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("jd,la,kibe,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_baabaa += np.einsum("jd,la,kice,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,ie,jlba,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,ie,jlca,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_baabaa += np.einsum("kd,la,jibe,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_baabaa += np.einsum("kd,la,jice,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_baabaa += np.einsum("jd,la,kmbc,ilmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_baabaa += np.einsum("kd,la,jmbc,ilmd->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_baabaa += np.einsum("lb,ma,jkcd,imld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * -2.0
    t3new_baabaa += np.einsum("lc,ma,jkbd,imld->ijkabc", t1.aa, t1.bb, t2.aaaa, v.bbaa.ooov) * 2.0
    t3new_baabaa += np.einsum("jd,ie,klbc,ldae->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_baabaa += np.einsum("kd,ie,jlbc,ldae->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_baabaa += np.einsum("lb,id,jkce,lead->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * 2.0
    t3new_baabaa += np.einsum("lc,id,jkbe,lead->ijkabc", t1.aa, t1.bb, t2.aaaa, v.aabb.ovvv) * -2.0
    t3new_baabaa += np.einsum("id,la,jmbc,kmld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * 2.0
    t3new_baabaa += np.einsum("id,la,kmbc,jmld->ijkabc", t1.bb, t1.bb, t2.aaaa, v.aabb.ooov) * -2.0
    t3new_baabaa += np.einsum("id,la,jkbe,ldce->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * -2.0
    t3new_baabaa += np.einsum("id,la,jkce,ldbe->ijkabc", t1.bb, t1.bb, t2.aaaa, v.bbaa.ovvv) * 2.0
    t3new_baabaa += np.einsum("jd,ke,lb,mica,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("jd,ke,lb,mica,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("jd,ke,lc,miba,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("jd,ke,lc,miba,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("jd,lb,mc,kiea,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("jd,lb,mc,kiea,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lb,mc,jiea,ldme->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lb,mc,jiea,lemd->ijkabc", t1.aa, t1.aa, t1.aa, t2.abab, v.aaaa.ovov)
    t3new_baabaa += np.einsum("jd,lb,ie,kmca,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("jd,lc,ie,kmba,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("jd,lb,ma,kice,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("jd,lc,ma,kibe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lb,ie,jmca,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lc,ie,jmba,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("kd,lb,ma,jice,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_baabaa += np.einsum("kd,lc,ma,jibe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.abab, v.aabb.ovov)
    t3new_baabaa += np.einsum("jd,ie,la,kmbc,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * -2.0
    t3new_baabaa += np.einsum("kd,ie,la,jmbc,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.bbaa.ovov) * 2.0
    t3new_baabaa += np.einsum("lb,id,ma,jkce,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * -2.0
    t3new_baabaa += np.einsum("lc,id,ma,jkbe,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.aaaa, v.aabb.ovov) * 2.0

    # T3 amplitudes
    t3new_babbab = np.zeros((nocc[1], nocc[0], nocc[1], nvir[1], nvir[0], nvir[1]), dtype=np.float64)
    t3new_babbab += np.einsum("il,jklbac->ijkabc", f.bb.oo, t3.abbabb) * 2.0
    t3new_babbab += np.einsum("jl,iklacb->ijkabc", f.aa.oo, t3.bbabba) * -2.0
    t3new_babbab += np.einsum("kl,ijlabc->ijkabc", f.bb.oo, t3.babbab) * -2.0
    t3new_babbab += np.einsum("ad,ijkcbd->ijkabc", f.bb.vv, t3.babbab) * -2.0
    t3new_babbab += np.einsum("bd,ijkadc->ijkabc", f.aa.vv, t3.babbab) * 2.0
    t3new_babbab += np.einsum("cd,ijkabd->ijkabc", f.bb.vv, t3.babbab) * 2.0
    t3new_babbab += np.einsum("jlba,ilkc->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("jlbc,ilka->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("jlba,klic->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("jlbc,klia->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("liba,jlkc->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_babbab += np.einsum("libc,jlka->ijkabc", t2.abab, v.aabb.ooov)
    t3new_babbab += np.einsum("lkba,jlic->ijkabc", t2.abab, v.aabb.ooov)
    t3new_babbab += np.einsum("lkbc,jlia->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_babbab += np.einsum("jkbd,iacd->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("jkdc,iabd->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_babbab += np.einsum("jkbd,icad->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("jkda,icbd->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_babbab += np.einsum("jibd,kacd->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("jidc,kabd->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_babbab += np.einsum("jibd,kcad->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("jida,kcbd->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_babbab += np.einsum("ilac,kljb->ijkabc", t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_babbab += np.einsum("klac,iljb->ijkabc", t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_babbab += np.einsum("ikad,jbcd->ijkabc", t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_babbab += np.einsum("ikcd,jbad->ijkabc", t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_babbab += np.einsum("ld,jd,iklacb->ijkabc", f.aa.ov, t1.aa, t3.bbabba) * -2.0
    t3new_babbab += np.einsum("ld,lb,ijkadc->ijkabc", f.aa.ov, t1.aa, t3.babbab) * -2.0
    t3new_babbab += np.einsum("ld,id,jklbac->ijkabc", f.bb.ov, t1.bb, t3.abbabb) * 2.0
    t3new_babbab += np.einsum("ld,kd,ijlabc->ijkabc", f.bb.ov, t1.bb, t3.babbab) * -2.0
    t3new_babbab += np.einsum("ld,la,ijkcbd->ijkabc", f.bb.ov, t1.bb, t3.babbab) * 2.0
    t3new_babbab += np.einsum("ld,lc,ijkabd->ijkabc", f.bb.ov, t1.bb, t3.babbab) * -2.0
    t3new_babbab += np.einsum("ld,jida,lkbc->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_babbab += np.einsum("ld,jidc,lkba->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_babbab += np.einsum("ld,jkda,libc->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_babbab += np.einsum("ld,jkdc,liba->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_babbab += np.einsum("ld,jkbd,ilac->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_babbab += np.einsum("ld,jlbc,ikad->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_babbab += np.einsum("ld,jlba,ikcd->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_babbab += np.einsum("ld,jibd,klac->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_babbab += np.einsum("jd,lkbc,iald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("jd,lkba,icld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("jd,libc,kald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("jd,liba,kcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("lb,jkdc,iald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("lb,jkda,icld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("lb,jidc,kald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("lb,jida,kcld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("jd,ilac,klbd->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * -2.0
    t3new_babbab += np.einsum("jd,klac,ilbd->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * 2.0
    t3new_babbab += np.einsum("lb,imac,jlkm->ijkabc", t1.aa, t2.bbbb, v.aabb.oooo) * 2.0
    t3new_babbab += np.einsum("lb,kmac,imjl->ijkabc", t1.aa, t2.bbbb, v.bbaa.oooo) * -2.0
    t3new_babbab += np.einsum("lb,ikad,jlcd->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * -2.0
    t3new_babbab += np.einsum("lb,ikcd,jlad->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * 2.0
    t3new_babbab += np.einsum("jd,ikce,aebd->ijkabc", t1.aa, t2.bbbb, v.bbaa.vvvv) * -2.0
    t3new_babbab += np.einsum("jd,ikae,bdce->ijkabc", t1.aa, t2.bbbb, v.aabb.vvvv) * 2.0
    t3new_babbab += np.einsum("id,jlbc,klad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_babbab += np.einsum("id,jlba,klcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_babbab += np.einsum("id,lkbc,jlad->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_babbab += np.einsum("id,lkba,jlcd->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_babbab += np.einsum("kd,jlbc,ilad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_babbab += np.einsum("kd,jlba,ilcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_babbab += np.einsum("kd,libc,jlad->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_babbab += np.einsum("kd,liba,jlcd->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_babbab += np.einsum("la,jmbc,ilkm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_babbab += np.einsum("la,jmbc,imkl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_babbab += np.einsum("la,mkbc,iljm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo)
    t3new_babbab += np.einsum("la,mibc,jmkl->ijkabc", t1.bb, t2.abab, v.aabb.oooo) * -1.0
    t3new_babbab += np.einsum("lc,jmba,ilkm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_babbab += np.einsum("lc,jmba,imkl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_babbab += np.einsum("lc,mkba,iljm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo) * -1.0
    t3new_babbab += np.einsum("lc,miba,jmkl->ijkabc", t1.bb, t2.abab, v.aabb.oooo)
    t3new_babbab += np.einsum("la,jkbd,ilcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_babbab += np.einsum("la,jkdc,ilbd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_babbab += np.einsum("la,jibd,klcd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_babbab += np.einsum("la,jidc,klbd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_babbab += np.einsum("lc,jkbd,ilad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_babbab += np.einsum("lc,jkda,ilbd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_babbab += np.einsum("lc,jibd,klad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_babbab += np.einsum("lc,jida,klbd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_babbab += np.einsum("id,jlbc,kald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("id,jlba,kcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("kd,jlbc,iald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("kd,jlba,icld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("la,jkbd,icld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("la,jibd,kcld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("lc,jkbd,iald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("lc,jibd,kald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("id,jkbe,adce->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_babbab += np.einsum("id,jkec,adbe->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv)
    t3new_babbab += np.einsum("id,jkbe,aecd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_babbab += np.einsum("id,jkea,becd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv) * -1.0
    t3new_babbab += np.einsum("kd,jibe,adce->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_babbab += np.einsum("kd,jiec,adbe->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_babbab += np.einsum("kd,jibe,aecd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_babbab += np.einsum("kd,jiea,becd->ijkabc", t1.bb, t2.abab, v.aabb.vvvv)
    t3new_babbab += np.einsum("id,klac,jbld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_babbab += np.einsum("kd,ilac,jbld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_babbab += np.einsum("la,ikcd,jbld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_babbab += np.einsum("lc,ikad,jbld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_babbab += np.einsum("jd,lb,imac,kmld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_babbab += np.einsum("jd,lb,kmac,imld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_babbab += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_babbab += np.einsum("jd,lb,ikce,ldae->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_babbab += np.einsum("jd,la,mkbc,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_babbab += np.einsum("jd,la,mibc,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_babbab += np.einsum("jd,lc,mkba,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_babbab += np.einsum("jd,lc,miba,klmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_babbab += np.einsum("lb,ma,jkdc,imld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_babbab += np.einsum("lb,ma,jidc,kmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_babbab += np.einsum("lb,mc,jkda,imld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_babbab += np.einsum("lb,mc,jida,kmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_babbab += np.einsum("jd,ie,lkbc,ldae->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_babbab += np.einsum("jd,ie,lkba,ldce->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_babbab += np.einsum("jd,ke,libc,ldae->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_babbab += np.einsum("jd,ke,liba,ldce->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_babbab += np.einsum("lb,id,jkec,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_babbab += np.einsum("lb,id,jkea,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_babbab += np.einsum("lb,kd,jiec,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_babbab += np.einsum("lb,kd,jiea,lecd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_babbab += np.einsum("lb,id,kmac,jlmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_babbab += np.einsum("lb,kd,imac,jlmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_babbab += np.einsum("lb,ma,ikcd,jlmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_babbab += np.einsum("lb,mc,ikad,jlmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_babbab += np.einsum("jd,ie,klac,lebd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_babbab += np.einsum("jd,ke,ilac,lebd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_babbab += np.einsum("jd,la,ikce,lebd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_babbab += np.einsum("jd,lc,ikae,lebd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_babbab += np.einsum("id,la,jmbc,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("id,la,jmbc,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("id,la,mkbc,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_babbab += np.einsum("id,lc,jmba,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("id,lc,jmba,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("id,lc,mkba,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_babbab += np.einsum("kd,la,jmbc,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("kd,la,jmbc,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("kd,la,mibc,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_babbab += np.einsum("kd,lc,jmba,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("kd,lc,jmba,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("kd,lc,miba,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_babbab += np.einsum("la,mc,jkbd,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("la,mc,jkbd,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("la,mc,jibd,klmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_babbab += np.einsum("la,mc,jibd,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_babbab += np.einsum("id,ke,jlbc,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("id,ke,jlba,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("id,ke,jlbc,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("id,ke,jlba,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("id,la,jkbe,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("id,la,jkec,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_babbab += np.einsum("id,la,jkbe,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("id,lc,jkbe,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("id,lc,jkea,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_babbab += np.einsum("id,lc,jkbe,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("kd,la,jibe,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("kd,la,jiec,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_babbab += np.einsum("kd,la,jibe,lecd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("kd,lc,jibe,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_babbab += np.einsum("kd,lc,jiea,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_babbab += np.einsum("kd,lc,jibe,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_babbab += np.einsum("jd,lb,ie,kmac,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_babbab += np.einsum("jd,lb,ke,imac,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_babbab += np.einsum("jd,lb,ma,ikce,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_babbab += np.einsum("jd,lb,mc,ikae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_babbab += np.einsum("jd,ie,la,mkbc,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("jd,ie,lc,mkba,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("jd,ke,la,mibc,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_babbab += np.einsum("jd,ke,lc,miba,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_babbab += np.einsum("lb,id,ma,jkec,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_babbab += np.einsum("lb,id,mc,jkea,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_babbab += np.einsum("lb,kd,ma,jiec,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_babbab += np.einsum("lb,kd,mc,jiea,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_babbab += np.einsum("id,ke,la,jmbc,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("id,ke,la,jmbc,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("id,ke,lc,jmba,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("id,ke,lc,jmba,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("id,la,mc,jkbe,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_babbab += np.einsum("id,la,mc,jkbe,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("kd,la,mc,jibe,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_babbab += np.einsum("kd,la,mc,jibe,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)

    # T3 amplitudes
    t3new_bbabba = np.zeros((nocc[1], nocc[1], nocc[0], nvir[1], nvir[1], nvir[0]), dtype=np.float64)
    t3new_bbabba += np.einsum("il,jklacb->ijkabc", f.bb.oo, t3.babbab) * 2.0
    t3new_bbabba += np.einsum("jl,iklacb->ijkabc", f.bb.oo, t3.babbab) * -2.0
    t3new_bbabba += np.einsum("kl,ijlabc->ijkabc", f.aa.oo, t3.bbabba) * -2.0
    t3new_bbabba += np.einsum("ad,ijkbdc->ijkabc", f.bb.vv, t3.bbabba) * -2.0
    t3new_bbabba += np.einsum("bd,ijkadc->ijkabc", f.bb.vv, t3.bbabba) * 2.0
    t3new_bbabba += np.einsum("cd,ijkabd->ijkabc", f.aa.vv, t3.bbabba) * 2.0
    t3new_bbabba += np.einsum("klca,iljb->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("klcb,ilja->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("klca,jlib->ijkabc", t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("klcb,jlia->ijkabc", t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("lica,kljb->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_bbabba += np.einsum("licb,klja->ijkabc", t2.abab, v.aabb.ooov)
    t3new_bbabba += np.einsum("ljca,klib->ijkabc", t2.abab, v.aabb.ooov)
    t3new_bbabba += np.einsum("ljcb,klia->ijkabc", t2.abab, v.aabb.ooov) * -1.0
    t3new_bbabba += np.einsum("kjcd,iabd->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("kjdb,iacd->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_bbabba += np.einsum("kjcd,ibad->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("kjda,ibcd->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_bbabba += np.einsum("kicd,jabd->ijkabc", t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("kidb,jacd->ijkabc", t2.abab, v.bbaa.ovvv) * -1.0
    t3new_bbabba += np.einsum("kicd,jbad->ijkabc", t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("kida,jbcd->ijkabc", t2.abab, v.bbaa.ovvv)
    t3new_bbabba += np.einsum("ilab,jlkc->ijkabc", t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_bbabba += np.einsum("jlab,ilkc->ijkabc", t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_bbabba += np.einsum("ijad,kcbd->ijkabc", t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_bbabba += np.einsum("ijbd,kcad->ijkabc", t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_bbabba += np.einsum("ld,kd,ijlabc->ijkabc", f.aa.ov, t1.aa, t3.bbabba) * -2.0
    t3new_bbabba += np.einsum("ld,lc,ijkabd->ijkabc", f.aa.ov, t1.aa, t3.bbabba) * -2.0
    t3new_bbabba += np.einsum("ld,id,jklacb->ijkabc", f.bb.ov, t1.bb, t3.babbab) * 2.0
    t3new_bbabba += np.einsum("ld,jd,iklacb->ijkabc", f.bb.ov, t1.bb, t3.babbab) * -2.0
    t3new_bbabba += np.einsum("ld,la,ijkbdc->ijkabc", f.bb.ov, t1.bb, t3.bbabba) * 2.0
    t3new_bbabba += np.einsum("ld,lb,ijkadc->ijkabc", f.bb.ov, t1.bb, t3.bbabba) * -2.0
    t3new_bbabba += np.einsum("ld,kida,ljcb->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_bbabba += np.einsum("ld,kidb,ljca->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_bbabba += np.einsum("ld,kjda,licb->ijkabc", f.aa.ov, t2.abab, t2.abab)
    t3new_bbabba += np.einsum("ld,kjdb,lica->ijkabc", f.aa.ov, t2.abab, t2.abab) * -1.0
    t3new_bbabba += np.einsum("ld,kjcd,ilab->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_bbabba += np.einsum("ld,klcb,ijad->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * -2.0
    t3new_bbabba += np.einsum("ld,klca,ijbd->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_bbabba += np.einsum("ld,kicd,jlab->ijkabc", f.bb.ov, t2.abab, t2.bbbb) * 2.0
    t3new_bbabba += np.einsum("kd,ljcb,iald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("kd,ljca,ibld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("kd,licb,jald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("kd,lica,jbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("lc,kjdb,iald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("lc,kjda,ibld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("lc,kidb,jald->ijkabc", t1.aa, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("lc,kida,jbld->ijkabc", t1.aa, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("kd,ilab,jlcd->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * -2.0
    t3new_bbabba += np.einsum("kd,jlab,ilcd->ijkabc", t1.aa, t2.bbbb, v.bbaa.oovv) * 2.0
    t3new_bbabba += np.einsum("lc,imab,jmkl->ijkabc", t1.aa, t2.bbbb, v.bbaa.oooo) * 2.0
    t3new_bbabba += np.einsum("lc,jmab,imkl->ijkabc", t1.aa, t2.bbbb, v.bbaa.oooo) * -2.0
    t3new_bbabba += np.einsum("lc,ijad,klbd->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * -2.0
    t3new_bbabba += np.einsum("lc,ijbd,klad->ijkabc", t1.aa, t2.bbbb, v.aabb.oovv) * 2.0
    t3new_bbabba += np.einsum("kd,ijbe,aecd->ijkabc", t1.aa, t2.bbbb, v.bbaa.vvvv) * -2.0
    t3new_bbabba += np.einsum("kd,ijae,becd->ijkabc", t1.aa, t2.bbbb, v.bbaa.vvvv) * 2.0
    t3new_bbabba += np.einsum("id,klcb,jlad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_bbabba += np.einsum("id,klca,jlbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_bbabba += np.einsum("id,ljcb,klad->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_bbabba += np.einsum("id,ljca,klbd->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_bbabba += np.einsum("jd,klcb,ilad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_bbabba += np.einsum("jd,klca,ilbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_bbabba += np.einsum("jd,licb,klad->ijkabc", t1.bb, t2.abab, v.aabb.oovv)
    t3new_bbabba += np.einsum("jd,lica,klbd->ijkabc", t1.bb, t2.abab, v.aabb.oovv) * -1.0
    t3new_bbabba += np.einsum("la,kmcb,iljm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_bbabba += np.einsum("la,kmcb,imjl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_bbabba += np.einsum("la,mjcb,ilkm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo)
    t3new_bbabba += np.einsum("la,micb,jlkm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo) * -1.0
    t3new_bbabba += np.einsum("lb,kmca,iljm->ijkabc", t1.bb, t2.abab, v.bbbb.oooo) * -1.0
    t3new_bbabba += np.einsum("lb,kmca,imjl->ijkabc", t1.bb, t2.abab, v.bbbb.oooo)
    t3new_bbabba += np.einsum("lb,mjca,ilkm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo) * -1.0
    t3new_bbabba += np.einsum("lb,mica,jlkm->ijkabc", t1.bb, t2.abab, v.bbaa.oooo)
    t3new_bbabba += np.einsum("la,kjcd,ilbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_bbabba += np.einsum("la,kjdb,ilcd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_bbabba += np.einsum("la,kicd,jlbd->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_bbabba += np.einsum("la,kidb,jlcd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_bbabba += np.einsum("lb,kjcd,ilad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv)
    t3new_bbabba += np.einsum("lb,kjda,ilcd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv)
    t3new_bbabba += np.einsum("lb,kicd,jlad->ijkabc", t1.bb, t2.abab, v.bbbb.oovv) * -1.0
    t3new_bbabba += np.einsum("lb,kida,jlcd->ijkabc", t1.bb, t2.abab, v.bbaa.oovv) * -1.0
    t3new_bbabba += np.einsum("id,klcb,jald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("id,klca,jbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("jd,klcb,iald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("jd,klca,ibld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("la,kjcd,ibld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("la,kicd,jbld->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("lb,kjcd,iald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("lb,kicd,jald->ijkabc", t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("id,kjce,adbe->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_bbabba += np.einsum("id,kjeb,adce->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv)
    t3new_bbabba += np.einsum("id,kjce,aebd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_bbabba += np.einsum("id,kjea,bdce->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_bbabba += np.einsum("jd,kice,adbe->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv) * -1.0
    t3new_bbabba += np.einsum("jd,kieb,adce->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv) * -1.0
    t3new_bbabba += np.einsum("jd,kice,aebd->ijkabc", t1.bb, t2.abab, v.bbbb.vvvv)
    t3new_bbabba += np.einsum("jd,kiea,bdce->ijkabc", t1.bb, t2.abab, v.bbaa.vvvv)
    t3new_bbabba += np.einsum("id,jlab,kcld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_bbabba += np.einsum("jd,ilab,kcld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_bbabba += np.einsum("la,ijbd,kcld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_bbabba += np.einsum("lb,ijad,kcld->ijkabc", t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_bbabba += np.einsum("kd,lc,imab,jmld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * 2.0
    t3new_bbabba += np.einsum("kd,lc,jmab,imld->ijkabc", t1.aa, t1.aa, t2.bbbb, v.bbaa.ooov) * -2.0
    t3new_bbabba += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * -2.0
    t3new_bbabba += np.einsum("kd,lc,ijbe,ldae->ijkabc", t1.aa, t1.aa, t2.bbbb, v.aabb.ovvv) * 2.0
    t3new_bbabba += np.einsum("kd,la,mjcb,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_bbabba += np.einsum("kd,la,micb,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_bbabba += np.einsum("kd,lb,mjca,ilmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_bbabba += np.einsum("kd,lb,mica,jlmd->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_bbabba += np.einsum("lc,ma,kjdb,imld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_bbabba += np.einsum("lc,ma,kidb,jmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_bbabba += np.einsum("lc,mb,kjda,imld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov) * -1.0
    t3new_bbabba += np.einsum("lc,mb,kida,jmld->ijkabc", t1.aa, t1.bb, t2.abab, v.bbaa.ooov)
    t3new_bbabba += np.einsum("kd,ie,ljcb,ldae->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_bbabba += np.einsum("kd,ie,ljca,ldbe->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_bbabba += np.einsum("kd,je,licb,ldae->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_bbabba += np.einsum("kd,je,lica,ldbe->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_bbabba += np.einsum("lc,id,kjeb,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_bbabba += np.einsum("lc,id,kjea,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_bbabba += np.einsum("lc,jd,kieb,lead->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv)
    t3new_bbabba += np.einsum("lc,jd,kiea,lebd->ijkabc", t1.aa, t1.bb, t2.abab, v.aabb.ovvv) * -1.0
    t3new_bbabba += np.einsum("lc,id,jmab,klmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_bbabba += np.einsum("lc,jd,imab,klmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_bbabba += np.einsum("lc,ma,ijbd,klmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * -2.0
    t3new_bbabba += np.einsum("lc,mb,ijad,klmd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.aabb.ooov) * 2.0
    t3new_bbabba += np.einsum("kd,ie,jlab,lecd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_bbabba += np.einsum("kd,je,ilab,lecd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_bbabba += np.einsum("kd,la,ijbe,lecd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * 2.0
    t3new_bbabba += np.einsum("kd,lb,ijae,lecd->ijkabc", t1.aa, t1.bb, t2.bbbb, v.bbaa.ovvv) * -2.0
    t3new_bbabba += np.einsum("id,la,kmcb,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("id,la,kmcb,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("id,la,mjcb,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_bbabba += np.einsum("id,lb,kmca,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("id,lb,kmca,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("id,lb,mjca,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_bbabba += np.einsum("jd,la,kmcb,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("jd,la,kmcb,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("jd,la,micb,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov) * -1.0
    t3new_bbabba += np.einsum("jd,lb,kmca,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("jd,lb,kmca,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("jd,lb,mica,kmld->ijkabc", t1.bb, t1.bb, t2.abab, v.aabb.ooov)
    t3new_bbabba += np.einsum("la,mb,kjcd,ilmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("la,mb,kjcd,imld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("la,mb,kicd,jlmd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov) * -1.0
    t3new_bbabba += np.einsum("la,mb,kicd,jmld->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ooov)
    t3new_bbabba += np.einsum("id,je,klcb,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("id,je,klca,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("id,je,klcb,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("id,je,klca,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("id,la,kjce,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("id,la,kjeb,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_bbabba += np.einsum("id,la,kjce,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("id,lb,kjce,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("id,lb,kjea,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_bbabba += np.einsum("id,lb,kjce,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("jd,la,kice,ldbe->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("jd,la,kieb,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv)
    t3new_bbabba += np.einsum("jd,la,kice,lebd->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("jd,lb,kice,ldae->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv) * -1.0
    t3new_bbabba += np.einsum("jd,lb,kiea,ldce->ijkabc", t1.bb, t1.bb, t2.abab, v.bbaa.ovvv) * -1.0
    t3new_bbabba += np.einsum("jd,lb,kice,lead->ijkabc", t1.bb, t1.bb, t2.abab, v.bbbb.ovvv)
    t3new_bbabba += np.einsum("kd,lc,ie,jmab,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_bbabba += np.einsum("kd,lc,je,imab,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_bbabba += np.einsum("kd,lc,ma,ijbe,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * -2.0
    t3new_bbabba += np.einsum("kd,lc,mb,ijae,ldme->ijkabc", t1.aa, t1.aa, t1.bb, t2.bbbb, v.aabb.ovov) * 2.0
    t3new_bbabba += np.einsum("kd,ie,la,mjcb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("kd,ie,lb,mjca,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("kd,je,la,micb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov) * -1.0
    t3new_bbabba += np.einsum("kd,je,lb,mica,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.bbaa.ovov)
    t3new_bbabba += np.einsum("lc,id,ma,kjeb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_bbabba += np.einsum("lc,id,mb,kjea,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_bbabba += np.einsum("lc,jd,ma,kieb,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov) * -1.0
    t3new_bbabba += np.einsum("lc,jd,mb,kiea,lemd->ijkabc", t1.aa, t1.bb, t1.bb, t2.abab, v.aabb.ovov)
    t3new_bbabba += np.einsum("id,je,la,kmcb,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("id,je,la,kmcb,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("id,je,lb,kmca,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("id,je,lb,kmca,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("id,la,mb,kjce,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)
    t3new_bbabba += np.einsum("id,la,mb,kjce,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("jd,la,mb,kice,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov) * -1.0
    t3new_bbabba += np.einsum("jd,la,mb,kice,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.abab, v.bbbb.ovov)

    # T3 amplitudes
    t3new_bbbbbb = np.zeros((nocc[1], nocc[1], nocc[1], nvir[1], nvir[1], nvir[1]), dtype=np.float64)
    t3new_bbbbbb += np.einsum("il,jklabc->ijkabc", f.bb.oo, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("jl,iklabc->ijkabc", f.bb.oo, t3.bbbbbb) * 6.0
    t3new_bbbbbb += np.einsum("kl,ijlabc->ijkabc", f.bb.oo, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("ad,ijkbcd->ijkabc", f.bb.vv, t3.bbbbbb) * 6.0
    t3new_bbbbbb += np.einsum("bd,ijkacd->ijkabc", f.bb.vv, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("cd,ijkabd->ijkabc", f.bb.vv, t3.bbbbbb) * 6.0
    t3new_bbbbbb += np.einsum("ilab,jlkc->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("ilac,jlkb->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("ilbc,jlka->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("ilab,kljc->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("ilac,kljb->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("ilbc,klja->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jlab,ilkc->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jlac,ilkb->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jlbc,ilka->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jlab,klic->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jlac,klib->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jlbc,klia->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("klab,iljc->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("klac,iljb->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("klbc,ilja->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("klab,jlic->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("klac,jlib->ijkabc", t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("klbc,jlia->ijkabc", t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("ikbd,jacd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ikcd,jabd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ikad,jbcd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ikcd,jbad->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ikad,jcbd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ikbd,jcad->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ijbd,kacd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ijcd,kabd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ijad,kbcd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ijcd,kbad->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ijad,kcbd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("ijbd,kcad->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jkbd,iacd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jkcd,iabd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jkad,ibcd->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jkcd,ibad->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jkad,icbd->ijkabc", t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jkbd,icad->ijkabc", t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("ld,id,jklabc->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("ld,jd,iklabc->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * 6.0
    t3new_bbbbbb += np.einsum("ld,kd,ijlabc->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("ld,la,ijkbcd->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("ld,lb,ijkacd->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * 6.0
    t3new_bbbbbb += np.einsum("ld,lc,ijkabd->ijkabc", f.bb.ov, t1.bb, t3.bbbbbb) * -6.0
    t3new_bbbbbb += np.einsum("ld,ikad,jlbc->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * -4.0
    t3new_bbbbbb += np.einsum("ld,ikbd,jlac->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * 4.0
    t3new_bbbbbb += np.einsum("ld,ikcd,jlab->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * -4.0
    t3new_bbbbbb += np.einsum("ld,ilac,jkbd->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * -4.0
    t3new_bbbbbb += np.einsum("ld,ilab,jkcd->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * 4.0
    t3new_bbbbbb += np.einsum("ld,ilbc,jkad->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * 4.0
    t3new_bbbbbb += np.einsum("ld,ijad,klbc->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * 4.0
    t3new_bbbbbb += np.einsum("ld,ijbd,klac->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * -4.0
    t3new_bbbbbb += np.einsum("ld,ijcd,klab->ijkabc", f.bb.ov, t2.bbbb, t2.bbbb) * 4.0
    t3new_bbbbbb += np.einsum("id,jlac,klbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("id,jlab,klcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("id,jlbc,klad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("id,klac,jlbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("id,klab,jlcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("id,klbc,jlad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ilac,klbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ilab,klcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ilbc,klad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("jd,klac,ilbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("jd,klab,ilcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("jd,klbc,ilad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ilac,jlbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("kd,ilab,jlcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ilbc,jlad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("kd,jlac,ilbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("kd,jlab,ilcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("kd,jlbc,ilad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("la,imbc,jlkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("la,imbc,jmkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("la,jmbc,ilkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("la,jmbc,imkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("la,kmbc,iljm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("la,kmbc,imjl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lb,imac,jlkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lb,imac,jmkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lb,jmac,ilkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lb,jmac,imkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lb,kmac,iljm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lb,kmac,imjl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lc,imab,jlkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lc,imab,jmkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lc,jmab,ilkm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("lc,jmab,imkl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lc,kmab,iljm->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * -2.0
    t3new_bbbbbb += np.einsum("lc,kmab,imjl->ijkabc", t1.bb, t2.bbbb, v.bbbb.oooo) * 2.0
    t3new_bbbbbb += np.einsum("la,ikbd,jlcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("la,ikcd,jlbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("la,ijbd,klcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("la,ijcd,klbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("la,jkbd,ilcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("la,jkcd,ilbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lb,ikad,jlcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lb,ikcd,jlad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lb,ijad,klcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lb,ijcd,klad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lb,jkad,ilcd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lb,jkcd,ilad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lc,ikad,jlbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lc,ikbd,jlad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lc,ijad,klbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lc,ijbd,klad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("lc,jkad,ilbd->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * -2.0
    t3new_bbbbbb += np.einsum("lc,jkbd,ilad->ijkabc", t1.bb, t2.bbbb, v.bbbb.oovv) * 2.0
    t3new_bbbbbb += np.einsum("id,jlbc,kald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,jlac,kbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,jlab,kcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,klbc,jald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,klac,jbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,klab,jcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,ilbc,kald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,ilac,kbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,ilab,kcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,klbc,iald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,klac,ibld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,klab,icld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,ilbc,jald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,ilac,jbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,ilab,jcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,jlbc,iald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,jlac,ibld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,jlab,icld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("la,ikcd,jbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("la,ikbd,jcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("la,ijcd,kbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("la,ijbd,kcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("la,jkcd,ibld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("la,jkbd,icld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lb,ikcd,jald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lb,ikad,jcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lb,ijcd,kald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lb,ijad,kcld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lb,jkcd,iald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lb,jkad,icld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lc,ikbd,jald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lc,ikad,jbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lc,ijbd,kald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lc,ijad,kbld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("lc,jkbd,iald->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("lc,jkad,ibld->ijkabc", t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,jkbe,adce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("id,jkce,adbe->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("id,jkbe,aecd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("id,jkce,aebd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("id,jkae,bdce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("id,jkae,becd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ikbe,adce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ikce,adbe->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ikbe,aecd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ikce,aebd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ikae,bdce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ikae,becd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ijbe,adce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,ijce,adbe->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ijbe,aecd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ijce,aebd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,ijae,bdce->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,ijae,becd->ijkabc", t1.bb, t2.bbbb, v.bbbb.vvvv) * 2.0
    t3new_bbbbbb += np.einsum("id,la,jmbc,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("id,la,jmbc,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,la,kmbc,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,la,kmbc,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,jmac,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,lb,jmac,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,kmac,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,kmac,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,jmab,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("id,lc,jmab,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,kmab,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,kmab,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,imbc,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jd,la,imbc,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,kmbc,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,kmbc,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,imac,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,lb,imac,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,kmac,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,kmac,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,imab,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lc,imab,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,kmab,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,kmab,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,imbc,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("kd,la,imbc,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,jmbc,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,jmbc,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,imac,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,lb,imac,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,jmac,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,jmac,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,imab,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lc,imab,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,jmab,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,jmab,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mb,ikcd,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mb,ikcd,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mb,ijcd,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mb,ijcd,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mb,jkcd,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mb,jkcd,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mc,ikbd,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mc,ikbd,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mc,ijbd,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mc,ijbd,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("la,mc,jkbd,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("la,mc,jkbd,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("lb,mc,ikad,jlmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("lb,mc,ikad,jmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("lb,mc,ijad,klmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("lb,mc,ijad,kmld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("lb,mc,jkad,ilmd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * -2.0
    t3new_bbbbbb += np.einsum("lb,mc,jkad,imld->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ooov) * 2.0
    t3new_bbbbbb += np.einsum("id,je,klac,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,je,klab,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,je,klbc,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,je,klac,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,je,klab,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,je,klbc,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,jlac,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,ke,jlab,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,jlbc,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,jlac,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,jlab,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,ke,jlbc,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,la,jkbe,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,la,jkce,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,la,jkbe,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,la,jkce,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,jkae,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,lb,jkce,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,jkae,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,jkce,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,jkae,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,lc,jkbe,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,jkae,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("id,lc,jkbe,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilac,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilab,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilbc,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilac,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilab,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,ke,ilbc,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,la,ikbe,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,la,ikce,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,ikbe,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,ikce,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,ikae,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,lb,ikce,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,ikae,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,ikce,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,ikae,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("jd,lc,ikbe,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,ikae,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("jd,lc,ikbe,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,ijbe,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,la,ijce,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,ijbe,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,ijce,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,ijae,ldce->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,lb,ijce,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,ijae,lecd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,ijce,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,ijae,ldbe->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("kd,lc,ijbe,ldae->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,ijae,lebd->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * 2.0
    t3new_bbbbbb += np.einsum("kd,lc,ijbe,lead->ijkabc", t1.bb, t1.bb, t2.bbbb, v.bbbb.ovvv) * -2.0
    t3new_bbbbbb += np.einsum("id,je,la,kmbc,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,je,la,kmbc,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,je,lb,kmac,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,je,lb,kmac,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,je,lc,kmab,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,je,lc,kmab,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,la,jmbc,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,la,jmbc,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,ke,lb,jmac,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,ke,lb,jmac,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,lc,jmab,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,ke,lc,jmab,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,la,mb,jkce,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,la,mb,jkce,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,la,mc,jkbe,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("id,la,mc,jkbe,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,mc,jkae,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("id,lb,mc,jkae,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,ke,la,imbc,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,la,imbc,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,ke,lb,imac,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,ke,lb,imac,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,lc,imab,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,ke,lc,imab,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,la,mb,ikce,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,la,mb,ikce,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,mc,ikbe,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("jd,la,mc,ikbe,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,mc,ikae,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("jd,lb,mc,ikae,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,la,mb,ijce,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,la,mb,ijce,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,mc,ijbe,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0
    t3new_bbbbbb += np.einsum("kd,la,mc,ijbe,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,mc,ijae,ldme->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * -2.0
    t3new_bbbbbb += np.einsum("kd,lb,mc,ijae,lemd->ijkabc", t1.bb, t1.bb, t1.bb, t2.bbbb, v.bbbb.ovov) * 2.0

    t1new.aa = t1new_aa
    t1new.bb = t1new_bb
    t2new.aaaa = t2new_aaaa
    t2new.abab = t2new_abab
    t2new.baba = t2new_baba
    t2new.bbbb = t2new_bbbb
    t3new.aaaaaa = t3new_aaaaaa
    t3new.aabaab = t3new_aabaab
    t3new.abaaba = t3new_abaaba
    t3new.baabaa = t3new_baabaa
    t3new.abbabb = t3new_abbabb
    t3new.babbab = t3new_babbab
    t3new.bbabba = t3new_bbabba
    t3new.bbbbbb = t3new_bbbbbb

    return {"t1new": t1new, "t2new": t2new, "t3new": t3new}

